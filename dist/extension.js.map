{
  "version": 3,
  "sources": ["../src/types/shared.ts", "../src/extension/api/BaseAdapter.ts", "../src/extension/api/OpenAIAdapter.ts", "../src/extension/api/DeepSeekAdapter.ts", "../src/extension/api/AnthropicAdapter.ts", "../src/extension/api/OtherAdapters.ts", "../src/extension/api/ChatService.ts", "../src/extension/test-generator/TestGenerator.ts", "../src/extension/mcp/types.ts", "../src/extension/mcp/builtins.ts", "../src/extension/mcp/additionalBuiltins.ts", "../src/extension/mcp/MCPRegistry.ts", "../src/extension/mcp/MCPExecutor.ts", "../src/extension/mcp/MCPAgent.ts", "../src/extension/mcp/AutonomousAgent.ts", "../src/extension/mcp/MCPParser.ts", "../src/extension/mcp/MCPPanelProvider.ts", "../src/extension/mcp/index.ts", "../src/extension.ts", "../src/extension/chatview/ChatViewProvider.ts", "../src/extension/ConfigManager.ts", "../src/extension/session/SessionManager.ts", "../src/extension/commands/CommandParser.ts", "../src/extension/diagram/DiagramGenerator.ts", "../src/extension/services/AutoFixService.ts", "../src/extension/analyzer/EnhancedProjectAnalyzer.ts", "../src/extension/commands/SmartInputParser.ts", "../src/extension/chatview/utils/TaskStateManager.ts", "../src/extension/chatview/handlers/SessionHandler.ts", "../src/extension/chatview/handlers/ChatMessageHandler.ts", "../src/extension/i18n/I18nManager.ts", "../src/extension/memory/MemoryManager.ts", "../src/extension/agent/IntentClassifier.ts", "../src/extension/chatview/handlers/DiagramHandler.ts", "../src/extension/chatview/handlers/TestHandler.ts", "../src/extension/chatview/handlers/CommandHandler.ts", "../src/extension/chatview/handlers/ConfigHandler.ts", "../src/extension/chatview/handlers/MCPHandler.ts", "../src/extension/skills/package/SkillManager.ts", "../src/extension/skills/package/SkillLoader.ts", "../src/extension/skills/package/SkillExecutor.ts", "../src/extension/skills/package/SkillMCPBridge.ts", "../src/extension/code-editor/SmartCodeEditor.ts", "../src/extension/code-editor/CodeApplier.ts", "../src/extension/services/NewFeaturesService.ts"],
  "sourcesContent": ["// ============================================\n// \u6D88\u606F\u76F8\u5173\u7C7B\u578B\n// ============================================\n\nexport interface Attachment {\n  id: string;\n  type: 'image' | 'voice' | 'file';\n  name: string;\n  data: string; // base64 for image/voice, path for file\n  mimeType?: string;\n  size?: number;\n  duration?: number; // for voice\n}\n\nexport interface Message {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: number;\n  isStreaming?: boolean;\n  attachments?: Attachment[];\n  metadata?: {\n    tokens?: number;\n    model?: string;\n    duration?: number;\n  };\n}\n\n// ============================================\n// \u4F1A\u8BDD\u7BA1\u7406\u7C7B\u578B\n// ============================================\n\nexport interface Session {\n  id: string;\n  title: string;\n  messages: Message[];\n  createdAt: number;\n  updatedAt: number;\n  metadata?: {\n    provider?: Provider;\n    model?: string;\n    projectPath?: string;\n    summary?: string; // \u538B\u7F29\u540E\u7684\u6458\u8981\n    totalTokens?: number;\n  };\n}\n\nexport interface SessionSummary {\n  id: string;\n  title: string;\n  preview: string;\n  messageCount: number;\n  createdAt: number;\n  updatedAt: number;\n}\n\n// ============================================\n// \u6A21\u578B\u76F8\u5173\u7C7B\u578B\n// ============================================\n\nexport type Provider = 'deepseek' | 'openai' | 'anthropic' | 'kimi' | 'openrouter';\n\nexport interface AIModel {\n  id: string;\n  name: string;\n  provider: Provider;\n  maxTokens: number;\n  supportStream: boolean;\n  supportVision?: boolean;\n  description?: string;\n}\n\nexport interface ModelConfig {\n  provider: Provider;\n  model: string;\n  apiKey?: string;\n  temperature: number;\n  maxTokens: number;\n}\n\n// ============================================\n// API \u8BF7\u6C42/\u54CD\u5E94\u7C7B\u578B\n// ============================================\n\nexport interface ChatRequest {\n  model: string;\n  messages: Array<{\n    role: string;\n    content: string | Array<{\n      type: 'text' | 'image_url';\n      text?: string;\n      image_url?: { url: string };\n    }>;\n  }>;\n  stream?: boolean;\n  temperature?: number;\n  max_tokens?: number;\n}\n\nexport interface ChatResponse {\n  id: string;\n  model: string;\n  choices: Array<{\n    message?: {\n      role: string;\n      content: string;\n    };\n    delta?: {\n      content?: string;\n    };\n    finish_reason?: string;\n  }>;\n}\n\n// ============================================\n// \u6D41\u7A0B\u56FE\u76F8\u5173\u7C7B\u578B\n// ============================================\n\nexport type DiagramFormat = 'mermaid' | 'plantuml' | 'd2';\nexport type DiagramType = 'flowchart' | 'sequence' | 'class' | 'state' | 'er' | 'gantt' | 'pie' | 'mindmap' | 'architecture';\n\nexport interface Diagram {\n  id: string;\n  title: string;\n  type: DiagramType;\n  format: DiagramFormat;\n  code: string;\n  createdAt: number;\n  updatedAt: number;\n  sessionId?: string;\n}\n\n// ============================================\n// \u6D4B\u8BD5\u751F\u6210\u76F8\u5173\u7C7B\u578B\n// ============================================\n\nexport type TestFramework = 'jest' | 'vitest' | 'mocha' | 'pytest' | 'junit' | 'go';\n\nexport interface GeneratedTest {\n  id: string;\n  sourceFile: string;\n  testFile: string;\n  framework: TestFramework;\n  code: string;\n  createdAt: number;\n}\n\n// \u6D4B\u8BD5\u5386\u53F2\u8BB0\u5F55\nexport interface TestHistoryItem {\n  code: string;\n  path: string;\n  framework: string;\n  sourceFile: string;\n  timestamp: number;\n  id?: string;\n  customName?: string;\n}\n\n// \u56FE\u8868\u5386\u53F2\u8BB0\u5F55\uFF08\u6269\u5C55 Diagram\uFF09\nexport interface DiagramHistoryItem extends Diagram {\n  sessionId?: string;\n}\n\n// ============================================\n// \u659C\u6760\u547D\u4EE4\u76F8\u5173\u7C7B\u578B\n// ============================================\n\nexport interface SlashCommand {\n  name: string;\n  description: string;\n  usage: string;\n  aliases?: string[];\n  args?: {\n    name: string;\n    required: boolean;\n    description: string;\n  }[];\n}\n\nexport const SLASH_COMMANDS: SlashCommand[] = [\n  {\n    name: 'clear',\n    description: '\u6E05\u9664\u5F53\u524D\u5BF9\u8BDD\u4E0A\u4E0B\u6587',\n    usage: '/clear',\n    aliases: ['c'],\n  },\n  {\n    name: 'compact',\n    description: '\u538B\u7F29\u5BF9\u8BDD\u5386\u53F2\uFF0C\u4FDD\u7559\u6458\u8981',\n    usage: '/compact',\n    aliases: ['k'],\n  },\n  {\n    name: 'resume',\n    description: '\u5207\u6362\u5230\u5176\u4ED6\u5386\u53F2\u4F1A\u8BDD',\n    usage: '/resume [session_id]',\n    aliases: ['r'],\n    args: [{ name: 'session_id', required: false, description: '\u4F1A\u8BDDID\uFF08\u53EF\u9009\uFF09' }],\n  },\n  {\n    name: 'init',\n    description: '\u521D\u59CB\u5316\u9879\u76EE\u7406\u89E3',\n    usage: '/init',\n    aliases: ['i'],\n  },\n  {\n    name: 'file',\n    description: '\u8BFB\u53D6\u5E76\u8BA8\u8BBA\u6587\u4EF6',\n    usage: '/file <path>',\n    args: [{ name: 'path', required: true, description: '\u6587\u4EF6\u8DEF\u5F84' }],\n  },\n  {\n    name: 'search',\n    description: '\u641C\u7D22\u9879\u76EE\u4EE3\u7801',\n    usage: '/search <query>',\n    aliases: ['s'],\n    args: [{ name: 'query', required: true, description: '\u641C\u7D22\u5173\u952E\u8BCD' }],\n  },\n  {\n    name: 'run',\n    description: '\u6267\u884C\u7EC8\u7AEF\u547D\u4EE4',\n    usage: '/run <command>',\n    aliases: ['!'],\n    args: [{ name: 'command', required: true, description: '\u8981\u6267\u884C\u7684\u547D\u4EE4' }],\n  },\n  {\n    name: 'build',\n    description: '\u6784\u5EFA\u9879\u76EE',\n    usage: '/build',\n    aliases: ['b'],\n  },\n  {\n    name: 'test',\n    description: '\u8FD0\u884C\u6D4B\u8BD5',\n    usage: '/test [file]',\n    aliases: ['t'],\n    args: [{ name: 'file', required: false, description: '\u6D4B\u8BD5\u6587\u4EF6\uFF08\u53EF\u9009\uFF09' }],\n  },\n  {\n    name: 'git',\n    description: 'Git \u64CD\u4F5C',\n    usage: '/git <command>',\n    aliases: ['g'],\n    args: [{ name: 'command', required: true, description: 'git \u547D\u4EE4' }],\n  },\n  // Git \u5FEB\u6377\u547D\u4EE4\n  {\n    name: 'gst',\n    description: 'Git status - \u67E5\u770B\u72B6\u6001',\n    usage: '/gst',\n    aliases: [],\n  },\n  {\n    name: 'gpl',\n    description: 'Git pull - \u62C9\u53D6\u4EE3\u7801',\n    usage: '/gpl',\n    aliases: [],\n  },\n  {\n    name: 'gps',\n    description: 'Git push - \u63A8\u9001\u4EE3\u7801',\n    usage: '/gps',\n    aliases: [],\n  },\n  {\n    name: 'gco',\n    description: 'Git checkout - \u5207\u6362\u5206\u652F',\n    usage: '/gco <branch>',\n    aliases: [],\n    args: [{ name: 'branch', required: true, description: '\u5206\u652F\u540D' }],\n  },\n  {\n    name: 'gcm',\n    description: 'Git commit - \u63D0\u4EA4\u4EE3\u7801',\n    usage: '/gcm <message>',\n    aliases: [],\n    args: [{ name: 'message', required: true, description: '\u63D0\u4EA4\u4FE1\u606F' }],\n  },\n  {\n    name: 'gdf',\n    description: 'Git diff - \u67E5\u770B\u5DEE\u5F02',\n    usage: '/gdf [file]',\n    aliases: [],\n    args: [{ name: 'file', required: false, description: '\u6587\u4EF6\u8DEF\u5F84\uFF08\u53EF\u9009\uFF09' }],\n  },\n  {\n    name: 'glg',\n    description: 'Git log - \u67E5\u770B\u65E5\u5FD7',\n    usage: '/glg',\n    aliases: [],\n  },\n  {\n    name: 'diagram',\n    description: '\u751F\u6210\u6D41\u7A0B\u56FE',\n    usage: '/diagram <type> [description]',\n    aliases: ['d'],\n    args: [\n      { name: 'type', required: true, description: '\u56FE\u8868\u7C7B\u578B: flowchart, sequence, class, state, er, architecture' },\n      { name: 'description', required: false, description: '\u56FE\u8868\u63CF\u8FF0' },\n    ],\n  },\n  {\n    name: 'gentest',\n    description: '\u4E3A\u6587\u4EF6\u751F\u6210\u6D4B\u8BD5',\n    usage: '/gentest [file]',\n    aliases: ['gt'],\n    args: [{ name: 'file', required: false, description: '\u6E90\u6587\u4EF6\u8DEF\u5F84\uFF08\u9ED8\u8BA4\u5F53\u524D\u6587\u4EF6\uFF09' }],\n  },\n  {\n    name: 'help',\n    description: '\u663E\u793A\u5E2E\u52A9\u4FE1\u606F',\n    usage: '/help [command]',\n    aliases: ['h', '?'],\n    args: [{ name: 'command', required: false, description: '\u547D\u4EE4\u540D\u79F0' }],\n  },\n];\n\n// ============================================\n// \u5FEB\u6377\u952E\u76F8\u5173\n// ============================================\n\nexport const KEYBOARD_SHORTCUTS = {\n  SHOW_COMMANDS: '/',\n  HISTORY_UP: 'ArrowUp',\n  HISTORY_DOWN: 'ArrowDown',\n  AUTOCOMPLETE: 'Tab',\n  NEWLINE: 'Alt+Enter',\n  CANCEL: 'Escape',\n  SUBMIT: 'Enter',\n  COPY: 'Ctrl+C',\n} as const;\n\n// ============================================\n// Webview \u6D88\u606F\u7C7B\u578B\n// ============================================\n\n// Extension -> Webview \u6D88\u606F\nexport type ExtensionToWebviewMessage =\n  | { type: 'streamChunk'; content: string; messageId: string }\n  | { type: 'streamComplete'; messageId: string }\n  | { type: 'response'; message: Message }\n  | { type: 'error'; error: string }\n  | { type: 'configUpdate'; config: ModelConfig }\n  | { type: 'modelsUpdate'; models: AIModel[] }\n  | { type: 'clearChat' }\n  | { type: 'themeChanged'; theme: 'light' | 'dark' }\n  | { type: 'codeAction'; action: CodeActionType; code: string; language?: string }\n  | { type: 'taskStatus'; status: TaskStatus | null }\n  | { type: 'sessionLoaded'; session: Session }\n  | { type: 'sessionList'; sessions: SessionSummary[] }\n  | { type: 'diagramGenerated'; diagram: Diagram }\n  | { type: 'diagramList'; diagrams: Diagram[] }\n  | { type: 'testGenerated'; test: GeneratedTest }\n  | { type: 'commandSuggestions'; suggestions: SlashCommand[] }\n  | { type: 'commandResult'; command: string; result: string; success: boolean }\n  | { type: 'voiceConfig'; enabled: boolean; language: string }\n  | { type: 'messageHistory'; messages: string[] }\n  | { type: 'inputHint'; hint: string; possibleCommand?: string }\n  | { type: 'diagramAutoFixed'; code: string; explanation?: string }\n  | { type: 'testAutoFixed'; code: string; explanation?: string };\n\n// \u4EFB\u52A1\u72B6\u6001\nexport interface TaskStatus {\n  type: 'chat' | 'codeAction' | 'command' | 'diagram' | 'test';\n  actionType?: CodeActionType;\n  label: string;\n  progress?: number;\n}\n\n// Webview -> Extension \u6D88\u606F\nexport type WebviewToExtensionMessage =\n  | { type: 'sendMessage'; content: string; attachments?: Attachment[] }\n  | { type: 'cancelRequest' }\n  | { type: 'getConfig' }\n  | { type: 'updateConfig'; config: Partial<ModelConfig> }\n  | { type: 'setApiKey'; provider: Provider; apiKey: string }\n  | { type: 'getModels' }\n  | { type: 'switchModel'; provider: Provider; model: string }\n  | { type: 'openExternal'; url: string }\n  | { type: 'insertCode'; code: string }\n  | { type: 'copyToClipboard'; text: string }\n  | { type: 'retryMessage'; messageId: string }\n  | { type: 'regenerateResponse' }\n  | { type: 'executeCommand'; command: string; args?: string[] }\n  | { type: 'loadSession'; sessionId: string }\n  | { type: 'getSessions' }\n  | { type: 'deleteSession'; sessionId: string }\n  | { type: 'compactContext' }\n  | { type: 'generateDiagram'; diagramType: DiagramType; description?: string }\n  | { type: 'updateDiagram'; diagramId: string; code: string }\n  | { type: 'exportDiagram'; diagramId: string; format: 'svg' | 'png' | 'md' }\n  | { type: 'generateTest'; filePath?: string }\n  | { type: 'saveTest'; test: GeneratedTest }\n  | { type: 'runTest'; testFile: string }\n  | { type: 'getMessageHistory' }\n  | { type: 'voiceInput'; audio: string; mimeType: string }\n  | { type: 'getVoiceConfig' };\n\n// \u4EE3\u7801\u64CD\u4F5C\u7C7B\u578B\nexport type CodeActionType = 'explain' | 'fix' | 'optimize' | 'addComments' | 'generateTests' | 'review';\n\nexport const CODE_ACTIONS: { type: CodeActionType; label: string; icon: string; prompt: string }[] = [\n  { \n    type: 'explain', \n    label: '\u89E3\u91CA\u4EE3\u7801', \n    icon: '\uD83D\uDCA1',\n    prompt: '\u8BF7\u8BE6\u7EC6\u89E3\u91CA\u4EE5\u4E0B\u4EE3\u7801\u7684\u529F\u80FD\u3001\u903B\u8F91\u548C\u5DE5\u4F5C\u539F\u7406\uFF1A\\n\\n```{language}\\n{code}\\n```'\n  },\n  { \n    type: 'fix', \n    label: '\u4FEE\u590D\u4EE3\u7801', \n    icon: '\uD83D\uDD27',\n    prompt: '\u8BF7\u68C0\u67E5\u4EE5\u4E0B\u4EE3\u7801\u4E2D\u53EF\u80FD\u5B58\u5728\u7684bug\u6216\u95EE\u9898\uFF0C\u5E76\u63D0\u4F9B\u4FEE\u590D\u540E\u7684\u4EE3\u7801\uFF1A\\n\\n```{language}\\n{code}\\n```'\n  },\n  { \n    type: 'optimize', \n    label: '\u4F18\u5316\u4EE3\u7801', \n    icon: '\u26A1',\n    prompt: '\u8BF7\u4F18\u5316\u4EE5\u4E0B\u4EE3\u7801\u7684\u6027\u80FD\u3001\u53EF\u8BFB\u6027\u548C\u6700\u4F73\u5B9E\u8DF5\uFF0C\u5E76\u89E3\u91CA\u4F18\u5316\u70B9\uFF1A\\n\\n```{language}\\n{code}\\n```'\n  },\n  { \n    type: 'addComments', \n    label: '\u6DFB\u52A0\u6CE8\u91CA', \n    icon: '\uD83D\uDCDD',\n    prompt: '\u8BF7\u4E3A\u4EE5\u4E0B\u4EE3\u7801\u6DFB\u52A0\u8BE6\u7EC6\u7684\u4E2D\u6587\u6CE8\u91CA\uFF0C\u89E3\u91CA\u6BCF\u4E2A\u90E8\u5206\u7684\u529F\u80FD\uFF1A\\n\\n```{language}\\n{code}\\n```'\n  },\n  { \n    type: 'generateTests', \n    label: '\u751F\u6210\u6D4B\u8BD5', \n    icon: '\uD83E\uDDEA',\n    prompt: '\u8BF7\u4E3A\u4EE5\u4E0B\u4EE3\u7801\u751F\u6210\u5B8C\u6574\u7684\u5355\u5143\u6D4B\u8BD5\u7528\u4F8B\uFF0C\u5305\u542B\u8FB9\u754C\u6761\u4EF6\u548C\u5F02\u5E38\u60C5\u51B5\uFF1A\\n\\n```{language}\\n{code}\\n```'\n  },\n  { \n    type: 'review', \n    label: '\u4EE3\u7801\u5BA1\u67E5', \n    icon: '\uD83D\uDD0D',\n    prompt: '\u8BF7\u5BF9\u4EE5\u4E0B\u4EE3\u7801\u8FDB\u884C\u4EE3\u7801\u5BA1\u67E5\uFF0C\u6307\u51FA\u6F5C\u5728\u95EE\u9898\u3001\u6539\u8FDB\u5EFA\u8BAE\u548C\u6700\u4F73\u5B9E\u8DF5\uFF1A\\n\\n```{language}\\n{code}\\n```'\n  },\n];\n\n// ============================================\n// \u9884\u8BBE\u6A21\u578B\u5217\u8868\n// ============================================\n\nexport const AVAILABLE_MODELS: Record<Provider, AIModel[]> = {\n  deepseek: [\n    { id: 'deepseek-chat', name: 'DeepSeek Chat', provider: 'deepseek', maxTokens: 4096, supportStream: true },\n    { id: 'deepseek-coder', name: 'DeepSeek Coder', provider: 'deepseek', maxTokens: 16384, supportStream: true },\n  ],\n  openai: [\n    { id: 'gpt-4-turbo', name: 'GPT-4 Turbo', provider: 'openai', maxTokens: 128000, supportStream: true, supportVision: true },\n    { id: 'gpt-4o', name: 'GPT-4o', provider: 'openai', maxTokens: 128000, supportStream: true, supportVision: true },\n    { id: 'gpt-4o-mini', name: 'GPT-4o Mini', provider: 'openai', maxTokens: 128000, supportStream: true, supportVision: true },\n    { id: 'gpt-3.5-turbo', name: 'GPT-3.5 Turbo', provider: 'openai', maxTokens: 16385, supportStream: true },\n  ],\n  anthropic: [\n    { id: 'claude-3-5-sonnet-20241022', name: 'Claude 3.5 Sonnet', provider: 'anthropic', maxTokens: 8192, supportStream: true, supportVision: true },\n    { id: 'claude-3-opus-20240229', name: 'Claude 3 Opus', provider: 'anthropic', maxTokens: 4096, supportStream: true, supportVision: true },\n    { id: 'claude-3-haiku-20240307', name: 'Claude 3 Haiku', provider: 'anthropic', maxTokens: 4096, supportStream: true, supportVision: true },\n  ],\n  kimi: [\n    { id: 'moonshot-v1-8k', name: 'Kimi 8K', provider: 'kimi', maxTokens: 8192, supportStream: true },\n    { id: 'moonshot-v1-32k', name: 'Kimi 32K', provider: 'kimi', maxTokens: 32768, supportStream: true },\n    { id: 'moonshot-v1-128k', name: 'Kimi 128K', provider: 'kimi', maxTokens: 131072, supportStream: true },\n  ],\n  openrouter: [\n    { id: 'anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonnet (OpenRouter)', provider: 'openrouter', maxTokens: 8192, supportStream: true, supportVision: true },\n    { id: 'google/gemini-pro-1.5', name: 'Gemini Pro 1.5', provider: 'openrouter', maxTokens: 32768, supportStream: true, supportVision: true },\n    { id: 'meta-llama/llama-3.1-405b-instruct', name: 'Llama 3.1 405B', provider: 'openrouter', maxTokens: 32768, supportStream: true },\n  ],\n};\n\n// ============================================\n// \u56FE\u8868\u6A21\u677F\n// ============================================\n\nexport const DIAGRAM_TEMPLATES: Record<DiagramType, string> = {\n  flowchart: `flowchart TD\n    A[\u5F00\u59CB] --> B{\u5224\u65AD}\n    B -->|\u662F| C[\u5904\u74061]\n    B -->|\u5426| D[\u5904\u74062]\n    C --> E[\u7ED3\u675F]\n    D --> E`,\n  sequence: `sequenceDiagram\n    participant A as \u7528\u6237\n    participant B as \u7CFB\u7EDF\n    A->>B: \u8BF7\u6C42\n    B-->>A: \u54CD\u5E94`,\n  class: `classDiagram\n    class Animal {\n        +String name\n        +int age\n        +makeSound()\n    }\n    class Dog {\n        +bark()\n    }\n    Animal <|-- Dog`,\n  state: `stateDiagram-v2\n    [*] --> \u5F85\u5904\u7406\n    \u5F85\u5904\u7406 --> \u5904\u7406\u4E2D: \u5F00\u59CB\n    \u5904\u7406\u4E2D --> \u5DF2\u5B8C\u6210: \u5B8C\u6210\n    \u5904\u7406\u4E2D --> \u5931\u8D25: \u9519\u8BEF\n    \u5DF2\u5B8C\u6210 --> [*]\n    \u5931\u8D25 --> \u5F85\u5904\u7406: \u91CD\u8BD5`,\n  er: `erDiagram\n    USER ||--o{ ORDER : places\n    ORDER ||--|{ LINE-ITEM : contains\n    PRODUCT ||--o{ LINE-ITEM : includes`,\n  gantt: `gantt\n    title \u9879\u76EE\u8BA1\u5212\n    dateFormat YYYY-MM-DD\n    section \u9636\u6BB51\n    \u4EFB\u52A11: 2024-01-01, 7d\n    \u4EFB\u52A12: 7d`,\n  pie: `pie title \u5206\u5E03\n    \"A\" : 40\n    \"B\" : 30\n    \"C\" : 30`,\n  mindmap: `mindmap\n    root((\u4E3B\u9898))\n      \u5206\u652F1\n        \u5B50\u8282\u70B91\n        \u5B50\u8282\u70B92\n      \u5206\u652F2\n        \u5B50\u8282\u70B93`,\n  architecture: `flowchart TB\n    subgraph Frontend\n        A[Web App]\n        B[Mobile App]\n    end\n    subgraph Backend\n        C[API Gateway]\n        D[Service A]\n        E[Service B]\n    end\n    subgraph Database\n        F[(\u4E3B\u6570\u636E\u5E93)]\n        G[(\u7F13\u5B58)]\n    end\n    A --> C\n    B --> C\n    C --> D\n    C --> E\n    D --> F\n    E --> F\n    D --> G`,\n};\n\n// ============================================\n// \u5DE5\u5177\u51FD\u6570\n// ============================================\n\nexport function generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport function getProviderDisplayName(provider: Provider): string {\n  const names: Record<Provider, string> = {\n    deepseek: 'DeepSeek',\n    openai: 'OpenAI',\n    anthropic: 'Anthropic',\n    kimi: 'Kimi (Moonshot)',\n    openrouter: 'OpenRouter',\n  };\n  return names[provider];\n}\n\nexport function estimateTokens(text: string): number {\n  // \u7B80\u5355\u4F30\u7B97\uFF1A\u4E2D\u6587\u7EA61.5\u5B57\u7B26/token\uFF0C\u82F1\u6587\u7EA64\u5B57\u7B26/token\n  const chineseChars = (text.match(/[\\u4e00-\\u9fa5]/g) || []).length;\n  const otherChars = text.length - chineseChars;\n  return Math.ceil(chineseChars / 1.5 + otherChars / 4);\n}\n\nexport function formatTimestamp(timestamp: number): string {\n  const date = new Date(timestamp);\n  const now = new Date();\n  const diffDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));\n  \n  if (diffDays === 0) {\n    return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });\n  } else if (diffDays === 1) {\n    return '\u6628\u5929 ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });\n  } else if (diffDays < 7) {\n    const weekdays = ['\u5468\u65E5', '\u5468\u4E00', '\u5468\u4E8C', '\u5468\u4E09', '\u5468\u56DB', '\u5468\u4E94', '\u5468\u516D'];\n    return weekdays[date.getDay()];\n  } else {\n    return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });\n  }\n}\n\nexport function truncateText(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength - 3) + '...';\n}\n", "import { Message, ModelConfig, Attachment } from '../../types/shared';\n\nexport interface StreamCallback {\n  onToken: (token: string) => void;\n  onComplete: (fullResponse: string) => void;\n  onError: (error: Error) => void;\n}\n\n// \u53EF\u9009\u7684\u8BF7\u6C42\u914D\u7F6E\nexport interface RequestOptions {\n  maxTokens?: number;\n  temperature?: number;\n  requestId?: string;  // \u2705 \u65B0\u589E\uFF1A\u7528\u4E8E\u6807\u8BC6\u72EC\u7ACB\u8BF7\u6C42\n}\n\nexport abstract class BaseAdapter {\n  protected config: ModelConfig;\n  \n  // \u2705 \u4FEE\u590D\uFF1A\u4F7F\u7528 Map \u7BA1\u7406\u591A\u4E2A\u72EC\u7ACB\u7684 AbortController\n  // \u8FD9\u6837\u4E0D\u540C\u4EFB\u52A1\uFF08chat, diagram, test\uFF09\u7684\u8BF7\u6C42\u4E92\u4E0D\u5F71\u54CD\n  protected abortControllers: Map<string, AbortController> = new Map();\n  \n  // \u2705 \u4FDD\u7559\u5411\u540E\u517C\u5BB9\u7684\u5355\u4E00 controller\uFF08\u7528\u4E8E\u6CA1\u6709\u6307\u5B9A requestId \u7684\u60C5\u51B5\uFF09\n  protected defaultAbortController: AbortController | null = null;\n\n  // \u2705 \u65B0\u589E\uFF1A\u5B58\u50A8\u6D3B\u52A8\u7684 reader\uFF0C\u4EE5\u4FBF\u53D6\u6D88\u65F6\u80FD\u4E3B\u52A8\u4E2D\u65AD\u6D41\u5F0F\u8BFB\u53D6\n  protected activeReaders: Map<string, ReadableStreamDefaultReader<Uint8Array>> = new Map();\n  protected defaultReader: ReadableStreamDefaultReader<Uint8Array> | null = null;\n\n  constructor(config: ModelConfig) {\n    this.config = config;\n  }\n\n  abstract sendMessage(\n    messages: Message[],\n    callbacks: StreamCallback,\n    options?: RequestOptions\n  ): Promise<void>;\n\n  abstract getEndpoint(): string;\n\n  /**\n   * \u2705 \u521B\u5EFA\u6216\u83B7\u53D6 AbortController\n   * @param requestId \u53EF\u9009\u7684\u8BF7\u6C42ID\uFF0C\u7528\u4E8E\u9694\u79BB\u4E0D\u540C\u4EFB\u52A1\u7684\u53D6\u6D88\u64CD\u4F5C\n   */\n  protected createAbortController(requestId?: string): AbortController {\n    const controller = new AbortController();\n    \n    if (requestId) {\n      // \u5982\u679C\u6709 requestId\uFF0C\u5B58\u5165 Map\n      // \u5148\u53D6\u6D88\u4E4B\u524D\u540CID\u7684\u8BF7\u6C42\uFF08\u5982\u679C\u5B58\u5728\uFF09\n      this.cancelRequest(requestId);\n      this.abortControllers.set(requestId, controller);\n    } else {\n      // \u6CA1\u6709 requestId\uFF0C\u4F7F\u7528\u9ED8\u8BA4 controller\uFF08\u5411\u540E\u517C\u5BB9\uFF09\n      this.defaultAbortController = controller;\n    }\n    \n    return controller;\n  }\n\n  /**\n   * \u2705 \u53D6\u6D88\u7279\u5B9A\u8BF7\u6C42 - \u4FEE\u590D\uFF1A\u540C\u65F6\u53D6\u6D88 reader\n   * @param requestId \u8BF7\u6C42ID\uFF0C\u5982\u679C\u4E0D\u6307\u5B9A\u5219\u53D6\u6D88\u9ED8\u8BA4\u8BF7\u6C42\n   */\n  cancelRequest(requestId?: string): void {\n    if (requestId) {\n      const controller = this.abortControllers.get(requestId);\n      if (controller) {\n        controller.abort();\n        this.abortControllers.delete(requestId);\n      }\n      // \u2705 \u4FEE\u590D\uFF1A\u540C\u65F6\u53D6\u6D88\u6D3B\u52A8\u7684 reader\n      const reader = this.activeReaders.get(requestId);\n      if (reader) {\n        try {\n          reader.cancel();\n        } catch (e) {\n          // \u5FFD\u7565\u53D6\u6D88\u9519\u8BEF\n        }\n        this.activeReaders.delete(requestId);\n      }\n    } else {\n      // \u53D6\u6D88\u9ED8\u8BA4\u8BF7\u6C42\n      if (this.defaultAbortController) {\n        this.defaultAbortController.abort();\n        this.defaultAbortController = null;\n      }\n      // \u2705 \u4FEE\u590D\uFF1A\u540C\u65F6\u53D6\u6D88\u9ED8\u8BA4 reader\n      if (this.defaultReader) {\n        try {\n          this.defaultReader.cancel();\n        } catch (e) {\n          // \u5FFD\u7565\u53D6\u6D88\u9519\u8BEF\n        }\n        this.defaultReader = null;\n      }\n    }\n  }\n\n  /**\n   * \u2705 \u53D6\u6D88\u6240\u6709\u8BF7\u6C42\uFF08\u4FDD\u7559\u5411\u540E\u517C\u5BB9\uFF09\n   */\n  cancel(): void {\n    // \u53D6\u6D88\u9ED8\u8BA4\u8BF7\u6C42\n    if (this.defaultAbortController) {\n      this.defaultAbortController.abort();\n      this.defaultAbortController = null;\n    }\n    if (this.defaultReader) {\n      try {\n        this.defaultReader.cancel();\n      } catch (e) {}\n      this.defaultReader = null;\n    }\n    \n    // \u53D6\u6D88\u6240\u6709\u5E26 ID \u7684\u8BF7\u6C42\n    for (const [id, controller] of this.abortControllers) {\n      controller.abort();\n    }\n    this.abortControllers.clear();\n    \n    // \u2705 \u4FEE\u590D\uFF1A\u53D6\u6D88\u6240\u6709\u6D3B\u52A8\u7684 reader\n    for (const [id, reader] of this.activeReaders) {\n      try {\n        reader.cancel();\n      } catch (e) {}\n    }\n    this.activeReaders.clear();\n  }\n\n  /**\n   * \u2705 \u6E05\u7406\u5DF2\u5B8C\u6210\u7684\u8BF7\u6C42\n   */\n  protected cleanupRequest(requestId?: string): void {\n    if (requestId) {\n      this.abortControllers.delete(requestId);\n      this.activeReaders.delete(requestId);\n    } else {\n      this.defaultReader = null;\n    }\n  }\n\n  protected buildMessageContent(message: Message): any {\n    if (!message.attachments || message.attachments.length === 0) {\n      return message.content;\n    }\n\n    const content: any[] = [{ type: 'text', text: message.content }];\n\n    for (const attachment of message.attachments) {\n      if (attachment.type === 'image') {\n        // \u56FE\u7247\u9644\u4EF6\n        content.push({\n          type: 'image_url',\n          image_url: {\n            url: attachment.data.startsWith('data:')\n              ? attachment.data\n              : `data:${attachment.mimeType};base64,${attachment.data}`,\n          },\n        });\n      } else if (attachment.type === 'file') {\n        // \u6587\u4EF6\u9644\u4EF6 - \u6839\u636E\u7C7B\u578B\u8FDB\u884C\u5904\u7406\n        const fileInfo = `\\n\\n---\\n\uD83D\uDCCE **\u9644\u4EF6: ${attachment.name}**`;\n        const mimeType = attachment.mimeType || '';\n        const fileName = attachment.name || '';\n        \n        // \u5904\u7406\u6587\u672C\u6587\u4EF6\n        if (this.isTextFile(mimeType, fileName)) {\n          try {\n            const fileContent = attachment.data.startsWith('data:')\n              ? this.decodeBase64(attachment.data.split(',')[1] || '')\n              : attachment.data;\n            const ext = this.getFileExtension(fileName);\n            content.push({\n              type: 'text',\n              text: `${fileInfo}\\n\\`\\`\\`${ext}\\n${fileContent}\\n\\`\\`\\``,\n            });\n          } catch (e) {\n            content.push({\n              type: 'text',\n              text: `${fileInfo}\\n[\u6587\u4EF6\u89E3\u6790\u9519\u8BEF]`,\n            });\n          }\n        }\n        // \u5904\u7406 CSV \u6587\u4EF6\n        else if (this.isCsvFile(mimeType, fileName)) {\n          try {\n            const csvContent = attachment.data.startsWith('data:')\n              ? this.decodeBase64(attachment.data.split(',')[1] || '')\n              : attachment.data;\n            const parsedCsv = this.parseCSV(csvContent);\n            content.push({\n              type: 'text',\n              text: `${fileInfo}\\n\\n**CSV \u6570\u636E\u9884\u89C8\uFF08\u524D20\u884C\uFF09:**\\n${parsedCsv}`,\n            });\n          } catch (e) {\n            content.push({\n              type: 'text',\n              text: `${fileInfo}\\n[CSV \u89E3\u6790\u9519\u8BEF]`,\n            });\n          }\n        }\n        // \u5904\u7406 JSON \u6587\u4EF6\n        else if (this.isJsonFile(mimeType, fileName)) {\n          try {\n            const jsonContent = attachment.data.startsWith('data:')\n              ? this.decodeBase64(attachment.data.split(',')[1] || '')\n              : attachment.data;\n            // \u5C1D\u8BD5\u683C\u5F0F\u5316 JSON\n            const parsed = JSON.parse(jsonContent);\n            const formatted = JSON.stringify(parsed, null, 2);\n            content.push({\n              type: 'text',\n              text: `${fileInfo}\\n\\`\\`\\`json\\n${formatted.slice(0, 10000)}${formatted.length > 10000 ? '\\n...(\u622A\u65AD)' : ''}\\n\\`\\`\\``,\n            });\n          } catch (e) {\n            content.push({\n              type: 'text',\n              text: `${fileInfo}\\n[JSON \u89E3\u6790\u9519\u8BEF]`,\n            });\n          }\n        }\n        // \u5904\u7406 PDF \u6587\u4EF6 - \u63D0\u793A\u7528\u6237\u8BE5\u529F\u80FD\u6709\u9650\n        else if (this.isPdfFile(mimeType, fileName)) {\n          content.push({\n            type: 'text',\n            text: `${fileInfo}\\n[PDF \u6587\u4EF6\uFF0C\u5927\u5C0F: ${attachment.size ? Math.round(attachment.size / 1024) + 'KB' : '\u672A\u77E5'}]\\n\\n\uD83D\uDCA1 **\u63D0\u793A**: PDF \u5185\u5BB9\u65E0\u6CD5\u76F4\u63A5\u89E3\u6790\u3002\u5982\u679C\u60A8\u4F7F\u7528\u652F\u6301\u89C6\u89C9\u7684\u6A21\u578B\uFF08\u5982 GPT-4o\u3001Claude 3\uFF09\uFF0C\u53EF\u4EE5\u5C06 PDF \u622A\u56FE\u540E\u4E0A\u4F20\u56FE\u7247\u3002`,\n          });\n        }\n        // \u5904\u7406 Excel \u6587\u4EF6 - \u63D0\u793A\u7528\u6237\u8F6C\u6362\u4E3A CSV\n        else if (this.isExcelFile(mimeType, fileName)) {\n          content.push({\n            type: 'text',\n            text: `${fileInfo}\\n[Excel \u6587\u4EF6\uFF0C\u5927\u5C0F: ${attachment.size ? Math.round(attachment.size / 1024) + 'KB' : '\u672A\u77E5'}]\\n\\n\uD83D\uDCA1 **\u63D0\u793A**: Excel \u6587\u4EF6\u65E0\u6CD5\u76F4\u63A5\u89E3\u6790\u3002\u5EFA\u8BAE\u60A8\u5C06\u5176\u5BFC\u51FA\u4E3A CSV \u683C\u5F0F\u540E\u91CD\u65B0\u4E0A\u4F20\u3002`,\n          });\n        }\n        // \u5176\u4ED6\u4E8C\u8FDB\u5236\u6587\u4EF6\n        else {\n          content.push({\n            type: 'text',\n            text: `${fileInfo}\\n[\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u7C7B\u578B: ${mimeType || '\u672A\u77E5'}\uFF0C\u5927\u5C0F: ${attachment.size ? Math.round(attachment.size / 1024) + 'KB' : '\u672A\u77E5'}]`,\n          });\n        }\n      } else if (attachment.type === 'voice') {\n        // \u8BED\u97F3\u9644\u4EF6 - \u63D0\u793A\u7528\u6237\u8BED\u97F3\u5DF2\u8F6C\u4E3A\u6587\u672C\n        content.push({\n          type: 'text',\n          text: `\\n\\n---\\n\uD83C\uDFA4 **\u8BED\u97F3\u8F93\u5165** (\u65F6\u957F: ${attachment.duration ? attachment.duration + '\u79D2' : '\u672A\u77E5'})`,\n        });\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * \u5B89\u5168\u89E3\u7801 Base64\n   */\n  private decodeBase64(base64: string): string {\n    try {\n      // \u6D4F\u89C8\u5668\u73AF\u5883\n      if (typeof atob !== 'undefined') {\n        return decodeURIComponent(escape(atob(base64)));\n      }\n      // Node.js \u73AF\u5883\n      return Buffer.from(base64, 'base64').toString('utf-8');\n    } catch {\n      // \u5982\u679C UTF-8 \u89E3\u7801\u5931\u8D25\uFF0C\u5C1D\u8BD5 Latin1\n      if (typeof atob !== 'undefined') {\n        return atob(base64);\n      }\n      return Buffer.from(base64, 'base64').toString('latin1');\n    }\n  }\n\n  /**\n   * \u89E3\u6790 CSV \u5185\u5BB9\u4E3A\u8868\u683C\u683C\u5F0F\n   */\n  private parseCSV(content: string, maxRows: number = 20): string {\n    const lines = content.split(/\\r?\\n/).filter(line => line.trim());\n    const displayLines = lines.slice(0, maxRows);\n    \n    if (displayLines.length === 0) return '(\u7A7A\u6587\u4EF6)';\n    \n    // \u5C1D\u8BD5\u68C0\u6D4B\u5206\u9694\u7B26\n    const firstLine = displayLines[0];\n    const delimiter = firstLine.includes('\\t') ? '\\t' : \n                      firstLine.includes(';') ? ';' : ',';\n    \n    // \u89E3\u6790\u4E3A\u8868\u683C\n    const rows = displayLines.map(line => {\n      const cells: string[] = [];\n      let current = '';\n      let inQuotes = false;\n      \n      for (const char of line) {\n        if (char === '\"') {\n          inQuotes = !inQuotes;\n        } else if (char === delimiter && !inQuotes) {\n          cells.push(current.trim());\n          current = '';\n        } else {\n          current += char;\n        }\n      }\n      cells.push(current.trim());\n      return cells;\n    });\n    \n    // \u751F\u6210 Markdown \u8868\u683C\n    if (rows.length === 0) return '(\u7A7A\u6587\u4EF6)';\n    \n    const header = rows[0];\n    const separator = header.map(() => '---');\n    const dataRows = rows.slice(1);\n    \n    let result = `| ${header.join(' | ')} |\\n| ${separator.join(' | ')} |\\n`;\n    for (const row of dataRows) {\n      result += `| ${row.join(' | ')} |\\n`;\n    }\n    \n    if (lines.length > maxRows) {\n      result += `\\n... (\u5171 ${lines.length} \u884C\uFF0C\u4EC5\u663E\u793A\u524D ${maxRows} \u884C)`;\n    }\n    \n    return result;\n  }\n\n  private isTextFile(mimeType?: string, fileName?: string): boolean {\n    const textMimeTypes = [\n      'text/', \n      'application/javascript',\n      'application/typescript',\n      'application/x-python',\n      'application/x-ruby',\n      'application/x-sh',\n      'application/x-yaml',\n    ];\n    const textExtensions = [\n      '.txt', '.md', '.markdown', '.html', '.htm', '.css', '.js', '.ts', \n      '.jsx', '.tsx', '.py', '.java', '.cpp', '.c', '.h', '.hpp', '.go', \n      '.rs', '.rb', '.php', '.sh', '.bash', '.zsh', '.yaml', '.yml', '.toml', \n      '.ini', '.cfg', '.conf', '.sql', '.vue', '.svelte', '.r', '.scala',\n      '.swift', '.kt', '.kts', '.gradle', '.cmake', '.makefile', '.dockerfile',\n      '.gitignore', '.env', '.env.local', '.env.example'\n    ];\n    \n    // \u6392\u9664 JSON \u548C CSV\uFF08\u5355\u72EC\u5904\u7406\uFF09\n    if (this.isJsonFile(mimeType, fileName) || this.isCsvFile(mimeType, fileName)) {\n      return false;\n    }\n    \n    if (mimeType && textMimeTypes.some(t => mimeType.startsWith(t))) {\n      return true;\n    }\n    if (fileName) {\n      const lowerName = fileName.toLowerCase();\n      if (textExtensions.some(ext => lowerName.endsWith(ext))) {\n        return true;\n      }\n      // \u65E0\u6269\u5C55\u540D\u7684\u5E38\u89C1\u914D\u7F6E\u6587\u4EF6\n      const noExtNames = ['makefile', 'dockerfile', 'jenkinsfile', 'vagrantfile', '.gitignore', '.dockerignore', '.editorconfig'];\n      if (noExtNames.some(name => lowerName === name || lowerName.endsWith('/' + name))) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  private isCsvFile(mimeType?: string, fileName?: string): boolean {\n    if (mimeType === 'text/csv' || mimeType === 'application/csv') return true;\n    if (fileName && (fileName.toLowerCase().endsWith('.csv') || fileName.toLowerCase().endsWith('.tsv'))) return true;\n    return false;\n  }\n\n  private isJsonFile(mimeType?: string, fileName?: string): boolean {\n    if (mimeType === 'application/json') return true;\n    if (fileName && fileName.toLowerCase().endsWith('.json')) return true;\n    return false;\n  }\n\n  private isPdfFile(mimeType?: string, fileName?: string): boolean {\n    if (mimeType === 'application/pdf') return true;\n    if (fileName && fileName.toLowerCase().endsWith('.pdf')) return true;\n    return false;\n  }\n\n  private isExcelFile(mimeType?: string, fileName?: string): boolean {\n    const excelMimes = [\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      'application/vnd.oasis.opendocument.spreadsheet'\n    ];\n    if (mimeType && excelMimes.includes(mimeType)) return true;\n    if (fileName) {\n      const lowerName = fileName.toLowerCase();\n      if (['.xls', '.xlsx', '.xlsm', '.ods'].some(ext => lowerName.endsWith(ext))) return true;\n    }\n    return false;\n  }\n\n  private getFileExtension(fileName: string): string {\n    const ext = fileName.split('.').pop()?.toLowerCase() || '';\n    const langMap: Record<string, string> = {\n      'js': 'javascript',\n      'ts': 'typescript',\n      'jsx': 'jsx',\n      'tsx': 'tsx',\n      'py': 'python',\n      'java': 'java',\n      'cpp': 'cpp',\n      'c': 'c',\n      'h': 'c',\n      'go': 'go',\n      'rs': 'rust',\n      'rb': 'ruby',\n      'php': 'php',\n      'sh': 'bash',\n      'yaml': 'yaml',\n      'yml': 'yaml',\n      'json': 'json',\n      'xml': 'xml',\n      'html': 'html',\n      'css': 'css',\n      'md': 'markdown',\n      'sql': 'sql',\n      'vue': 'vue',\n    };\n    return langMap[ext] || ext;\n  }\n\n  protected async handleSSEStream(\n    response: Response,\n    callbacks: StreamCallback,\n    extractContent: (data: any) => string | null,\n    requestId?: string  // \u2705 \u65B0\u589E\uFF1A\u4F20\u5165 requestId \u7528\u4E8E\u68C0\u67E5\u6B63\u786E\u7684 controller\n  ): Promise<void> {\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('No response body');\n    }\n\n    // \u2705 \u4FEE\u590D\uFF1A\u5B58\u50A8 reader \u4EE5\u4FBF\u53D6\u6D88\u65F6\u80FD\u4E3B\u52A8\u4E2D\u65AD\n    if (requestId) {\n      this.activeReaders.set(requestId, reader);\n    } else {\n      this.defaultReader = reader;\n    }\n\n    const decoder = new TextDecoder();\n    let buffer = '';\n    let fullResponse = '';\n\n    // \u2705 \u83B7\u53D6\u6B63\u786E\u7684 AbortController\n    const controller = requestId \n      ? this.abortControllers.get(requestId) \n      : this.defaultAbortController;\n\n    try {\n      while (true) {\n        // \u2705 \u68C0\u67E5\u6B63\u786E\u7684 controller \u662F\u5426\u5DF2\u88AB\u53D6\u6D88\n        if (controller?.signal.aborted) {\n          try {\n            reader.cancel();\n          } catch (e) {}\n          return; // \u76F4\u63A5\u8FD4\u56DE\uFF0C\u4E0D\u8C03\u7528onComplete\n        }\n\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        // \u2705 \u518D\u6B21\u68C0\u67E5\u662F\u5426\u88AB\u53D6\u6D88\uFF08\u5728\u8BFB\u53D6\u540E\uFF09\n        if (controller?.signal.aborted) {\n          try {\n            reader.cancel();\n          } catch (e) {}\n          return;\n        }\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n            if (data === '[DONE]') continue;\n\n            try {\n              const parsed = JSON.parse(data);\n              const content = extractContent(parsed);\n              if (content) {\n                fullResponse += content;\n                callbacks.onToken(content);\n              }\n            } catch {\n              // Skip invalid JSON\n            }\n          }\n        }\n      }\n\n      callbacks.onComplete(fullResponse);\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        // \u88AB\u53D6\u6D88\u65F6\u4E0D\u8C03\u7528onComplete\uFF0C\u76F4\u63A5\u8FD4\u56DE\n        return;\n      } else {\n        throw error;\n      }\n    } finally {\n      // \u2705 \u6E05\u7406\u8BF7\u6C42\u548C reader\n      this.cleanupRequest(requestId);\n    }\n  }\n}\n", "import { Message } from '../../types/shared';\nimport { BaseAdapter, StreamCallback, RequestOptions } from './BaseAdapter';\n\nexport class OpenAIAdapter extends BaseAdapter {\n  getEndpoint(): string {\n    return 'https://api.openai.com/v1/chat/completions';\n  }\n\n  async sendMessage(messages: Message[], callbacks: StreamCallback, options?: RequestOptions): Promise<void> {\n    // \u2705 \u4FEE\u590D\uFF1A\u4F7F\u7528 createAbortController \u65B9\u6CD5\uFF0C\u652F\u6301 requestId \u9694\u79BB\n    const requestId = options?.requestId;\n    const abortController = this.createAbortController(requestId);\n    const formattedMessages = messages.map((msg) => ({\n      role: msg.role,\n      content: this.buildMessageContent(msg),\n    }));\n\n    // \u4F7F\u7528options\u4E2D\u7684\u503C\uFF0C\u5426\u5219\u4F7F\u7528config\u4E2D\u7684\u9ED8\u8BA4\u503C\n    const maxTokens = options?.maxTokens ?? this.config.maxTokens;\n    const temperature = options?.temperature ?? this.config.temperature;\n\n    try {\n      const response = await fetch(this.getEndpoint(), {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${this.config.apiKey}`,\n        },\n        body: JSON.stringify({\n          model: this.config.model,\n          messages: formattedMessages,\n          temperature: temperature,\n          max_tokens: maxTokens,\n          stream: true,\n        }),\n        signal: abortController.signal,  // \u2705 \u4F7F\u7528\u6B63\u786E\u7684 controller\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error?.message || 'API request failed');\n      }\n\n      // \u2705 \u4F20\u5165 requestId \u4EE5\u4FBF\u6B63\u786E\u68C0\u67E5\u53D6\u6D88\u72B6\u6001\n      await this.handleSSEStream(response, callbacks, (data) => {\n        return data.choices?.[0]?.delta?.content || null;\n      }, requestId);\n    } catch (error) {\n      if (error instanceof Error && error.name !== 'AbortError') {\n        callbacks.onError(error);\n      }\n    } finally {\n      // \u2705 \u6E05\u7406\u8BF7\u6C42\uFF08\u5982\u679C handleSSEStream \u6CA1\u6709\u5904\u7406\u7684\u8BDD\uFF09\n      this.cleanupRequest(requestId);\n    }\n  }\n}\n", "import { OpenAIAdapter } from './OpenAIAdapter';\n\nexport class DeepSeekAdapter extends OpenAIAdapter {\n  getEndpoint(): string {\n    return 'https://api.deepseek.com/v1/chat/completions';\n  }\n}\n", "import { Message } from '../../types/shared';\nimport { BaseAdapter, StreamCallback, RequestOptions } from './BaseAdapter';\n\nexport class AnthropicAdapter extends BaseAdapter {\n  getEndpoint(): string {\n    return 'https://api.anthropic.com/v1/messages';\n  }\n\n  async sendMessage(messages: Message[], callbacks: StreamCallback, options?: RequestOptions): Promise<void> {\n    // \u2705 \u4FEE\u590D\uFF1A\u4F7F\u7528 createAbortController \u65B9\u6CD5\uFF0C\u652F\u6301 requestId \u9694\u79BB\n    const requestId = options?.requestId;\n    const abortController = this.createAbortController(requestId);\n\n    // Anthropic uses separate system parameter\n    let systemPrompt = '';\n    const formattedMessages: Array<{ role: string; content: any }> = [];\n\n    for (const msg of messages) {\n      if (msg.role === 'system') {\n        systemPrompt += (systemPrompt ? '\\n' : '') + msg.content;\n      } else {\n        formattedMessages.push({\n          role: msg.role,\n          content: this.buildAnthropicContent(msg),\n        });\n      }\n    }\n\n    // \u4F7F\u7528options\u4E2D\u7684\u503C\uFF0C\u5426\u5219\u4F7F\u7528config\u4E2D\u7684\u9ED8\u8BA4\u503C\n    const maxTokens = options?.maxTokens ?? this.config.maxTokens ?? 4096;\n\n    try {\n      const body: any = {\n        model: this.config.model,\n        messages: formattedMessages,\n        max_tokens: maxTokens,\n        stream: true,\n      };\n\n      if (systemPrompt) {\n        body.system = systemPrompt;\n      }\n\n      const response = await fetch(this.getEndpoint(), {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-api-key': this.config.apiKey!,\n          'anthropic-version': '2023-06-01',\n        },\n        body: JSON.stringify(body),\n        signal: abortController.signal,  // \u2705 \u4F7F\u7528\u6B63\u786E\u7684 controller\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error?.message || 'API request failed');\n      }\n\n      // \u2705 \u4F20\u5165 requestId \u4EE5\u4FBF\u6B63\u786E\u68C0\u67E5\u53D6\u6D88\u72B6\u6001\n      await this.handleAnthropicStream(response, callbacks, requestId);\n    } catch (error) {\n      if (error instanceof Error && error.name !== 'AbortError') {\n        callbacks.onError(error);\n      }\n    } finally {\n      // \u2705 \u6E05\u7406\u8BF7\u6C42\n      this.cleanupRequest(requestId);\n    }\n  }\n\n  private buildAnthropicContent(message: Message): any {\n    if (!message.attachments || message.attachments.length === 0) {\n      return message.content;\n    }\n\n    const content: any[] = [{ type: 'text', text: message.content }];\n\n    for (const attachment of message.attachments) {\n      if (attachment.type === 'image') {\n        content.push({\n          type: 'image',\n          source: {\n            type: 'base64',\n            media_type: attachment.mimeType,\n            data: attachment.data.replace(/^data:[^;]+;base64,/, ''),\n          },\n        });\n      }\n    }\n\n    return content;\n  }\n\n  private async handleAnthropicStream(\n    response: Response,\n    callbacks: StreamCallback,\n    requestId?: string  // \u2705 \u65B0\u589E\uFF1A\u4F20\u5165 requestId\n  ): Promise<void> {\n    const reader = response.body?.getReader();\n    if (!reader) throw new Error('No response body');\n\n    // \u2705 \u4FEE\u590D\uFF1A\u5B58\u50A8 reader \u4EE5\u4FBF\u53D6\u6D88\u65F6\u80FD\u4E3B\u52A8\u4E2D\u65AD\n    if (requestId) {\n      this.activeReaders.set(requestId, reader);\n    } else {\n      this.defaultReader = reader;\n    }\n\n    const decoder = new TextDecoder();\n    let buffer = '';\n    let fullResponse = '';\n\n    // \u2705 \u83B7\u53D6\u6B63\u786E\u7684 AbortController\n    const controller = requestId \n      ? this.abortControllers.get(requestId) \n      : this.defaultAbortController;\n\n    try {\n      while (true) {\n        // \u2705 \u68C0\u67E5\u6B63\u786E\u7684 controller \u662F\u5426\u5DF2\u88AB\u53D6\u6D88\n        if (controller?.signal.aborted) {\n          try {\n            reader.cancel();\n          } catch (e) {}\n          return; // \u76F4\u63A5\u8FD4\u56DE\uFF0C\u4E0D\u8C03\u7528onComplete\n        }\n\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        // \u2705 \u518D\u6B21\u68C0\u67E5\u662F\u5426\u88AB\u53D6\u6D88\uFF08\u5728\u8BFB\u53D6\u540E\uFF09\n        if (controller?.signal.aborted) {\n          try {\n            reader.cancel();\n          } catch (e) {}\n          return;\n        }\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              if (data.type === 'content_block_delta') {\n                const text = data.delta?.text || '';\n                if (text) {\n                  fullResponse += text;\n                  callbacks.onToken(text);\n                }\n              }\n            } catch {\n              // Skip invalid JSON\n            }\n          }\n        }\n      }\n\n      callbacks.onComplete(fullResponse);\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        // \u88AB\u53D6\u6D88\u65F6\u4E0D\u8C03\u7528onComplete\uFF0C\u76F4\u63A5\u8FD4\u56DE\n        return;\n      } else {\n        throw error;\n      }\n    } finally {\n      // \u2705 \u6E05\u7406 reader\n      this.cleanupRequest(requestId);\n    }\n  }\n}\n", "import { OpenAIAdapter } from './OpenAIAdapter';\n\nexport class KimiAdapter extends OpenAIAdapter {\n  getEndpoint(): string {\n    return 'https://api.moonshot.cn/v1/chat/completions';\n  }\n}\n\nexport class OpenRouterAdapter extends OpenAIAdapter {\n  getEndpoint(): string {\n    return 'https://openrouter.ai/api/v1/chat/completions';\n  }\n}\n", "import { Message, ModelConfig, Provider, AVAILABLE_MODELS } from '../../types/shared';\nimport { BaseAdapter, StreamCallback, RequestOptions } from './BaseAdapter';\nimport { OpenAIAdapter } from './OpenAIAdapter';\nimport { DeepSeekAdapter } from './DeepSeekAdapter';\nimport { AnthropicAdapter } from './AnthropicAdapter';\nimport { KimiAdapter, OpenRouterAdapter } from './OtherAdapters';\n\nexport class ChatService {\n  private adapter: BaseAdapter | null = null;\n  private config: ModelConfig;\n\n  constructor(config: ModelConfig) {\n    this.config = config;\n    this.createAdapter();\n  }\n\n  private createAdapter(): void {\n    switch (this.config.provider) {\n      case 'openai':\n        this.adapter = new OpenAIAdapter(this.config);\n        break;\n      case 'deepseek':\n        this.adapter = new DeepSeekAdapter(this.config);\n        break;\n      case 'anthropic':\n        this.adapter = new AnthropicAdapter(this.config);\n        break;\n      case 'kimi':\n        this.adapter = new KimiAdapter(this.config);\n        break;\n      case 'openrouter':\n        this.adapter = new OpenRouterAdapter(this.config);\n        break;\n      default:\n        throw new Error(`Unknown provider: ${this.config.provider}`);\n    }\n  }\n\n  updateConfig(config: ModelConfig): void {\n    this.config = config;\n    this.createAdapter();\n  }\n\n  async sendMessage(messages: Message[], callbacks: StreamCallback, options?: RequestOptions): Promise<void> {\n    if (!this.adapter) {\n      throw new Error('No adapter configured');\n    }\n    if (!this.config.apiKey) {\n      throw new Error('API Key not configured');\n    }\n    await this.adapter.sendMessage(messages, callbacks, options);\n  }\n\n  /**\n   * \u540C\u6B65\u53D1\u9001\u6D88\u606F\u5E76\u7B49\u5F85\u5B8C\u6574\u54CD\u5E94\n   * \u7528\u4E8EAgent\u7B49\u9700\u8981\u5B8C\u6574\u54CD\u5E94\u7684\u573A\u666F\n   */\n  async sendMessageSync(messages: Message[], options?: RequestOptions): Promise<string> {\n    if (!this.adapter) {\n      throw new Error('No adapter configured');\n    }\n    if (!this.config.apiKey) {\n      throw new Error('API Key not configured');\n    }\n\n    let fullContent = '';\n    \n    await this.adapter.sendMessage(\n      messages,\n      {\n        onToken: (token: string) => {\n          fullContent += token;\n        },\n        onComplete: (content: string) => {\n          fullContent = content;\n        },\n        onError: (error: Error) => {\n          throw error;\n        },\n      },\n      options\n    );\n\n    return fullContent;\n  }\n\n  /**\n   * \u2705 \u65B0\u589E\uFF1A\u53D6\u6D88\u7279\u5B9A\u8BF7\u6C42\n   * @param requestId \u8BF7\u6C42ID\uFF0C\u5BF9\u5E94\u4E0D\u540C\u4EFB\u52A1\u7C7B\u578B\n   */\n  cancelRequest(requestId: string): void {\n    this.adapter?.cancelRequest(requestId);\n  }\n\n  /**\n   * \u2705 \u53D6\u6D88\u6240\u6709\u8BF7\u6C42\uFF08\u4FDD\u7559\u5411\u540E\u517C\u5BB9\uFF09\n   */\n  cancel(): void {\n    this.adapter?.cancel();\n  }\n\n  supportsVision(): boolean {\n    const models = AVAILABLE_MODELS[this.config.provider];\n    const model = models?.find((m) => m.id === this.config.model);\n    return model?.supportVision ?? false;\n  }\n\n  getProvider(): Provider {\n    return this.config.provider;\n  }\n\n  getModel(): string {\n    return this.config.model;\n  }\n}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { GeneratedTest, TestFramework } from '../../types/shared';\n\nexport class TestGenerator {\n  private context: vscode.ExtensionContext;\n\n  constructor(context: vscode.ExtensionContext) {\n    this.context = context;\n  }\n\n  /**\n   * \u6839\u636E\u6587\u4EF6\u6269\u5C55\u540D\u68C0\u6D4B\u8BED\u8A00\u548C\u5BF9\u5E94\u7684\u6D4B\u8BD5\u6846\u67B6\n   */\n  detectLanguageAndFramework(filePath: string, workspaceRoot: string): { language: string; framework: TestFramework } {\n    const ext = path.extname(filePath).toLowerCase();\n    \n    // \u6839\u636E\u6587\u4EF6\u6269\u5C55\u540D\u786E\u5B9A\u8BED\u8A00\n    const langMap: Record<string, { language: string; defaultFramework: TestFramework }> = {\n      '.py': { language: 'python', defaultFramework: 'pytest' },\n      '.go': { language: 'go', defaultFramework: 'go' },\n      '.java': { language: 'java', defaultFramework: 'junit' },\n      '.kt': { language: 'kotlin', defaultFramework: 'junit' },\n      '.kts': { language: 'kotlin', defaultFramework: 'junit' },\n      '.ts': { language: 'typescript', defaultFramework: 'jest' },\n      '.tsx': { language: 'typescript', defaultFramework: 'jest' },\n      '.js': { language: 'javascript', defaultFramework: 'jest' },\n      '.jsx': { language: 'javascript', defaultFramework: 'jest' },\n      '.mjs': { language: 'javascript', defaultFramework: 'jest' },\n      '.cjs': { language: 'javascript', defaultFramework: 'jest' },\n      '.rs': { language: 'rust', defaultFramework: 'jest' }, // Rust \u4F7F\u7528\u5185\u7F6E\u6D4B\u8BD5\n      '.rb': { language: 'ruby', defaultFramework: 'jest' }, // Ruby \u4F7F\u7528 RSpec\n      '.cs': { language: 'csharp', defaultFramework: 'jest' }, // C# \u4F7F\u7528 xUnit/NUnit\n      '.php': { language: 'php', defaultFramework: 'jest' }, // PHP \u4F7F\u7528 PHPUnit\n      '.swift': { language: 'swift', defaultFramework: 'jest' }, // Swift \u4F7F\u7528 XCTest\n      '.scala': { language: 'scala', defaultFramework: 'jest' }, // Scala \u4F7F\u7528 ScalaTest\n    };\n\n    const detected = langMap[ext] || { language: 'code', defaultFramework: 'jest' };\n    \n    // \u5BF9\u4E8EJS/TS\u9879\u76EE\uFF0C\u68C0\u67E5\u5177\u4F53\u4F7F\u7528\u7684\u6D4B\u8BD5\u6846\u67B6\n    if (['.ts', '.tsx', '.js', '.jsx', '.mjs', '.cjs'].includes(ext)) {\n      const packageJsonPath = path.join(workspaceRoot, 'package.json');\n      if (fs.existsSync(packageJsonPath)) {\n        try {\n          const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n          const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n          if (deps['vitest']) return { language: detected.language, framework: 'vitest' };\n          if (deps['jest']) return { language: detected.language, framework: 'jest' };\n          if (deps['mocha']) return { language: detected.language, framework: 'mocha' };\n        } catch {}\n      }\n    }\n\n    return { language: detected.language, framework: detected.defaultFramework };\n  }\n\n  async detectFramework(workspaceRoot: string): Promise<TestFramework> {\n    // Check package.json for JS/TS projects\n    const packageJsonPath = path.join(workspaceRoot, 'package.json');\n    if (fs.existsSync(packageJsonPath)) {\n      try {\n        const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n        const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n        if (deps['vitest']) return 'vitest';\n        if (deps['jest']) return 'jest';\n        if (deps['mocha']) return 'mocha';\n      } catch {}\n    }\n\n    // Check for Python\n    if (fs.existsSync(path.join(workspaceRoot, 'pytest.ini')) ||\n        fs.existsSync(path.join(workspaceRoot, 'pyproject.toml')) ||\n        fs.existsSync(path.join(workspaceRoot, 'requirements.txt'))) {\n      return 'pytest';\n    }\n\n    // Check for Go\n    if (fs.existsSync(path.join(workspaceRoot, 'go.mod'))) {\n      return 'go';\n    }\n\n    // Check for Java\n    if (fs.existsSync(path.join(workspaceRoot, 'pom.xml')) ||\n        fs.existsSync(path.join(workspaceRoot, 'build.gradle'))) {\n      return 'junit';\n    }\n\n    return 'jest'; // Default\n  }\n\n  generateTestFilePath(sourceFile: string, framework: TestFramework): string {\n    const dir = path.dirname(sourceFile);\n    const ext = path.extname(sourceFile);\n    const base = path.basename(sourceFile, ext);\n\n    // \u786E\u4FDD base \u4E0D\u4E3A\u7A7A\n    const safeName = base || 'unnamed';\n    \n    switch (framework) {\n      case 'pytest':\n        // Python: test_xxx.py \u6216 xxx_test.py (\u4F7F\u7528\u540E\u8005)\n        return path.join(dir, `${safeName}_test.py`);\n      case 'go':\n        // Go: xxx_test.go\n        return path.join(dir, `${safeName}_test.go`);\n      case 'junit':\n        // Java: XxxTest.java\n        return path.join(dir, `${safeName}Test.java`);\n      case 'jest':\n      case 'vitest':\n      case 'mocha':\n      default:\n        // JS/TS: xxx_test.ts \u6216 xxx_test.js (\u6539\u7528\u4E0B\u5212\u7EBF)\n        const testExt = ext || '.js';\n        return path.join(dir, `${safeName}_test${testExt}`);\n    }\n  }\n\n  generatePrompt(sourceCode: string, filePath: string, framework: TestFramework): string {\n    const ext = path.extname(filePath);\n    const lang = this.getLanguage(ext);\n\n    const frameworkGuide = this.getFrameworkGuide(framework);\n\n    return `Generate comprehensive unit tests for the following ${lang} code using ${framework}.\n\nSource file: ${path.basename(filePath)}\nLanguage: ${lang}\n\n\\`\\`\\`${lang}\n${sourceCode}\n\\`\\`\\`\n\n${frameworkGuide}\n\nRequirements:\n1. Test all public functions/methods\n2. Include edge cases and error handling\n3. Use descriptive test names in ${lang}\n4. Add necessary imports for ${lang}\n5. Follow ${framework} best practices\n6. The output must be valid ${lang} code\n\nIMPORTANT: Generate ONLY the test code in ${lang}, no markdown, no explanations, no code block markers.`;\n  }\n\n  private getLanguage(ext: string): string {\n    const map: Record<string, string> = {\n      '.ts': 'typescript',\n      '.tsx': 'typescript',\n      '.mts': 'typescript',\n      '.cts': 'typescript',\n      '.js': 'javascript',\n      '.jsx': 'javascript',\n      '.mjs': 'javascript',\n      '.cjs': 'javascript',\n      '.py': 'python',\n      '.go': 'go',\n      '.java': 'java',\n      '.kt': 'kotlin',\n      '.kts': 'kotlin',\n      '.rs': 'rust',\n      '.rb': 'ruby',\n      '.cs': 'csharp',\n      '.php': 'php',\n      '.swift': 'swift',\n      '.scala': 'scala',\n      '.cpp': 'cpp',\n      '.cc': 'cpp',\n      '.cxx': 'cpp',\n      '.c': 'c',\n      '.h': 'c',\n      '.hpp': 'cpp',\n      '.lua': 'lua',\n      '.r': 'r',\n      '.dart': 'dart',\n      '.ex': 'elixir',\n      '.exs': 'elixir',\n      '.erl': 'erlang',\n      '.clj': 'clojure',\n      '.hs': 'haskell',\n      '.ml': 'ocaml',\n      '.fs': 'fsharp',\n      '.groovy': 'groovy',\n      '.pl': 'perl',\n      '.vue': 'vue',\n      '.svelte': 'svelte',\n    };\n    return map[ext] || 'code';\n  }\n\n  private getFrameworkGuide(framework: TestFramework): string {\n    const guides: Record<TestFramework, string> = {\n      jest: `Use Jest with:\n- describe() for test suites\n- it() or test() for test cases\n- expect() for assertions\n- beforeEach/afterEach for setup/teardown`,\n\n      vitest: `Use Vitest with:\n- describe() for test suites\n- it() or test() for test cases\n- expect() for assertions\n- vi.fn() for mocks`,\n\n      mocha: `Use Mocha with Chai:\n- describe() for test suites\n- it() for test cases\n- expect() from chai for assertions`,\n\n      pytest: `Use pytest with:\n- test_ prefix for test functions or methods\n- assert statements for assertions\n- @pytest.fixture for fixtures\n- @pytest.mark.parametrize for parameterized tests\n- Use Python syntax only`,\n\n      junit: `Use JUnit 5 with:\n- @Test annotation\n- @BeforeEach/@AfterEach for setup\n- Assertions class for assertions\n- @DisplayName for readable names`,\n\n      go: `Use Go testing with:\n- func TestXxx(t *testing.T) naming\n- t.Run() for subtests\n- t.Errorf() for failures\n- table-driven tests pattern`,\n    };\n    return guides[framework];\n  }\n\n  /**\n   * \u63D0\u53D6\u6D4B\u8BD5\u4EE3\u7801\uFF0C\u6E05\u7406\u4EE3\u7801\u5757\u6807\u8BB0\n   */\n  extractTestCode(response: string, expectedLanguage?: string): string {\n    // \u79FB\u9664\u6240\u6709\u4EE3\u7801\u5757\u6807\u8BB0\n    let code = response;\n    \n    // \u5339\u914D\u5E76\u79FB\u9664 ```language \u5F00\u59CB\u6807\u8BB0\n    code = code.replace(/^```[\\w]*\\s*\\n?/gm, '');\n    // \u79FB\u9664\u7ED3\u675F\u6807\u8BB0\n    code = code.replace(/\\n?```\\s*$/gm, '');\n    code = code.replace(/```/g, '');\n    \n    // \u6E05\u7406\u5F00\u5934\u548C\u7ED3\u5C3E\u7684\u7A7A\u767D\n    code = code.trim();\n    \n    // \u5982\u679C\u4EE3\u7801\u4EE5\u8BED\u8A00\u6807\u8BC6\u7B26\u5F00\u5934\uFF08\u6BD4\u5982 javascript, python\uFF09\uFF0C\u79FB\u9664\u5B83\n    const langPatterns = ['javascript', 'typescript', 'python', 'java', 'go', 'rust', 'ruby'];\n    for (const lang of langPatterns) {\n      if (code.toLowerCase().startsWith(lang + '\\n')) {\n        code = code.substring(lang.length + 1);\n        break;\n      }\n    }\n    \n    return code.trim();\n  }\n\n  async saveTestFile(\n    testCode: string,\n    testPath: string,\n    overwrite: boolean = false\n  ): Promise<{ success: boolean; path?: string; error?: string }> {\n    try {\n      if (fs.existsSync(testPath) && !overwrite) {\n        return { success: false, error: 'File already exists' };\n      }\n\n      const dir = path.dirname(testPath);\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n\n      // \u6E05\u7406\u4EE3\u7801\u4E2D\u53EF\u80FD\u6B8B\u7559\u7684\u4EE3\u7801\u5757\u6807\u8BB0\n      const cleanCode = this.extractTestCode(testCode);\n      \n      fs.writeFileSync(testPath, cleanCode, 'utf-8');\n      return { success: true, path: testPath };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      };\n    }\n  }\n\n  getTestCommand(framework: TestFramework, testPath: string): string {\n    const commands: Record<TestFramework, string> = {\n      jest: `npx jest \"${testPath}\"`,\n      vitest: `npx vitest run \"${testPath}\"`,\n      mocha: `npx mocha \"${testPath}\"`,\n      pytest: `python -m pytest \"${testPath}\" -v`,\n      junit: `mvn test -Dtest=${path.basename(testPath, '.java')}`,\n      go: `go test -v -run ${path.basename(testPath, '_test.go')}`,\n    };\n    return commands[framework];\n  }\n\n  /**\n   * \u6839\u636E\u6D4B\u8BD5\u6587\u4EF6\u8DEF\u5F84\u68C0\u6D4B\u5E94\u8BE5\u4F7F\u7528\u7684\u6D4B\u8BD5\u6846\u67B6\n   */\n  detectFrameworkByTestPath(testPath: string, workspaceRoot: string): TestFramework {\n    const ext = path.extname(testPath).toLowerCase();\n    \n    // \u6839\u636E\u6587\u4EF6\u6269\u5C55\u540D\u786E\u5B9A\u57FA\u7840\u6846\u67B6\n    const extFrameworks: Record<string, TestFramework> = {\n      '.py': 'pytest',\n      '.go': 'go',\n      '.java': 'junit',\n      '.kt': 'junit',\n      '.rs': 'go', // Rust uses cargo test, but we treat it like go\n    };\n\n    // \u5982\u679C\u662FPython/Go/Java\u7B49\u660E\u786E\u7684\u8BED\u8A00\uFF0C\u76F4\u63A5\u8FD4\u56DE\u5BF9\u5E94\u6846\u67B6\n    if (extFrameworks[ext]) {\n      return extFrameworks[ext];\n    }\n\n    // \u5BF9\u4E8EJS/TS\uFF0C\u68C0\u67E5\u9879\u76EE\u4E2D\u5B9E\u9645\u4F7F\u7528\u7684\u6846\u67B6\n    if (['.ts', '.tsx', '.js', '.jsx'].includes(ext)) {\n      const packageJsonPath = path.join(workspaceRoot, 'package.json');\n      if (fs.existsSync(packageJsonPath)) {\n        try {\n          const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n          const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n          if (deps['vitest']) return 'vitest';\n          if (deps['jest']) return 'jest';\n          if (deps['mocha']) return 'mocha';\n        } catch {}\n      }\n      return 'jest'; // JS/TS \u9ED8\u8BA4\u4F7F\u7528 jest\n    }\n\n    // \u9ED8\u8BA4\u60C5\u51B5\u4E0B\u8FD4\u56DE\u9ED8\u8BA4\u6846\u67B6\n    // \u6CE8\u610F\uFF1A\u8FD9\u91CC\u4E0D\u8C03\u7528async\u7684detectFramework\uFF0C\u4EE5\u4FDD\u6301\u540C\u6B65\n    return 'jest' as TestFramework;\n  }\n\n  /**\n   * \u83B7\u53D6\u8FD0\u884C\u6D4B\u8BD5\u7684\u5B8C\u6574\u547D\u4EE4\uFF08\u6839\u636E\u6587\u4EF6\u8DEF\u5F84\u667A\u80FD\u5224\u65AD\uFF09\n   */\n  getSmartTestCommand(testPath: string, workspaceRoot: string): string {\n    const ext = path.extname(testPath).toLowerCase();\n    const testFileName = path.basename(testPath);\n    \n    // Python\n    if (ext === '.py') {\n      // \u68C0\u67E5\u662F\u5426\u4F7F\u7528 unittest \u6216 pytest\n      if (fs.existsSync(path.join(workspaceRoot, 'pytest.ini')) ||\n          fs.existsSync(path.join(workspaceRoot, 'pyproject.toml')) ||\n          fs.existsSync(path.join(workspaceRoot, 'setup.cfg'))) {\n        return `python -m pytest \"${testPath}\" -v`;\n      }\n      // \u68C0\u67E5\u6587\u4EF6\u5185\u5BB9\u5224\u65AD\u6846\u67B6\n      try {\n        const content = fs.readFileSync(testPath, 'utf-8');\n        if (content.includes('import unittest') || content.includes('from unittest')) {\n          return `python -m unittest \"${testPath}\" -v`;\n        }\n      } catch {}\n      // \u9ED8\u8BA4\u4F7F\u7528 pytest\n      return `python -m pytest \"${testPath}\" -v`;\n    }\n    \n    // Go\n    if (ext === '.go') {\n      const dir = path.dirname(testPath);\n      const testName = path.basename(testPath, '_test.go');\n      // Go \u6D4B\u8BD5\u9700\u8981\u5728\u5305\u76EE\u5F55\u4E0B\u8FD0\u884C\n      return `cd \"${dir}\" && go test -v -run \"Test${this.capitalizeFirst(testName)}\"`;\n    }\n    \n    // Java\n    if (ext === '.java') {\n      const testName = path.basename(testPath, '.java');\n      // \u68C0\u6D4B\u662F Maven \u8FD8\u662F Gradle\n      if (fs.existsSync(path.join(workspaceRoot, 'pom.xml'))) {\n        return `mvn test -Dtest=\"${testName}\"`;\n      } else if (fs.existsSync(path.join(workspaceRoot, 'build.gradle')) || \n                 fs.existsSync(path.join(workspaceRoot, 'build.gradle.kts'))) {\n        // Windows/Unix \u517C\u5BB9\n        const gradleCmd = process.platform === 'win32' ? 'gradlew.bat' : './gradlew';\n        return `${gradleCmd} test --tests \"${testName}\"`;\n      }\n      return `mvn test -Dtest=\"${testName}\"`;\n    }\n    \n    // Kotlin\n    if (ext === '.kt') {\n      const testName = path.basename(testPath, '.kt');\n      const gradleCmd = process.platform === 'win32' ? 'gradlew.bat' : './gradlew';\n      return `${gradleCmd} test --tests \"${testName}\"`;\n    }\n    \n    // Rust\n    if (ext === '.rs') {\n      // Rust \u6D4B\u8BD5\u901A\u8FC7 cargo test \u8FD0\u884C\n      // \u5C1D\u8BD5\u63D0\u53D6\u6A21\u5757\u540D\n      const testName = path.basename(testPath, '.rs');\n      if (testName === 'lib' || testName === 'main') {\n        return 'cargo test';\n      }\n      return `cargo test ${testName}::`;\n    }\n    \n    // Ruby\n    if (ext === '.rb') {\n      if (testPath.includes('_spec.rb')) {\n        // RSpec\n        return `bundle exec rspec \"${testPath}\"`;\n      } else if (testPath.includes('_test.rb')) {\n        // Minitest\n        return `ruby -Ilib:test \"${testPath}\"`;\n      }\n      return `ruby \"${testPath}\"`;\n    }\n    \n    // C#\n    if (ext === '.cs') {\n      const testName = path.basename(testPath, '.cs');\n      return `dotnet test --filter \"FullyQualifiedName~${testName}\"`;\n    }\n    \n    // PHP\n    if (ext === '.php') {\n      if (testPath.includes('Test.php')) {\n        return `./vendor/bin/phpunit \"${testPath}\"`;\n      }\n      return `php \"${testPath}\"`;\n    }\n    \n    // Swift\n    if (ext === '.swift') {\n      return `swift test`;\n    }\n\n    // JavaScript/TypeScript - \u68C0\u6D4B\u5177\u4F53\u6846\u67B6\n    if (['.ts', '.tsx', '.js', '.jsx', '.mjs', '.cjs'].includes(ext)) {\n      const packageJsonPath = path.join(workspaceRoot, 'package.json');\n      if (fs.existsSync(packageJsonPath)) {\n        try {\n          const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n          const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n          const scripts = pkg.scripts || {};\n          \n          // \u68C0\u67E5\u662F\u5426\u6709\u6D4B\u8BD5\u811A\u672C\n          if (scripts.test) {\n            // \u5982\u679C\u6709 test \u811A\u672C\uFF0C\u68C0\u67E5\u5B83\u4F7F\u7528\u7684\u6846\u67B6\n            const testScript = scripts.test;\n            if (testScript.includes('vitest')) {\n              return `npx vitest run \"${testPath}\"`;\n            }\n            if (testScript.includes('jest')) {\n              return `npx jest \"${testPath}\"`;\n            }\n            if (testScript.includes('mocha')) {\n              return `npx mocha \"${testPath}\"`;\n            }\n            if (testScript.includes('ava')) {\n              return `npx ava \"${testPath}\"`;\n            }\n            if (testScript.includes('tap')) {\n              return `npx tap \"${testPath}\"`;\n            }\n          }\n          \n          // \u6839\u636E\u4F9D\u8D56\u5224\u65AD\n          if (deps['vitest']) return `npx vitest run \"${testPath}\"`;\n          if (deps['jest']) return `npx jest \"${testPath}\"`;\n          if (deps['mocha']) return `npx mocha \"${testPath}\"`;\n          if (deps['ava']) return `npx ava \"${testPath}\"`;\n          if (deps['tap']) return `npx tap \"${testPath}\"`;\n          if (deps['jasmine']) return `npx jasmine \"${testPath}\"`;\n          \n          // Deno \u68C0\u6D4B\n          if (fs.existsSync(path.join(workspaceRoot, 'deno.json')) ||\n              fs.existsSync(path.join(workspaceRoot, 'deno.jsonc'))) {\n            return `deno test \"${testPath}\"`;\n          }\n          \n          // Bun \u68C0\u6D4B\n          if (fs.existsSync(path.join(workspaceRoot, 'bun.lockb'))) {\n            return `bun test \"${testPath}\"`;\n          }\n        } catch {}\n      }\n      \n      // \u9ED8\u8BA4\u4F7F\u7528 jest\n      return `npx jest \"${testPath}\"`;\n    }\n    \n    // \u9ED8\u8BA4\u8FD4\u56DE jest \u547D\u4EE4\n    return `npx jest \"${testPath}\"`;\n  }\n\n  /**\n   * \u9996\u5B57\u6BCD\u5927\u5199\n   */\n  private capitalizeFirst(str: string): string {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  }\n\n  generateTemplate(framework: TestFramework, className?: string): string {\n    const templates: Record<TestFramework, string> = {\n      jest: `describe('${className || 'Module'}', () => {\n  beforeEach(() => {\n    // Setup\n  });\n\n  it('should work correctly', () => {\n    expect(true).toBe(true);\n  });\n});`,\n\n      vitest: `import { describe, it, expect, beforeEach } from 'vitest';\n\ndescribe('${className || 'Module'}', () => {\n  beforeEach(() => {\n    // Setup\n  });\n\n  it('should work correctly', () => {\n    expect(true).toBe(true);\n  });\n});`,\n\n      mocha: `const { expect } = require('chai');\n\ndescribe('${className || 'Module'}', () => {\n  beforeEach(() => {\n    // Setup\n  });\n\n  it('should work correctly', () => {\n    expect(true).to.be.true;\n  });\n});`,\n\n      pytest: `import pytest\n\nclass Test${className || 'Module'}:\n    @pytest.fixture(autouse=True)\n    def setup(self):\n        # Setup\n        pass\n\n    def test_should_work_correctly(self):\n        assert True`,\n\n      junit: `import org.junit.jupiter.api.*;\nimport static org.junit.jupiter.api.Assertions.*;\n\nclass ${className || 'Module'}Test {\n    @BeforeEach\n    void setUp() {\n        // Setup\n    }\n\n    @Test\n    @DisplayName(\"Should work correctly\")\n    void shouldWorkCorrectly() {\n        assertTrue(true);\n    }\n}`,\n\n      go: `package main\n\nimport \"testing\"\n\nfunc Test${className || 'Module'}(t *testing.T) {\n    t.Run(\"should work correctly\", func(t *testing.T) {\n        if true != true {\n            t.Error(\"Expected true\")\n        }\n    })\n}`,\n    };\n    return templates[framework];\n  }\n}\n", "/**\n * MCP (Model Context Protocol) \u7C7B\u578B\u5B9A\u4E49\n * \n * MCP\u662F\u4E00\u4E2A\u8BA9AI\u6A21\u578B\u4E0E\u5916\u90E8\u5DE5\u5177\u4EA4\u4E92\u7684\u534F\u8BAE\n * \u652F\u6301\u7528\u6237\u6CE8\u518C\u81EA\u5B9A\u4E49\u5DE5\u5177\uFF0CAgent\u81EA\u52A8\u9009\u62E9\u5DE5\u5177\u6267\u884C\u4EFB\u52A1\n */\n\n// ============================================\n// \u57FA\u7840\u7C7B\u578B\n// ============================================\n\n/**\n * \u53C2\u6570\u7C7B\u578B\n */\nexport type MCPParameterType = \n  | 'string' \n  | 'number' \n  | 'boolean' \n  | 'array' \n  | 'object'\n  | 'file'      // \u6587\u4EF6\u8DEF\u5F84\n  | 'code'      // \u4EE3\u7801\u7247\u6BB5\n  | 'json';     // JSON\u6570\u636E\n\n/**\n * \u5DE5\u5177\u7C7B\u522B\n */\nexport type MCPToolCategory = \n  | 'file'        // \u6587\u4EF6\u64CD\u4F5C\n  | 'code'        // \u4EE3\u7801\u76F8\u5173\n  | 'api'         // API\u8C03\u7528\n  | 'database'    // \u6570\u636E\u5E93\u64CD\u4F5C\n  | 'shell'       // Shell\u547D\u4EE4\n  | 'web'         // Web\u8BF7\u6C42\n  | 'ai'          // AI\u670D\u52A1\n  | 'utility'     // \u5DE5\u5177\u7C7B\n  | 'test'        // \u6D4B\u8BD5\u76F8\u5173\n  | 'diagram'     // \u56FE\u8868\u76F8\u5173\n  | 'git'         // Git\u64CD\u4F5C\n  | 'custom';     // \u81EA\u5B9A\u4E49\n\n/**\n * \u6267\u884C\u65B9\u5F0F\n */\nexport type MCPExecutionType = \n  | 'http'        // HTTP\u8BF7\u6C42\n  | 'command'     // \u547D\u4EE4\u884C\u6267\u884C\n  | 'function'    // \u5185\u7F6E\u51FD\u6570\n  | 'script'      // \u811A\u672C\u6267\u884C\n  | 'websocket';  // WebSocket\n\n/**\n * \u5DE5\u5177\u72B6\u6001\n */\nexport type MCPToolStatus = 'active' | 'inactive' | 'error' | 'testing';\n\n// ============================================\n// \u53C2\u6570\u5B9A\u4E49\n// ============================================\n\n/**\n * \u53C2\u6570\u9A8C\u8BC1\u89C4\u5219\n */\nexport interface MCPParameterValidation {\n  pattern?: string;          // \u6B63\u5219\u8868\u8FBE\u5F0F\n  min?: number;              // \u6700\u5C0F\u503C\uFF08\u6570\u5B57\uFF09\u6216\u6700\u5C0F\u957F\u5EA6\uFF08\u5B57\u7B26\u4E32\uFF09\n  max?: number;              // \u6700\u5927\u503C\uFF08\u6570\u5B57\uFF09\u6216\u6700\u5927\u957F\u5EA6\uFF08\u5B57\u7B26\u4E32\uFF09\n  enum?: string[];           // \u679A\u4E3E\u503C\n  customValidator?: string;  // \u81EA\u5B9A\u4E49\u9A8C\u8BC1\u51FD\u6570\u540D\n}\n\n/**\n * \u5DE5\u5177\u53C2\u6570\u5B9A\u4E49\n */\nexport interface MCPToolParameter {\n  name: string;\n  type: MCPParameterType;\n  description: string;\n  required: boolean;\n  default?: any;\n  validation?: MCPParameterValidation;\n  // \u6570\u7EC4\u7C7B\u578B\u7684\u5B50\u9879\u5B9A\u4E49\n  items?: {\n    type: MCPParameterType;\n    description?: string;\n  };\n  // \u5BF9\u8C61\u7C7B\u578B\u7684\u5C5E\u6027\u5B9A\u4E49\n  properties?: Record<string, MCPToolParameter>;\n}\n\n// ============================================\n// HTTP\u914D\u7F6E\n// ============================================\n\n/**\n * HTTP\u8BF7\u6C42\u914D\u7F6E\n */\nexport interface MCPHttpConfig {\n  url: string;\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  headers?: Record<string, string>;\n  // \u8BF7\u6C42\u4F53\u6A21\u677F\uFF0C\u652F\u6301 {{paramName}} \u53D8\u91CF\u66FF\u6362\n  bodyTemplate?: string;\n  // URL\u53C2\u6570\u6A21\u677F\n  queryTemplate?: Record<string, string>;\n  // \u54CD\u5E94\u5904\u7406\n  responseMapping?: {\n    resultPath?: string;      // \u7ED3\u679C\u6570\u636E\u8DEF\u5F84\uFF0C\u5982 \"data.result\"\n    errorPath?: string;       // \u9519\u8BEF\u4FE1\u606F\u8DEF\u5F84\n    successCondition?: string; // \u6210\u529F\u6761\u4EF6\u8868\u8FBE\u5F0F\n  };\n  // \u8D85\u65F6\u8BBE\u7F6E\uFF08\u6BEB\u79D2\uFF09\n  timeout?: number;\n  // \u8BA4\u8BC1\u914D\u7F6E\n  auth?: {\n    type: 'none' | 'bearer' | 'basic' | 'apiKey';\n    tokenEnvVar?: string;     // \u73AF\u5883\u53D8\u91CF\u540D\n    headerName?: string;      // API Key header\u540D\n  };\n}\n\n// ============================================\n// \u547D\u4EE4\u884C\u914D\u7F6E\n// ============================================\n\n/**\n * \u547D\u4EE4\u884C\u6267\u884C\u914D\u7F6E\n */\nexport interface MCPCommandConfig {\n  // \u547D\u4EE4\u6A21\u677F\uFF0C\u652F\u6301 {{paramName}} \u53D8\u91CF\u66FF\u6362\n  command: string;\n  // \u5DE5\u4F5C\u76EE\u5F55\n  cwd?: string;\n  // \u73AF\u5883\u53D8\u91CF\n  env?: Record<string, string>;\n  // Shell\u7C7B\u578B\n  shell?: 'bash' | 'powershell' | 'cmd' | 'sh';\n  // \u8D85\u65F6\u8BBE\u7F6E\uFF08\u6BEB\u79D2\uFF09\n  timeout?: number;\n  // \u662F\u5426\u9700\u8981\u786E\u8BA4\u6267\u884C\n  requireConfirmation?: boolean;\n  // \u5371\u9669\u547D\u4EE4\u68C0\u6D4B\n  dangerousPatterns?: string[];\n}\n\n// ============================================\n// \u811A\u672C\u914D\u7F6E\n// ============================================\n\n/**\n * \u811A\u672C\u6267\u884C\u914D\u7F6E\n */\nexport interface MCPScriptConfig {\n  // \u811A\u672C\u8BED\u8A00\n  language: 'javascript' | 'typescript' | 'python' | 'shell';\n  // \u811A\u672C\u5185\u5BB9\n  code: string;\n  // \u5165\u53E3\u51FD\u6570\u540D\n  entryFunction?: string;\n  // \u4F9D\u8D56\u5305\n  dependencies?: string[];\n  // \u8D85\u65F6\u8BBE\u7F6E\n  timeout?: number;\n}\n\n// ============================================\n// WebSocket\u914D\u7F6E\n// ============================================\n\n/**\n * WebSocket\u914D\u7F6E\n */\nexport interface MCPWebSocketConfig {\n  url: string;\n  // \u53D1\u9001\u6D88\u606F\u6A21\u677F\n  messageTemplate: string;\n  // \u54CD\u5E94\u5904\u7406\n  responseHandler?: string;\n  // \u8D85\u65F6\u8BBE\u7F6E\n  timeout?: number;\n}\n\n// ============================================\n// \u5DE5\u5177\u5B9A\u4E49\n// ============================================\n\n/**\n * MCP\u5DE5\u5177\u5B8C\u6574\u5B9A\u4E49\n */\nexport interface MCPToolDefinition {\n  // \u57FA\u672C\u4FE1\u606F\n  id: string;                       // \u552F\u4E00\u6807\u8BC6\u7B26\n  name: string;                     // \u663E\u793A\u540D\u79F0\n  description: string;              // \u8BE6\u7EC6\u63CF\u8FF0\n  version: string;                  // \u7248\u672C\u53F7\n  author?: string;                  // \u4F5C\u8005\n  \n  // \u5206\u7C7B\u548C\u6807\u7B7E\n  category: MCPToolCategory;\n  tags?: string[];\n  \n  // \u53C2\u6570\u5B9A\u4E49\n  parameters: MCPToolParameter[];\n  \n  // \u8FD4\u56DE\u503C\u5B9A\u4E49\n  returns: {\n    type: MCPParameterType;\n    description: string;\n    schema?: Record<string, any>;   // JSON Schema\n  };\n  \n  // \u6267\u884C\u914D\u7F6E\n  execution: {\n    type: MCPExecutionType;\n    http?: MCPHttpConfig;\n    command?: MCPCommandConfig;\n    script?: MCPScriptConfig;\n    websocket?: MCPWebSocketConfig;\n    // \u5185\u7F6E\u51FD\u6570\u540D\n    builtinFunction?: string;\n  };\n  \n  // \u5143\u6570\u636E\n  metadata: {\n    status: MCPToolStatus;\n    createdAt: number;\n    updatedAt: number;\n    lastUsedAt?: number;\n    usageCount?: number;\n    averageExecutionTime?: number;\n    successRate?: number;\n  };\n  \n  // AI\u63D0\u793A\n  aiHints?: {\n    // \u4F55\u65F6\u4F7F\u7528\u6B64\u5DE5\u5177\u7684\u63CF\u8FF0\n    whenToUse?: string;\n    // \u4F7F\u7528\u793A\u4F8B\n    examples?: Array<{\n      input: Record<string, any>;\n      output: any;\n      description?: string;\n    }>;\n    // \u4E0E\u5176\u4ED6\u5DE5\u5177\u7684\u5173\u7CFB\n    relatedTools?: string[];\n    // \u4F18\u5148\u7EA7\uFF08Agent\u9009\u62E9\u65F6\u4F7F\u7528\uFF09\n    priority?: number;\n  };\n  \n  // \u5B89\u5168\u8BBE\u7F6E\n  security?: {\n    // \u662F\u5426\u9700\u8981\u7528\u6237\u786E\u8BA4\n    requireConfirmation?: boolean;\n    // \u5141\u8BB8\u7684\u8C03\u7528\u8005\n    allowedCallers?: ('user' | 'agent')[];\n    // \u901F\u7387\u9650\u5236\uFF08\u6BCF\u5206\u949F\u6700\u5927\u8C03\u7528\u6B21\u6570\uFF09\n    rateLimit?: number;\n    // \u654F\u611F\u53C2\u6570\uFF08\u9700\u8981\u52A0\u5BC6\u5B58\u50A8\uFF09\n    sensitiveParams?: string[];\n    // \u5371\u9669\u547D\u4EE4\u6A21\u5F0F\uFF08\u9700\u8981\u989D\u5916\u8B66\u544A\uFF09\n    dangerousPatterns?: string[];\n  };\n}\n\n// ============================================\n// \u6267\u884C\u76F8\u5173\n// ============================================\n\n/**\n * \u5DE5\u5177\u8C03\u7528\u53C2\u6570\n */\nexport interface MCPToolCallParams {\n  toolId: string;\n  arguments: Record<string, any>;\n  // \u8C03\u7528\u6765\u6E90\n  caller: 'user' | 'agent';\n  // \u8BF7\u6C42ID\n  requestId?: string;\n  // \u4E0A\u4E0B\u6587\u4FE1\u606F\n  context?: {\n    sessionId?: string;\n    messageId?: string;\n    workspaceRoot?: string;\n    activeFile?: string;\n  };\n}\n\n/**\n * \u5DE5\u5177\u6267\u884C\u7ED3\u679C\n */\nexport interface MCPToolResult {\n  success: boolean;\n  toolId: string;\n  requestId?: string;\n  \n  // \u6210\u529F\u65F6\u7684\u6570\u636E\n  data?: any;\n  \n  // \u5931\u8D25\u65F6\u7684\u9519\u8BEF\u4FE1\u606F\n  error?: {\n    code: string;\n    message: string;\n    details?: any;\n  };\n  \n  // \u6267\u884C\u7EDF\u8BA1\n  stats: {\n    startTime: number;\n    endTime: number;\n    duration: number;\n  };\n  \n  // \u65E5\u5FD7\n  logs?: string[];\n}\n\n// ============================================\n// \u6CE8\u518C\u548C\u7BA1\u7406\n// ============================================\n\n/**\n * \u5DE5\u5177\u6CE8\u518C\u4FE1\u606F\n */\nexport interface MCPToolRegistration {\n  tool: MCPToolDefinition;\n  // \u6CE8\u518C\u6765\u6E90\n  source: 'builtin' | 'user' | 'marketplace' | 'import';\n  // \u662F\u5426\u542F\u7528\n  enabled: boolean;\n  // \u81EA\u5B9A\u4E49\u914D\u7F6E\u8986\u76D6\n  configOverrides?: Partial<MCPToolDefinition['execution']>;\n}\n\n/**\n * MCP\u914D\u7F6E\n */\nexport interface MCPConfig {\n  // \u662F\u5426\u542F\u7528MCP\u529F\u80FD\n  enabled: boolean;\n  // Agent\u81EA\u52A8\u9009\u62E9\u5DE5\u5177\u65F6\u7684\u6700\u5927\u5DE5\u5177\u6570\n  maxToolsPerRequest: number;\n  // \u9ED8\u8BA4\u8D85\u65F6\n  defaultTimeout: number;\n  // \u662F\u5426\u8BB0\u5F55\u6240\u6709\u6267\u884C\u65E5\u5FD7\n  logAllExecutions: boolean;\n  // \u73AF\u5883\u53D8\u91CF\uFF08\u7528\u4E8EAPI\u5BC6\u94A5\u7B49\uFF09\n  envVariables: Record<string, string>;\n  // \u5371\u9669\u547D\u4EE4\u9ED1\u540D\u5355\n  dangerousCommands: string[];\n}\n\n// ============================================\n// Agent\u76F8\u5173\n// ============================================\n\n/**\n * Agent\u5DE5\u5177\u9009\u62E9\u7ED3\u679C\n */\nexport interface MCPAgentToolSelection {\n  toolId: string;\n  confidence: number;        // \u7F6E\u4FE1\u5EA6 0-1\n  reason: string;            // \u9009\u62E9\u539F\u56E0\n  suggestedParams?: Record<string, any>;\n}\n\n/**\n * Agent\u4EFB\u52A1\u8BF7\u6C42\n */\nexport interface MCPAgentRequest {\n  task: string;              // \u7528\u6237\u4EFB\u52A1\u63CF\u8FF0\n  context?: {\n    workspaceRoot?: string;\n    activeFile?: string;\n    selectedCode?: string;\n    recentTools?: string[];  // \u6700\u8FD1\u4F7F\u7528\u7684\u5DE5\u5177\n  };\n  // \u7EA6\u675F\u6761\u4EF6\n  constraints?: {\n    allowedCategories?: MCPToolCategory[];\n    excludeTools?: string[];\n    maxExecutions?: number;\n  };\n}\n\n/**\n * Agent\u4EFB\u52A1\u7ED3\u679C\n */\nexport interface MCPAgentResult {\n  success: boolean;\n  task: string;\n  // \u6267\u884C\u8BA1\u5212\n  plan?: Array<{\n    step: number;\n    toolId: string;\n    description: string;\n    params: Record<string, any>;\n  }>;\n  // \u6267\u884C\u7ED3\u679C\n  executions: Array<{\n    toolId: string;\n    result: MCPToolResult;\n  }>;\n  // \u6700\u7EC8\u56DE\u7B54\n  answer?: string;\n  // \u6267\u884C\u6458\u8981\n  summary?: string;\n}\n\n// ============================================\n// WebView\u6D88\u606F\u7C7B\u578B\n// ============================================\n\n/**\n * MCP\u76F8\u5173\u7684WebView\u6D88\u606F\n */\nexport type MCPWebViewMessage = \n  | { type: 'mcp:getTools' }\n  | { type: 'mcp:getTool'; toolId: string }\n  | { type: 'mcp:registerTool'; tool: MCPToolDefinition }\n  | { type: 'mcp:updateTool'; tool: MCPToolDefinition }\n  | { type: 'mcp:deleteTool'; toolId: string }\n  | { type: 'mcp:toggleTool'; toolId: string; enabled: boolean }\n  | { type: 'mcp:testTool'; toolId: string; testParams: Record<string, any> }\n  | { type: 'mcp:executeTool'; params: MCPToolCallParams }\n  | { type: 'mcp:agentRequest'; request: MCPAgentRequest }\n  | { type: 'mcp:getConfig' }\n  | { type: 'mcp:updateConfig'; config: Partial<MCPConfig> }\n  | { type: 'mcp:importTools'; data: string }\n  | { type: 'mcp:exportTools'; toolIds?: string[] }\n  | { type: 'mcp:getExecutionHistory'; limit?: number };\n\n// ============================================\n// \u5185\u7F6E\u5DE5\u5177\u63A5\u53E3\n// ============================================\n\n/**\n * \u5185\u7F6E\u5DE5\u5177\u51FD\u6570\u7B7E\u540D\n */\nexport type MCPBuiltinFunction = (\n  params: Record<string, any>,\n  context: {\n    workspaceRoot?: string;\n    extensionContext: any;\n  }\n) => Promise<any>;\n\n/**\n * \u5185\u7F6E\u5DE5\u5177\u6CE8\u518C\u8868\n */\nexport interface MCPBuiltinRegistry {\n  [functionName: string]: MCPBuiltinFunction;\n}\n", "/**\n * MCP \u5185\u7F6E\u5DE5\u5177\u5B9A\u4E49\n * \n * \u63D0\u4F9B\u4E00\u7EC4\u5F00\u7BB1\u5373\u7528\u7684\u5E38\u7528\u5DE5\u5177\n */\n\nimport * as vscode from 'vscode';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { MCPToolDefinition, MCPBuiltinFunction, MCPBuiltinRegistry } from './types';\n\n// ============================================\n// \u5185\u7F6E\u5DE5\u5177\u5B9A\u4E49\n// ============================================\n\n/**\n * \u83B7\u53D6\u6240\u6709\u5185\u7F6E\u5DE5\u5177\n */\nexport function getBuiltinTools(): MCPToolDefinition[] {\n  return [\n    // \u6587\u4EF6\u8BFB\u53D6\u5DE5\u5177\n    {\n      id: 'builtin_read_file',\n      name: '\u8BFB\u53D6\u6587\u4EF6',\n      description: '\u8BFB\u53D6\u6307\u5B9A\u8DEF\u5F84\u7684\u6587\u4EF6\u5185\u5BB9',\n      version: '1.0.0',\n      author: 'System',\n      category: 'file',\n      tags: ['file', 'read', 'content'],\n      parameters: [\n        {\n          name: 'filePath',\n          type: 'file',\n          description: '\u6587\u4EF6\u8DEF\u5F84\uFF08\u76F8\u5BF9\u4E8E\u5DE5\u4F5C\u533A\u6216\u7EDD\u5BF9\u8DEF\u5F84\uFF09',\n          required: true,\n        },\n        {\n          name: 'encoding',\n          type: 'string',\n          description: '\u6587\u4EF6\u7F16\u7801',\n          required: false,\n          default: 'utf-8',\n          validation: {\n            enum: ['utf-8', 'ascii', 'utf-16', 'latin1'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u6587\u4EF6\u5185\u5BB9\u548C\u5143\u4FE1\u606F',\n        schema: {\n          content: 'string',\n          size: 'number',\n          path: 'string',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'readFile',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\u65F6\u4F7F\u7528',\n        examples: [\n          {\n            input: { filePath: 'src/index.ts' },\n            output: { content: '...', size: 1234, path: '/workspace/src/index.ts' },\n            description: '\u8BFB\u53D6TypeScript\u6587\u4EF6',\n          },\n        ],\n        priority: 80,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u6587\u4EF6\u5199\u5165\u5DE5\u5177\n    {\n      id: 'builtin_write_file',\n      name: '\u5199\u5165\u6587\u4EF6',\n      description: '\u5C06\u5185\u5BB9\u5199\u5165\u6307\u5B9A\u6587\u4EF6',\n      version: '1.0.0',\n      author: 'System',\n      category: 'file',\n      tags: ['file', 'write', 'save'],\n      parameters: [\n        {\n          name: 'filePath',\n          type: 'file',\n          description: '\u6587\u4EF6\u8DEF\u5F84',\n          required: true,\n        },\n        {\n          name: 'content',\n          type: 'string',\n          description: '\u8981\u5199\u5165\u7684\u5185\u5BB9',\n          required: true,\n        },\n        {\n          name: 'createDir',\n          type: 'boolean',\n          description: '\u5982\u679C\u76EE\u5F55\u4E0D\u5B58\u5728\u662F\u5426\u521B\u5EFA',\n          required: false,\n          default: true,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u5199\u5165\u7ED3\u679C',\n        schema: {\n          success: 'boolean',\n          path: 'string',\n          size: 'number',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'writeFile',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u521B\u5EFA\u6216\u4FEE\u6539\u6587\u4EF6\u65F6\u4F7F\u7528',\n        priority: 70,\n      },\n      security: {\n        requireConfirmation: true,\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u6587\u4EF6\u641C\u7D22\u5DE5\u5177\n    {\n      id: 'builtin_search_files',\n      name: '\u641C\u7D22\u6587\u4EF6',\n      description: '\u5728\u5DE5\u4F5C\u533A\u4E2D\u641C\u7D22\u5339\u914D\u7684\u6587\u4EF6',\n      version: '1.0.0',\n      author: 'System',\n      category: 'file',\n      tags: ['file', 'search', 'find', 'glob'],\n      parameters: [\n        {\n          name: 'pattern',\n          type: 'string',\n          description: 'Glob\u6A21\u5F0F\uFF0C\u5982 **/*.ts',\n          required: true,\n        },\n        {\n          name: 'exclude',\n          type: 'string',\n          description: '\u6392\u9664\u7684Glob\u6A21\u5F0F',\n          required: false,\n          default: '**/node_modules/**',\n        },\n        {\n          name: 'maxResults',\n          type: 'number',\n          description: '\u6700\u5927\u7ED3\u679C\u6570',\n          required: false,\n          default: 100,\n        },\n      ],\n      returns: {\n        type: 'array',\n        description: '\u5339\u914D\u7684\u6587\u4EF6\u8DEF\u5F84\u5217\u8868',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'searchFiles',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u67E5\u627E\u9879\u76EE\u4E2D\u7684\u6587\u4EF6\u65F6\u4F7F\u7528',\n        examples: [\n          {\n            input: { pattern: '**/*.test.ts' },\n            output: ['src/utils.test.ts', 'src/api.test.ts'],\n            description: '\u641C\u7D22\u6240\u6709\u6D4B\u8BD5\u6587\u4EF6',\n          },\n        ],\n        priority: 75,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u641C\u7D22\u5DE5\u5177\n    {\n      id: 'builtin_search_code',\n      name: '\u641C\u7D22\u4EE3\u7801',\n      description: '\u5728\u4EE3\u7801\u6587\u4EF6\u4E2D\u641C\u7D22\u6587\u672C\u6216\u6B63\u5219\u8868\u8FBE\u5F0F',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'search', 'grep', 'regex'],\n      parameters: [\n        {\n          name: 'query',\n          type: 'string',\n          description: '\u641C\u7D22\u6587\u672C\u6216\u6B63\u5219\u8868\u8FBE\u5F0F',\n          required: true,\n        },\n        {\n          name: 'isRegex',\n          type: 'boolean',\n          description: '\u662F\u5426\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F',\n          required: false,\n          default: false,\n        },\n        {\n          name: 'include',\n          type: 'string',\n          description: '\u5305\u542B\u7684\u6587\u4EF6\u6A21\u5F0F',\n          required: false,\n          default: '**/*',\n        },\n        {\n          name: 'maxResults',\n          type: 'number',\n          description: '\u6700\u5927\u7ED3\u679C\u6570',\n          required: false,\n          default: 50,\n        },\n      ],\n      returns: {\n        type: 'array',\n        description: '\u641C\u7D22\u7ED3\u679C\u5217\u8868',\n        schema: {\n          items: {\n            file: 'string',\n            line: 'number',\n            column: 'number',\n            text: 'string',\n          },\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'searchCode',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u5728\u4EE3\u7801\u4E2D\u641C\u7D22\u7279\u5B9A\u5185\u5BB9\u65F6\u4F7F\u7528',\n        priority: 85,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u6267\u884CShell\u547D\u4EE4\n    {\n      id: 'builtin_run_command',\n      name: '\u6267\u884C\u547D\u4EE4',\n      description: '\u5728\u7EC8\u7AEF\u6267\u884CShell\u547D\u4EE4',\n      version: '1.0.0',\n      author: 'System',\n      category: 'shell',\n      tags: ['shell', 'command', 'terminal', 'exec'],\n      parameters: [\n        {\n          name: 'command',\n          type: 'string',\n          description: '\u8981\u6267\u884C\u7684\u547D\u4EE4',\n          required: true,\n        },\n        {\n          name: 'cwd',\n          type: 'string',\n          description: '\u5DE5\u4F5C\u76EE\u5F55',\n          required: false,\n        },\n        {\n          name: 'timeout',\n          type: 'number',\n          description: '\u8D85\u65F6\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09',\n          required: false,\n          default: 30000,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u547D\u4EE4\u6267\u884C\u7ED3\u679C',\n        schema: {\n          stdout: 'string',\n          stderr: 'string',\n          exitCode: 'number',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'runCommand',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u6267\u884C\u7EC8\u7AEF\u547D\u4EE4\u65F6\u4F7F\u7528\uFF0C\u5982npm install, git status\u7B49',\n        examples: [\n          {\n            input: { command: 'npm run build' },\n            output: { stdout: 'Build completed', stderr: '', exitCode: 0 },\n          },\n        ],\n        priority: 60,\n      },\n      security: {\n        requireConfirmation: true,\n        allowedCallers: ['user', 'agent'],\n        dangerousPatterns: ['rm -rf', 'format', 'del /s'],\n      },\n    },\n    \n    // HTTP\u8BF7\u6C42\u5DE5\u5177\n    {\n      id: 'builtin_http_request',\n      name: 'HTTP\u8BF7\u6C42',\n      description: '\u53D1\u9001HTTP\u8BF7\u6C42\u5E76\u83B7\u53D6\u54CD\u5E94',\n      version: '1.0.0',\n      author: 'System',\n      category: 'web',\n      tags: ['http', 'api', 'request', 'fetch'],\n      parameters: [\n        {\n          name: 'url',\n          type: 'string',\n          description: '\u8BF7\u6C42URL',\n          required: true,\n        },\n        {\n          name: 'method',\n          type: 'string',\n          description: 'HTTP\u65B9\u6CD5',\n          required: false,\n          default: 'GET',\n          validation: {\n            enum: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n          },\n        },\n        {\n          name: 'headers',\n          type: 'object',\n          description: '\u8BF7\u6C42\u5934',\n          required: false,\n        },\n        {\n          name: 'body',\n          type: 'string',\n          description: '\u8BF7\u6C42\u4F53',\n          required: false,\n        },\n        {\n          name: 'timeout',\n          type: 'number',\n          description: '\u8D85\u65F6\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09',\n          required: false,\n          default: 30000,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: 'HTTP\u54CD\u5E94',\n        schema: {\n          status: 'number',\n          statusText: 'string',\n          headers: 'object',\n          body: 'string',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'httpRequest',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u8C03\u7528\u5916\u90E8API\u6216\u83B7\u53D6\u7F51\u7EDC\u8D44\u6E90\u65F6\u4F7F\u7528',\n        priority: 65,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u83B7\u53D6\u9879\u76EE\u7ED3\u6784\n    {\n      id: 'builtin_get_project_structure',\n      name: '\u83B7\u53D6\u9879\u76EE\u7ED3\u6784',\n      description: '\u83B7\u53D6\u5F53\u524D\u9879\u76EE\u7684\u76EE\u5F55\u7ED3\u6784',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['project', 'structure', 'tree', 'directory'],\n      parameters: [\n        {\n          name: 'depth',\n          type: 'number',\n          description: '\u76EE\u5F55\u6DF1\u5EA6',\n          required: false,\n          default: 3,\n        },\n        {\n          name: 'exclude',\n          type: 'array',\n          description: '\u6392\u9664\u7684\u76EE\u5F55',\n          required: false,\n          default: ['node_modules', '.git', 'dist', 'build'],\n          items: {\n            type: 'string',\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u9879\u76EE\u7ED3\u6784\u6811',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'getProjectStructure',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4E86\u89E3\u9879\u76EE\u6574\u4F53\u7ED3\u6784\u65F6\u4F7F\u7528',\n        priority: 90,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u83B7\u53D6\u5F53\u524D\u7F16\u8F91\u5668\u4FE1\u606F\n    {\n      id: 'builtin_get_editor_context',\n      name: '\u83B7\u53D6\u7F16\u8F91\u5668\u4E0A\u4E0B\u6587',\n      description: '\u83B7\u53D6\u5F53\u524D\u6D3B\u52A8\u7F16\u8F91\u5668\u7684\u4FE1\u606F',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['editor', 'context', 'selection', 'cursor'],\n      parameters: [],\n      returns: {\n        type: 'object',\n        description: '\u7F16\u8F91\u5668\u4E0A\u4E0B\u6587\u4FE1\u606F',\n        schema: {\n          fileName: 'string',\n          language: 'string',\n          content: 'string',\n          selection: 'string',\n          cursorPosition: 'object',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'getEditorContext',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u83B7\u53D6\u7528\u6237\u5F53\u524D\u6B63\u5728\u7F16\u8F91\u7684\u6587\u4EF6\u4FE1\u606F\u65F6\u4F7F\u7528',\n        priority: 95,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u63D2\u5165\u4EE3\u7801\u5230\u7F16\u8F91\u5668\n    {\n      id: 'builtin_insert_code',\n      name: '\u63D2\u5165\u4EE3\u7801',\n      description: '\u5728\u5F53\u524D\u7F16\u8F91\u5668\u5149\u6807\u4F4D\u7F6E\u63D2\u5165\u4EE3\u7801',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'insert', 'editor'],\n      parameters: [\n        {\n          name: 'code',\n          type: 'code',\n          description: '\u8981\u63D2\u5165\u7684\u4EE3\u7801',\n          required: true,\n        },\n        {\n          name: 'position',\n          type: 'string',\n          description: '\u63D2\u5165\u4F4D\u7F6E',\n          required: false,\n          default: 'cursor',\n          validation: {\n            enum: ['cursor', 'start', 'end', 'replace-selection'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u63D2\u5165\u7ED3\u679C',\n        schema: {\n          success: 'boolean',\n          insertedAt: 'object',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'insertCode',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u5728\u7F16\u8F91\u5668\u4E2D\u63D2\u5165\u4EE3\u7801\u65F6\u4F7F\u7528',\n        priority: 70,\n      },\n      security: {\n        requireConfirmation: false,\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git\u72B6\u6001\n    {\n      id: 'builtin_git_status',\n      name: 'Git\u72B6\u6001',\n      description: '\u83B7\u53D6\u5F53\u524DGit\u4ED3\u5E93\u72B6\u6001',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'status', 'version-control'],\n      parameters: [],\n      returns: {\n        type: 'object',\n        description: 'Git\u72B6\u6001\u4FE1\u606F',\n        schema: {\n          branch: 'string',\n          staged: 'array',\n          modified: 'array',\n          untracked: 'array',\n        },\n      },\n      execution: {\n        type: 'command',\n        command: {\n          command: 'git status --porcelain -b',\n          timeout: 10000,\n        },\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4E86\u89E3Git\u4ED3\u5E93\u72B6\u6001\u65F6\u4F7F\u7528',\n        priority: 60,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // ============================================\n    // \u547D\u4EE4\u8FC1\u79FB - \u5C06 /\u547D\u4EE4 \u8FC1\u79FB\u4E3A MCP \u5DE5\u5177\n    // ============================================\n    \n    // \u5E2E\u52A9\u547D\u4EE4\n    {\n      id: 'builtin_help',\n      name: '\u663E\u793A\u5E2E\u52A9',\n      description: '\u663E\u793A\u6240\u6709\u53EF\u7528\u7684\u547D\u4EE4\u548C\u529F\u80FD\u5E2E\u52A9\u4FE1\u606F',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['help', 'command', 'usage'],\n      parameters: [],\n      returns: {\n        type: 'string',\n        description: '\u5E2E\u52A9\u4FE1\u606F\u6587\u672C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'showHelp',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u7528\u6237\u8BE2\u95EE\u5982\u4F55\u4F7F\u7528\u6216\u9700\u8981\u5E2E\u52A9\u65F6',\n        priority: 50,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u9879\u76EE\u521D\u59CB\u5316/\u5206\u6790\n    {\n      id: 'builtin_init_project',\n      name: '\u5206\u6790\u9879\u76EE',\n      description: '\u5206\u6790\u5E76\u7406\u89E3\u5F53\u524D\u9879\u76EE\u7684\u7ED3\u6784\u3001\u7C7B\u578B\u3001\u6846\u67B6\u548C\u4F9D\u8D56',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['project', 'init', 'analyze', 'structure'],\n      parameters: [\n        {\n          name: 'depth',\n          type: 'number',\n          description: '\u5206\u6790\u6DF1\u5EA6',\n          required: false,\n          default: 3,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u9879\u76EE\u5206\u6790\u7ED3\u679C',\n        schema: {\n          type: 'string',\n          framework: 'string',\n          language: 'string',\n          structure: 'object',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'initProject',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4E86\u89E3\u9879\u76EE\u7ED3\u6784\u6216\u5F00\u59CB\u65B0\u7684\u5DE5\u4F5C\u4F1A\u8BDD\u65F6',\n        priority: 85,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git \u5FEB\u6377\u547D\u4EE4 - pull\n    {\n      id: 'builtin_git_pull',\n      name: 'Git\u62C9\u53D6',\n      description: '\u4ECE\u8FDC\u7A0B\u4ED3\u5E93\u62C9\u53D6\u6700\u65B0\u4EE3\u7801 (git pull)',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'pull', 'sync'],\n      parameters: [\n        {\n          name: 'remote',\n          type: 'string',\n          description: '\u8FDC\u7A0B\u4ED3\u5E93\u540D\u79F0',\n          required: false,\n          default: 'origin',\n        },\n        {\n          name: 'branch',\n          type: 'string',\n          description: '\u5206\u652F\u540D\u79F0',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u547D\u4EE4\u6267\u884C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'gitPull',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u62C9\u53D6\u8FDC\u7A0B\u4EE3\u7801\u66F4\u65B0\u65F6',\n        priority: 55,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git \u5FEB\u6377\u547D\u4EE4 - push\n    {\n      id: 'builtin_git_push',\n      name: 'Git\u63A8\u9001',\n      description: '\u63A8\u9001\u672C\u5730\u63D0\u4EA4\u5230\u8FDC\u7A0B\u4ED3\u5E93 (git push)',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'push', 'sync'],\n      parameters: [\n        {\n          name: 'remote',\n          type: 'string',\n          description: '\u8FDC\u7A0B\u4ED3\u5E93\u540D\u79F0',\n          required: false,\n          default: 'origin',\n        },\n        {\n          name: 'branch',\n          type: 'string',\n          description: '\u5206\u652F\u540D\u79F0',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u547D\u4EE4\u6267\u884C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'gitPush',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u63A8\u9001\u672C\u5730\u4EE3\u7801\u5230\u8FDC\u7A0B\u4ED3\u5E93\u65F6',\n        priority: 55,\n      },\n      security: {\n        requireConfirmation: true,\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git \u5FEB\u6377\u547D\u4EE4 - commit\n    {\n      id: 'builtin_git_commit',\n      name: 'Git\u63D0\u4EA4',\n      description: '\u63D0\u4EA4\u66F4\u6539\u5230\u672C\u5730\u4ED3\u5E93 (git commit)',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'commit', 'save'],\n      parameters: [\n        {\n          name: 'message',\n          type: 'string',\n          description: '\u63D0\u4EA4\u4FE1\u606F',\n          required: true,\n        },\n        {\n          name: 'all',\n          type: 'boolean',\n          description: '\u662F\u5426\u63D0\u4EA4\u6240\u6709\u66F4\u6539 (-a)',\n          required: false,\n          default: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u547D\u4EE4\u6267\u884C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'gitCommit',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u63D0\u4EA4\u4EE3\u7801\u66F4\u6539\u65F6',\n        priority: 60,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git \u5FEB\u6377\u547D\u4EE4 - checkout\n    {\n      id: 'builtin_git_checkout',\n      name: 'Git\u5207\u6362\u5206\u652F',\n      description: '\u5207\u6362\u5230\u6307\u5B9A\u5206\u652F (git checkout)',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'checkout', 'branch', 'switch'],\n      parameters: [\n        {\n          name: 'branch',\n          type: 'string',\n          description: '\u5206\u652F\u540D\u79F0',\n          required: true,\n        },\n        {\n          name: 'create',\n          type: 'boolean',\n          description: '\u662F\u5426\u521B\u5EFA\u65B0\u5206\u652F (-b)',\n          required: false,\n          default: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u547D\u4EE4\u6267\u884C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'gitCheckout',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u5207\u6362\u5206\u652F\u65F6',\n        priority: 55,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git \u5FEB\u6377\u547D\u4EE4 - diff\n    {\n      id: 'builtin_git_diff',\n      name: 'Git\u5DEE\u5F02',\n      description: '\u663E\u793A\u672A\u63D0\u4EA4\u7684\u66F4\u6539 (git diff)',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'diff', 'changes'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u6307\u5B9A\u6587\u4EF6\uFF08\u53EF\u9009\uFF0C\u4E0D\u6307\u5B9A\u5219\u663E\u793A\u6240\u6709\u66F4\u6539\uFF09',\n          required: false,\n        },\n        {\n          name: 'staged',\n          type: 'boolean',\n          description: '\u662F\u5426\u663E\u793A\u5DF2\u6682\u5B58\u7684\u66F4\u6539 (--staged)',\n          required: false,\n          default: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u5DEE\u5F02\u5185\u5BB9',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'gitDiff',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u67E5\u770B\u4EE3\u7801\u66F4\u6539\u65F6',\n        priority: 60,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // Git \u5FEB\u6377\u547D\u4EE4 - log\n    {\n      id: 'builtin_git_log',\n      name: 'Git\u65E5\u5FD7',\n      description: '\u663E\u793A\u63D0\u4EA4\u5386\u53F2 (git log)',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['git', 'log', 'history'],\n      parameters: [\n        {\n          name: 'count',\n          type: 'number',\n          description: '\u663E\u793A\u7684\u63D0\u4EA4\u6570\u91CF',\n          required: false,\n          default: 15,\n        },\n        {\n          name: 'oneline',\n          type: 'boolean',\n          description: '\u5355\u884C\u663E\u793A (--oneline)',\n          required: false,\n          default: true,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u63D0\u4EA4\u5386\u53F2',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'gitLog',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u67E5\u770B\u63D0\u4EA4\u5386\u53F2\u65F6',\n        priority: 55,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u8FD0\u884C\u6D4B\u8BD5\n    {\n      id: 'builtin_run_test',\n      name: '\u8FD0\u884C\u6D4B\u8BD5',\n      description: '\u8FD0\u884C\u9879\u76EE\u7684\u6D4B\u8BD5\u5957\u4EF6',\n      version: '1.0.0',\n      author: 'System',\n      category: 'test',\n      tags: ['test', 'run', 'unit', 'jest', 'vitest'],\n      parameters: [\n        {\n          name: 'pattern',\n          type: 'string',\n          description: '\u6D4B\u8BD5\u6587\u4EF6\u6A21\u5F0F\uFF08\u53EF\u9009\uFF09',\n          required: false,\n        },\n        {\n          name: 'watch',\n          type: 'boolean',\n          description: '\u662F\u5426\u76D1\u542C\u6A21\u5F0F',\n          required: false,\n          default: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u6D4B\u8BD5\u6267\u884C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'runTest',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u8FD0\u884C\u6D4B\u8BD5\u65F6',\n        priority: 65,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u6784\u5EFA\u9879\u76EE\n    {\n      id: 'builtin_build',\n      name: '\u6784\u5EFA\u9879\u76EE',\n      description: '\u6784\u5EFA/\u7F16\u8BD1\u9879\u76EE',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['build', 'compile', 'npm', 'yarn'],\n      parameters: [\n        {\n          name: 'command',\n          type: 'string',\n          description: '\u81EA\u5B9A\u4E49\u6784\u5EFA\u547D\u4EE4\uFF08\u53EF\u9009\uFF0C\u9ED8\u8BA4\u4F7F\u7528 npm run build\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u6784\u5EFA\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'buildProject',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u6784\u5EFA\u9879\u76EE\u65F6',\n        priority: 60,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u751F\u6210\u56FE\u8868\n    {\n      id: 'builtin_diagram',\n      name: '\u751F\u6210\u56FE\u8868',\n      description: '\u6839\u636E\u4EE3\u7801\u6216\u63CF\u8FF0\u751F\u6210\u5404\u7C7B\u56FE\u8868\uFF08\u6D41\u7A0B\u56FE\u3001\u65F6\u5E8F\u56FE\u3001\u7C7B\u56FE\u3001\u67B6\u6784\u56FE\u7B49\uFF09',\n      version: '1.0.0',\n      author: 'System',\n      category: 'diagram',\n      tags: ['diagram', 'flowchart', 'sequence', 'class', 'mermaid'],\n      parameters: [\n        {\n          name: 'type',\n          type: 'string',\n          description: '\u56FE\u8868\u7C7B\u578B',\n          required: false,\n          default: 'flowchart',\n          validation: {\n            enum: ['flowchart', 'sequence', 'class', 'state', 'er', 'gantt', 'mindmap', 'architecture'],\n          },\n        },\n        {\n          name: 'source',\n          type: 'string',\n          description: '\u6765\u6E90: file(\u5F53\u524D\u6587\u4EF6), project(\u6574\u4E2A\u9879\u76EE), selection(\u9009\u4E2D\u5185\u5BB9), description(\u6587\u5B57\u63CF\u8FF0)',\n          required: false,\n          default: 'file',\n          validation: {\n            enum: ['file', 'project', 'selection', 'description'],\n          },\n        },\n        {\n          name: 'description',\n          type: 'string',\n          description: '\u56FE\u8868\u63CF\u8FF0\uFF08\u5F53source\u4E3Adescription\u65F6\u9700\u8981\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: 'Mermaid\u56FE\u8868\u4EE3\u7801',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'generateDiagram',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u53EF\u89C6\u5316\u4EE3\u7801\u7ED3\u6784\u6216\u6D41\u7A0B\u65F6',\n        examples: [\n          {\n            input: { type: 'flowchart', source: 'file' },\n            output: { mermaid: 'flowchart TD...' },\n            description: '\u4E3A\u5F53\u524D\u6587\u4EF6\u751F\u6210\u6D41\u7A0B\u56FE',\n          },\n        ],\n        priority: 70,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u751F\u6210\u6D4B\u8BD5\n    {\n      id: 'builtin_gentest',\n      name: '\u751F\u6210\u6D4B\u8BD5',\n      description: '\u4E3A\u4EE3\u7801\u81EA\u52A8\u751F\u6210\u5355\u5143\u6D4B\u8BD5',\n      version: '1.0.0',\n      author: 'System',\n      category: 'test',\n      tags: ['test', 'generate', 'unit', 'jest', 'vitest'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u751F\u6210\u6D4B\u8BD5\u7684\u6587\u4EF6\uFF08\u53EF\u9009\uFF0C\u9ED8\u8BA4\u5F53\u524D\u6587\u4EF6\uFF09',\n          required: false,\n        },\n        {\n          name: 'framework',\n          type: 'string',\n          description: '\u6D4B\u8BD5\u6846\u67B6',\n          required: false,\n          validation: {\n            enum: ['jest', 'vitest', 'mocha', 'pytest', 'auto'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u751F\u6210\u7684\u6D4B\u8BD5\u4EE3\u7801',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'generateTest',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4E3A\u4EE3\u7801\u751F\u6210\u6D4B\u8BD5\u65F6',\n        priority: 75,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n  ];\n}\n\n// ============================================\n// \u5185\u7F6E\u51FD\u6570\u5B9E\u73B0\n// ============================================\n\n/**\n * \u5185\u7F6E\u51FD\u6570\u6CE8\u518C\u8868\n */\nexport const builtinFunctions: MCPBuiltinRegistry = {\n  /**\n   * \u8BFB\u53D6\u6587\u4EF6\n   */\n  readFile: async (params, context) => {\n    const { filePath, encoding = 'utf-8' } = params;\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    const fullPath = path.isAbsolute(filePath) \n      ? filePath \n      : path.join(workspaceRoot, filePath);\n    \n    if (!fs.existsSync(fullPath)) {\n      throw new Error(`File not found: ${filePath}`);\n    }\n    \n    const stats = fs.statSync(fullPath);\n    const content = fs.readFileSync(fullPath, encoding as BufferEncoding);\n    \n    return {\n      content,\n      size: stats.size,\n      path: fullPath,\n      modified: stats.mtime.toISOString(),\n    };\n  },\n  \n  /**\n   * \u5199\u5165\u6587\u4EF6\n   */\n  writeFile: async (params, context) => {\n    const { filePath, content, createDir = true } = params;\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    const fullPath = path.isAbsolute(filePath) \n      ? filePath \n      : path.join(workspaceRoot, filePath);\n    \n    const dir = path.dirname(fullPath);\n    if (createDir && !fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n    \n    fs.writeFileSync(fullPath, content, 'utf-8');\n    const stats = fs.statSync(fullPath);\n    \n    return {\n      success: true,\n      path: fullPath,\n      size: stats.size,\n    };\n  },\n  \n  /**\n   * \u641C\u7D22\u6587\u4EF6\n   */\n  searchFiles: async (params, context) => {\n    const { pattern, exclude = '**/node_modules/**', maxResults = 100 } = params;\n    \n    const files = await vscode.workspace.findFiles(\n      pattern,\n      exclude,\n      maxResults\n    );\n    \n    return files.map(f => vscode.workspace.asRelativePath(f));\n  },\n  \n  /**\n   * \u641C\u7D22\u4EE3\u7801\n   */\n  searchCode: async (params, context) => {\n    const { query, isRegex = false, include = '**/*', maxResults = 50 } = params;\n    \n    const results: Array<{\n      file: string;\n      line: number;\n      column: number;\n      text: string;\n    }> = [];\n    \n    const files = await vscode.workspace.findFiles(include, '**/node_modules/**', 1000);\n    \n    for (const fileUri of files) {\n      if (results.length >= maxResults) break;\n      \n      try {\n        const document = await vscode.workspace.openTextDocument(fileUri);\n        const text = document.getText();\n        const lines = text.split('\\n');\n        \n        const regex = isRegex ? new RegExp(query, 'g') : null;\n        \n        for (let i = 0; i < lines.length && results.length < maxResults; i++) {\n          const line = lines[i];\n          let match: boolean;\n          let column = 0;\n          \n          if (regex) {\n            const m = regex.exec(line);\n            match = m !== null;\n            column = m?.index || 0;\n            regex.lastIndex = 0;\n          } else {\n            column = line.indexOf(query);\n            match = column !== -1;\n          }\n          \n          if (match) {\n            results.push({\n              file: vscode.workspace.asRelativePath(fileUri),\n              line: i + 1,\n              column: column + 1,\n              text: line.trim().substring(0, 200),\n            });\n          }\n        }\n      } catch (e) {\n        // \u8DF3\u8FC7\u65E0\u6CD5\u8BFB\u53D6\u7684\u6587\u4EF6\n      }\n    }\n    \n    return results;\n  },\n  \n  /**\n   * \u6267\u884C\u547D\u4EE4\n   */\n  runCommand: async (params, context) => {\n    const { command, cwd, timeout = 30000 } = params;\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      const { stdout, stderr } = await execAsync(command, {\n        cwd: cwd || workspaceRoot,\n        timeout,\n        maxBuffer: 10 * 1024 * 1024, // 10MB\n      });\n      \n      return {\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n        exitCode: 0,\n      };\n    } catch (error: any) {\n      return {\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n        exitCode: error.code || 1,\n      };\n    }\n  },\n  \n  /**\n   * HTTP\u8BF7\u6C42\n   */\n  httpRequest: async (params, context) => {\n    const { url, method = 'GET', headers = {}, body, timeout = 30000 } = params;\n    \n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n    \n    try {\n      const response = await fetch(url, {\n        method,\n        headers,\n        body: body ? body : undefined,\n        signal: controller.signal,\n      });\n      \n      clearTimeout(timeoutId);\n      \n      const responseBody = await response.text();\n      \n      return {\n        status: response.status,\n        statusText: response.statusText,\n        headers: Object.fromEntries(response.headers.entries()),\n        body: responseBody,\n      };\n    } catch (error: any) {\n      clearTimeout(timeoutId);\n      throw new Error(`HTTP request failed: ${error.message}`);\n    }\n  },\n  \n  /**\n   * \u83B7\u53D6\u9879\u76EE\u7ED3\u6784\n   */\n  getProjectStructure: async (params, context) => {\n    const { depth = 3, exclude = ['node_modules', '.git', 'dist', 'build'] } = params;\n    const workspaceRoot = context.workspaceRoot;\n    \n    if (!workspaceRoot) {\n      throw new Error('No workspace folder open');\n    }\n    \n    const buildTree = (dir: string, currentDepth: number): any => {\n      if (currentDepth > depth) return null;\n      \n      const result: any = {\n        name: path.basename(dir),\n        type: 'directory',\n        children: [],\n      };\n      \n      try {\n        const items = fs.readdirSync(dir);\n        \n        for (const item of items) {\n          if (exclude.includes(item) || item.startsWith('.')) continue;\n          \n          const fullPath = path.join(dir, item);\n          const stats = fs.statSync(fullPath);\n          \n          if (stats.isDirectory()) {\n            const subtree = buildTree(fullPath, currentDepth + 1);\n            if (subtree) {\n              result.children.push(subtree);\n            }\n          } else {\n            result.children.push({\n              name: item,\n              type: 'file',\n              size: stats.size,\n            });\n          }\n        }\n      } catch (e) {\n        // \u5FFD\u7565\u6743\u9650\u9519\u8BEF\n      }\n      \n      return result;\n    };\n    \n    return buildTree(workspaceRoot, 1);\n  },\n  \n  /**\n   * \u83B7\u53D6\u7F16\u8F91\u5668\u4E0A\u4E0B\u6587\n   */\n  getEditorContext: async (params, context) => {\n    const editor = vscode.window.activeTextEditor;\n    \n    if (!editor) {\n      return {\n        active: false,\n        message: 'No active editor',\n      };\n    }\n    \n    const document = editor.document;\n    const selection = editor.selection;\n    \n    return {\n      active: true,\n      fileName: document.fileName,\n      relativePath: vscode.workspace.asRelativePath(document.uri),\n      language: document.languageId,\n      lineCount: document.lineCount,\n      content: document.getText(),\n      selection: document.getText(selection),\n      hasSelection: !selection.isEmpty,\n      cursorPosition: {\n        line: selection.active.line + 1,\n        column: selection.active.character + 1,\n      },\n      isDirty: document.isDirty,\n    };\n  },\n  \n  /**\n   * \u63D2\u5165\u4EE3\u7801\n   */\n  insertCode: async (params, context) => {\n    const { code, position = 'cursor' } = params;\n    const editor = vscode.window.activeTextEditor;\n    \n    if (!editor) {\n      throw new Error('No active editor');\n    }\n    \n    let insertPosition: vscode.Position;\n    let range: vscode.Range | undefined;\n    \n    switch (position) {\n      case 'start':\n        insertPosition = new vscode.Position(0, 0);\n        break;\n      case 'end':\n        const lastLine = editor.document.lineCount - 1;\n        insertPosition = new vscode.Position(\n          lastLine,\n          editor.document.lineAt(lastLine).text.length\n        );\n        break;\n      case 'replace-selection':\n        range = editor.selection;\n        insertPosition = editor.selection.start;\n        break;\n      case 'cursor':\n      default:\n        insertPosition = editor.selection.active;\n        break;\n    }\n    \n    const success = await editor.edit(editBuilder => {\n      if (range && position === 'replace-selection') {\n        editBuilder.replace(range, code);\n      } else {\n        editBuilder.insert(insertPosition, code);\n      }\n    });\n    \n    return {\n      success,\n      insertedAt: {\n        line: insertPosition.line + 1,\n        column: insertPosition.character + 1,\n      },\n    };\n  },\n  \n  // ============================================\n  // \u547D\u4EE4\u8FC1\u79FB - \u65B0\u589E\u5185\u7F6E\u51FD\u6570\n  // ============================================\n  \n  /**\n   * \u663E\u793A\u5E2E\u52A9\u4FE1\u606F\n   */\n  showHelp: async (params, context) => {\n    return {\n      content: `## \uD83E\uDD16 AI Code Assistant \u5E2E\u52A9\n\n### \u4E3B\u8981\u529F\u80FD\n\n**1. \u667A\u80FD\u5BF9\u8BDD** - \u4E0E AI \u8FDB\u884C\u81EA\u7136\u8BED\u8A00\u5BF9\u8BDD\n- \u652F\u6301\u591A\u8F6E\u5BF9\u8BDD\u3001\u4E0A\u4E0B\u6587\u7406\u89E3\n- \u53EF\u4E0A\u4F20\u56FE\u7247\u3001\u4EE3\u7801\u8FDB\u884C\u5206\u6790\n\n**2. \u4EE3\u7801\u64CD\u4F5C** - \u9009\u4E2D\u4EE3\u7801\u540E\u4F7F\u7528\n- \u53F3\u952E\u83DC\u5355\uFF1A\u89E3\u91CA\u3001\u4FEE\u590D\u3001\u91CD\u6784\u3001\u6DFB\u52A0\u6CE8\u91CA\n\n**3. MCP\u5DE5\u5177\u8C03\u7528** - \u4F7F\u7528 @mcp:\u5DE5\u5177\u540D \u8C03\u7528\n- @mcp:file:read - \u8BFB\u53D6\u6587\u4EF6\n- @mcp:shell:run - \u6267\u884C\u547D\u4EE4\n- @mcp:git:status - Git\u72B6\u6001\n\n**4. Skill\u6280\u80FD\u8C03\u7528** - \u4F7F\u7528 @skill:\u6280\u80FD\u540D \u8C03\u7528\n- @skill:test-architect - \u751F\u6210\u6D4B\u8BD5\n- @skill:code-reviewer - \u4EE3\u7801\u5BA1\u67E5\n- @skill:tool-maker - \u5236\u4F5C\u5DE5\u5177\n\n### \u2328\uFE0F \u5FEB\u6377\u952E\n\n- \\`\u2191/\u2193\\` - \u6D4F\u89C8\u5386\u53F2\u8F93\u5165\n- \\`Tab\\` - \u547D\u4EE4\u81EA\u52A8\u8865\u5168\n- \\`ESC\\` - \u505C\u6B62\u5F53\u524D\u4EFB\u52A1\n- \\`Alt+Enter\\` - \u8F93\u5165\u6362\u884C\n\n### \uD83D\uDCA1 \u4F7F\u7528\u6280\u5DE7\n\n1. **\u9009\u4E2D\u4EE3\u7801** \u518D\u8F93\u5165\u95EE\u9898\uFF0CAI\u4F1A\u9488\u5BF9\u8BE5\u4EE3\u7801\u56DE\u7B54\n2. **\u62D6\u62FD\u6587\u4EF6** \u5230\u8F93\u5165\u6846\u53EF\u4E0A\u4F20\u56FE\u7247/\u6587\u6863\n3. **\u8F93\u5165@** \u89E6\u53D1MCP\u548CSkill\u667A\u80FD\u63D0\u793A`,\n    };\n  },\n  \n  /**\n   * \u521D\u59CB\u5316/\u5206\u6790\u9879\u76EE\n   */\n  initProject: async (params, context) => {\n    const workspaceRoot = context.workspaceRoot;\n    \n    if (!workspaceRoot) {\n      throw new Error('\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u5DE5\u4F5C\u533A');\n    }\n    \n    // \u5206\u6790\u9879\u76EE\u7C7B\u578B\u548C\u6846\u67B6\n    const analysis: any = {\n      type: 'unknown',\n      framework: null,\n      language: null,\n      structure: {},\n    };\n    \n    try {\n      // \u68C0\u6D4B\u9879\u76EE\u7C7B\u578B\n      const packageJsonPath = path.join(workspaceRoot, 'package.json');\n      if (fs.existsSync(packageJsonPath)) {\n        const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n        analysis.type = 'nodejs';\n        analysis.language = 'javascript/typescript';\n        \n        // \u68C0\u6D4B\u6846\u67B6\n        const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n        if (deps['react']) analysis.framework = 'React';\n        else if (deps['vue']) analysis.framework = 'Vue';\n        else if (deps['@angular/core']) analysis.framework = 'Angular';\n        else if (deps['next']) analysis.framework = 'Next.js';\n        else if (deps['express']) analysis.framework = 'Express';\n      }\n      \n      // \u68C0\u6D4B\u5176\u4ED6\u9879\u76EE\u7C7B\u578B\n      if (fs.existsSync(path.join(workspaceRoot, 'requirements.txt')) || \n          fs.existsSync(path.join(workspaceRoot, 'pyproject.toml'))) {\n        analysis.type = 'python';\n        analysis.language = 'python';\n      }\n      \n      if (fs.existsSync(path.join(workspaceRoot, 'go.mod'))) {\n        analysis.type = 'go';\n        analysis.language = 'go';\n      }\n      \n      if (fs.existsSync(path.join(workspaceRoot, 'pom.xml')) ||\n          fs.existsSync(path.join(workspaceRoot, 'build.gradle'))) {\n        analysis.type = 'java';\n        analysis.language = 'java';\n      }\n      \n      // \u83B7\u53D6\u7B80\u5316\u7684\u76EE\u5F55\u7ED3\u6784\n      const getStructure = (dir: string, depth: number = 0, maxDepth: number = 2): any => {\n        if (depth > maxDepth) return null;\n        \n        const result: any = { name: path.basename(dir), type: 'directory', children: [] };\n        const exclude = ['node_modules', '.git', 'dist', 'build', '.next', '__pycache__', 'venv'];\n        \n        try {\n          const items = fs.readdirSync(dir);\n          for (const item of items) {\n            if (exclude.includes(item) || item.startsWith('.')) continue;\n            \n            const fullPath = path.join(dir, item);\n            const stats = fs.statSync(fullPath);\n            \n            if (stats.isDirectory()) {\n              const subtree = getStructure(fullPath, depth + 1, maxDepth);\n              if (subtree) result.children.push(subtree);\n            } else {\n              result.children.push({ name: item, type: 'file' });\n            }\n          }\n        } catch (e) {\n          // \u5FFD\u7565\u6743\u9650\u9519\u8BEF\n        }\n        \n        return result;\n      };\n      \n      analysis.structure = getStructure(workspaceRoot);\n      \n    } catch (e) {\n      console.error('\u9879\u76EE\u5206\u6790\u5931\u8D25:', e);\n    }\n    \n    return analysis;\n  },\n  \n  /**\n   * Git pull\n   */\n  gitPull: async (params, context) => {\n    const { remote = 'origin', branch } = params;\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      const cmd = branch ? `git pull ${remote} ${branch}` : 'git pull';\n      const { stdout, stderr } = await execAsync(cmd, {\n        cwd: context.workspaceRoot,\n        timeout: 60000,\n      });\n      \n      return {\n        success: true,\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * Git push\n   */\n  gitPush: async (params, context) => {\n    const { remote = 'origin', branch } = params;\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      const cmd = branch ? `git push ${remote} ${branch}` : 'git push';\n      const { stdout, stderr } = await execAsync(cmd, {\n        cwd: context.workspaceRoot,\n        timeout: 60000,\n      });\n      \n      return {\n        success: true,\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * Git commit\n   */\n  gitCommit: async (params, context) => {\n    const { message, all = false } = params;\n    \n    if (!message) {\n      throw new Error('\u63D0\u4EA4\u4FE1\u606F\u4E0D\u80FD\u4E3A\u7A7A');\n    }\n    \n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      const flags = all ? '-am' : '-m';\n      const { stdout, stderr } = await execAsync(`git commit ${flags} \"${message}\"`, {\n        cwd: context.workspaceRoot,\n        timeout: 30000,\n      });\n      \n      return {\n        success: true,\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * Git checkout\n   */\n  gitCheckout: async (params, context) => {\n    const { branch, create = false } = params;\n    \n    if (!branch) {\n      throw new Error('\u8BF7\u6307\u5B9A\u5206\u652F\u540D\u79F0');\n    }\n    \n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      const cmd = create ? `git checkout -b ${branch}` : `git checkout ${branch}`;\n      const { stdout, stderr } = await execAsync(cmd, {\n        cwd: context.workspaceRoot,\n        timeout: 30000,\n      });\n      \n      return {\n        success: true,\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * Git diff\n   */\n  gitDiff: async (params, context) => {\n    const { file, staged = false } = params;\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      let cmd = 'git diff';\n      if (staged) cmd += ' --staged';\n      if (file) cmd += ` ${file}`;\n      \n      const { stdout, stderr } = await execAsync(cmd, {\n        cwd: context.workspaceRoot,\n        timeout: 30000,\n        maxBuffer: 10 * 1024 * 1024,\n      });\n      \n      return {\n        success: true,\n        diff: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        diff: '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * Git log\n   */\n  gitLog: async (params, context) => {\n    const { count = 15, oneline = true } = params;\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    try {\n      const format = oneline ? '--oneline' : '';\n      const { stdout, stderr } = await execAsync(`git log ${format} -${count}`, {\n        cwd: context.workspaceRoot,\n        timeout: 30000,\n      });\n      \n      return {\n        success: true,\n        log: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        log: '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * \u8FD0\u884C\u6D4B\u8BD5\n   */\n  runTest: async (params, context) => {\n    const { pattern, watch = false } = params;\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    // \u68C0\u6D4B\u6D4B\u8BD5\u6846\u67B6\n    let testCmd = 'npm test';\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    try {\n      if (workspaceRoot) {\n        const pkgPath = path.join(workspaceRoot, 'package.json');\n        if (fs.existsSync(pkgPath)) {\n          const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n          const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n          \n          if (deps['vitest']) {\n            testCmd = watch ? 'npx vitest' : 'npx vitest run';\n          } else if (deps['jest']) {\n            testCmd = watch ? 'npx jest --watch' : 'npx jest';\n          }\n        }\n      }\n      \n      if (pattern) {\n        testCmd += ` ${pattern}`;\n      }\n      \n      const { stdout, stderr } = await execAsync(testCmd, {\n        cwd: workspaceRoot || process.cwd(),\n        timeout: 120000,\n        maxBuffer: 10 * 1024 * 1024,\n      });\n      \n      return {\n        success: true,\n        command: testCmd,\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        command: testCmd,\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * \u6784\u5EFA\u9879\u76EE\n   */\n  buildProject: async (params, context) => {\n    const { command } = params;\n    const { exec } = require('child_process');\n    const { promisify } = require('util');\n    const execAsync = promisify(exec);\n    \n    let buildCmd = command || 'npm run build';\n    \n    try {\n      const { stdout, stderr } = await execAsync(buildCmd, {\n        cwd: context.workspaceRoot,\n        timeout: 300000, // 5\u5206\u949F\u8D85\u65F6\n        maxBuffer: 10 * 1024 * 1024,\n      });\n      \n      return {\n        success: true,\n        command: buildCmd,\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        command: buildCmd,\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n      };\n    }\n  },\n  \n  /**\n   * \u751F\u6210\u56FE\u8868\uFF08\u8FD4\u56DE\u63D0\u793A\uFF0C\u5B9E\u9645\u751F\u6210\u9700\u8981AI\u914D\u5408\uFF09\n   */\n  generateDiagram: async (params, context) => {\n    const { type = 'flowchart', source = 'file', description } = params;\n    \n    // \u83B7\u53D6\u4E0A\u4E0B\u6587\n    let content = '';\n    \n    if (source === 'description') {\n      content = description || '';\n    } else if (source === 'selection') {\n      const editor = vscode.window.activeTextEditor;\n      if (editor && !editor.selection.isEmpty) {\n        content = editor.document.getText(editor.selection);\n      }\n    } else if (source === 'file') {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        content = editor.document.getText();\n      }\n    }\n    \n    return {\n      type,\n      source,\n      content,\n      instruction: `\u8BF7\u6839\u636E\u4EE5\u4E0A\u5185\u5BB9\u751F\u6210 ${type} \u7C7B\u578B\u7684 Mermaid \u56FE\u8868`,\n    };\n  },\n  \n  /**\n   * \u751F\u6210\u6D4B\u8BD5\uFF08\u8FD4\u56DE\u63D0\u793A\uFF0C\u5B9E\u9645\u751F\u6210\u9700\u8981AI\u914D\u5408\uFF09\n   */\n  generateTest: async (params, context) => {\n    const { file, framework } = params;\n    \n    let targetFile = file;\n    let content = '';\n    \n    if (!targetFile) {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        targetFile = vscode.workspace.asRelativePath(editor.document.uri);\n        content = editor.document.getText();\n      }\n    } else {\n      const workspaceRoot = context.workspaceRoot || '';\n      const fullPath = path.isAbsolute(targetFile) \n        ? targetFile \n        : path.join(workspaceRoot, targetFile);\n      \n      if (fs.existsSync(fullPath)) {\n        content = fs.readFileSync(fullPath, 'utf-8');\n      }\n    }\n    \n    // \u68C0\u6D4B\u6D4B\u8BD5\u6846\u67B6\n    let detectedFramework = framework || 'auto';\n    \n    if (detectedFramework === 'auto') {\n      try {\n        const workspaceRoot = context.workspaceRoot || '';\n        if (workspaceRoot) {\n          const pkgPath = path.join(workspaceRoot, 'package.json');\n          if (fs.existsSync(pkgPath)) {\n            const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n            const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n            \n            if (deps['vitest']) detectedFramework = 'vitest';\n            else if (deps['jest']) detectedFramework = 'jest';\n            else if (deps['mocha']) detectedFramework = 'mocha';\n          }\n        }\n        \n        // Python \u9879\u76EE\n        if (targetFile?.endsWith('.py')) {\n          detectedFramework = 'pytest';\n        }\n      } catch (e) {\n        // \u5FFD\u7565\n      }\n    }\n    \n    return {\n      file: targetFile,\n      content,\n      framework: detectedFramework,\n      instruction: `\u8BF7\u4E3A\u4EE5\u4E0A\u4EE3\u7801\u751F\u6210 ${detectedFramework} \u5355\u5143\u6D4B\u8BD5`,\n    };\n  },\n};\n", "/**\n * \u8865\u5145\u5185\u7F6E\u5DE5\u5177\n * \n * \u5305\u542B\u4E4B\u524D\u9057\u6F0F\u7684\u5DE5\u5177\u5B9A\u4E49\u548C\u5B9E\u73B0\n */\n\nimport * as vscode from 'vscode';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { MCPToolDefinition, MCPBuiltinFunction } from './types';\n\n// ============================================\n// \u8865\u5145\u5DE5\u5177\u5B9A\u4E49\n// ============================================\n\nexport function getAdditionalBuiltinTools(): MCPToolDefinition[] {\n  return [\n    // \u6D4B\u8BD5\u751F\u6210\u5668\u5DE5\u5177\n    {\n      id: 'builtin_generate_test',\n      name: '\u751F\u6210\u5355\u5143\u6D4B\u8BD5',\n      description: '\u81EA\u52A8\u8BC6\u522B\u9879\u76EE\u6D4B\u8BD5\u6846\u67B6\u5E76\u4E3A\u6E90\u4EE3\u7801\u751F\u6210\u5BF9\u5E94\u7684\u5355\u5143\u6D4B\u8BD5\uFF0C\u652F\u6301Jest/Vitest/Pytest/Go/JUnit\u7B49',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['test', 'unit-test', 'testing', 'generate', 'jest', 'vitest', 'pytest'],\n      parameters: [\n        {\n          name: 'filePath',\n          type: 'file',\n          description: '\u8981\u751F\u6210\u6D4B\u8BD5\u7684\u6E90\u6587\u4EF6\u8DEF\u5F84\uFF08\u53EF\u9009\uFF0C\u9ED8\u8BA4\u5F53\u524D\u6587\u4EF6\uFF09',\n          required: false,\n        },\n        {\n          name: 'code',\n          type: 'string',\n          description: '\u8981\u751F\u6210\u6D4B\u8BD5\u7684\u4EE3\u7801\u5185\u5BB9\uFF08\u53EF\u9009\uFF0C\u5982\u679C\u4E0D\u63D0\u4F9B\u5219\u8BFB\u53D6\u6587\u4EF6\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u751F\u6210\u7684\u6D4B\u8BD5\u4EE3\u7801\u3001\u5EFA\u8BAE\u7684\u6587\u4EF6\u8DEF\u5F84\u3001\u68C0\u6D4B\u5230\u7684\u6846\u67B6',\n        schema: {\n          testCode: 'string',\n          suggestedPath: 'string',\n          framework: 'string',\n          language: 'string',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'generateTest',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u7528\u6237\u9700\u8981\u4E3A\u4EE3\u7801\u751F\u6210\u5355\u5143\u6D4B\u8BD5\u65F6\u4F7F\u7528',\n        examples: [\n          {\n            input: { filePath: 'src/utils.ts' },\n            output: { testCode: '...', framework: 'jest', suggestedPath: 'src/utils_test.ts' },\n            description: '\u4E3ATypeScript\u6587\u4EF6\u751F\u6210Jest\u6D4B\u8BD5',\n          },\n        ],\n        priority: 85,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n\n    // \u4EE3\u7801\u5206\u6790\u5DE5\u5177\n    {\n      id: 'builtin_analyze_code',\n      name: '\u5206\u6790\u4EE3\u7801',\n      description: '\u5206\u6790\u4EE3\u7801\u7ED3\u6784\u3001\u590D\u6742\u5EA6\u3001\u4F9D\u8D56\u5173\u7CFB\u7B49',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'analyze', 'structure', 'complexity', 'dependency'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u5206\u6790\u7684\u6587\u4EF6\u8DEF\u5F84\uFF08\u53EF\u9009\uFF0C\u9ED8\u8BA4\u5F53\u524D\u6587\u4EF6\uFF09',\n          required: false,\n        },\n        {\n          name: 'type',\n          type: 'string',\n          description: '\u5206\u6790\u7C7B\u578B',\n          required: false,\n          default: 'full',\n          validation: {\n            enum: ['full', 'structure', 'complexity', 'dependencies', 'issues'],\n          },\n        },\n        {\n          name: 'includeMetrics',\n          type: 'boolean',\n          description: '\u662F\u5426\u5305\u542B\u4EE3\u7801\u5EA6\u91CF\u6307\u6807',\n          required: false,\n          default: true,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u4EE3\u7801\u5206\u6790\u7ED3\u679C',\n        schema: {\n          structure: 'object',\n          complexity: 'object',\n          dependencies: 'array',\n          issues: 'array',\n          metrics: 'object',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'analyzeCode',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4E86\u89E3\u4EE3\u7801\u7ED3\u6784\u3001\u590D\u6742\u5EA6\u6216\u5BFB\u627E\u6F5C\u5728\u95EE\u9898\u65F6\u4F7F\u7528',\n        examples: [\n          {\n            input: { file: 'src/index.ts', type: 'full' },\n            output: {\n              structure: { classes: 2, functions: 5 },\n              complexity: { cyclomatic: 8 },\n              dependencies: ['vscode', 'path'],\n              issues: [],\n            },\n            description: '\u5206\u6790TypeScript\u6587\u4EF6',\n          },\n        ],\n        priority: 80,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u91CD\u6784\u5DE5\u5177\n    {\n      id: 'builtin_refactor_code',\n      name: '\u91CD\u6784\u4EE3\u7801',\n      description: '\u6267\u884C\u4EE3\u7801\u91CD\u6784\u64CD\u4F5C\uFF0C\u5982\u63D0\u53D6\u51FD\u6570\u3001\u91CD\u547D\u540D\u3001\u79FB\u52A8\u7B49',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'refactor', 'extract', 'rename', 'move'],\n      parameters: [\n        {\n          name: 'action',\n          type: 'string',\n          description: '\u91CD\u6784\u64CD\u4F5C\u7C7B\u578B',\n          required: true,\n          validation: {\n            enum: ['extract-function', 'extract-variable', 'rename', 'move', 'inline'],\n          },\n        },\n        {\n          name: 'target',\n          type: 'string',\n          description: '\u76EE\u6807\u4EE3\u7801\u6216\u7B26\u53F7\u540D\u79F0',\n          required: true,\n        },\n        {\n          name: 'newName',\n          type: 'string',\n          description: '\u65B0\u540D\u79F0\uFF08\u7528\u4E8Erename\u64CD\u4F5C\uFF09',\n          required: false,\n        },\n        {\n          name: 'destination',\n          type: 'string',\n          description: '\u76EE\u6807\u4F4D\u7F6E\uFF08\u7528\u4E8Emove\u64CD\u4F5C\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u91CD\u6784\u7ED3\u679C',\n        schema: {\n          success: 'boolean',\n          changes: 'array',\n          preview: 'string',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'refactorCode',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u91CD\u6784\u4EE3\u7801\u65F6\u4F7F\u7528',\n        priority: 70,\n      },\n      security: {\n        requireConfirmation: true,\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u683C\u5F0F\u5316\u5DE5\u5177\n    {\n      id: 'builtin_format_code',\n      name: '\u683C\u5F0F\u5316\u4EE3\u7801',\n      description: '\u683C\u5F0F\u5316\u4EE3\u7801\u6216\u6587\u4EF6',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'format', 'prettier', 'lint'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u683C\u5F0F\u5316\u7684\u6587\u4EF6\uFF08\u53EF\u9009\uFF0C\u9ED8\u8BA4\u5F53\u524D\u6587\u4EF6\uFF09',\n          required: false,\n        },\n        {\n          name: 'formatter',\n          type: 'string',\n          description: '\u4F7F\u7528\u7684\u683C\u5F0F\u5316\u5DE5\u5177',\n          required: false,\n          default: 'auto',\n          validation: {\n            enum: ['auto', 'prettier', 'eslint', 'vscode'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u683C\u5F0F\u5316\u7ED3\u679C',\n        schema: {\n          success: 'boolean',\n          formatted: 'string',\n          changes: 'number',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'formatCode',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u683C\u5F0F\u5316\u4EE3\u7801\u65F6\u4F7F\u7528',\n        priority: 65,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u89E3\u91CA\u5DE5\u5177\n    {\n      id: 'builtin_explain_code',\n      name: '\u89E3\u91CA\u4EE3\u7801',\n      description: '\u83B7\u53D6\u4EE3\u7801\u7684\u8BE6\u7EC6\u89E3\u91CA\uFF0C\u5305\u62EC\u51FD\u6570\u4F5C\u7528\u3001\u53C2\u6570\u8BF4\u660E\u7B49',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'explain', 'document', 'understand'],\n      parameters: [\n        {\n          name: 'code',\n          type: 'code',\n          description: '\u8981\u89E3\u91CA\u7684\u4EE3\u7801\uFF08\u53EF\u9009\uFF0C\u4F7F\u7528\u9009\u4E2D\u5185\u5BB9\uFF09',\n          required: false,\n        },\n        {\n          name: 'level',\n          type: 'string',\n          description: '\u89E3\u91CA\u8BE6\u7EC6\u7A0B\u5EA6',\n          required: false,\n          default: 'normal',\n          validation: {\n            enum: ['brief', 'normal', 'detailed'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u4EE3\u7801\u89E3\u91CA',\n        schema: {\n          summary: 'string',\n          details: 'object',\n          examples: 'array',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'explainCode',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u7528\u6237\u8BF7\u6C42\u89E3\u91CA\u4EE3\u7801\u65F6\u4F7F\u7528',\n        priority: 75,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u4F18\u5316\u5EFA\u8BAE\u5DE5\u5177\n    {\n      id: 'builtin_suggest_optimization',\n      name: '\u4F18\u5316\u5EFA\u8BAE',\n      description: '\u5206\u6790\u4EE3\u7801\u5E76\u63D0\u4F9B\u4F18\u5316\u5EFA\u8BAE',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'optimize', 'performance', 'suggestion'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u5206\u6790\u7684\u6587\u4EF6',\n          required: false,\n        },\n        {\n          name: 'focus',\n          type: 'string',\n          description: '\u4F18\u5316\u91CD\u70B9',\n          required: false,\n          default: 'all',\n          validation: {\n            enum: ['all', 'performance', 'readability', 'security', 'memory'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u4F18\u5316\u5EFA\u8BAE\u5217\u8868',\n        schema: {\n          suggestions: 'array',\n          priority: 'string',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'suggestOptimization',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u6539\u8FDB\u4EE3\u7801\u8D28\u91CF\u65F6\u4F7F\u7528',\n        priority: 70,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u6587\u6863\u751F\u6210\u5DE5\u5177\n    {\n      id: 'builtin_generate_docs',\n      name: '\u751F\u6210\u6587\u6863',\n      description: '\u4E3A\u4EE3\u7801\u751F\u6210\u6587\u6863\u6CE8\u91CA',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'document', 'jsdoc', 'comment'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u751F\u6210\u6587\u6863\u7684\u6587\u4EF6',\n          required: false,\n        },\n        {\n          name: 'style',\n          type: 'string',\n          description: '\u6587\u6863\u98CE\u683C',\n          required: false,\n          default: 'jsdoc',\n          validation: {\n            enum: ['jsdoc', 'tsdoc', 'docstring', 'javadoc'],\n          },\n        },\n        {\n          name: 'overwrite',\n          type: 'boolean',\n          description: '\u662F\u5426\u8986\u76D6\u73B0\u6709\u6587\u6863',\n          required: false,\n          default: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u751F\u6210\u7684\u6587\u6863',\n        schema: {\n          documentedItems: 'number',\n          preview: 'string',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'generateDocs',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4E3A\u4EE3\u7801\u6DFB\u52A0\u6587\u6863\u6CE8\u91CA\u65F6\u4F7F\u7528',\n        priority: 65,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4F9D\u8D56\u5206\u6790\u5DE5\u5177\n    {\n      id: 'builtin_analyze_dependencies',\n      name: '\u5206\u6790\u4F9D\u8D56',\n      description: '\u5206\u6790\u9879\u76EE\u4F9D\u8D56\u5173\u7CFB\u3001\u7248\u672C\u548C\u5B89\u5168\u95EE\u9898',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['dependency', 'package', 'npm', 'security', 'audit'],\n      parameters: [\n        {\n          name: 'type',\n          type: 'string',\n          description: '\u5206\u6790\u7C7B\u578B',\n          required: false,\n          default: 'all',\n          validation: {\n            enum: ['all', 'outdated', 'security', 'unused', 'duplicates'],\n          },\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u4F9D\u8D56\u5206\u6790\u7ED3\u679C',\n        schema: {\n          dependencies: 'object',\n          devDependencies: 'object',\n          issues: 'array',\n          recommendations: 'array',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'analyzeDependencies',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u68C0\u67E5\u9879\u76EE\u4F9D\u8D56\u65F6\u4F7F\u7528',\n        priority: 60,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u7247\u6BB5\u5DE5\u5177\n    {\n      id: 'builtin_code_snippet',\n      name: '\u4EE3\u7801\u7247\u6BB5',\n      description: '\u641C\u7D22\u548C\u63D2\u5165\u5E38\u7528\u4EE3\u7801\u7247\u6BB5',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['code', 'snippet', 'template', 'boilerplate'],\n      parameters: [\n        {\n          name: 'action',\n          type: 'string',\n          description: '\u64CD\u4F5C\u7C7B\u578B',\n          required: true,\n          validation: {\n            enum: ['search', 'insert', 'save', 'list'],\n          },\n        },\n        {\n          name: 'query',\n          type: 'string',\n          description: '\u641C\u7D22\u5173\u952E\u8BCD\uFF08search\u65F6\u9700\u8981\uFF09',\n          required: false,\n        },\n        {\n          name: 'snippet',\n          type: 'code',\n          description: '\u4EE3\u7801\u7247\u6BB5\uFF08insert/save\u65F6\u9700\u8981\uFF09',\n          required: false,\n        },\n        {\n          name: 'name',\n          type: 'string',\n          description: '\u7247\u6BB5\u540D\u79F0\uFF08save\u65F6\u9700\u8981\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u64CD\u4F5C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'codeSnippet',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u4F7F\u7528\u5E38\u7528\u4EE3\u7801\u6A21\u677F\u65F6\u4F7F\u7528',\n        priority: 55,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u7EC8\u7AEF\u7BA1\u7406\u5DE5\u5177\n    {\n      id: 'builtin_terminal',\n      name: '\u7EC8\u7AEF\u7BA1\u7406',\n      description: '\u521B\u5EFA\u3001\u5207\u6362\u548C\u7BA1\u7406\u7EC8\u7AEF',\n      version: '1.0.0',\n      author: 'System',\n      category: 'shell',\n      tags: ['terminal', 'shell', 'console'],\n      parameters: [\n        {\n          name: 'action',\n          type: 'string',\n          description: '\u64CD\u4F5C\u7C7B\u578B',\n          required: true,\n          validation: {\n            enum: ['create', 'show', 'hide', 'dispose', 'list', 'sendText'],\n          },\n        },\n        {\n          name: 'name',\n          type: 'string',\n          description: '\u7EC8\u7AEF\u540D\u79F0',\n          required: false,\n        },\n        {\n          name: 'text',\n          type: 'string',\n          description: '\u8981\u53D1\u9001\u7684\u6587\u672C\uFF08sendText\u65F6\u9700\u8981\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u7EC8\u7AEF\u64CD\u4F5C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'terminalManage',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u7BA1\u7406VS Code\u7EC8\u7AEF\u65F6\u4F7F\u7528',\n        priority: 50,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u5DE5\u4F5C\u533A\u7BA1\u7406\u5DE5\u5177\n    {\n      id: 'builtin_workspace',\n      name: '\u5DE5\u4F5C\u533A\u7BA1\u7406',\n      description: '\u7BA1\u7406VS Code\u5DE5\u4F5C\u533A',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['workspace', 'folder', 'project'],\n      parameters: [\n        {\n          name: 'action',\n          type: 'string',\n          description: '\u64CD\u4F5C\u7C7B\u578B',\n          required: true,\n          validation: {\n            enum: ['info', 'addFolder', 'removeFolder', 'openFile', 'openFolder'],\n          },\n        },\n        {\n          name: 'path',\n          type: 'string',\n          description: '\u6587\u4EF6\u6216\u6587\u4EF6\u5939\u8DEF\u5F84',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u5DE5\u4F5C\u533A\u4FE1\u606F\u6216\u64CD\u4F5C\u7ED3\u679C',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'workspaceManage',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u7BA1\u7406\u5DE5\u4F5C\u533A\u65F6\u4F7F\u7528',\n        priority: 50,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u7B26\u53F7\u67E5\u627E\u5DE5\u5177\n    {\n      id: 'builtin_find_symbol',\n      name: '\u67E5\u627E\u7B26\u53F7',\n      description: '\u5728\u5DE5\u4F5C\u533A\u4E2D\u67E5\u627E\u7B26\u53F7\u5B9A\u4E49',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['symbol', 'definition', 'reference', 'find'],\n      parameters: [\n        {\n          name: 'name',\n          type: 'string',\n          description: '\u7B26\u53F7\u540D\u79F0',\n          required: true,\n        },\n        {\n          name: 'kind',\n          type: 'string',\n          description: '\u7B26\u53F7\u7C7B\u578B',\n          required: false,\n          validation: {\n            enum: ['all', 'class', 'function', 'method', 'variable', 'interface', 'type'],\n          },\n        },\n      ],\n      returns: {\n        type: 'array',\n        description: '\u7B26\u53F7\u4F4D\u7F6E\u5217\u8868',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'findSymbol',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u67E5\u627E\u4EE3\u7801\u4E2D\u7684\u7B26\u53F7\u5B9A\u4E49\u65F6\u4F7F\u7528',\n        priority: 75,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u4EE3\u7801\u8BCA\u65AD\u5DE5\u5177\n    {\n      id: 'builtin_diagnostics',\n      name: '\u4EE3\u7801\u8BCA\u65AD',\n      description: '\u83B7\u53D6\u4EE3\u7801\u8BCA\u65AD\u4FE1\u606F\uFF08\u9519\u8BEF\u3001\u8B66\u544A\u7B49\uFF09',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['diagnostics', 'errors', 'warnings', 'lint'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u8BCA\u65AD\u7684\u6587\u4EF6\uFF08\u53EF\u9009\uFF0C\u9ED8\u8BA4\u5F53\u524D\u6587\u4EF6\uFF09',\n          required: false,\n        },\n        {\n          name: 'severity',\n          type: 'string',\n          description: '\u4E25\u91CD\u7A0B\u5EA6\u8FC7\u6EE4',\n          required: false,\n          default: 'all',\n          validation: {\n            enum: ['all', 'error', 'warning', 'info', 'hint'],\n          },\n        },\n      ],\n      returns: {\n        type: 'array',\n        description: '\u8BCA\u65AD\u4FE1\u606F\u5217\u8868',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'getDiagnostics',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u68C0\u67E5\u4EE3\u7801\u95EE\u9898\u65F6\u4F7F\u7528',\n        priority: 80,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u81EA\u52A8\u4FEE\u590D\u5DE5\u5177\n    {\n      id: 'builtin_auto_fix',\n      name: '\u81EA\u52A8\u4FEE\u590D',\n      description: '\u81EA\u52A8\u4FEE\u590D\u4EE3\u7801\u95EE\u9898',\n      version: '1.0.0',\n      author: 'System',\n      category: 'code',\n      tags: ['fix', 'auto', 'quick-fix', 'repair'],\n      parameters: [\n        {\n          name: 'file',\n          type: 'file',\n          description: '\u8981\u4FEE\u590D\u7684\u6587\u4EF6',\n          required: false,\n        },\n        {\n          name: 'diagnosticIndex',\n          type: 'number',\n          description: '\u8981\u4FEE\u590D\u7684\u8BCA\u65AD\u7D22\u5F15\uFF08\u53EF\u9009\uFF0C\u4E0D\u6307\u5B9A\u5219\u4FEE\u590D\u6240\u6709\uFF09',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'object',\n        description: '\u4FEE\u590D\u7ED3\u679C',\n        schema: {\n          fixed: 'number',\n          remaining: 'number',\n        },\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'autoFix',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u81EA\u52A8\u4FEE\u590D\u4EE3\u7801\u95EE\u9898\u65F6\u4F7F\u7528',\n        priority: 70,\n      },\n      security: {\n        requireConfirmation: true,\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n    \n    // \u5217\u51FAMCP\u5DE5\u5177\n    {\n      id: 'builtin_list_tools',\n      name: '\u5217\u51FA\u5DE5\u5177',\n      description: '\u5217\u51FA\u6240\u6709\u53EF\u7528\u7684MCP\u5DE5\u5177',\n      version: '1.0.0',\n      author: 'System',\n      category: 'utility',\n      tags: ['mcp', 'tools', 'list', 'help'],\n      parameters: [\n        {\n          name: 'category',\n          type: 'string',\n          description: '\u6309\u7C7B\u522B\u8FC7\u6EE4',\n          required: false,\n        },\n        {\n          name: 'search',\n          type: 'string',\n          description: '\u641C\u7D22\u5173\u952E\u8BCD',\n          required: false,\n        },\n      ],\n      returns: {\n        type: 'array',\n        description: '\u5DE5\u5177\u5217\u8868',\n      },\n      execution: {\n        type: 'function',\n        builtinFunction: 'listTools',\n      },\n      metadata: {\n        status: 'active',\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      },\n      aiHints: {\n        whenToUse: '\u5F53\u9700\u8981\u67E5\u770B\u53EF\u7528\u5DE5\u5177\u65F6\u4F7F\u7528',\n        priority: 50,\n      },\n      security: {\n        allowedCallers: ['user', 'agent'],\n      },\n    },\n  ];\n}\n\n// ============================================\n// \u8865\u5145\u51FD\u6570\u5B9E\u73B0\n// ============================================\n\nexport const additionalBuiltinFunctions: Record<string, MCPBuiltinFunction> = {\n  /**\n   * \u751F\u6210\u5355\u5143\u6D4B\u8BD5\n   * \u6B64\u51FD\u6570\u4F1A\u53D1\u9001\u6D88\u606F\u5230chatView\u89E6\u53D1TestHandler\n   */\n  generateTest: async (params, context) => {\n    const { filePath, code } = params;\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    let targetPath = filePath;\n    let sourceCode = code;\n    \n    // \u5982\u679C\u6CA1\u6709\u63D0\u4F9B\u6587\u4EF6\u8DEF\u5F84\uFF0C\u4F7F\u7528\u5F53\u524D\u6D3B\u52A8\u6587\u4EF6\n    if (!targetPath) {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        targetPath = editor.document.uri.fsPath;\n      }\n    }\n    \n    if (!targetPath && !sourceCode) {\n      throw new Error('\u8BF7\u63D0\u4F9B\u6587\u4EF6\u8DEF\u5F84\u6216\u4EE3\u7801\u5185\u5BB9');\n    }\n    \n    // \u5982\u679C\u63D0\u4F9B\u4E86\u6587\u4EF6\u8DEF\u5F84\u4F46\u6CA1\u6709\u4EE3\u7801\uFF0C\u8BFB\u53D6\u6587\u4EF6\n    if (targetPath && !sourceCode) {\n      const fullPath = path.isAbsolute(targetPath) ? targetPath : path.join(workspaceRoot, targetPath);\n      if (!fs.existsSync(fullPath)) {\n        throw new Error(`\u6587\u4EF6\u4E0D\u5B58\u5728: ${targetPath}`);\n      }\n      sourceCode = fs.readFileSync(fullPath, 'utf-8');\n    }\n    \n    // \u4F7F\u7528TestGenerator\u68C0\u6D4B\u6846\u67B6\n    const { TestGenerator } = await import('../test-generator/TestGenerator');\n    const testGen = new TestGenerator(context._extensionContext || ({} as any));\n    \n    const effectivePath = targetPath || 'inline.ts';\n    const { language, framework } = testGen.detectLanguageAndFramework(effectivePath, workspaceRoot);\n    const testFilePath = testGen.generateTestFilePath(effectivePath, framework);\n    const prompt = testGen.generatePrompt(sourceCode!, effectivePath, framework);\n    \n    // \u901A\u8FC7 vscode command \u89E6\u53D1 TestHandler \u5B9E\u9645\u751F\u6210\u6D4B\u8BD5\n    try {\n      await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n    } catch {}\n    \n    // \u901A\u8FC7\u5185\u90E8\u6D88\u606F\u89E6\u53D1\u5B9E\u9645\u7684\u6D4B\u8BD5\u751F\u6210\n    // generateTestFile command \u4F1A\u901A\u77E5 ChatViewProvider \u8C03\u7528 TestHandler\n    try {\n      await vscode.commands.executeCommand('aiAssistant.triggerTestGeneration', effectivePath);\n    } catch {\n      // \u547D\u4EE4\u53EF\u80FD\u672A\u6CE8\u518C\uFF0C\u56DE\u9000\u8FD4\u56DE\u751F\u6210\u4FE1\u606F\n    }\n    \n    return {\n      status: 'generating',\n      message: `\u6B63\u5728\u4E3A ${path.basename(effectivePath)} \u751F\u6210 ${framework} \u6D4B\u8BD5...`,\n      framework,\n      language,\n      suggestedPath: testFilePath,\n      sourceFile: effectivePath,\n      sourceCode: sourceCode!.slice(0, 500) + (sourceCode!.length > 500 ? '...' : ''),\n      prompt: prompt,\n      instruction: `\u8BF7\u4E3A\u4EE5\u4E0A\u4EE3\u7801\u751F\u6210 ${framework} \u5355\u5143\u6D4B\u8BD5`,\n    };\n  },\n\n  /**\n   * \u5206\u6790\u4EE3\u7801\n   */\n  analyzeCode: async (params, context) => {\n    const { file, type = 'full', includeMetrics = true } = params;\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    let content = '';\n    let filePath = file;\n    \n    // \u83B7\u53D6\u6587\u4EF6\u5185\u5BB9\n    if (!file) {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        content = editor.document.getText();\n        filePath = vscode.workspace.asRelativePath(editor.document.uri);\n      }\n    } else {\n      const fullPath = path.isAbsolute(file) ? file : path.join(workspaceRoot, file);\n      if (fs.existsSync(fullPath)) {\n        content = fs.readFileSync(fullPath, 'utf-8');\n      }\n    }\n    \n    if (!content) {\n      throw new Error('\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u5185\u5BB9');\n    }\n    \n    const result: any = {};\n    \n    // \u7ED3\u6784\u5206\u6790\n    if (type === 'full' || type === 'structure') {\n      result.structure = analyzeStructure(content, filePath);\n    }\n    \n    // \u590D\u6742\u5EA6\u5206\u6790\n    if (type === 'full' || type === 'complexity') {\n      result.complexity = analyzeComplexity(content);\n    }\n    \n    // \u4F9D\u8D56\u5206\u6790\n    if (type === 'full' || type === 'dependencies') {\n      result.dependencies = analyzeDeps(content, filePath);\n    }\n    \n    // \u95EE\u9898\u68C0\u6D4B\n    if (type === 'full' || type === 'issues') {\n      result.issues = detectIssues(content, filePath);\n    }\n    \n    // \u4EE3\u7801\u5EA6\u91CF\n    if (includeMetrics) {\n      result.metrics = calculateMetrics(content);\n    }\n    \n    return result;\n  },\n  \n  /**\n   * \u91CD\u6784\u4EE3\u7801\n   */\n  refactorCode: async (params, context) => {\n    const { action, target, newName, destination } = params;\n    \n    // \u4F7F\u7528VS Code\u7684\u91CD\u6784\u529F\u80FD\n    const editor = vscode.window.activeTextEditor;\n    if (!editor) {\n      throw new Error('\u6CA1\u6709\u6D3B\u52A8\u7684\u7F16\u8F91\u5668');\n    }\n    \n    switch (action) {\n      case 'rename':\n        if (!newName) throw new Error('\u9700\u8981\u63D0\u4F9B\u65B0\u540D\u79F0');\n        await vscode.commands.executeCommand('editor.action.rename');\n        return { success: true, message: '\u8BF7\u5728\u5F39\u51FA\u7684\u8F93\u5165\u6846\u4E2D\u8F93\u5165\u65B0\u540D\u79F0' };\n      \n      case 'extract-function':\n        await vscode.commands.executeCommand('editor.action.codeAction', {\n          kind: 'refactor.extract.function',\n        });\n        return { success: true, message: '\u8BF7\u9009\u62E9\u8981\u63D0\u53D6\u7684\u4EE3\u7801' };\n      \n      case 'extract-variable':\n        await vscode.commands.executeCommand('editor.action.codeAction', {\n          kind: 'refactor.extract.constant',\n        });\n        return { success: true, message: '\u8BF7\u9009\u62E9\u8981\u63D0\u53D6\u7684\u8868\u8FBE\u5F0F' };\n      \n      case 'inline':\n        await vscode.commands.executeCommand('editor.action.codeAction', {\n          kind: 'refactor.inline',\n        });\n        return { success: true, message: '\u5185\u8054\u64CD\u4F5C\u5DF2\u89E6\u53D1' };\n      \n      default:\n        throw new Error(`\u4E0D\u652F\u6301\u7684\u91CD\u6784\u64CD\u4F5C: ${action}`);\n    }\n  },\n  \n  /**\n   * \u683C\u5F0F\u5316\u4EE3\u7801\n   */\n  formatCode: async (params, context) => {\n    const { file, formatter = 'auto' } = params;\n    \n    if (file) {\n      const workspaceRoot = context.workspaceRoot || '';\n      const fullPath = path.isAbsolute(file) ? file : path.join(workspaceRoot, file);\n      const uri = vscode.Uri.file(fullPath);\n      const doc = await vscode.workspace.openTextDocument(uri);\n      await vscode.window.showTextDocument(doc);\n    }\n    \n    await vscode.commands.executeCommand('editor.action.formatDocument');\n    \n    return {\n      success: true,\n      message: '\u683C\u5F0F\u5316\u5B8C\u6210',\n    };\n  },\n  \n  /**\n   * \u89E3\u91CA\u4EE3\u7801\n   */\n  explainCode: async (params, context) => {\n    const { code, level = 'normal' } = params;\n    \n    let targetCode = code;\n    \n    if (!targetCode) {\n      const editor = vscode.window.activeTextEditor;\n      if (editor && !editor.selection.isEmpty) {\n        targetCode = editor.document.getText(editor.selection);\n      }\n    }\n    \n    if (!targetCode) {\n      throw new Error('\u8BF7\u9009\u62E9\u8981\u89E3\u91CA\u7684\u4EE3\u7801');\n    }\n    \n    // \u8FD4\u56DE\u4EE3\u7801\u548C\u7EA7\u522B\uFF0C\u8BA9AI\u8FDB\u884C\u5B9E\u9645\u89E3\u91CA\n    return {\n      code: targetCode,\n      level,\n      instruction: `\u8BF7${level === 'brief' ? '\u7B80\u8981' : level === 'detailed' ? '\u8BE6\u7EC6' : ''}\u89E3\u91CA\u4EE5\u4E0B\u4EE3\u7801\u7684\u4F5C\u7528`,\n    };\n  },\n  \n  /**\n   * \u4F18\u5316\u5EFA\u8BAE\n   */\n  suggestOptimization: async (params, context) => {\n    const { file, focus = 'all' } = params;\n    \n    let content = '';\n    let filePath = file;\n    \n    if (!file) {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        content = editor.document.getText();\n        filePath = vscode.workspace.asRelativePath(editor.document.uri);\n      }\n    } else {\n      const workspaceRoot = context.workspaceRoot || '';\n      const fullPath = path.isAbsolute(file) ? file : path.join(workspaceRoot, file);\n      if (fs.existsSync(fullPath)) {\n        content = fs.readFileSync(fullPath, 'utf-8');\n      }\n    }\n    \n    if (!content) {\n      throw new Error('\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u5185\u5BB9');\n    }\n    \n    return {\n      code: content,\n      file: filePath,\n      focus,\n      instruction: `\u8BF7\u5206\u6790\u4EE3\u7801\u5E76\u63D0\u4F9B${focus === 'all' ? '\u5168\u9762\u7684' : focus}\u4F18\u5316\u5EFA\u8BAE`,\n    };\n  },\n  \n  /**\n   * \u751F\u6210\u6587\u6863\n   */\n  generateDocs: async (params, context) => {\n    const { file, style = 'jsdoc', overwrite = false } = params;\n    \n    let content = '';\n    let filePath = file;\n    \n    if (!file) {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        content = editor.document.getText();\n        filePath = vscode.workspace.asRelativePath(editor.document.uri);\n      }\n    } else {\n      const workspaceRoot = context.workspaceRoot || '';\n      const fullPath = path.isAbsolute(file) ? file : path.join(workspaceRoot, file);\n      if (fs.existsSync(fullPath)) {\n        content = fs.readFileSync(fullPath, 'utf-8');\n      }\n    }\n    \n    if (!content) {\n      throw new Error('\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u5185\u5BB9');\n    }\n    \n    return {\n      code: content,\n      file: filePath,\n      style,\n      overwrite,\n      instruction: `\u8BF7\u4E3A\u4EE3\u7801\u751F\u6210 ${style} \u98CE\u683C\u7684\u6587\u6863\u6CE8\u91CA`,\n    };\n  },\n  \n  /**\n   * \u5206\u6790\u4F9D\u8D56\n   */\n  analyzeDependencies: async (params, context) => {\n    const { type = 'all' } = params;\n    const workspaceRoot = context.workspaceRoot || '';\n    \n    const pkgPath = path.join(workspaceRoot, 'package.json');\n    if (!fs.existsSync(pkgPath)) {\n      throw new Error('\u627E\u4E0D\u5230 package.json');\n    }\n    \n    const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n    const result: any = {\n      dependencies: pkg.dependencies || {},\n      devDependencies: pkg.devDependencies || {},\n      issues: [],\n      recommendations: [],\n    };\n    \n    // \u68C0\u67E5\u8FC7\u671F\u4F9D\u8D56\n    if (type === 'all' || type === 'outdated') {\n      // \u8FD9\u91CC\u53EF\u4EE5\u8C03\u7528 npm outdated \u547D\u4EE4\n      result.recommendations.push('\u8FD0\u884C npm outdated \u68C0\u67E5\u8FC7\u671F\u4F9D\u8D56');\n    }\n    \n    // \u68C0\u67E5\u5B89\u5168\u95EE\u9898\n    if (type === 'all' || type === 'security') {\n      result.recommendations.push('\u8FD0\u884C npm audit \u68C0\u67E5\u5B89\u5168\u95EE\u9898');\n    }\n    \n    return result;\n  },\n  \n  /**\n   * \u4EE3\u7801\u7247\u6BB5\n   */\n  codeSnippet: async (params, context) => {\n    const { action, query, snippet, name } = params;\n    \n    switch (action) {\n      case 'list':\n        return { snippets: ['component', 'hook', 'api-call', 'test'] };\n      \n      case 'search':\n        return {\n          results: [],\n          instruction: `\u641C\u7D22\u4EE3\u7801\u7247\u6BB5: ${query}`,\n        };\n      \n      case 'insert':\n        if (!snippet) throw new Error('\u9700\u8981\u63D0\u4F9B\u4EE3\u7801\u7247\u6BB5');\n        const editor = vscode.window.activeTextEditor;\n        if (editor) {\n          await editor.edit(builder => {\n            builder.insert(editor.selection.active, snippet);\n          });\n        }\n        return { success: true };\n      \n      case 'save':\n        return { success: true, message: '\u7247\u6BB5\u4FDD\u5B58\u529F\u80FD\u5F85\u5B9E\u73B0' };\n      \n      default:\n        throw new Error(`\u4E0D\u652F\u6301\u7684\u64CD\u4F5C: ${action}`);\n    }\n  },\n  \n  /**\n   * \u7EC8\u7AEF\u7BA1\u7406\n   */\n  terminalManage: async (params, context) => {\n    const { action, name, text } = params;\n    \n    switch (action) {\n      case 'create':\n        const terminal = vscode.window.createTerminal(name || 'AI Assistant');\n        terminal.show();\n        return { success: true, name: terminal.name };\n      \n      case 'list':\n        return {\n          terminals: vscode.window.terminals.map(t => ({\n            name: t.name,\n          })),\n        };\n      \n      case 'sendText':\n        const activeTerminal = vscode.window.activeTerminal;\n        if (activeTerminal && text) {\n          activeTerminal.sendText(text);\n        }\n        return { success: true };\n      \n      case 'show':\n        vscode.window.activeTerminal?.show();\n        return { success: true };\n      \n      case 'hide':\n        vscode.window.activeTerminal?.hide();\n        return { success: true };\n      \n      default:\n        throw new Error(`\u4E0D\u652F\u6301\u7684\u64CD\u4F5C: ${action}`);\n    }\n  },\n  \n  /**\n   * \u5DE5\u4F5C\u533A\u7BA1\u7406\n   */\n  workspaceManage: async (params, context) => {\n    const { action, path: targetPath } = params;\n    \n    switch (action) {\n      case 'info':\n        return {\n          folders: vscode.workspace.workspaceFolders?.map(f => ({\n            name: f.name,\n            path: f.uri.fsPath,\n          })) || [],\n          name: vscode.workspace.name,\n        };\n      \n      case 'openFile':\n        if (targetPath) {\n          const uri = vscode.Uri.file(targetPath);\n          await vscode.window.showTextDocument(uri);\n        }\n        return { success: true };\n      \n      case 'openFolder':\n        if (targetPath) {\n          await vscode.commands.executeCommand('vscode.openFolder', vscode.Uri.file(targetPath));\n        }\n        return { success: true };\n      \n      default:\n        throw new Error(`\u4E0D\u652F\u6301\u7684\u64CD\u4F5C: ${action}`);\n    }\n  },\n  \n  /**\n   * \u67E5\u627E\u7B26\u53F7\n   */\n  findSymbol: async (params, context) => {\n    const { name, kind = 'all' } = params;\n    \n    const symbols = await vscode.commands.executeCommand<vscode.SymbolInformation[]>(\n      'vscode.executeWorkspaceSymbolProvider',\n      name\n    );\n    \n    if (!symbols) {\n      return [];\n    }\n    \n    const kindFilter = kind === 'all' ? null : getSymbolKind(kind);\n    \n    return symbols\n      .filter(s => kindFilter === null || s.kind === kindFilter)\n      .slice(0, 20)\n      .map(s => ({\n        name: s.name,\n        kind: vscode.SymbolKind[s.kind],\n        file: vscode.workspace.asRelativePath(s.location.uri),\n        line: s.location.range.start.line + 1,\n      }));\n  },\n  \n  /**\n   * \u83B7\u53D6\u8BCA\u65AD\u4FE1\u606F\n   */\n  getDiagnostics: async (params, context) => {\n    const { file, severity = 'all' } = params;\n    \n    let uri: vscode.Uri | undefined;\n    \n    if (file) {\n      const workspaceRoot = context.workspaceRoot || '';\n      const fullPath = path.isAbsolute(file) ? file : path.join(workspaceRoot, file);\n      uri = vscode.Uri.file(fullPath);\n    } else {\n      uri = vscode.window.activeTextEditor?.document.uri;\n    }\n    \n    if (!uri) {\n      throw new Error('\u8BF7\u6307\u5B9A\u6587\u4EF6\u6216\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6');\n    }\n    \n    const diagnostics = vscode.languages.getDiagnostics(uri);\n    \n    const severityFilter = getSeverityFilter(severity);\n    \n    return diagnostics\n      .filter(d => severityFilter === null || d.severity === severityFilter)\n      .map(d => ({\n        message: d.message,\n        severity: vscode.DiagnosticSeverity[d.severity],\n        line: d.range.start.line + 1,\n        column: d.range.start.character + 1,\n        source: d.source,\n      }));\n  },\n  \n  /**\n   * \u81EA\u52A8\u4FEE\u590D\n   */\n  autoFix: async (params, context) => {\n    const { file } = params;\n    \n    if (file) {\n      const workspaceRoot = context.workspaceRoot || '';\n      const fullPath = path.isAbsolute(file) ? file : path.join(workspaceRoot, file);\n      const uri = vscode.Uri.file(fullPath);\n      const doc = await vscode.workspace.openTextDocument(uri);\n      await vscode.window.showTextDocument(doc);\n    }\n    \n    await vscode.commands.executeCommand('editor.action.fixAll');\n    \n    return {\n      success: true,\n      message: '\u81EA\u52A8\u4FEE\u590D\u5DF2\u6267\u884C',\n    };\n  },\n  \n  /**\n   * \u5217\u51FA\u5DE5\u5177\n   */\n  listTools: async (params, context) => {\n    const { category, search } = params;\n    \n    // \u8FD9\u4E2A\u51FD\u6570\u7684\u5B9E\u9645\u5B9E\u73B0\u9700\u8981\u8BBF\u95EE MCPRegistry\n    // \u8FD9\u91CC\u8FD4\u56DE\u4E00\u4E2A\u5360\u4F4D\u7B26\n    return {\n      instruction: `\u5217\u51FA${category ? `${category}\u7C7B\u522B\u7684` : '\u6240\u6709'}\u5DE5\u5177${search ? `\uFF0C\u641C\u7D22: ${search}` : ''}`,\n    };\n  },\n};\n\n// ============================================\n// \u8F85\u52A9\u51FD\u6570\n// ============================================\n\nfunction analyzeStructure(content: string, filePath: string): any {\n  const structure: any = {\n    classes: 0,\n    functions: 0,\n    methods: 0,\n    interfaces: 0,\n    variables: 0,\n    exports: 0,\n  };\n  \n  // \u7B80\u5355\u7684\u6B63\u5219\u5339\u914D\uFF08\u5B9E\u9645\u9879\u76EE\u4E2D\u53EF\u4EE5\u4F7F\u7528AST\u89E3\u6790\uFF09\n  structure.classes = (content.match(/\\bclass\\s+\\w+/g) || []).length;\n  structure.functions = (content.match(/\\bfunction\\s+\\w+/g) || []).length +\n    (content.match(/\\bconst\\s+\\w+\\s*=\\s*(async\\s+)?\\(/g) || []).length;\n  structure.interfaces = (content.match(/\\binterface\\s+\\w+/g) || []).length;\n  structure.exports = (content.match(/\\bexport\\s+(default\\s+)?/g) || []).length;\n  \n  return structure;\n}\n\nfunction analyzeComplexity(content: string): any {\n  // \u7B80\u5316\u7684\u590D\u6742\u5EA6\u8BA1\u7B97\n  const lines = content.split('\\n');\n  const nonEmptyLines = lines.filter(l => l.trim().length > 0).length;\n  \n  // \u8BA1\u7B97\u5708\u590D\u6742\u5EA6\u7684\u7B80\u5316\u7248\u672C\n  const branchingKeywords = ['if', 'else', 'for', 'while', 'switch', 'case', 'catch', '\\\\?', '&&', '\\\\|\\\\|'];\n  let cyclomatic = 1;\n  \n  branchingKeywords.forEach(kw => {\n    const regex = new RegExp(`\\\\b${kw}\\\\b`, 'g');\n    cyclomatic += (content.match(regex) || []).length;\n  });\n  \n  return {\n    cyclomatic,\n    linesOfCode: lines.length,\n    nonEmptyLines,\n    commentLines: lines.filter(l => l.trim().startsWith('//')).length,\n  };\n}\n\nfunction analyzeDeps(content: string, filePath: string): string[] {\n  const deps: string[] = [];\n  \n  // \u5339\u914D import \u8BED\u53E5\n  const importMatches = content.matchAll(/import\\s+.*?from\\s+['\"](.+?)['\"]/g);\n  for (const match of importMatches) {\n    deps.push(match[1]);\n  }\n  \n  // \u5339\u914D require \u8BED\u53E5\n  const requireMatches = content.matchAll(/require\\s*\\(\\s*['\"](.+?)['\"]\\s*\\)/g);\n  for (const match of requireMatches) {\n    deps.push(match[1]);\n  }\n  \n  return [...new Set(deps)];\n}\n\nfunction detectIssues(content: string, filePath: string): any[] {\n  const issues: any[] = [];\n  const lines = content.split('\\n');\n  \n  lines.forEach((line, index) => {\n    // \u68C0\u6D4B console.log\n    if (/console\\.(log|warn|error)/.test(line)) {\n      issues.push({\n        type: 'warning',\n        line: index + 1,\n        message: '\u4EE3\u7801\u4E2D\u5305\u542B console \u8BED\u53E5',\n      });\n    }\n    \n    // \u68C0\u6D4B TODO/FIXME\n    if (/\\/\\/\\s*(TODO|FIXME|HACK|XXX)/i.test(line)) {\n      issues.push({\n        type: 'info',\n        line: index + 1,\n        message: line.match(/\\/\\/\\s*(TODO|FIXME|HACK|XXX).*/i)?.[0] || 'TODO/FIXME \u6CE8\u91CA',\n      });\n    }\n    \n    // \u68C0\u6D4B\u8FC7\u957F\u7684\u884C\n    if (line.length > 120) {\n      issues.push({\n        type: 'style',\n        line: index + 1,\n        message: '\u884C\u957F\u5EA6\u8D85\u8FC7120\u5B57\u7B26',\n      });\n    }\n  });\n  \n  return issues;\n}\n\nfunction calculateMetrics(content: string): any {\n  const lines = content.split('\\n');\n  \n  return {\n    totalLines: lines.length,\n    codeLines: lines.filter(l => l.trim().length > 0 && !l.trim().startsWith('//')).length,\n    commentLines: lines.filter(l => l.trim().startsWith('//')).length,\n    blankLines: lines.filter(l => l.trim().length === 0).length,\n    avgLineLength: Math.round(lines.reduce((sum, l) => sum + l.length, 0) / lines.length),\n    maxLineLength: Math.max(...lines.map(l => l.length)),\n  };\n}\n\nfunction getSymbolKind(kind: string): vscode.SymbolKind | null {\n  const mapping: Record<string, vscode.SymbolKind> = {\n    class: vscode.SymbolKind.Class,\n    function: vscode.SymbolKind.Function,\n    method: vscode.SymbolKind.Method,\n    variable: vscode.SymbolKind.Variable,\n    interface: vscode.SymbolKind.Interface,\n    type: vscode.SymbolKind.TypeParameter,\n  };\n  return mapping[kind] || null;\n}\n\nfunction getSeverityFilter(severity: string): vscode.DiagnosticSeverity | null {\n  const mapping: Record<string, vscode.DiagnosticSeverity> = {\n    error: vscode.DiagnosticSeverity.Error,\n    warning: vscode.DiagnosticSeverity.Warning,\n    info: vscode.DiagnosticSeverity.Information,\n    hint: vscode.DiagnosticSeverity.Hint,\n  };\n  return mapping[severity] || null;\n}\n", "/**\n * MCP\u5DE5\u5177\u6CE8\u518C\u7BA1\u7406\u5668\n * \n * \u8D1F\u8D23\u5DE5\u5177\u7684\u6CE8\u518C\u3001\u5B58\u50A8\u3001\u67E5\u8BE2\u3001\u542F\u7528/\u7981\u7528\u7B49\u7BA1\u7406\u529F\u80FD\n */\n\nimport * as vscode from 'vscode';\nimport {\n  MCPToolDefinition,\n  MCPToolRegistration,\n  MCPToolCategory,\n  MCPToolStatus,\n  MCPConfig,\n} from './types';\nimport { getBuiltinTools } from './builtins';\nimport { getAdditionalBuiltinTools } from './additionalBuiltins';\n\nconst STORAGE_KEY = 'aiAssistant.mcp.tools';\nconst CONFIG_KEY = 'aiAssistant.mcp.config';\n\n/**\n * MCP\u5DE5\u5177\u6CE8\u518C\u7BA1\u7406\u5668\n */\nexport class MCPRegistry {\n  private static instance: MCPRegistry | null = null;\n  \n  private context: vscode.ExtensionContext;\n  private tools: Map<string, MCPToolRegistration> = new Map();\n  private config: MCPConfig;\n  \n  // \u4E8B\u4EF6\u53D1\u5C04\u5668\n  private _onToolsChanged = new vscode.EventEmitter<void>();\n  public readonly onToolsChanged = this._onToolsChanged.event;\n  \n  private constructor(context: vscode.ExtensionContext) {\n    this.context = context;\n    this.config = this.loadConfig();\n    this.loadTools();\n  }\n  \n  /**\n   * \u83B7\u53D6\u5355\u4F8B\u5B9E\u4F8B\n   */\n  static getInstance(context: vscode.ExtensionContext): MCPRegistry {\n    if (!MCPRegistry.instance) {\n      MCPRegistry.instance = new MCPRegistry(context);\n    }\n    return MCPRegistry.instance;\n  }\n  \n  // ============================================\n  // \u914D\u7F6E\u7BA1\u7406\n  // ============================================\n  \n  /**\n   * \u52A0\u8F7D\u914D\u7F6E\n   */\n  private loadConfig(): MCPConfig {\n    const saved = this.context.globalState.get<MCPConfig>(CONFIG_KEY);\n    return {\n      enabled: true,\n      maxToolsPerRequest: 5,\n      defaultTimeout: 30000,\n      logAllExecutions: true,\n      envVariables: {},\n      dangerousCommands: [\n        'rm -rf',\n        'format',\n        'del /s',\n        'rmdir /s',\n        'drop database',\n        'truncate table',\n      ],\n      ...saved,\n    };\n  }\n  \n  /**\n   * \u4FDD\u5B58\u914D\u7F6E\n   */\n  private async saveConfig(): Promise<void> {\n    await this.context.globalState.update(CONFIG_KEY, this.config);\n  }\n  \n  /**\n   * \u83B7\u53D6\u914D\u7F6E\n   */\n  getConfig(): MCPConfig {\n    return { ...this.config };\n  }\n  \n  /**\n   * \u66F4\u65B0\u914D\u7F6E\n   */\n  async updateConfig(updates: Partial<MCPConfig>): Promise<void> {\n    this.config = { ...this.config, ...updates };\n    await this.saveConfig();\n  }\n  \n  // ============================================\n  // \u5DE5\u5177\u52A0\u8F7D\u548C\u4FDD\u5B58\n  // ============================================\n  \n  /**\n   * \u52A0\u8F7D\u5DE5\u5177\n   */\n  private loadTools(): void {\n    // \u52A0\u8F7D\u5185\u7F6E\u5DE5\u5177\n    const builtinTools = getBuiltinTools();\n    for (const tool of builtinTools) {\n      this.tools.set(tool.id, {\n        tool,\n        source: 'builtin',\n        enabled: true,\n      });\n    }\n    \n    // \u52A0\u8F7D\u989D\u5916\u7684\u5185\u7F6E\u5DE5\u5177\n    const additionalTools = getAdditionalBuiltinTools();\n    for (const tool of additionalTools) {\n      this.tools.set(tool.id, {\n        tool,\n        source: 'builtin',\n        enabled: true,\n      });\n    }\n    \n    // \u52A0\u8F7D\u7528\u6237\u5DE5\u5177\n    const savedTools = this.context.globalState.get<MCPToolRegistration[]>(STORAGE_KEY) || [];\n    for (const registration of savedTools) {\n      // \u4E0D\u8986\u76D6\u5185\u7F6E\u5DE5\u5177\n      if (!this.tools.has(registration.tool.id) || registration.source !== 'builtin') {\n        this.tools.set(registration.tool.id, registration);\n      }\n    }\n    \n    const totalBuiltin = builtinTools.length + additionalTools.length;\n    console.log(`[MCPRegistry] Loaded ${this.tools.size} tools (${totalBuiltin} builtin)`);\n  }\n  \n  /**\n   * \u4FDD\u5B58\u5DE5\u5177\n   */\n  private async saveTools(): Promise<void> {\n    // \u53EA\u4FDD\u5B58\u975E\u5185\u7F6E\u5DE5\u5177\n    const toSave = Array.from(this.tools.values()).filter(r => r.source !== 'builtin');\n    await this.context.globalState.update(STORAGE_KEY, toSave);\n    this._onToolsChanged.fire();\n  }\n  \n  // ============================================\n  // \u5DE5\u5177\u6CE8\u518C\u548C\u7BA1\u7406\n  // ============================================\n  \n  /**\n   * \u6CE8\u518C\u65B0\u5DE5\u5177\n   */\n  async registerTool(\n    tool: MCPToolDefinition,\n    source: 'user' | 'marketplace' | 'import' = 'user'\n  ): Promise<{ success: boolean; error?: string }> {\n    // \u9A8C\u8BC1\u5DE5\u5177\u5B9A\u4E49\n    const validation = this.validateToolDefinition(tool);\n    if (!validation.valid) {\n      return { success: false, error: validation.error };\n    }\n    \n    // \u68C0\u67E5ID\u662F\u5426\u5DF2\u5B58\u5728\n    if (this.tools.has(tool.id)) {\n      const existing = this.tools.get(tool.id)!;\n      if (existing.source === 'builtin') {\n        return { success: false, error: `Cannot override builtin tool: ${tool.id}` };\n      }\n    }\n    \n    // \u8BBE\u7F6E\u5143\u6570\u636E\n    const now = Date.now();\n    tool.metadata = {\n      ...tool.metadata,\n      status: 'active',\n      createdAt: tool.metadata?.createdAt || now,\n      updatedAt: now,\n    };\n    \n    // \u6CE8\u518C\u5DE5\u5177\n    this.tools.set(tool.id, {\n      tool,\n      source,\n      enabled: true,\n    });\n    \n    await this.saveTools();\n    console.log(`[MCPRegistry] Registered tool: ${tool.id}`);\n    \n    return { success: true };\n  }\n  \n  /**\n   * \u66F4\u65B0\u5DE5\u5177\n   */\n  async updateTool(tool: MCPToolDefinition): Promise<{ success: boolean; error?: string }> {\n    const existing = this.tools.get(tool.id);\n    if (!existing) {\n      return { success: false, error: `Tool not found: ${tool.id}` };\n    }\n    \n    if (existing.source === 'builtin') {\n      return { success: false, error: `Cannot modify builtin tool: ${tool.id}` };\n    }\n    \n    // \u9A8C\u8BC1\u5DE5\u5177\u5B9A\u4E49\n    const validation = this.validateToolDefinition(tool);\n    if (!validation.valid) {\n      return { success: false, error: validation.error };\n    }\n    \n    // \u66F4\u65B0\u5DE5\u5177\n    tool.metadata = {\n      ...existing.tool.metadata,\n      ...tool.metadata,\n      updatedAt: Date.now(),\n    };\n    \n    this.tools.set(tool.id, {\n      ...existing,\n      tool,\n    });\n    \n    await this.saveTools();\n    console.log(`[MCPRegistry] Updated tool: ${tool.id}`);\n    \n    return { success: true };\n  }\n  \n  /**\n   * \u5220\u9664\u5DE5\u5177\n   */\n  async deleteTool(toolId: string): Promise<{ success: boolean; error?: string }> {\n    const existing = this.tools.get(toolId);\n    if (!existing) {\n      return { success: false, error: `Tool not found: ${toolId}` };\n    }\n    \n    if (existing.source === 'builtin') {\n      return { success: false, error: `Cannot delete builtin tool: ${toolId}` };\n    }\n    \n    this.tools.delete(toolId);\n    await this.saveTools();\n    console.log(`[MCPRegistry] Deleted tool: ${toolId}`);\n    \n    return { success: true };\n  }\n  \n  /**\n   * \u542F\u7528/\u7981\u7528\u5DE5\u5177\n   */\n  async toggleTool(toolId: string, enabled: boolean): Promise<{ success: boolean; error?: string }> {\n    const existing = this.tools.get(toolId);\n    if (!existing) {\n      return { success: false, error: `Tool not found: ${toolId}` };\n    }\n    \n    existing.enabled = enabled;\n    await this.saveTools();\n    console.log(`[MCPRegistry] Tool ${toolId} ${enabled ? 'enabled' : 'disabled'}`);\n    \n    return { success: true };\n  }\n  \n  /**\n   * \u66F4\u65B0\u5DE5\u5177\u72B6\u6001\n   */\n  async updateToolStatus(toolId: string, status: MCPToolStatus): Promise<void> {\n    const existing = this.tools.get(toolId);\n    if (existing) {\n      existing.tool.metadata.status = status;\n      await this.saveTools();\n    }\n  }\n  \n  /**\n   * \u66F4\u65B0\u5DE5\u5177\u4F7F\u7528\u7EDF\u8BA1\n   */\n  async updateToolStats(\n    toolId: string,\n    executionTime: number,\n    success: boolean\n  ): Promise<void> {\n    const existing = this.tools.get(toolId);\n    if (existing) {\n      const meta = existing.tool.metadata;\n      meta.lastUsedAt = Date.now();\n      meta.usageCount = (meta.usageCount || 0) + 1;\n      \n      // \u8BA1\u7B97\u5E73\u5747\u6267\u884C\u65F6\u95F4\n      const prevAvg = meta.averageExecutionTime || 0;\n      const prevCount = meta.usageCount - 1;\n      meta.averageExecutionTime = (prevAvg * prevCount + executionTime) / meta.usageCount;\n      \n      // \u8BA1\u7B97\u6210\u529F\u7387\n      const prevSuccessRate = meta.successRate || 1;\n      meta.successRate = (prevSuccessRate * prevCount + (success ? 1 : 0)) / meta.usageCount;\n      \n      await this.saveTools();\n    }\n  }\n  \n  // ============================================\n  // \u5DE5\u5177\u67E5\u8BE2\n  // ============================================\n  \n  /**\n   * \u83B7\u53D6\u6240\u6709\u5DE5\u5177\n   */\n  getAllTools(): MCPToolRegistration[] {\n    return Array.from(this.tools.values());\n  }\n  \n  /**\n   * \u83B7\u53D6\u542F\u7528\u7684\u5DE5\u5177\n   */\n  getEnabledTools(): MCPToolRegistration[] {\n    return Array.from(this.tools.values()).filter(r => r.enabled);\n  }\n  \n  /**\n   * \u6839\u636EID\u83B7\u53D6\u5DE5\u5177\n   */\n  getTool(toolId: string): MCPToolRegistration | undefined {\n    return this.tools.get(toolId);\n  }\n  \n  /**\n   * \u6839\u636E\u7C7B\u522B\u83B7\u53D6\u5DE5\u5177\n   */\n  getToolsByCategory(category: MCPToolCategory): MCPToolRegistration[] {\n    return Array.from(this.tools.values()).filter(\n      r => r.tool.category === category && r.enabled\n    );\n  }\n  \n  /**\n   * \u641C\u7D22\u5DE5\u5177\n   */\n  searchTools(query: string): MCPToolRegistration[] {\n    const lowerQuery = query.toLowerCase();\n    return Array.from(this.tools.values()).filter(r => {\n      const tool = r.tool;\n      return (\n        tool.name.toLowerCase().includes(lowerQuery) ||\n        tool.description.toLowerCase().includes(lowerQuery) ||\n        tool.tags?.some(t => t.toLowerCase().includes(lowerQuery)) ||\n        tool.category.toLowerCase().includes(lowerQuery)\n      );\n    });\n  }\n  \n  /**\n   * \u83B7\u53D6\u9002\u5408Agent\u4F7F\u7528\u7684\u5DE5\u5177\u5217\u8868\n   * \u8FD4\u56DE\u542F\u7528\u4E14\u5141\u8BB8Agent\u8C03\u7528\u7684\u5DE5\u5177\uFF0C\u6309\u4F18\u5148\u7EA7\u6392\u5E8F\n   */\n  getAgentTools(): MCPToolDefinition[] {\n    return Array.from(this.tools.values())\n      .filter(r => {\n        if (!r.enabled) return false;\n        const security = r.tool.security;\n        if (!security?.allowedCallers) return true;\n        return security.allowedCallers.includes('agent');\n      })\n      .sort((a, b) => {\n        const priorityA = a.tool.aiHints?.priority || 50;\n        const priorityB = b.tool.aiHints?.priority || 50;\n        return priorityB - priorityA;\n      })\n      .map(r => r.tool);\n  }\n  \n  // ============================================\n  // \u5BFC\u5165\u5BFC\u51FA\n  // ============================================\n  \n  /**\n   * \u5BFC\u51FA\u5DE5\u5177\n   */\n  exportTools(toolIds?: string[]): string {\n    let toExport: MCPToolRegistration[];\n    \n    if (toolIds && toolIds.length > 0) {\n      toExport = toolIds\n        .map(id => this.tools.get(id))\n        .filter((r): r is MCPToolRegistration => r !== undefined && r.source !== 'builtin');\n    } else {\n      toExport = Array.from(this.tools.values()).filter(r => r.source !== 'builtin');\n    }\n    \n    return JSON.stringify(toExport.map(r => r.tool), null, 2);\n  }\n  \n  /**\n   * \u5BFC\u5165\u5DE5\u5177\n   */\n  async importTools(data: string): Promise<{ \n    success: boolean; \n    imported: number; \n    errors: string[] \n  }> {\n    const errors: string[] = [];\n    let imported = 0;\n    \n    try {\n      const tools = JSON.parse(data) as MCPToolDefinition[];\n      \n      if (!Array.isArray(tools)) {\n        return { success: false, imported: 0, errors: ['Invalid format: expected array'] };\n      }\n      \n      for (const tool of tools) {\n        const result = await this.registerTool(tool, 'import');\n        if (result.success) {\n          imported++;\n        } else {\n          errors.push(`${tool.id || 'unknown'}: ${result.error}`);\n        }\n      }\n      \n      return { success: errors.length === 0, imported, errors };\n    } catch (e) {\n      return { \n        success: false, \n        imported: 0, \n        errors: [`Parse error: ${e instanceof Error ? e.message : 'Unknown error'}`] \n      };\n    }\n  }\n  \n  // ============================================\n  // \u9A8C\u8BC1\n  // ============================================\n  \n  /**\n   * \u9A8C\u8BC1\u5DE5\u5177\u5B9A\u4E49\n   */\n  validateToolDefinition(tool: MCPToolDefinition): { valid: boolean; error?: string } {\n    // \u57FA\u672C\u5B57\u6BB5\u9A8C\u8BC1\n    if (!tool.id || typeof tool.id !== 'string') {\n      return { valid: false, error: 'Tool ID is required' };\n    }\n    \n    if (!/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(tool.id)) {\n      return { valid: false, error: 'Tool ID must start with letter and contain only alphanumeric, underscore, or hyphen' };\n    }\n    \n    if (!tool.name || typeof tool.name !== 'string') {\n      return { valid: false, error: 'Tool name is required' };\n    }\n    \n    if (!tool.description || typeof tool.description !== 'string') {\n      return { valid: false, error: 'Tool description is required' };\n    }\n    \n    if (!tool.version || typeof tool.version !== 'string') {\n      return { valid: false, error: 'Tool version is required' };\n    }\n    \n    // \u6267\u884C\u914D\u7F6E\u9A8C\u8BC1\n    if (!tool.execution || !tool.execution.type) {\n      return { valid: false, error: 'Execution configuration is required' };\n    }\n    \n    const execType = tool.execution.type;\n    \n    if (execType === 'http' && !tool.execution.http) {\n      return { valid: false, error: 'HTTP configuration is required for http execution type' };\n    }\n    \n    if (execType === 'command' && !tool.execution.command) {\n      return { valid: false, error: 'Command configuration is required for command execution type' };\n    }\n    \n    if (execType === 'script' && !tool.execution.script) {\n      return { valid: false, error: 'Script configuration is required for script execution type' };\n    }\n    \n    if (execType === 'function' && !tool.execution.builtinFunction) {\n      return { valid: false, error: 'Builtin function name is required for function execution type' };\n    }\n    \n    // \u53C2\u6570\u9A8C\u8BC1\n    if (!Array.isArray(tool.parameters)) {\n      return { valid: false, error: 'Parameters must be an array' };\n    }\n    \n    for (const param of tool.parameters) {\n      if (!param.name || !param.type || !param.description) {\n        return { valid: false, error: `Invalid parameter definition: ${param.name || 'unnamed'}` };\n      }\n    }\n    \n    // \u8FD4\u56DE\u503C\u9A8C\u8BC1\n    if (!tool.returns || !tool.returns.type || !tool.returns.description) {\n      return { valid: false, error: 'Returns definition is required' };\n    }\n    \n    return { valid: true };\n  }\n  \n  /**\n   * \u6E05\u7406\u6240\u6709\u7528\u6237\u5DE5\u5177\n   */\n  async clearUserTools(): Promise<void> {\n    const builtinIds = Array.from(this.tools.entries())\n      .filter(([_, r]) => r.source === 'builtin')\n      .map(([id, _]) => id);\n    \n    this.tools.clear();\n    \n    // \u91CD\u65B0\u52A0\u8F7D\u5185\u7F6E\u5DE5\u5177\n    const builtinTools = getBuiltinTools();\n    for (const tool of builtinTools) {\n      this.tools.set(tool.id, {\n        tool,\n        source: 'builtin',\n        enabled: true,\n      });\n    }\n    \n    await this.saveTools();\n    console.log('[MCPRegistry] Cleared all user tools');\n  }\n}\n", "/**\n * MCP\u5DE5\u5177\u6267\u884C\u5668\n * \n * \u8D1F\u8D23\u5B9E\u9645\u6267\u884C\u5DE5\u5177\u8C03\u7528\uFF0C\u652F\u6301\u591A\u79CD\u6267\u884C\u65B9\u5F0F\uFF1A\n * - HTTP\u8BF7\u6C42\n * - \u547D\u4EE4\u884C\u6267\u884C\n * - \u5185\u7F6E\u51FD\u6570\n * - \u811A\u672C\u6267\u884C\n */\n\nimport * as vscode from 'vscode';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport {\n  MCPToolDefinition,\n  MCPToolCallParams,\n  MCPToolResult,\n  MCPHttpConfig,\n  MCPCommandConfig,\n  MCPScriptConfig,\n  MCPConfig,\n} from './types';\nimport { MCPRegistry } from './MCPRegistry';\nimport { builtinFunctions } from './builtins';\nimport { additionalBuiltinFunctions } from './additionalBuiltins';\n\n// \u5408\u5E76\u6240\u6709\u5185\u7F6E\u51FD\u6570\nconst allBuiltinFunctions = { ...builtinFunctions, ...additionalBuiltinFunctions };\n\nconst execAsync = promisify(exec);\n\n/**\n * \u6267\u884C\u5386\u53F2\u8BB0\u5F55\n */\nexport interface ExecutionHistory {\n  id: string;\n  toolId: string;\n  toolName: string;\n  params: Record<string, any>;\n  result: MCPToolResult;\n  caller: 'user' | 'agent';\n  timestamp: number;\n}\n\n/**\n * MCP\u5DE5\u5177\u6267\u884C\u5668\n */\nexport class MCPExecutor {\n  private static instance: MCPExecutor | null = null;\n  \n  private context: vscode.ExtensionContext;\n  private registry: MCPRegistry;\n  private executionHistory: ExecutionHistory[] = [];\n  private maxHistorySize = 100;\n  \n  // \u901F\u7387\u9650\u5236\u8FFD\u8E2A\n  private rateLimitMap: Map<string, number[]> = new Map();\n  \n  // \u4E8B\u4EF6\n  private _onExecutionStart = new vscode.EventEmitter<{ toolId: string; params: any }>();\n  private _onExecutionComplete = new vscode.EventEmitter<ExecutionHistory>();\n  \n  public readonly onExecutionStart = this._onExecutionStart.event;\n  public readonly onExecutionComplete = this._onExecutionComplete.event;\n  \n  private constructor(context: vscode.ExtensionContext, registry: MCPRegistry) {\n    this.context = context;\n    this.registry = registry;\n  }\n  \n  static getInstance(context: vscode.ExtensionContext, registry: MCPRegistry): MCPExecutor {\n    if (!MCPExecutor.instance) {\n      MCPExecutor.instance = new MCPExecutor(context, registry);\n    }\n    return MCPExecutor.instance;\n  }\n  \n  /**\n   * \u6267\u884C\u5DE5\u5177\n   */\n  async execute(params: MCPToolCallParams): Promise<MCPToolResult> {\n    const startTime = Date.now();\n    const requestId = params.requestId || `exec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    \n    // \u83B7\u53D6\u5DE5\u5177\u5B9A\u4E49\n    const registration = this.registry.getTool(params.toolId);\n    if (!registration) {\n      return this.createErrorResult(params.toolId, requestId, 'TOOL_NOT_FOUND', `Tool not found: ${params.toolId}`, startTime);\n    }\n    \n    if (!registration.enabled) {\n      return this.createErrorResult(params.toolId, requestId, 'TOOL_DISABLED', `Tool is disabled: ${params.toolId}`, startTime);\n    }\n    \n    const tool = registration.tool;\n    \n    // \u68C0\u67E5\u8C03\u7528\u6743\u9650\n    if (tool.security?.allowedCallers && !tool.security.allowedCallers.includes(params.caller)) {\n      return this.createErrorResult(params.toolId, requestId, 'UNAUTHORIZED', `Caller '${params.caller}' is not allowed to use this tool`, startTime);\n    }\n    \n    // \u68C0\u67E5\u901F\u7387\u9650\u5236\n    if (tool.security?.rateLimit) {\n      if (!this.checkRateLimit(params.toolId, tool.security.rateLimit)) {\n        return this.createErrorResult(params.toolId, requestId, 'RATE_LIMITED', 'Rate limit exceeded', startTime);\n      }\n    }\n    \n    // \u9A8C\u8BC1\u53C2\u6570\n    const validation = this.validateParams(tool, params.arguments);\n    if (!validation.valid) {\n      return this.createErrorResult(params.toolId, requestId, 'INVALID_PARAMS', validation.error!, startTime);\n    }\n    \n    // \u5982\u679C\u9700\u8981\u786E\u8BA4\uFF0C\u663E\u793A\u786E\u8BA4\u5BF9\u8BDD\u6846\n    if (tool.security?.requireConfirmation && params.caller === 'agent') {\n      const confirmed = await this.requestConfirmation(tool, params.arguments);\n      if (!confirmed) {\n        return this.createErrorResult(params.toolId, requestId, 'USER_CANCELLED', 'User cancelled execution', startTime);\n      }\n    }\n    \n    // \u89E6\u53D1\u6267\u884C\u5F00\u59CB\u4E8B\u4EF6\n    this._onExecutionStart.fire({ toolId: params.toolId, params: params.arguments });\n    \n    // \u6267\u884C\u5DE5\u5177\n    let result: MCPToolResult;\n    \n    try {\n      const data = await this.executeInternal(tool, params);\n      \n      result = {\n        success: true,\n        toolId: params.toolId,\n        requestId,\n        data,\n        stats: {\n          startTime,\n          endTime: Date.now(),\n          duration: Date.now() - startTime,\n        },\n      };\n    } catch (error) {\n      result = this.createErrorResult(\n        params.toolId,\n        requestId,\n        'EXECUTION_ERROR',\n        error instanceof Error ? error.message : 'Unknown error',\n        startTime\n      );\n    }\n    \n    // \u66F4\u65B0\u7EDF\u8BA1\n    await this.registry.updateToolStats(params.toolId, result.stats.duration, result.success);\n    \n    // \u8BB0\u5F55\u5386\u53F2\n    this.addToHistory({\n      id: requestId,\n      toolId: params.toolId,\n      toolName: tool.name,\n      params: params.arguments,\n      result,\n      caller: params.caller,\n      timestamp: startTime,\n    });\n    \n    // \u89E6\u53D1\u6267\u884C\u5B8C\u6210\u4E8B\u4EF6\n    this._onExecutionComplete.fire(this.executionHistory[this.executionHistory.length - 1]);\n    \n    return result;\n  }\n  \n  /**\n   * \u5185\u90E8\u6267\u884C\u903B\u8F91\n   */\n  private async executeInternal(tool: MCPToolDefinition, params: MCPToolCallParams): Promise<any> {\n    const execution = tool.execution;\n    const config = this.registry.getConfig();\n    const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n    \n    switch (execution.type) {\n      case 'function':\n        return this.executeBuiltinFunction(execution.builtinFunction!, params.arguments, {\n          workspaceRoot,\n          extensionContext: this.context,\n        });\n      \n      case 'http':\n        return this.executeHttp(execution.http!, params.arguments, config);\n      \n      case 'command':\n        return this.executeCommand(execution.command!, params.arguments, config, workspaceRoot);\n      \n      case 'script':\n        return this.executeScript(execution.script!, params.arguments);\n      \n      default:\n        throw new Error(`Unsupported execution type: ${execution.type}`);\n    }\n  }\n  \n  /**\n   * \u6267\u884C\u5185\u7F6E\u51FD\u6570\n   */\n  private async executeBuiltinFunction(\n    functionName: string,\n    args: Record<string, any>,\n    context: { workspaceRoot?: string; extensionContext: any }\n  ): Promise<any> {\n    const fn = allBuiltinFunctions[functionName];\n    if (!fn) {\n      throw new Error(`Builtin function not found: ${functionName}`);\n    }\n    \n    return fn(args, context);\n  }\n  \n  /**\n   * \u6267\u884CHTTP\u8BF7\u6C42\n   */\n  private async executeHttp(\n    httpConfig: MCPHttpConfig,\n    args: Record<string, any>,\n    mcpConfig: MCPConfig\n  ): Promise<any> {\n    // \u66FF\u6362URL\u4E2D\u7684\u53D8\u91CF\n    let url = this.replaceVariables(httpConfig.url, args, mcpConfig.envVariables);\n    \n    // \u6DFB\u52A0\u67E5\u8BE2\u53C2\u6570\n    if (httpConfig.queryTemplate) {\n      const queryParams = new URLSearchParams();\n      for (const [key, template] of Object.entries(httpConfig.queryTemplate)) {\n        queryParams.set(key, this.replaceVariables(template, args, mcpConfig.envVariables));\n      }\n      url += (url.includes('?') ? '&' : '?') + queryParams.toString();\n    }\n    \n    // \u51C6\u5907\u8BF7\u6C42\u5934\n    const headers: Record<string, string> = { ...httpConfig.headers };\n    \n    // \u5904\u7406\u8BA4\u8BC1\n    if (httpConfig.auth) {\n      const token = httpConfig.auth.tokenEnvVar \n        ? mcpConfig.envVariables[httpConfig.auth.tokenEnvVar]\n        : undefined;\n      \n      switch (httpConfig.auth.type) {\n        case 'bearer':\n          if (token) headers['Authorization'] = `Bearer ${token}`;\n          break;\n        case 'basic':\n          if (token) headers['Authorization'] = `Basic ${token}`;\n          break;\n        case 'apiKey':\n          if (token && httpConfig.auth.headerName) {\n            headers[httpConfig.auth.headerName] = token;\n          }\n          break;\n      }\n    }\n    \n    // \u51C6\u5907\u8BF7\u6C42\u4F53\n    let body: string | undefined;\n    if (httpConfig.bodyTemplate) {\n      body = this.replaceVariables(httpConfig.bodyTemplate, args, mcpConfig.envVariables);\n      if (!headers['Content-Type']) {\n        headers['Content-Type'] = 'application/json';\n      }\n    }\n    \n    // \u53D1\u9001\u8BF7\u6C42\n    const controller = new AbortController();\n    const timeout = httpConfig.timeout || mcpConfig.defaultTimeout;\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n    \n    try {\n      const response = await fetch(url, {\n        method: httpConfig.method,\n        headers,\n        body,\n        signal: controller.signal,\n      });\n      \n      clearTimeout(timeoutId);\n      \n      const responseText = await response.text();\n      let responseData: any;\n      \n      try {\n        responseData = JSON.parse(responseText);\n      } catch {\n        responseData = responseText;\n      }\n      \n      // \u68C0\u67E5\u6210\u529F\u6761\u4EF6\n      if (httpConfig.responseMapping?.successCondition) {\n        const isSuccess = this.evaluateCondition(httpConfig.responseMapping.successCondition, responseData);\n        if (!isSuccess) {\n          const errorPath = httpConfig.responseMapping.errorPath;\n          const errorMessage = errorPath ? this.getNestedValue(responseData, errorPath) : 'Request failed';\n          throw new Error(errorMessage);\n        }\n      }\n      \n      // \u63D0\u53D6\u7ED3\u679C\u6570\u636E\n      if (httpConfig.responseMapping?.resultPath) {\n        return this.getNestedValue(responseData, httpConfig.responseMapping.resultPath);\n      }\n      \n      return responseData;\n    } catch (error: any) {\n      clearTimeout(timeoutId);\n      if (error.name === 'AbortError') {\n        throw new Error('Request timeout');\n      }\n      throw error;\n    }\n  }\n  \n  /**\n   * \u6267\u884C\u547D\u4EE4\u884C\n   */\n  private async executeCommand(\n    commandConfig: MCPCommandConfig,\n    args: Record<string, any>,\n    mcpConfig: MCPConfig,\n    workspaceRoot?: string\n  ): Promise<any> {\n    // \u66FF\u6362\u547D\u4EE4\u4E2D\u7684\u53D8\u91CF\n    let command = this.replaceVariables(commandConfig.command, args, mcpConfig.envVariables);\n    \n    // \u68C0\u67E5\u5371\u9669\u547D\u4EE4\n    const dangerousPatterns = [\n      ...mcpConfig.dangerousCommands,\n      ...(commandConfig.dangerousPatterns || []),\n    ];\n    \n    for (const pattern of dangerousPatterns) {\n      if (command.toLowerCase().includes(pattern.toLowerCase())) {\n        throw new Error(`Dangerous command detected: ${pattern}`);\n      }\n    }\n    \n    // \u51C6\u5907\u6267\u884C\u73AF\u5883\n    const cwd = commandConfig.cwd \n      ? this.replaceVariables(commandConfig.cwd, args, mcpConfig.envVariables)\n      : workspaceRoot;\n    \n    const env = {\n      ...process.env,\n      ...commandConfig.env,\n      ...mcpConfig.envVariables,\n    };\n    \n    const timeout = commandConfig.timeout || mcpConfig.defaultTimeout;\n    \n    try {\n      const { stdout, stderr } = await execAsync(command, {\n        cwd,\n        env,\n        timeout,\n        maxBuffer: 10 * 1024 * 1024, // 10MB\n        shell: commandConfig.shell || (process.platform === 'win32' ? 'cmd' : 'bash'),\n      });\n      \n      return {\n        stdout: stdout.toString(),\n        stderr: stderr.toString(),\n        exitCode: 0,\n      };\n    } catch (error: any) {\n      return {\n        stdout: error.stdout?.toString() || '',\n        stderr: error.stderr?.toString() || error.message,\n        exitCode: error.code || 1,\n      };\n    }\n  }\n  \n  /**\n   * \u6267\u884C\u811A\u672C\n   */\n  private async executeScript(\n    scriptConfig: MCPScriptConfig,\n    args: Record<string, any>\n  ): Promise<any> {\n    switch (scriptConfig.language) {\n      case 'javascript':\n      case 'typescript':\n        return this.executeJavaScript(scriptConfig.code, args, scriptConfig.entryFunction);\n      \n      default:\n        throw new Error(`Unsupported script language: ${scriptConfig.language}`);\n    }\n  }\n  \n  /**\n   * \u6267\u884CJavaScript\u4EE3\u7801\n   */\n  private async executeJavaScript(\n    code: string,\n    args: Record<string, any>,\n    entryFunction?: string\n  ): Promise<any> {\n    // \u521B\u5EFA\u6C99\u7BB1\u73AF\u5883\n    const sandbox = {\n      args,\n      console: {\n        log: (...msgs: any[]) => console.log('[MCP Script]', ...msgs),\n        error: (...msgs: any[]) => console.error('[MCP Script]', ...msgs),\n      },\n      fetch,\n      JSON,\n      Math,\n      Date,\n      Array,\n      Object,\n      String,\n      Number,\n      Boolean,\n      Promise,\n      setTimeout,\n      clearTimeout,\n    };\n    \n    // \u5305\u88C5\u4EE3\u7801\n    const wrappedCode = `\n      (async function(sandbox) {\n        const { args, console, fetch, JSON, Math, Date, Array, Object, String, Number, Boolean, Promise, setTimeout, clearTimeout } = sandbox;\n        ${code}\n        ${entryFunction ? `return await ${entryFunction}(args);` : ''}\n      })(sandbox)\n    `;\n    \n    // \u6267\u884C\n    const AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;\n    const fn = new AsyncFunction('sandbox', `return ${wrappedCode}`);\n    \n    return fn(sandbox);\n  }\n  \n  // ============================================\n  // \u8F85\u52A9\u65B9\u6CD5\n  // ============================================\n  \n  /**\n   * \u66FF\u6362\u53D8\u91CF\n   */\n  private replaceVariables(\n    template: string,\n    args: Record<string, any>,\n    envVars: Record<string, string>\n  ): string {\n    let result = template;\n    \n    // \u66FF\u6362\u53C2\u6570\u53D8\u91CF {{paramName}}\n    for (const [key, value] of Object.entries(args)) {\n      const placeholder = new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, 'g');\n      result = result.replace(placeholder, String(value));\n    }\n    \n    // \u66FF\u6362\u73AF\u5883\u53D8\u91CF ${ENV_VAR}\n    for (const [key, value] of Object.entries(envVars)) {\n      const placeholder = new RegExp(`\\\\$\\\\{${key}\\\\}`, 'g');\n      result = result.replace(placeholder, value);\n    }\n    \n    return result;\n  }\n  \n  /**\n   * \u83B7\u53D6\u5D4C\u5957\u5C5E\u6027\u503C\n   */\n  private getNestedValue(obj: any, path: string): any {\n    return path.split('.').reduce((current, key) => current?.[key], obj);\n  }\n  \n  /**\n   * \u8BC4\u4F30\u6761\u4EF6\u8868\u8FBE\u5F0F\n   */\n  private evaluateCondition(condition: string, data: any): boolean {\n    try {\n      const fn = new Function('data', `return ${condition}`);\n      return fn(data);\n    } catch {\n      return false;\n    }\n  }\n  \n  /**\n   * \u9A8C\u8BC1\u53C2\u6570\n   */\n  private validateParams(\n    tool: MCPToolDefinition,\n    args: Record<string, any>\n  ): { valid: boolean; error?: string } {\n    for (const param of tool.parameters) {\n      const value = args[param.name];\n      \n      // \u68C0\u67E5\u5FC5\u586B\n      if (param.required && (value === undefined || value === null)) {\n        return { valid: false, error: `Missing required parameter: ${param.name}` };\n      }\n      \n      if (value === undefined || value === null) continue;\n      \n      // \u7C7B\u578B\u68C0\u67E5\n      const actualType = Array.isArray(value) ? 'array' : typeof value;\n      if (param.type !== 'json' && actualType !== param.type && \n          !(param.type === 'file' && actualType === 'string') &&\n          !(param.type === 'code' && actualType === 'string')) {\n        return { valid: false, error: `Invalid type for ${param.name}: expected ${param.type}, got ${actualType}` };\n      }\n      \n      // \u9A8C\u8BC1\u89C4\u5219\n      if (param.validation) {\n        const v = param.validation;\n        \n        if (v.enum && !v.enum.includes(value)) {\n          return { valid: false, error: `Invalid value for ${param.name}: must be one of ${v.enum.join(', ')}` };\n        }\n        \n        if (v.pattern && !new RegExp(v.pattern).test(value)) {\n          return { valid: false, error: `Invalid format for ${param.name}` };\n        }\n        \n        if (typeof value === 'number') {\n          if (v.min !== undefined && value < v.min) {\n            return { valid: false, error: `${param.name} must be at least ${v.min}` };\n          }\n          if (v.max !== undefined && value > v.max) {\n            return { valid: false, error: `${param.name} must be at most ${v.max}` };\n          }\n        }\n        \n        if (typeof value === 'string') {\n          if (v.min !== undefined && value.length < v.min) {\n            return { valid: false, error: `${param.name} must be at least ${v.min} characters` };\n          }\n          if (v.max !== undefined && value.length > v.max) {\n            return { valid: false, error: `${param.name} must be at most ${v.max} characters` };\n          }\n        }\n      }\n    }\n    \n    return { valid: true };\n  }\n  \n  /**\n   * \u68C0\u67E5\u901F\u7387\u9650\u5236\n   */\n  private checkRateLimit(toolId: string, limit: number): boolean {\n    const now = Date.now();\n    const windowStart = now - 60000; // 1\u5206\u949F\u7A97\u53E3\n    \n    let timestamps = this.rateLimitMap.get(toolId) || [];\n    timestamps = timestamps.filter(t => t > windowStart);\n    \n    if (timestamps.length >= limit) {\n      return false;\n    }\n    \n    timestamps.push(now);\n    this.rateLimitMap.set(toolId, timestamps);\n    return true;\n  }\n  \n  /**\n   * \u8BF7\u6C42\u7528\u6237\u786E\u8BA4\n   */\n  private async requestConfirmation(\n    tool: MCPToolDefinition,\n    args: Record<string, any>\n  ): Promise<boolean> {\n    const argsStr = Object.entries(args)\n      .map(([k, v]) => `  ${k}: ${JSON.stringify(v)}`)\n      .join('\\n');\n    \n    const result = await vscode.window.showWarningMessage(\n      `MCP\u5DE5\u5177 \"${tool.name}\" \u8BF7\u6C42\u6267\u884C:\\n\\n${argsStr}\\n\\n\u662F\u5426\u5141\u8BB8?`,\n      { modal: true },\n      '\u5141\u8BB8',\n      '\u62D2\u7EDD'\n    );\n    \n    return result === '\u5141\u8BB8';\n  }\n  \n  /**\n   * \u521B\u5EFA\u9519\u8BEF\u7ED3\u679C\n   */\n  private createErrorResult(\n    toolId: string,\n    requestId: string,\n    code: string,\n    message: string,\n    startTime: number\n  ): MCPToolResult {\n    return {\n      success: false,\n      toolId,\n      requestId,\n      error: { code, message },\n      stats: {\n        startTime,\n        endTime: Date.now(),\n        duration: Date.now() - startTime,\n      },\n    };\n  }\n  \n  /**\n   * \u6DFB\u52A0\u5230\u5386\u53F2\u8BB0\u5F55\n   */\n  private addToHistory(entry: ExecutionHistory): void {\n    this.executionHistory.push(entry);\n    \n    // \u9650\u5236\u5386\u53F2\u5927\u5C0F\n    if (this.executionHistory.length > this.maxHistorySize) {\n      this.executionHistory.shift();\n    }\n  }\n  \n  /**\n   * \u83B7\u53D6\u6267\u884C\u5386\u53F2\n   */\n  getExecutionHistory(limit?: number): ExecutionHistory[] {\n    const history = [...this.executionHistory].reverse();\n    return limit ? history.slice(0, limit) : history;\n  }\n  \n  /**\n   * \u6E05\u9664\u6267\u884C\u5386\u53F2\n   */\n  clearHistory(): void {\n    this.executionHistory = [];\n  }\n}\n", "/**\n * MCP Agent\n * \n * \u667A\u80FD\u4EE3\u7406\uFF0C\u80FD\u591F\u7406\u89E3\u7528\u6237\u4EFB\u52A1\uFF0C\u81EA\u52A8\u9009\u62E9\u5408\u9002\u7684\u5DE5\u5177\u5E76\u6267\u884C\n * \u652F\u6301\u591A\u6B65\u9AA4\u4EFB\u52A1\u89C4\u5212\u548C\u6267\u884C\n */\n\nimport * as vscode from 'vscode';\nimport {\n  MCPToolDefinition,\n  MCPAgentRequest,\n  MCPAgentResult,\n  MCPAgentToolSelection,\n  MCPToolCallParams,\n  MCPToolResult,\n} from './types';\nimport { MCPRegistry } from './MCPRegistry';\nimport { MCPExecutor } from './MCPExecutor';\nimport { ChatService } from '../api/ChatService';\nimport { ConfigManager } from '../ConfigManager';\nimport { Message } from '../../types/shared';\n\n/**\n * Agent\u6267\u884C\u72B6\u6001\n */\nexport type AgentStatus = 'idle' | 'planning' | 'executing' | 'completed' | 'failed';\n\n/**\n * Agent\u6267\u884C\u6B65\u9AA4\n */\nexport interface AgentStep {\n  step: number;\n  toolId: string;\n  toolName: string;\n  description: string;\n  params: Record<string, any>;\n  status: 'pending' | 'running' | 'success' | 'failed' | 'skipped';\n  result?: MCPToolResult;\n}\n\n/**\n * MCP Agent\n */\nexport class MCPAgent {\n  private static instance: MCPAgent | null = null;\n  \n  private context: vscode.ExtensionContext;\n  private registry: MCPRegistry;\n  private executor: MCPExecutor;\n  private configManager: ConfigManager;\n  private chatService: ChatService | null = null;\n  \n  private status: AgentStatus = 'idle';\n  private currentSteps: AgentStep[] = [];\n  private abortController: AbortController | null = null;\n  \n  // \u4E8B\u4EF6\n  private _onStatusChange = new vscode.EventEmitter<AgentStatus>();\n  private _onStepUpdate = new vscode.EventEmitter<AgentStep>();\n  private _onProgress = new vscode.EventEmitter<{ message: string; progress?: number }>();\n  \n  public readonly onStatusChange = this._onStatusChange.event;\n  public readonly onStepUpdate = this._onStepUpdate.event;\n  public readonly onProgress = this._onProgress.event;\n  \n  private constructor(\n    context: vscode.ExtensionContext,\n    registry: MCPRegistry,\n    executor: MCPExecutor,\n    configManager: ConfigManager\n  ) {\n    this.context = context;\n    this.registry = registry;\n    this.executor = executor;\n    this.configManager = configManager;\n  }\n  \n  static getInstance(\n    context: vscode.ExtensionContext,\n    registry: MCPRegistry,\n    executor: MCPExecutor,\n    configManager: ConfigManager\n  ): MCPAgent {\n    if (!MCPAgent.instance) {\n      MCPAgent.instance = new MCPAgent(context, registry, executor, configManager);\n    }\n    return MCPAgent.instance;\n  }\n  \n  /**\n   * \u6267\u884CAgent\u4EFB\u52A1\n   */\n  async executeTask(request: MCPAgentRequest): Promise<MCPAgentResult> {\n    if (this.status !== 'idle') {\n      return {\n        success: false,\n        task: request.task,\n        executions: [],\n        answer: 'Agent is busy with another task',\n      };\n    }\n    \n    this.abortController = new AbortController();\n    this.currentSteps = [];\n    \n    try {\n      // \u786E\u4FDDChatService\u53EF\u7528\n      await this.ensureChatService();\n      if (!this.chatService) {\n        return {\n          success: false,\n          task: request.task,\n          executions: [],\n          answer: '\u8BF7\u5148\u914D\u7F6EAPI Key',\n        };\n      }\n      \n      // \u9636\u6BB51: \u89C4\u5212\n      this.setStatus('planning');\n      this._onProgress.fire({ message: '\u6B63\u5728\u5206\u6790\u4EFB\u52A1...', progress: 10 });\n      \n      const plan = await this.planTask(request);\n      \n      if (!plan.length) {\n        this.setStatus('idle');\n        return {\n          success: true,\n          task: request.task,\n          executions: [],\n          answer: '\u65E0\u9700\u4F7F\u7528\u5DE5\u5177\uFF0C\u6211\u53EF\u4EE5\u76F4\u63A5\u56DE\u7B54\u8FD9\u4E2A\u95EE\u9898\u3002',\n        };\n      }\n      \n      this.currentSteps = plan;\n      this._onProgress.fire({ message: `\u5DF2\u89C4\u5212 ${plan.length} \u4E2A\u6B65\u9AA4`, progress: 30 });\n      \n      // \u9636\u6BB52: \u6267\u884C\n      this.setStatus('executing');\n      const executions: Array<{ toolId: string; result: MCPToolResult }> = [];\n      \n      for (let i = 0; i < plan.length; i++) {\n        if (this.abortController.signal.aborted) {\n          break;\n        }\n        \n        const step = plan[i];\n        step.status = 'running';\n        this._onStepUpdate.fire(step);\n        this._onProgress.fire({ \n          message: `\u6B63\u5728\u6267\u884C: ${step.toolName}`, \n          progress: 30 + (i / plan.length) * 50 \n        });\n        \n        try {\n          const result = await this.executor.execute({\n            toolId: step.toolId,\n            arguments: step.params,\n            caller: 'agent',\n            context: request.context,\n          });\n          \n          step.result = result;\n          step.status = result.success ? 'success' : 'failed';\n          executions.push({ toolId: step.toolId, result });\n          \n          // \u5982\u679C\u5931\u8D25\u4E14\u662F\u5173\u952E\u6B65\u9AA4\uFF0C\u53EF\u80FD\u9700\u8981\u4E2D\u65AD\n          if (!result.success && this.isCriticalStep(step, plan)) {\n            console.log(`[MCPAgent] Critical step failed: ${step.toolId}`);\n            break;\n          }\n        } catch (error) {\n          step.status = 'failed';\n          step.result = {\n            success: false,\n            toolId: step.toolId,\n            error: {\n              code: 'EXECUTION_ERROR',\n              message: error instanceof Error ? error.message : 'Unknown error',\n            },\n            stats: {\n              startTime: Date.now(),\n              endTime: Date.now(),\n              duration: 0,\n            },\n          };\n          executions.push({ toolId: step.toolId, result: step.result });\n        }\n        \n        this._onStepUpdate.fire(step);\n      }\n      \n      // \u9636\u6BB53: \u603B\u7ED3\n      this._onProgress.fire({ message: '\u6B63\u5728\u751F\u6210\u603B\u7ED3...', progress: 90 });\n      \n      const summary = await this.generateSummary(request.task, executions);\n      \n      this.setStatus('completed');\n      this._onProgress.fire({ message: '\u5B8C\u6210', progress: 100 });\n      \n      return {\n        success: executions.every(e => e.result.success),\n        task: request.task,\n        plan: plan.map(s => ({\n          step: s.step,\n          toolId: s.toolId,\n          description: s.description,\n          params: s.params,\n        })),\n        executions,\n        answer: summary.answer,\n        summary: summary.summary,\n      };\n      \n    } catch (error) {\n      this.setStatus('failed');\n      return {\n        success: false,\n        task: request.task,\n        executions: [],\n        answer: `\u6267\u884C\u5931\u8D25: ${error instanceof Error ? error.message : 'Unknown error'}`,\n      };\n    } finally {\n      this.abortController = null;\n    }\n  }\n  \n  /**\n   * \u53D6\u6D88\u5F53\u524D\u4EFB\u52A1\n   */\n  cancelTask(): void {\n    if (this.abortController) {\n      this.abortController.abort();\n      this.setStatus('idle');\n    }\n  }\n  \n  /**\n   * \u83B7\u53D6\u5F53\u524D\u72B6\u6001\n   */\n  getStatus(): AgentStatus {\n    return this.status;\n  }\n  \n  /**\n   * \u83B7\u53D6\u5F53\u524D\u6267\u884C\u6B65\u9AA4\n   */\n  getCurrentSteps(): AgentStep[] {\n    return [...this.currentSteps];\n  }\n  \n  /**\n   * \u89C4\u5212\u4EFB\u52A1\n   */\n  private async planTask(request: MCPAgentRequest): Promise<AgentStep[]> {\n    const tools = this.registry.getAgentTools();\n    \n    // \u5E94\u7528\u7EA6\u675F\n    let availableTools = tools;\n    if (request.constraints) {\n      if (request.constraints.allowedCategories) {\n        availableTools = availableTools.filter(t => \n          request.constraints!.allowedCategories!.includes(t.category)\n        );\n      }\n      if (request.constraints.excludeTools) {\n        availableTools = availableTools.filter(t => \n          !request.constraints!.excludeTools!.includes(t.id)\n        );\n      }\n    }\n    \n    if (availableTools.length === 0) {\n      return [];\n    }\n    \n    // \u6784\u5EFA\u5DE5\u5177\u63CF\u8FF0\n    const toolDescriptions = availableTools.map(t => this.formatToolForAI(t)).join('\\n\\n');\n    \n    // \u6784\u5EFA\u4E0A\u4E0B\u6587\n    const contextInfo = this.buildContextInfo(request.context);\n    \n    // \u8BF7\u6C42AI\u89C4\u5212\n    const planPrompt = this.buildPlanningPrompt(request.task, toolDescriptions, contextInfo);\n    \n    try {\n      const response = await this.chatService!.sendMessageSync([\n        {\n          id: 'plan',\n          role: 'user',\n          content: planPrompt,\n          timestamp: Date.now(),\n        },\n      ]);\n      \n      return this.parsePlanResponse(response, availableTools);\n    } catch (error) {\n      console.error('[MCPAgent] Planning failed:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * \u683C\u5F0F\u5316\u5DE5\u5177\u63CF\u8FF0\u7ED9AI\n   */\n  private formatToolForAI(tool: MCPToolDefinition): string {\n    const params = tool.parameters.map(p => \n      `  - ${p.name} (${p.type}${p.required ? ', required' : ''}): ${p.description}`\n    ).join('\\n');\n    \n    return `### ${tool.id}\nName: ${tool.name}\nDescription: ${tool.description}\nCategory: ${tool.category}\n${tool.aiHints?.whenToUse ? `When to use: ${tool.aiHints.whenToUse}` : ''}\nParameters:\n${params || '  (none)'}\nReturns: ${tool.returns.description}`;\n  }\n  \n  /**\n   * \u6784\u5EFA\u4E0A\u4E0B\u6587\u4FE1\u606F\n   */\n  private buildContextInfo(context?: MCPAgentRequest['context']): string {\n    if (!context) return '';\n    \n    const parts: string[] = [];\n    \n    if (context.workspaceRoot) {\n      parts.push(`Workspace: ${context.workspaceRoot}`);\n    }\n    if (context.activeFile) {\n      parts.push(`Active file: ${context.activeFile}`);\n    }\n    if (context.selectedCode) {\n      parts.push(`Selected code:\\n\\`\\`\\`\\n${context.selectedCode.slice(0, 500)}\\n\\`\\`\\``);\n    }\n    if (context.recentTools?.length) {\n      parts.push(`Recently used tools: ${context.recentTools.join(', ')}`);\n    }\n    \n    return parts.length ? `\\n\\nContext:\\n${parts.join('\\n')}` : '';\n  }\n  \n  /**\n   * \u6784\u5EFA\u89C4\u5212\u63D0\u793A\n   */\n  private buildPlanningPrompt(task: string, tools: string, context: string): string {\n    return `You are an AI assistant with access to various tools. Your task is to analyze the user's request and create an execution plan.\n\n## Available Tools:\n${tools}\n\n## User Task:\n${task}\n${context}\n\n## Instructions:\n1. Analyze what the user wants to accomplish\n2. Determine which tools (if any) are needed\n3. Create a step-by-step execution plan\n4. For each step, specify the tool and its parameters\n\n## Response Format:\nIf no tools are needed, respond with:\nNO_TOOLS_NEEDED\n\nIf tools are needed, respond with a JSON array:\n\\`\\`\\`json\n[\n  {\n    \"step\": 1,\n    \"toolId\": \"tool_id\",\n    \"description\": \"What this step does\",\n    \"params\": {\n      \"param1\": \"value1\"\n    }\n  }\n]\n\\`\\`\\`\n\nImportant:\n- Only use tools from the available list\n- Provide complete parameter values based on the task context\n- Keep the plan concise (usually 1-3 steps)\n- If the task is a simple question, NO_TOOLS_NEEDED is appropriate`;\n  }\n  \n  /**\n   * \u89E3\u6790\u89C4\u5212\u54CD\u5E94\n   */\n  private parsePlanResponse(response: string, tools: MCPToolDefinition[]): AgentStep[] {\n    if (response.includes('NO_TOOLS_NEEDED')) {\n      return [];\n    }\n    \n    // \u63D0\u53D6JSON\n    const jsonMatch = response.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n    if (!jsonMatch) {\n      // \u5C1D\u8BD5\u76F4\u63A5\u89E3\u6790\n      try {\n        const parsed = JSON.parse(response);\n        if (Array.isArray(parsed)) {\n          return this.validateAndEnrichSteps(parsed, tools);\n        }\n      } catch {\n        console.error('[MCPAgent] Failed to parse plan response');\n      }\n      return [];\n    }\n    \n    try {\n      const parsed = JSON.parse(jsonMatch[1]);\n      if (!Array.isArray(parsed)) {\n        return [];\n      }\n      \n      return this.validateAndEnrichSteps(parsed, tools);\n    } catch (error) {\n      console.error('[MCPAgent] Failed to parse plan JSON:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * \u9A8C\u8BC1\u548C\u4E30\u5BCC\u6B65\u9AA4\n   */\n  private validateAndEnrichSteps(\n    steps: any[],\n    tools: MCPToolDefinition[]\n  ): AgentStep[] {\n    const toolMap = new Map(tools.map(t => [t.id, t]));\n    \n    return steps\n      .filter(s => s.toolId && toolMap.has(s.toolId))\n      .map((s, index) => ({\n        step: s.step || index + 1,\n        toolId: s.toolId,\n        toolName: toolMap.get(s.toolId)!.name,\n        description: s.description || `Execute ${toolMap.get(s.toolId)!.name}`,\n        params: s.params || {},\n        status: 'pending' as const,\n      }));\n  }\n  \n  /**\n   * \u5224\u65AD\u662F\u5426\u662F\u5173\u952E\u6B65\u9AA4\n   */\n  private isCriticalStep(step: AgentStep, allSteps: AgentStep[]): boolean {\n    // \u7B2C\u4E00\u6B65\u901A\u5E38\u662F\u5173\u952E\u7684\n    if (step.step === 1) return true;\n    \n    // \u5982\u679C\u540E\u7EED\u6B65\u9AA4\u4F9D\u8D56\u6B64\u6B65\u9AA4\u7684\u8F93\u51FA\uFF0C\u4E5F\u662F\u5173\u952E\u7684\n    // \u7B80\u5316\u5B9E\u73B0\uFF1A\u5047\u8BBE\u6240\u6709\u6B65\u9AA4\u90FD\u662F\u987A\u5E8F\u4F9D\u8D56\u7684\n    return step.step < allSteps.length;\n  }\n  \n  /**\n   * \u751F\u6210\u6267\u884C\u603B\u7ED3\n   */\n  private async generateSummary(\n    task: string,\n    executions: Array<{ toolId: string; result: MCPToolResult }>\n  ): Promise<{ answer: string; summary: string }> {\n    if (executions.length === 0) {\n      return {\n        answer: '\u4EFB\u52A1\u5B8C\u6210\uFF0C\u4F46\u6CA1\u6709\u6267\u884C\u4EFB\u4F55\u5DE5\u5177\u3002',\n        summary: '',\n      };\n    }\n    \n    // \u6784\u5EFA\u6267\u884C\u7ED3\u679C\u6458\u8981\n    const executionSummary = executions.map(e => {\n      const tool = this.registry.getTool(e.toolId);\n      const toolName = tool?.tool.name || e.toolId;\n      \n      if (e.result.success) {\n        const dataPreview = JSON.stringify(e.result.data).slice(0, 500);\n        return `\u2713 ${toolName}: ${dataPreview}${dataPreview.length >= 500 ? '...' : ''}`;\n      } else {\n        return `\u2717 ${toolName}: ${e.result.error?.message || 'Failed'}`;\n      }\n    }).join('\\n');\n    \n    // \u8BF7\u6C42AI\u751F\u6210\u603B\u7ED3\n    const summaryPrompt = `Based on the following tool execution results, provide a concise answer to the user's task.\n\n## Original Task:\n${task}\n\n## Execution Results:\n${executionSummary}\n\n## Instructions:\n1. Summarize what was accomplished\n2. Provide the relevant information the user asked for\n3. Note any failures if they affected the result\n4. Keep the response concise and helpful\n\nResponse in the user's language (Chinese if the task is in Chinese).`;\n    \n    try {\n      const response = await this.chatService!.sendMessageSync([\n        {\n          id: 'summary',\n          role: 'user',\n          content: summaryPrompt,\n          timestamp: Date.now(),\n        },\n      ]);\n      \n      return {\n        answer: response,\n        summary: executionSummary,\n      };\n    } catch (error) {\n      // \u5982\u679CAI\u603B\u7ED3\u5931\u8D25\uFF0C\u8FD4\u56DE\u57FA\u672C\u4FE1\u606F\n      const successCount = executions.filter(e => e.result.success).length;\n      return {\n        answer: `\u5DF2\u6267\u884C ${executions.length} \u4E2A\u5DE5\u5177\uFF0C${successCount} \u4E2A\u6210\u529F\u3002`,\n        summary: executionSummary,\n      };\n    }\n  }\n  \n  /**\n   * \u786E\u4FDDChatService\u53EF\u7528\n   */\n  private async ensureChatService(): Promise<void> {\n    if (this.chatService) return;\n    \n    const config = await this.configManager.getFullModelConfig();\n    if (config.apiKey) {\n      this.chatService = new ChatService(config);\n    }\n  }\n  \n  /**\n   * \u8BBE\u7F6E\u72B6\u6001\n   */\n  private setStatus(status: AgentStatus): void {\n    this.status = status;\n    this._onStatusChange.fire(status);\n  }\n  \n  /**\n   * \u76F4\u63A5\u9009\u62E9\u5DE5\u5177\uFF08\u4E0D\u6267\u884C\uFF09\n   * \u7528\u4E8E\u7528\u6237\u67E5\u770BAI\u4F1A\u9009\u62E9\u54EA\u4E9B\u5DE5\u5177\n   */\n  async selectTools(task: string): Promise<MCPAgentToolSelection[]> {\n    await this.ensureChatService();\n    if (!this.chatService) {\n      return [];\n    }\n    \n    const tools = this.registry.getAgentTools();\n    const toolDescriptions = tools.map(t => this.formatToolForAI(t)).join('\\n\\n');\n    \n    const prompt = `Given the following task and available tools, select the most appropriate tools and explain why.\n\n## Task:\n${task}\n\n## Available Tools:\n${toolDescriptions}\n\n## Instructions:\nSelect 1-3 tools that would be most helpful for this task.\nFor each selected tool, provide:\n1. Tool ID\n2. Confidence score (0-1)\n3. Reason for selection\n4. Suggested parameter values\n\nResponse format:\n\\`\\`\\`json\n[\n  {\n    \"toolId\": \"tool_id\",\n    \"confidence\": 0.9,\n    \"reason\": \"Why this tool is appropriate\",\n    \"suggestedParams\": { \"param1\": \"value1\" }\n  }\n]\n\\`\\`\\``;\n    \n    try {\n      const response = await this.chatService.sendMessageSync([\n        {\n          id: 'select',\n          role: 'user',\n          content: prompt,\n          timestamp: Date.now(),\n        },\n      ]);\n      \n      const jsonMatch = response.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[1]);\n      }\n      return [];\n    } catch {\n      return [];\n    }\n  }\n}\n", "/**\n * MCP Autonomous Agent (ReAct Pattern)\n * \n * \u81EA\u4E3B\u5FAA\u73AFAgent\uFF0C\u91C7\u7528ReAct\u6A21\u5F0F\uFF08Reasoning + Acting\uFF09\n * \n * \u6838\u5FC3\u80FD\u529B\uFF1A\n * 1. \u81EA\u4E3B\u601D\u8003-\u884C\u52A8\u5FAA\u73AF\uFF0C\u76F4\u5230\u4EFB\u52A1\u5B8C\u6210\n * 2. \u652F\u6301\u5E76\u884C\u8C03\u7528\u591A\u4E2A\u5DE5\u5177\n * 3. \u57FA\u4E8E\u6267\u884C\u7ED3\u679C\u52A8\u6001\u8C03\u6574\u7B56\u7565\n * 4. \u5DE5\u5177\u95F4\u6570\u636E\u4F20\u9012\u548C\u4E0A\u4E0B\u6587\u79EF\u7D2F\n * 5. \u667A\u80FD\u7EC8\u6B62\u6761\u4EF6\u5224\u65AD\n */\n\nimport * as vscode from 'vscode';\nimport {\n  MCPToolDefinition,\n  MCPToolResult,\n  MCPToolCallParams,\n} from './types';\nimport { MCPRegistry } from './MCPRegistry';\nimport { MCPExecutor } from './MCPExecutor';\nimport { ChatService } from '../api/ChatService';\nimport { ConfigManager } from '../ConfigManager';\n\n// ============================================\n// \u7C7B\u578B\u5B9A\u4E49\n// ============================================\n\n/**\n * Agent\u8FD0\u884C\u72B6\u6001\n */\nexport type AutonomousAgentStatus = \n  | 'idle'           // \u7A7A\u95F2\n  | 'thinking'       // \u601D\u8003\u4E2D\n  | 'executing'      // \u6267\u884C\u5DE5\u5177\u4E2D\n  | 'reflecting'     // \u53CD\u601D\u7ED3\u679C\u4E2D\n  | 'completed'      // \u5B8C\u6210\n  | 'failed'         // \u5931\u8D25\n  | 'cancelled';     // \u5DF2\u53D6\u6D88\n\n/**\n * \u5355\u6B21\u5DE5\u5177\u8C03\u7528\n */\nexport interface ToolCall {\n  id: string;\n  toolId: string;\n  toolName: string;\n  params: Record<string, any>;\n  reason: string;           // \u4E3A\u4EC0\u4E48\u8C03\u7528\u8FD9\u4E2A\u5DE5\u5177\n  dependsOn?: string[];     // \u4F9D\u8D56\u54EA\u4E9B\u524D\u7F6E\u8C03\u7528\u7684\u7ED3\u679C\n}\n\n/**\n * \u601D\u8003\u6B65\u9AA4\n */\nexport interface ThoughtStep {\n  iteration: number;\n  thought: string;          // Agent\u7684\u601D\u8003\u8FC7\u7A0B\n  analysis: string;         // \u5BF9\u5F53\u524D\u72B6\u6001\u7684\u5206\u6790\n  decision: 'continue' | 'complete' | 'need_clarification';\n  toolCalls: ToolCall[];    // \u672C\u8F6E\u8981\u6267\u884C\u7684\u5DE5\u5177\uFF08\u53EF\u4EE5\u591A\u4E2A\uFF09\n  parallelizable: boolean;  // \u8FD9\u4E9B\u5DE5\u5177\u662F\u5426\u53EF\u4EE5\u5E76\u884C\u6267\u884C\n}\n\n/**\n * \u6267\u884C\u7ED3\u679C\n */\nexport interface ExecutionResult {\n  callId: string;\n  toolId: string;\n  success: boolean;\n  data?: any;\n  error?: string;\n  duration: number;\n}\n\n/**\n * \u8FED\u4EE3\u8BB0\u5F55\n */\nexport interface IterationRecord {\n  iteration: number;\n  thought: ThoughtStep;\n  executions: ExecutionResult[];\n  observation: string;      // Agent\u5BF9\u7ED3\u679C\u7684\u89C2\u5BDF\u603B\u7ED3\n  timestamp: number;\n}\n\n/**\n * Agent\u4EFB\u52A1\u8BF7\u6C42\n */\nexport interface AutonomousAgentRequest {\n  task: string;\n  context?: {\n    workspaceRoot?: string;\n    activeFile?: string;\n    selectedCode?: string;\n    additionalContext?: string;\n  };\n  config?: {\n    maxIterations?: number;     // \u6700\u5927\u8FED\u4EE3\u6B21\u6570\uFF0C\u9ED8\u8BA410\n    maxParallelCalls?: number;  // \u6700\u5927\u5E76\u884C\u8C03\u7528\u6570\uFF0C\u9ED8\u8BA45\n    timeout?: number;           // \u603B\u8D85\u65F6\u65F6\u95F4(ms)\uFF0C\u9ED8\u8BA4120000\n    autoApprove?: boolean;      // \u662F\u5426\u81EA\u52A8\u6279\u51C6\u5371\u9669\u64CD\u4F5C\uFF0C\u9ED8\u8BA4false\n  };\n}\n\n/**\n * Agent\u4EFB\u52A1\u7ED3\u679C\n */\nexport interface AutonomousAgentResult {\n  success: boolean;\n  task: string;\n  iterations: IterationRecord[];\n  finalAnswer: string;\n  totalDuration: number;\n  toolsUsed: string[];\n  stats: {\n    totalIterations: number;\n    totalToolCalls: number;\n    successfulCalls: number;\n    failedCalls: number;\n  };\n}\n\n// ============================================\n// \u81EA\u4E3B\u5FAA\u73AFAgent\u5B9E\u73B0\n// ============================================\n\nexport class AutonomousAgent {\n  private static instance: AutonomousAgent | null = null;\n  \n  private context: vscode.ExtensionContext;\n  private registry: MCPRegistry;\n  private executor: MCPExecutor;\n  private configManager: ConfigManager;\n  private chatService: ChatService | null = null;\n  \n  private status: AutonomousAgentStatus = 'idle';\n  private abortController: AbortController | null = null;\n  \n  // \u8FD0\u884C\u65F6\u72B6\u6001\n  private currentTask: string = '';\n  private iterations: IterationRecord[] = [];\n  private accumulatedContext: string = '';  // \u79EF\u7D2F\u7684\u4E0A\u4E0B\u6587\n  private toolResultsMap: Map<string, any> = new Map();  // \u5DE5\u5177\u7ED3\u679C\u7F13\u5B58\n  \n  // \u4E8B\u4EF6\n  private _onStatusChange = new vscode.EventEmitter<AutonomousAgentStatus>();\n  private _onIteration = new vscode.EventEmitter<IterationRecord>();\n  private _onThought = new vscode.EventEmitter<ThoughtStep>();\n  private _onToolExecution = new vscode.EventEmitter<{ call: ToolCall; result?: ExecutionResult }>();\n  private _onProgress = new vscode.EventEmitter<{ message: string; progress: number; detail?: string }>();\n  \n  public readonly onStatusChange = this._onStatusChange.event;\n  public readonly onIteration = this._onIteration.event;\n  public readonly onThought = this._onThought.event;\n  public readonly onToolExecution = this._onToolExecution.event;\n  public readonly onProgress = this._onProgress.event;\n  \n  private constructor(\n    context: vscode.ExtensionContext,\n    registry: MCPRegistry,\n    executor: MCPExecutor,\n    configManager: ConfigManager\n  ) {\n    this.context = context;\n    this.registry = registry;\n    this.executor = executor;\n    this.configManager = configManager;\n  }\n  \n  static getInstance(\n    context: vscode.ExtensionContext,\n    registry: MCPRegistry,\n    executor: MCPExecutor,\n    configManager: ConfigManager\n  ): AutonomousAgent {\n    if (!AutonomousAgent.instance) {\n      AutonomousAgent.instance = new AutonomousAgent(context, registry, executor, configManager);\n    }\n    return AutonomousAgent.instance;\n  }\n  \n  /**\n   * \u6267\u884C\u81EA\u4E3B\u4EFB\u52A1\n   */\n  async execute(request: AutonomousAgentRequest): Promise<AutonomousAgentResult> {\n    if (this.status !== 'idle') {\n      throw new Error('Agent is busy with another task');\n    }\n    \n    const startTime = Date.now();\n    const config = {\n      maxIterations: request.config?.maxIterations ?? 10,\n      maxParallelCalls: request.config?.maxParallelCalls ?? 5,\n      timeout: request.config?.timeout ?? 120000,\n      autoApprove: request.config?.autoApprove ?? false,\n    };\n    \n    // \u521D\u59CB\u5316\n    this.abortController = new AbortController();\n    this.currentTask = request.task;\n    this.iterations = [];\n    this.accumulatedContext = '';\n    this.toolResultsMap.clear();\n    \n    const toolsUsed = new Set<string>();\n    let totalCalls = 0;\n    let successfulCalls = 0;\n    let failedCalls = 0;\n    \n    try {\n      // \u786E\u4FDDChatService\u53EF\u7528\n      await this.ensureChatService();\n      if (!this.chatService) {\n        return this.createFailedResult(request.task, '\u8BF7\u5148\u914D\u7F6EAPI Key', startTime);\n      }\n      \n      this._onProgress.fire({ message: '\u5F00\u59CB\u5206\u6790\u4EFB\u52A1...', progress: 5 });\n      \n      // ========== ReAct\u5FAA\u73AF ==========\n      for (let iteration = 1; iteration <= config.maxIterations; iteration++) {\n        // \u68C0\u67E5\u53D6\u6D88\u548C\u8D85\u65F6\n        if (this.abortController.signal.aborted) {\n          this.setStatus('cancelled');\n          break;\n        }\n        \n        if (Date.now() - startTime > config.timeout) {\n          this._onProgress.fire({ message: '\u4EFB\u52A1\u8D85\u65F6', progress: 100 });\n          break;\n        }\n        \n        const iterationProgress = 5 + (iteration / config.maxIterations) * 85;\n        this._onProgress.fire({ \n          message: `\u7B2C ${iteration} \u8F6E\u601D\u8003...`, \n          progress: iterationProgress,\n          detail: `\u5DF2\u6267\u884C ${totalCalls} \u6B21\u5DE5\u5177\u8C03\u7528`\n        });\n        \n        // ===== 1. \u601D\u8003\u9636\u6BB5 =====\n        this.setStatus('thinking');\n        const thought = await this.think(request, iteration);\n        this._onThought.fire(thought);\n        \n        // \u68C0\u67E5\u662F\u5426\u5B8C\u6210\n        if (thought.decision === 'complete') {\n          const finalAnswer = await this.generateFinalAnswer(request);\n          this.setStatus('completed');\n          \n          return {\n            success: true,\n            task: request.task,\n            iterations: this.iterations,\n            finalAnswer,\n            totalDuration: Date.now() - startTime,\n            toolsUsed: Array.from(toolsUsed),\n            stats: {\n              totalIterations: iteration,\n              totalToolCalls: totalCalls,\n              successfulCalls,\n              failedCalls,\n            },\n          };\n        }\n        \n        if (thought.decision === 'need_clarification') {\n          // \u9700\u8981\u7528\u6237\u6F84\u6E05\n          this.setStatus('completed');\n          return {\n            success: true,\n            task: request.task,\n            iterations: this.iterations,\n            finalAnswer: thought.thought,\n            totalDuration: Date.now() - startTime,\n            toolsUsed: Array.from(toolsUsed),\n            stats: {\n              totalIterations: iteration,\n              totalToolCalls: totalCalls,\n              successfulCalls,\n              failedCalls,\n            },\n          };\n        }\n        \n        // ===== 2. \u6267\u884C\u9636\u6BB5 =====\n        if (thought.toolCalls.length > 0) {\n          this.setStatus('executing');\n          \n          let executions: ExecutionResult[];\n          \n          if (thought.parallelizable && thought.toolCalls.length > 1) {\n            // \u5E76\u884C\u6267\u884C\n            executions = await this.executeToolsInParallel(\n              thought.toolCalls, \n              config.maxParallelCalls,\n              request.context\n            );\n          } else {\n            // \u4E32\u884C\u6267\u884C\uFF08\u6709\u4F9D\u8D56\u5173\u7CFB\uFF09\n            executions = await this.executeToolsSequentially(\n              thought.toolCalls,\n              request.context\n            );\n          }\n          \n          // \u7EDF\u8BA1\n          for (const exec of executions) {\n            totalCalls++;\n            toolsUsed.add(exec.toolId);\n            if (exec.success) {\n              successfulCalls++;\n              // \u7F13\u5B58\u7ED3\u679C\u4F9B\u540E\u7EED\u4F7F\u7528\n              this.toolResultsMap.set(exec.callId, exec.data);\n            } else {\n              failedCalls++;\n            }\n          }\n          \n          // ===== 3. \u53CD\u601D\u9636\u6BB5 =====\n          this.setStatus('reflecting');\n          const observation = await this.observe(thought, executions);\n          \n          // \u8BB0\u5F55\u672C\u8F6E\u8FED\u4EE3\n          const record: IterationRecord = {\n            iteration,\n            thought,\n            executions,\n            observation,\n            timestamp: Date.now(),\n          };\n          \n          this.iterations.push(record);\n          this._onIteration.fire(record);\n          \n          // \u66F4\u65B0\u79EF\u7D2F\u4E0A\u4E0B\u6587\n          this.accumulatedContext += `\\n\\n--- Iteration ${iteration} ---\\n`;\n          this.accumulatedContext += `Thought: ${thought.thought}\\n`;\n          this.accumulatedContext += `Actions: ${thought.toolCalls.map(c => c.toolId).join(', ')}\\n`;\n          this.accumulatedContext += `Observation: ${observation}\\n`;\n        }\n      }\n      \n      // \u8FBE\u5230\u6700\u5927\u8FED\u4EE3\u6B21\u6570\n      this.setStatus('completed');\n      const finalAnswer = await this.generateFinalAnswer(request);\n      \n      return {\n        success: true,\n        task: request.task,\n        iterations: this.iterations,\n        finalAnswer,\n        totalDuration: Date.now() - startTime,\n        toolsUsed: Array.from(toolsUsed),\n        stats: {\n          totalIterations: this.iterations.length,\n          totalToolCalls: totalCalls,\n          successfulCalls,\n          failedCalls,\n        },\n      };\n      \n    } catch (error) {\n      this.setStatus('failed');\n      return this.createFailedResult(\n        request.task, \n        error instanceof Error ? error.message : 'Unknown error',\n        startTime\n      );\n    } finally {\n      this.abortController = null;\n      this.setStatus('idle');\n    }\n  }\n  \n  /**\n   * \u601D\u8003\u9636\u6BB5 - \u51B3\u5B9A\u4E0B\u4E00\u6B65\u884C\u52A8\n   */\n  private async think(request: AutonomousAgentRequest, iteration: number): Promise<ThoughtStep> {\n    const tools = this.registry.getAgentTools();\n    const toolDescriptions = this.formatToolsForAI(tools);\n    \n    const prompt = this.buildThinkingPrompt(request, iteration, toolDescriptions);\n    \n    try {\n      const response = await this.chatService!.sendMessageSync([\n        {\n          id: `think_${iteration}`,\n          role: 'user',\n          content: prompt,\n          timestamp: Date.now(),\n        },\n      ]);\n      \n      return this.parseThinkingResponse(response, iteration, tools);\n    } catch (error) {\n      console.error('[AutonomousAgent] Thinking failed:', error);\n      // \u8FD4\u56DE\u5B8C\u6210\u51B3\u5B9A\u4EE5\u907F\u514D\u65E0\u9650\u5FAA\u73AF\n      return {\n        iteration,\n        thought: 'Unable to process the task due to an error.',\n        analysis: 'Error occurred during thinking phase.',\n        decision: 'complete',\n        toolCalls: [],\n        parallelizable: false,\n      };\n    }\n  }\n  \n  /**\n   * \u6784\u5EFA\u601D\u8003\u63D0\u793A\u8BCD\n   */\n  private buildThinkingPrompt(\n    request: AutonomousAgentRequest, \n    iteration: number,\n    toolDescriptions: string\n  ): string {\n    const contextParts: string[] = [];\n    \n    if (request.context?.workspaceRoot) {\n      contextParts.push(`Workspace: ${request.context.workspaceRoot}`);\n    }\n    if (request.context?.activeFile) {\n      contextParts.push(`Active file: ${request.context.activeFile}`);\n    }\n    if (request.context?.selectedCode) {\n      contextParts.push(`Selected code:\\n\\`\\`\\`\\n${request.context.selectedCode.slice(0, 1000)}\\n\\`\\`\\``);\n    }\n    if (request.context?.additionalContext) {\n      contextParts.push(`Additional context: ${request.context.additionalContext}`);\n    }\n    \n    const previousIterations = this.iterations.length > 0 \n      ? this.formatPreviousIterations()\n      : 'None yet.';\n    \n    return `You are an autonomous AI agent that can use tools to complete tasks. You operate in a ReAct loop (Reasoning + Acting).\n\n## Your Task\n${request.task}\n\n## Current Context\n${contextParts.join('\\n') || 'No additional context.'}\n\n## Available Tools\n${toolDescriptions}\n\n## Previous Iterations\n${previousIterations}\n\n## Accumulated Results\n${this.formatAccumulatedResults()}\n\n## Current Iteration: ${iteration}\n\n## Instructions\nAnalyze the current state and decide what to do next. You can:\n1. Call one or more tools (they can run in parallel if independent)\n2. Decide the task is complete\n3. Ask for clarification if needed\n\nThink step by step:\n1. What has been accomplished so far?\n2. What still needs to be done?\n3. Which tools should be used next and why?\n4. Can multiple tools be run in parallel?\n\n## Response Format (JSON)\n\\`\\`\\`json\n{\n  \"thought\": \"Your reasoning process...\",\n  \"analysis\": \"Analysis of current state...\",\n  \"decision\": \"continue\" | \"complete\" | \"need_clarification\",\n  \"toolCalls\": [\n    {\n      \"id\": \"unique_call_id\",\n      \"toolId\": \"tool_id\",\n      \"params\": { \"param1\": \"value1\" },\n      \"reason\": \"Why this tool is needed\",\n      \"dependsOn\": [\"previous_call_id\"] // optional, for sequential execution\n    }\n  ],\n  \"parallelizable\": true | false\n}\n\\`\\`\\`\n\nIf decision is \"complete\", toolCalls should be empty and thought should contain the final answer.\nIf decision is \"need_clarification\", thought should contain the clarifying question.\n\nImportant:\n- You can call MULTIPLE tools at once if they are independent\n- Use \"dependsOn\" if a tool needs results from another tool\n- Set \"parallelizable\": true if tools can run simultaneously\n- Be efficient - don't repeat the same tool calls\n- If the task seems complete based on results, set decision to \"complete\"`;\n  }\n  \n  /**\n   * \u683C\u5F0F\u5316\u4E4B\u524D\u7684\u8FED\u4EE3\u8BB0\u5F55\n   */\n  private formatPreviousIterations(): string {\n    if (this.iterations.length === 0) return 'None yet.';\n    \n    return this.iterations.map(iter => {\n      const execSummary = iter.executions.map(e => \n        `  - ${e.toolId}: ${e.success ? 'SUCCESS' : 'FAILED'}`\n      ).join('\\n');\n      \n      return `### Iteration ${iter.iteration}\nThought: ${iter.thought.thought}\nActions:\n${execSummary}\nObservation: ${iter.observation}`;\n    }).join('\\n\\n');\n  }\n  \n  /**\n   * \u683C\u5F0F\u5316\u79EF\u7D2F\u7684\u7ED3\u679C\n   */\n  private formatAccumulatedResults(): string {\n    if (this.toolResultsMap.size === 0) return 'No results yet.';\n    \n    const results: string[] = [];\n    this.toolResultsMap.forEach((value, key) => {\n      const preview = JSON.stringify(value).slice(0, 500);\n      results.push(`${key}: ${preview}${preview.length >= 500 ? '...' : ''}`);\n    });\n    \n    return results.join('\\n');\n  }\n  \n  /**\n   * \u683C\u5F0F\u5316\u5DE5\u5177\u63CF\u8FF0\n   */\n  private formatToolsForAI(tools: MCPToolDefinition[]): string {\n    return tools.map(t => {\n      const params = t.parameters.map(p => \n        `    - ${p.name} (${p.type}${p.required ? ', required' : ''}): ${p.description}`\n      ).join('\\n');\n      \n      return `### ${t.id}\n  Name: ${t.name}\n  Description: ${t.description}\n  ${t.aiHints?.whenToUse ? `When to use: ${t.aiHints.whenToUse}` : ''}\n  Parameters:\n${params || '    (none)'}`;\n    }).join('\\n\\n');\n  }\n  \n  /**\n   * \u89E3\u6790\u601D\u8003\u54CD\u5E94\n   */\n  private parseThinkingResponse(\n    response: string, \n    iteration: number,\n    tools: MCPToolDefinition[]\n  ): ThoughtStep {\n    // \u63D0\u53D6JSON\n    const jsonMatch = response.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n    \n    if (!jsonMatch) {\n      // \u5C1D\u8BD5\u76F4\u63A5\u89E3\u6790\n      try {\n        const parsed = JSON.parse(response);\n        return this.validateThoughtStep(parsed, iteration, tools);\n      } catch {\n        // \u65E0\u6CD5\u89E3\u6790\uFF0C\u8FD4\u56DE\u5B8C\u6210\u72B6\u6001\n        return {\n          iteration,\n          thought: response,\n          analysis: 'Could not parse structured response.',\n          decision: 'complete',\n          toolCalls: [],\n          parallelizable: false,\n        };\n      }\n    }\n    \n    try {\n      const parsed = JSON.parse(jsonMatch[1]);\n      return this.validateThoughtStep(parsed, iteration, tools);\n    } catch (error) {\n      console.error('[AutonomousAgent] Failed to parse thinking response:', error);\n      return {\n        iteration,\n        thought: response,\n        analysis: 'Parse error.',\n        decision: 'complete',\n        toolCalls: [],\n        parallelizable: false,\n      };\n    }\n  }\n  \n  /**\n   * \u9A8C\u8BC1\u601D\u8003\u6B65\u9AA4\n   */\n  private validateThoughtStep(\n    parsed: any, \n    iteration: number,\n    tools: MCPToolDefinition[]\n  ): ThoughtStep {\n    const toolMap = new Map(tools.map(t => [t.id, t]));\n    \n    const validToolCalls: ToolCall[] = (parsed.toolCalls || [])\n      .filter((call: any) => call.toolId && toolMap.has(call.toolId))\n      .map((call: any, index: number) => ({\n        id: call.id || `call_${iteration}_${index}`,\n        toolId: call.toolId,\n        toolName: toolMap.get(call.toolId)!.name,\n        params: call.params || {},\n        reason: call.reason || '',\n        dependsOn: call.dependsOn,\n      }));\n    \n    return {\n      iteration,\n      thought: parsed.thought || '',\n      analysis: parsed.analysis || '',\n      decision: ['continue', 'complete', 'need_clarification'].includes(parsed.decision) \n        ? parsed.decision \n        : 'continue',\n      toolCalls: validToolCalls,\n      parallelizable: parsed.parallelizable ?? (validToolCalls.length > 1),\n    };\n  }\n  \n  /**\n   * \u5E76\u884C\u6267\u884C\u5DE5\u5177\n   */\n  private async executeToolsInParallel(\n    calls: ToolCall[],\n    maxParallel: number,\n    context?: AutonomousAgentRequest['context']\n  ): Promise<ExecutionResult[]> {\n    const results: ExecutionResult[] = [];\n    \n    // \u5206\u6279\u6267\u884C\n    for (let i = 0; i < calls.length; i += maxParallel) {\n      const batch = calls.slice(i, i + maxParallel);\n      \n      const batchPromises = batch.map(async (call) => {\n        this._onToolExecution.fire({ call });\n        \n        const startTime = Date.now();\n        try {\n          const result = await this.executor.execute({\n            toolId: call.toolId,\n            arguments: this.resolveParams(call.params, call.dependsOn),\n            caller: 'agent',\n            requestId: call.id,\n            context: {\n              workspaceRoot: context?.workspaceRoot,\n              activeFile: context?.activeFile,\n            },\n          });\n          \n          const execResult: ExecutionResult = {\n            callId: call.id,\n            toolId: call.toolId,\n            success: result.success,\n            data: result.data,\n            error: result.error?.message,\n            duration: Date.now() - startTime,\n          };\n          \n          this._onToolExecution.fire({ call, result: execResult });\n          return execResult;\n          \n        } catch (error) {\n          const execResult: ExecutionResult = {\n            callId: call.id,\n            toolId: call.toolId,\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error',\n            duration: Date.now() - startTime,\n          };\n          \n          this._onToolExecution.fire({ call, result: execResult });\n          return execResult;\n        }\n      });\n      \n      const batchResults = await Promise.all(batchPromises);\n      results.push(...batchResults);\n    }\n    \n    return results;\n  }\n  \n  /**\n   * \u4E32\u884C\u6267\u884C\u5DE5\u5177\uFF08\u6709\u4F9D\u8D56\u5173\u7CFB\uFF09\n   */\n  private async executeToolsSequentially(\n    calls: ToolCall[],\n    context?: AutonomousAgentRequest['context']\n  ): Promise<ExecutionResult[]> {\n    const results: ExecutionResult[] = [];\n    const localResults = new Map<string, any>();\n    \n    for (const call of calls) {\n      this._onToolExecution.fire({ call });\n      \n      const startTime = Date.now();\n      try {\n        // \u89E3\u6790\u53C2\u6570\uFF0C\u66FF\u6362\u4F9D\u8D56\u7684\u7ED3\u679C\n        const resolvedParams = this.resolveParams(\n          call.params, \n          call.dependsOn,\n          localResults\n        );\n        \n        const result = await this.executor.execute({\n          toolId: call.toolId,\n          arguments: resolvedParams,\n          caller: 'agent',\n          requestId: call.id,\n          context: {\n            workspaceRoot: context?.workspaceRoot,\n            activeFile: context?.activeFile,\n          },\n        });\n        \n        const execResult: ExecutionResult = {\n          callId: call.id,\n          toolId: call.toolId,\n          success: result.success,\n          data: result.data,\n          error: result.error?.message,\n          duration: Date.now() - startTime,\n        };\n        \n        if (result.success) {\n          localResults.set(call.id, result.data);\n        }\n        \n        results.push(execResult);\n        this._onToolExecution.fire({ call, result: execResult });\n        \n      } catch (error) {\n        const execResult: ExecutionResult = {\n          callId: call.id,\n          toolId: call.toolId,\n          success: false,\n          error: error instanceof Error ? error.message : 'Unknown error',\n          duration: Date.now() - startTime,\n        };\n        \n        results.push(execResult);\n        this._onToolExecution.fire({ call, result: execResult });\n      }\n    }\n    \n    return results;\n  }\n  \n  /**\n   * \u89E3\u6790\u53C2\u6570\uFF0C\u66FF\u6362\u4F9D\u8D56\u5F15\u7528\n   */\n  private resolveParams(\n    params: Record<string, any>,\n    dependsOn?: string[],\n    localResults?: Map<string, any>\n  ): Record<string, any> {\n    const resolved = { ...params };\n    \n    // \u66FF\u6362 {{callId}} \u6216 {{callId.path}} \u683C\u5F0F\u7684\u5F15\u7528\n    for (const [key, value] of Object.entries(resolved)) {\n      if (typeof value === 'string') {\n        const refMatch = value.match(/\\{\\{(\\w+)(?:\\.(.+?))?\\}\\}/);\n        if (refMatch) {\n          const [, refId, path] = refMatch;\n          let refValue = localResults?.get(refId) ?? this.toolResultsMap.get(refId);\n          \n          if (refValue !== undefined && path) {\n            // \u652F\u6301\u8DEF\u5F84\u8BBF\u95EE\uFF0C\u5982 {{callId.data.items}}\n            const pathParts = path.split('.');\n            for (const part of pathParts) {\n              refValue = refValue?.[part];\n            }\n          }\n          \n          resolved[key] = refValue ?? value;\n        }\n      }\n    }\n    \n    return resolved;\n  }\n  \n  /**\n   * \u89C2\u5BDF\u9636\u6BB5 - \u5206\u6790\u6267\u884C\u7ED3\u679C\n   */\n  private async observe(thought: ThoughtStep, executions: ExecutionResult[]): Promise<string> {\n    // \u6784\u5EFA\u7ED3\u679C\u6458\u8981\n    const resultsSummary = executions.map(e => {\n      if (e.success) {\n        const dataStr = JSON.stringify(e.data).slice(0, 1000);\n        return `\u2713 ${e.toolId} (${e.duration}ms): ${dataStr}`;\n      } else {\n        return `\u2717 ${e.toolId}: ${e.error}`;\n      }\n    }).join('\\n');\n    \n    // \u5982\u679C\u6240\u6709\u8C03\u7528\u90FD\u5931\u8D25\uFF0C\u8FD4\u56DE\u7B80\u5355\u89C2\u5BDF\n    if (executions.every(e => !e.success)) {\n      return `All tool calls failed. Errors: ${executions.map(e => e.error).join('; ')}`;\n    }\n    \n    // \u8BA9AI\u751F\u6210\u89C2\u5BDF\u603B\u7ED3\n    try {\n      const observePrompt = `Based on the tool execution results, provide a brief observation summary.\n\nTool Calls:\n${thought.toolCalls.map(c => `- ${c.toolId}: ${c.reason}`).join('\\n')}\n\nResults:\n${resultsSummary}\n\nProvide a 1-2 sentence observation about what was learned or accomplished.`;\n\n      const observation = await this.chatService!.sendMessageSync([\n        {\n          id: 'observe',\n          role: 'user',\n          content: observePrompt,\n          timestamp: Date.now(),\n        },\n      ]);\n      \n      return observation.slice(0, 500);\n    } catch {\n      // \u56DE\u9000\u5230\u7B80\u5355\u6458\u8981\n      const successCount = executions.filter(e => e.success).length;\n      return `Executed ${executions.length} tools: ${successCount} succeeded, ${executions.length - successCount} failed.`;\n    }\n  }\n  \n  /**\n   * \u751F\u6210\u6700\u7EC8\u7B54\u6848\n   */\n  private async generateFinalAnswer(request: AutonomousAgentRequest): Promise<string> {\n    if (this.iterations.length === 0) {\n      return 'No actions were taken for this task.';\n    }\n    \n    const iterationsSummary = this.iterations.map(iter => \n      `Iteration ${iter.iteration}: ${iter.thought.thought}\\nResults: ${iter.observation}`\n    ).join('\\n\\n');\n    \n    const prompt = `Based on the following task execution, provide a comprehensive final answer.\n\n## Original Task\n${request.task}\n\n## Execution Summary\n${iterationsSummary}\n\n## All Results\n${this.formatAccumulatedResults()}\n\n## Instructions\nProvide a clear, helpful answer that:\n1. Directly addresses the user's task\n2. Summarizes what was accomplished\n3. Includes relevant data from the tool results\n4. Notes any issues or limitations\n\nRespond in the same language as the task.`;\n\n    try {\n      return await this.chatService!.sendMessageSync([\n        {\n          id: 'final',\n          role: 'user',\n          content: prompt,\n          timestamp: Date.now(),\n        },\n      ]);\n    } catch {\n      // \u56DE\u9000\u7B54\u6848\n      const successCount = this.iterations.flatMap(i => i.executions).filter(e => e.success).length;\n      return `\u4EFB\u52A1\u6267\u884C\u5B8C\u6210\u3002\u5171\u8FDB\u884C ${this.iterations.length} \u8F6E\u8FED\u4EE3\uFF0C\u6210\u529F\u6267\u884C ${successCount} \u6B21\u5DE5\u5177\u8C03\u7528\u3002`;\n    }\n  }\n  \n  /**\n   * \u521B\u5EFA\u5931\u8D25\u7ED3\u679C\n   */\n  private createFailedResult(task: string, error: string, startTime: number): AutonomousAgentResult {\n    return {\n      success: false,\n      task,\n      iterations: this.iterations,\n      finalAnswer: `\u4EFB\u52A1\u6267\u884C\u5931\u8D25: ${error}`,\n      totalDuration: Date.now() - startTime,\n      toolsUsed: [],\n      stats: {\n        totalIterations: this.iterations.length,\n        totalToolCalls: 0,\n        successfulCalls: 0,\n        failedCalls: 0,\n      },\n    };\n  }\n  \n  /**\n   * \u53D6\u6D88\u4EFB\u52A1\n   */\n  cancel(): void {\n    if (this.abortController) {\n      this.abortController.abort();\n      this.setStatus('cancelled');\n    }\n  }\n  \n  /**\n   * \u83B7\u53D6\u5F53\u524D\u72B6\u6001\n   */\n  getStatus(): AutonomousAgentStatus {\n    return this.status;\n  }\n  \n  /**\n   * \u83B7\u53D6\u5F53\u524D\u8FED\u4EE3\u8BB0\u5F55\n   */\n  getIterations(): IterationRecord[] {\n    return [...this.iterations];\n  }\n  \n  /**\n   * \u786E\u4FDDChatService\u53EF\u7528\n   */\n  private async ensureChatService(): Promise<void> {\n    if (this.chatService) return;\n    \n    const config = await this.configManager.getFullModelConfig();\n    if (config.apiKey) {\n      this.chatService = new ChatService(config);\n    }\n  }\n  \n  /**\n   * \u8BBE\u7F6E\u72B6\u6001\n   */\n  private setStatus(status: AutonomousAgentStatus): void {\n    this.status = status;\n    this._onStatusChange.fire(status);\n  }\n}\n", "/**\n * MCP\u89E3\u6790\u5668\n * \n * \u89E3\u6790\u7528\u6237\u8F93\u5165\u4E2D\u7684@\u8BED\u6CD5\uFF0C\u8BC6\u522BMCP\u76F8\u5173\u6307\u4EE4\n * \n * \u652F\u6301\u7684\u8BED\u6CD5\uFF1A\n * - @mcp                    \u663E\u793AMCP\u5E2E\u52A9\n * - @mcp:list               \u5217\u51FA\u6240\u6709\u53EF\u7528\u5DE5\u5177\n * - @mcp:tool_id            \u76F4\u63A5\u8C03\u7528\u6307\u5B9A\u5DE5\u5177\n * - @mcp:tool_id param=val  \u5E26\u53C2\u6570\u8C03\u7528\u5DE5\u5177\n * - @mcp:agent \u4EFB\u52A1\u63CF\u8FF0     \u8BA9Agent\u81EA\u52A8\u9009\u62E9\u5DE5\u5177\u6267\u884C\u4EFB\u52A1\n * - @mcp:search \u5173\u952E\u8BCD      \u641C\u7D22\u5DE5\u5177\n */\n\nimport { MCPToolCallParams, MCPAgentRequest } from './types';\n\n/**\n * \u89E3\u6790\u7ED3\u679C\u7C7B\u578B\n */\nexport type MCPParseResultType = \n  | 'help'           // \u663E\u793A\u5E2E\u52A9\n  | 'list'           // \u5217\u51FA\u5DE5\u5177\n  | 'search'         // \u641C\u7D22\u5DE5\u5177\n  | 'call'           // \u76F4\u63A5\u8C03\u7528\u5DE5\u5177\n  | 'agent'          // Agent\u6A21\u5F0F\n  | 'manage'         // \u7BA1\u7406\u9762\u677F\n  | 'history'        // \u67E5\u770B\u5386\u53F2\n  | 'none';          // \u975EMCP\u6307\u4EE4\n\n/**\n * \u89E3\u6790\u7ED3\u679C\n */\nexport interface MCPParseResult {\n  type: MCPParseResultType;\n  \n  // \u5DE5\u5177\u8C03\u7528\u53C2\u6570\n  toolId?: string;\n  params?: Record<string, any>;\n  \n  // Agent\u8BF7\u6C42\n  agentTask?: string;\n  \n  // \u641C\u7D22\u5173\u952E\u8BCD\n  searchQuery?: string;\n  \n  // \u539F\u59CB\u8F93\u5165\n  originalInput: string;\n  \n  // \u5269\u4F59\u6587\u672C\uFF08\u975EMCP\u90E8\u5206\uFF09\n  remainingText?: string;\n}\n\n/**\n * MCP\u89E3\u6790\u5668\n */\nexport class MCPParser {\n  // @mcp \u6307\u4EE4\u7684\u6B63\u5219\u8868\u8FBE\u5F0F\n  private static readonly MCP_PATTERN = /^@mcp(?::(\\w+))?(?:\\s+(.*))?$/i;\n  \n  // \u53C2\u6570\u89E3\u6790\u6B63\u5219\n  private static readonly PARAM_PATTERN = /(\\w+)=(?:\"([^\"]*)\"|'([^']*)'|(\\S+))/g;\n  \n  // JSON\u53C2\u6570\u68C0\u6D4B\n  private static readonly JSON_PATTERN = /^\\{[\\s\\S]*\\}$/;\n  \n  /**\n   * \u89E3\u6790\u7528\u6237\u8F93\u5165\n   */\n  static parse(input: string): MCPParseResult {\n    const trimmed = input.trim();\n    \n    // \u68C0\u67E5\u662F\u5426\u4EE5@mcp\u5F00\u5934\n    if (!trimmed.toLowerCase().startsWith('@mcp')) {\n      return { type: 'none', originalInput: input };\n    }\n    \n    const match = trimmed.match(this.MCP_PATTERN);\n    if (!match) {\n      return { type: 'none', originalInput: input };\n    }\n    \n    const command = match[1]?.toLowerCase();\n    const rest = match[2]?.trim() || '';\n    \n    // \u65E0\u5B50\u547D\u4EE4\uFF1A\u663E\u793A\u5E2E\u52A9\n    if (!command) {\n      return { type: 'help', originalInput: input };\n    }\n    \n    // \u7279\u6B8A\u547D\u4EE4\n    switch (command) {\n      case 'list':\n        return { type: 'list', originalInput: input };\n      \n      case 'search':\n        return { \n          type: 'search', \n          searchQuery: rest || undefined,\n          originalInput: input \n        };\n      \n      case 'agent':\n        return {\n          type: 'agent',\n          agentTask: rest || undefined,\n          originalInput: input,\n        };\n      \n      case 'manage':\n      case 'config':\n      case 'settings':\n        return { type: 'manage', originalInput: input };\n      \n      case 'history':\n        return { type: 'history', originalInput: input };\n      \n      default:\n        // \u5047\u8BBE\u662F\u5DE5\u5177ID\n        return this.parseToolCall(command, rest, input);\n    }\n  }\n  \n  /**\n   * \u89E3\u6790\u5DE5\u5177\u8C03\u7528\n   */\n  private static parseToolCall(\n    toolId: string,\n    paramString: string,\n    originalInput: string\n  ): MCPParseResult {\n    const params: Record<string, any> = {};\n    \n    if (paramString) {\n      // \u5C1D\u8BD5\u89E3\u6790JSON\u53C2\u6570\n      if (this.JSON_PATTERN.test(paramString)) {\n        try {\n          Object.assign(params, JSON.parse(paramString));\n        } catch {\n          // JSON\u89E3\u6790\u5931\u8D25\uFF0C\u5C1D\u8BD5\u952E\u503C\u5BF9\u89E3\u6790\n          this.parseKeyValueParams(paramString, params);\n        }\n      } else {\n        // \u952E\u503C\u5BF9\u89E3\u6790\n        this.parseKeyValueParams(paramString, params);\n      }\n    }\n    \n    return {\n      type: 'call',\n      toolId,\n      params,\n      originalInput,\n    };\n  }\n  \n  /**\n   * \u89E3\u6790\u952E\u503C\u5BF9\u53C2\u6570\n   */\n  private static parseKeyValueParams(\n    paramString: string,\n    params: Record<string, any>\n  ): void {\n    let match;\n    const regex = new RegExp(this.PARAM_PATTERN.source, 'g');\n    \n    while ((match = regex.exec(paramString)) !== null) {\n      const key = match[1];\n      // \u4F18\u5148\u7EA7\uFF1A\u53CC\u5F15\u53F7 > \u5355\u5F15\u53F7 > \u65E0\u5F15\u53F7\n      const value = match[2] ?? match[3] ?? match[4];\n      \n      // \u5C1D\u8BD5\u89E3\u6790\u7C7B\u578B\n      params[key] = this.parseValue(value);\n    }\n    \n    // \u5982\u679C\u6CA1\u6709\u89E3\u6790\u5230\u4EFB\u4F55\u53C2\u6570\uFF0C\u4E14\u6709\u5185\u5BB9\uFF0C\u4F5C\u4E3A\u9ED8\u8BA4\u53C2\u6570\n    if (Object.keys(params).length === 0 && paramString.trim()) {\n      // \u68C0\u67E5\u662F\u5426\u662F\u7B80\u5355\u7684\u503C\u5217\u8868\n      const values = paramString.split(/\\s+/);\n      if (values.length === 1) {\n        params['_default'] = this.parseValue(values[0]);\n      } else {\n        params['_args'] = values.map(v => this.parseValue(v));\n      }\n    }\n  }\n  \n  /**\n   * \u89E3\u6790\u503C\u7C7B\u578B\n   */\n  private static parseValue(value: string): any {\n    // \u5E03\u5C14\u503C\n    if (value.toLowerCase() === 'true') return true;\n    if (value.toLowerCase() === 'false') return false;\n    \n    // \u6570\u5B57\n    if (/^-?\\d+$/.test(value)) return parseInt(value, 10);\n    if (/^-?\\d+\\.\\d+$/.test(value)) return parseFloat(value);\n    \n    // JSON\u6570\u7EC4\u6216\u5BF9\u8C61\n    if (value.startsWith('[') || value.startsWith('{')) {\n      try {\n        return JSON.parse(value);\n      } catch {\n        return value;\n      }\n    }\n    \n    return value;\n  }\n  \n  /**\n   * \u68C0\u67E5\u8F93\u5165\u662F\u5426\u5305\u542BMCP\u6307\u4EE4\n   */\n  static isMCPCommand(input: string): boolean {\n    return input.trim().toLowerCase().startsWith('@mcp');\n  }\n  \n  /**\n   * \u83B7\u53D6MCP\u5E2E\u52A9\u6587\u672C\n   */\n  static getHelpText(): string {\n    return `# MCP \u5DE5\u5177\u4F7F\u7528\u5E2E\u52A9\n\n## \u57FA\u672C\u8BED\u6CD5\n\\`@mcp\\` - \u663E\u793A\u6B64\u5E2E\u52A9\n\\`@mcp:list\\` - \u5217\u51FA\u6240\u6709\u53EF\u7528\u5DE5\u5177\n\\`@mcp:search \u5173\u952E\u8BCD\\` - \u641C\u7D22\u5DE5\u5177\n\\`@mcp:manage\\` - \u6253\u5F00\u5DE5\u5177\u7BA1\u7406\u9762\u677F\n\\`@mcp:history\\` - \u67E5\u770B\u6267\u884C\u5386\u53F2\n\n## \u76F4\u63A5\u8C03\u7528\u5DE5\u5177\n\\`@mcp:\u5DE5\u5177ID\\` - \u8C03\u7528\u6307\u5B9A\u5DE5\u5177\uFF08\u65E0\u53C2\u6570\uFF09\n\\`@mcp:\u5DE5\u5177ID param1=value1 param2=value2\\` - \u5E26\u53C2\u6570\u8C03\u7528\n\\`@mcp:\u5DE5\u5177ID {\"param1\": \"value1\"}\\` - JSON\u53C2\u6570\u683C\u5F0F\n\n## Agent\u6A21\u5F0F\n\\`@mcp:agent \u4F60\u7684\u4EFB\u52A1\u63CF\u8FF0\\` - \u8BA9AI\u81EA\u52A8\u9009\u62E9\u5DE5\u5177\u5B8C\u6210\u4EFB\u52A1\n\n## \u793A\u4F8B\n\\`@mcp:builtin_read_file filePath=src/index.ts\\`\n\\`@mcp:builtin_search_code query=TODO include=\"**/*.ts\"\\`\n\\`@mcp:agent \u5E2E\u6211\u67E5\u627E\u6240\u6709\u5305\u542BTODO\u7684\u6587\u4EF6\\`\n`;\n  }\n  \n  /**\n   * \u5C06\u89E3\u6790\u7ED3\u679C\u8F6C\u6362\u4E3A\u5DE5\u5177\u8C03\u7528\u53C2\u6570\n   */\n  static toToolCallParams(\n    result: MCPParseResult,\n    context?: MCPToolCallParams['context']\n  ): MCPToolCallParams | null {\n    if (result.type !== 'call' || !result.toolId) {\n      return null;\n    }\n    \n    // \u5904\u7406\u9ED8\u8BA4\u53C2\u6570\n    const params = { ...result.params };\n    if (params['_default'] !== undefined) {\n      // \u5C06_default\u6620\u5C04\u5230\u5DE5\u5177\u7684\u7B2C\u4E00\u4E2A\u5FC5\u9700\u53C2\u6570\n      // \u8FD9\u9700\u8981\u77E5\u9053\u5DE5\u5177\u5B9A\u4E49\uFF0C\u6240\u4EE5\u6682\u65F6\u4FDD\u7559\n    }\n    \n    return {\n      toolId: result.toolId,\n      arguments: params,\n      caller: 'user',\n      context,\n    };\n  }\n  \n  /**\n   * \u5C06\u89E3\u6790\u7ED3\u679C\u8F6C\u6362\u4E3AAgent\u8BF7\u6C42\n   */\n  static toAgentRequest(\n    result: MCPParseResult,\n    context?: MCPAgentRequest['context']\n  ): MCPAgentRequest | null {\n    if (result.type !== 'agent' || !result.agentTask) {\n      return null;\n    }\n    \n    return {\n      task: result.agentTask,\n      context,\n    };\n  }\n  \n  /**\n   * \u683C\u5F0F\u5316\u5DE5\u5177\u8C03\u7528\u4E3A\u663E\u793A\u6587\u672C\n   */\n  static formatToolCall(toolId: string, params: Record<string, any>): string {\n    const paramStr = Object.entries(params)\n      .map(([k, v]) => `${k}=${JSON.stringify(v)}`)\n      .join(' ');\n    \n    return paramStr ? `@mcp:${toolId} ${paramStr}` : `@mcp:${toolId}`;\n  }\n  \n  /**\n   * \u81EA\u52A8\u8865\u5168\u5EFA\u8BAE\n   */\n  static getCompletions(\n    input: string,\n    availableTools: Array<{ id: string; name: string; description: string }>\n  ): Array<{ text: string; displayText: string; description: string }> {\n    const completions: Array<{ text: string; displayText: string; description: string }> = [];\n    \n    // \u57FA\u672C\u547D\u4EE4\u8865\u5168\n    if (input === '@' || input === '@m' || input === '@mc' || input === '@mcp') {\n      completions.push(\n        { text: '@mcp:list', displayText: '@mcp:list', description: '\u5217\u51FA\u6240\u6709\u5DE5\u5177' },\n        { text: '@mcp:search ', displayText: '@mcp:search', description: '\u641C\u7D22\u5DE5\u5177' },\n        { text: '@mcp:agent ', displayText: '@mcp:agent', description: 'Agent\u6A21\u5F0F' },\n        { text: '@mcp:manage', displayText: '@mcp:manage', description: '\u7BA1\u7406\u5DE5\u5177' },\n      );\n    }\n    \n    // \u5DE5\u5177ID\u8865\u5168\n    if (input.match(/^@mcp:(\\w*)$/i)) {\n      const prefix = input.replace(/^@mcp:/i, '').toLowerCase();\n      \n      for (const tool of availableTools) {\n        if (tool.id.toLowerCase().startsWith(prefix)) {\n          completions.push({\n            text: `@mcp:${tool.id}`,\n            displayText: tool.name,\n            description: tool.description,\n          });\n        }\n      }\n    }\n    \n    return completions;\n  }\n}\n", "/**\n * MCP\u5DE5\u5177\u7BA1\u7406\u9762\u677FProvider\n * \n * \u63D0\u4F9B\u4E00\u4E2A\u72EC\u7ACB\u7684WebView\u9762\u677F\u7528\u4E8E\u7BA1\u7406MCP\u5DE5\u5177\uFF1A\n * - \u6CE8\u518C\u65B0\u5DE5\u5177\n * - \u7F16\u8F91\u73B0\u6709\u5DE5\u5177\n * - \u6D4B\u8BD5\u5DE5\u5177\n * - \u5BFC\u5165/\u5BFC\u51FA\u5DE5\u5177\n */\n\nimport * as vscode from 'vscode';\nimport { MCPRegistry } from './MCPRegistry';\nimport { MCPExecutor } from './MCPExecutor';\nimport { MCPToolDefinition, MCPToolRegistration, MCPConfig } from './types';\n\nexport class MCPPanelProvider implements vscode.WebviewViewProvider {\n  public static readonly viewType = 'aiAssistant.mcpPanel';\n  \n  private static instance: MCPPanelProvider | null = null;\n  private _view?: vscode.WebviewView;\n  private _registry: MCPRegistry;\n  private _executor: MCPExecutor;\n  \n  private constructor(\n    private readonly _extensionUri: vscode.Uri,\n    private readonly _context: vscode.ExtensionContext\n  ) {\n    this._registry = MCPRegistry.getInstance(_context);\n    this._executor = MCPExecutor.getInstance(_context, this._registry);\n    \n    // \u76D1\u542C\u5DE5\u5177\u53D8\u5316\n    this._registry.onToolsChanged(() => {\n      this._sendToolsToWebview();\n    });\n  }\n  \n  static getInstance(\n    extensionUri: vscode.Uri,\n    context: vscode.ExtensionContext\n  ): MCPPanelProvider {\n    if (!MCPPanelProvider.instance) {\n      MCPPanelProvider.instance = new MCPPanelProvider(extensionUri, context);\n    }\n    return MCPPanelProvider.instance;\n  }\n  \n  public resolveWebviewView(\n    webviewView: vscode.WebviewView,\n    _context: vscode.WebviewViewResolveContext,\n    _token: vscode.CancellationToken\n  ): void {\n    this._view = webviewView;\n    \n    webviewView.webview.options = {\n      enableScripts: true,\n      localResourceRoots: [this._extensionUri],\n    };\n    \n    webviewView.title = 'MCP\u5DE5\u5177\u7BA1\u7406';\n    webviewView.webview.html = this._getHtmlForWebview(webviewView.webview);\n    \n    // \u5904\u7406\u6765\u81EAWebView\u7684\u6D88\u606F\n    webviewView.webview.onDidReceiveMessage(async (data) => {\n      await this._handleMessage(data);\n    });\n    \n    // \u521D\u59CB\u53D1\u9001\u5DE5\u5177\u5217\u8868\n    setTimeout(() => this._sendToolsToWebview(), 100);\n  }\n  \n  /**\n   * \u5904\u7406WebView\u6D88\u606F\n   */\n  private async _handleMessage(data: any): Promise<void> {\n    switch (data.type) {\n      case 'getTools':\n        this._sendToolsToWebview();\n        break;\n        \n      case 'getConfig':\n        this._sendConfig();\n        break;\n        \n      case 'registerTool':\n        await this._registerTool(data.tool);\n        break;\n        \n      case 'updateTool':\n        await this._updateTool(data.tool);\n        break;\n        \n      case 'deleteTool':\n        await this._deleteTool(data.toolId);\n        break;\n        \n      case 'toggleTool':\n        await this._toggleTool(data.toolId, data.enabled);\n        break;\n        \n      case 'testTool':\n        await this._testTool(data.toolId, data.params);\n        break;\n        \n      case 'updateConfig':\n        await this._updateConfig(data.config);\n        break;\n        \n      case 'importTools':\n        await this._importTools(data.data);\n        break;\n        \n      case 'exportTools':\n        this._exportTools(data.toolIds);\n        break;\n        \n      case 'getToolTemplate':\n        this._sendToolTemplate(data.executionType);\n        break;\n    }\n  }\n  \n  /**\n   * \u53D1\u9001\u5DE5\u5177\u5217\u8868\u5230WebView\n   */\n  private _sendToolsToWebview(): void {\n    if (!this._view) return;\n    \n    const tools = this._registry.getAllTools();\n    this._view.webview.postMessage({\n      type: 'toolList',\n      tools,\n    });\n  }\n  \n  /**\n   * \u53D1\u9001\u914D\u7F6E\u5230WebView\n   */\n  private _sendConfig(): void {\n    if (!this._view) return;\n    \n    const config = this._registry.getConfig();\n    this._view.webview.postMessage({\n      type: 'config',\n      config,\n    });\n  }\n  \n  /**\n   * \u6CE8\u518C\u5DE5\u5177\n   */\n  private async _registerTool(tool: MCPToolDefinition): Promise<void> {\n    const result = await this._registry.registerTool(tool, 'user');\n    \n    this._view?.webview.postMessage({\n      type: 'registerResult',\n      ...result,\n      toolId: tool.id,\n    });\n    \n    if (result.success) {\n      vscode.window.showInformationMessage(`MCP\u5DE5\u5177 \"${tool.name}\" \u5DF2\u6210\u529F\u6CE8\u518C`);\n    } else {\n      vscode.window.showErrorMessage(`\u6CE8\u518C\u5931\u8D25: ${result.error}`);\n    }\n  }\n  \n  /**\n   * \u66F4\u65B0\u5DE5\u5177\n   */\n  private async _updateTool(tool: MCPToolDefinition): Promise<void> {\n    const result = await this._registry.updateTool(tool);\n    \n    this._view?.webview.postMessage({\n      type: 'updateResult',\n      ...result,\n      toolId: tool.id,\n    });\n    \n    if (result.success) {\n      vscode.window.showInformationMessage(`MCP\u5DE5\u5177 \"${tool.name}\" \u5DF2\u66F4\u65B0`);\n    }\n  }\n  \n  /**\n   * \u5220\u9664\u5DE5\u5177\n   */\n  private async _deleteTool(toolId: string): Promise<void> {\n    // \u83B7\u53D6\u5DE5\u5177\u4FE1\u606F\u7528\u4E8E\u663E\u793A\n    const tool = this._registry.getTool(toolId);\n    const toolName = tool?.tool.name || toolId;\n    \n    // \u4F7F\u7528VSCode API\u663E\u793A\u786E\u8BA4\u5BF9\u8BDD\u6846\n    const answer = await vscode.window.showWarningMessage(\n      `\u786E\u5B9A\u8981\u5220\u9664\u5DE5\u5177 \"${toolName}\" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`,\n      { modal: true },\n      '\u786E\u8BA4\u5220\u9664'\n    );\n    \n    // \u5982\u679C\u7528\u6237\u6CA1\u6709\u70B9\u51FB\"\u786E\u8BA4\u5220\u9664\"\uFF0C\u5219\u53D6\u6D88\u64CD\u4F5C\n    if (answer !== '\u786E\u8BA4\u5220\u9664') {\n      this._view?.webview.postMessage({\n        type: 'deleteResult',\n        success: false,\n        cancelled: true,\n        toolId,\n      });\n      return;\n    }\n    \n    const result = await this._registry.deleteTool(toolId);\n    \n    this._view?.webview.postMessage({\n      type: 'deleteResult',\n      ...result,\n      toolId,\n    });\n    \n    if (result.success) {\n      vscode.window.showInformationMessage('MCP\u5DE5\u5177\u5DF2\u5220\u9664');\n    } else {\n      vscode.window.showErrorMessage(`\u5220\u9664\u5931\u8D25: ${result.error}`);\n    }\n  }\n  \n  /**\n   * \u5207\u6362\u5DE5\u5177\u542F\u7528\u72B6\u6001\n   */\n  private async _toggleTool(toolId: string, enabled: boolean): Promise<void> {\n    const result = await this._registry.toggleTool(toolId, enabled);\n    \n    this._view?.webview.postMessage({\n      type: 'toggleResult',\n      ...result,\n      toolId,\n      enabled,\n    });\n  }\n  \n  /**\n   * \u6D4B\u8BD5\u5DE5\u5177\n   */\n  private async _testTool(toolId: string, params: Record<string, any>): Promise<void> {\n    await this._registry.updateToolStatus(toolId, 'testing');\n    \n    this._view?.webview.postMessage({\n      type: 'testStart',\n      toolId,\n    });\n    \n    const result = await this._executor.execute({\n      toolId,\n      arguments: params,\n      caller: 'user',\n      requestId: `test_${Date.now()}`,\n    });\n    \n    await this._registry.updateToolStatus(toolId, result.success ? 'active' : 'error');\n    \n    this._view?.webview.postMessage({\n      type: 'testResult',\n      toolId,\n      result,\n    });\n  }\n  \n  /**\n   * \u66F4\u65B0\u914D\u7F6E\n   */\n  private async _updateConfig(config: Partial<MCPConfig>): Promise<void> {\n    await this._registry.updateConfig(config);\n    \n    this._view?.webview.postMessage({\n      type: 'configUpdated',\n      config: this._registry.getConfig(),\n    });\n    \n    vscode.window.showInformationMessage('MCP\u914D\u7F6E\u5DF2\u66F4\u65B0');\n  }\n  \n  /**\n   * \u5BFC\u5165\u5DE5\u5177\n   */\n  private async _importTools(data: string): Promise<void> {\n    const result = await this._registry.importTools(data);\n    \n    this._view?.webview.postMessage({\n      type: 'importResult',\n      ...result,\n    });\n    \n    if (result.success) {\n      vscode.window.showInformationMessage(`\u6210\u529F\u5BFC\u5165 ${result.imported} \u4E2A\u5DE5\u5177`);\n    } else if (result.imported > 0) {\n      vscode.window.showWarningMessage(\n        `\u5BFC\u5165\u5B8C\u6210: ${result.imported} \u4E2A\u6210\u529F, ${result.errors.length} \u4E2A\u5931\u8D25`\n      );\n    } else {\n      vscode.window.showErrorMessage(`\u5BFC\u5165\u5931\u8D25: ${result.errors.join(', ')}`);\n    }\n  }\n  \n  /**\n   * \u5BFC\u51FA\u5DE5\u5177\n   */\n  private _exportTools(toolIds?: string[]): void {\n    const data = this._registry.exportTools(toolIds);\n    \n    this._view?.webview.postMessage({\n      type: 'exportData',\n      data,\n    });\n  }\n  \n  /**\n   * \u53D1\u9001\u5DE5\u5177\u6A21\u677F\n   */\n  private _sendToolTemplate(executionType: string): void {\n    const templates: Record<string, Partial<MCPToolDefinition>> = {\n      http: {\n        id: 'my_http_tool',\n        name: 'My HTTP Tool',\n        description: 'Description of what this tool does',\n        version: '1.0.0',\n        category: 'api',\n        parameters: [\n          {\n            name: 'param1',\n            type: 'string',\n            description: 'First parameter',\n            required: true,\n          },\n        ],\n        returns: {\n          type: 'object',\n          description: 'API response',\n        },\n        execution: {\n          type: 'http',\n          http: {\n            url: 'https://api.example.com/endpoint',\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            bodyTemplate: '{\"param1\": \"{{param1}}\"}',\n            responseMapping: {\n              resultPath: 'data',\n              successCondition: 'data.status === 200',\n            },\n            timeout: 30000,\n            auth: {\n              type: 'bearer',\n              tokenEnvVar: 'API_TOKEN',\n            },\n          },\n        },\n        metadata: {\n          status: 'active',\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        },\n        aiHints: {\n          whenToUse: 'When you need to...',\n          priority: 50,\n        },\n        security: {\n          requireConfirmation: false,\n          allowedCallers: ['user', 'agent'],\n        },\n      },\n      command: {\n        id: 'my_command_tool',\n        name: 'My Command Tool',\n        description: 'Execute a shell command',\n        version: '1.0.0',\n        category: 'shell',\n        parameters: [\n          {\n            name: 'args',\n            type: 'string',\n            description: 'Command arguments',\n            required: false,\n          },\n        ],\n        returns: {\n          type: 'object',\n          description: 'Command output',\n        },\n        execution: {\n          type: 'command',\n          command: {\n            command: 'echo {{args}}',\n            timeout: 30000,\n            requireConfirmation: true,\n          },\n        },\n        metadata: {\n          status: 'active',\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        },\n        security: {\n          requireConfirmation: true,\n          allowedCallers: ['user'],\n        },\n      },\n      script: {\n        id: 'my_script_tool',\n        name: 'My Script Tool',\n        description: 'Execute a JavaScript script',\n        version: '1.0.0',\n        category: 'utility',\n        parameters: [\n          {\n            name: 'input',\n            type: 'string',\n            description: 'Input data',\n            required: true,\n          },\n        ],\n        returns: {\n          type: 'object',\n          description: 'Script result',\n        },\n        execution: {\n          type: 'script',\n          script: {\n            language: 'javascript',\n            code: `\n// Your JavaScript code here\nconst { input } = args;\nreturn { processed: input.toUpperCase() };\n            `.trim(),\n            timeout: 10000,\n          },\n        },\n        metadata: {\n          status: 'active',\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        },\n        security: {\n          allowedCallers: ['user', 'agent'],\n        },\n      },\n    };\n    \n    this._view?.webview.postMessage({\n      type: 'toolTemplate',\n      template: templates[executionType] || templates.http,\n      executionType,\n    });\n  }\n  \n  /**\n   * \u751F\u6210WebView HTML\n   */\n  private _getHtmlForWebview(webview: vscode.Webview): string {\n    const nonce = getNonce();\n    \n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n  <title>MCP\u5DE5\u5177\u7BA1\u7406</title>\n  <style>\n    * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n    \n    body {\n      font-family: var(--vscode-font-family);\n      font-size: var(--vscode-font-size);\n      color: var(--vscode-foreground);\n      background-color: var(--vscode-editor-background);\n      padding: 12px;\n    }\n    \n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 16px;\n      padding-bottom: 12px;\n      border-bottom: 1px solid var(--vscode-panel-border);\n    }\n    \n    .header h2 {\n      font-size: 14px;\n      font-weight: 600;\n    }\n    \n    .header-actions {\n      display: flex;\n      gap: 8px;\n    }\n    \n    button {\n      padding: 6px 12px;\n      background-color: var(--vscode-button-background);\n      color: var(--vscode-button-foreground);\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n    }\n    \n    button:hover {\n      background-color: var(--vscode-button-hoverBackground);\n    }\n    \n    button.secondary {\n      background-color: var(--vscode-button-secondaryBackground);\n      color: var(--vscode-button-secondaryForeground);\n    }\n    \n    button.danger {\n      background-color: var(--vscode-errorForeground);\n    }\n    \n    button:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n    \n    .tabs {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 16px;\n      border-bottom: 1px solid var(--vscode-panel-border);\n    }\n    \n    .tab {\n      padding: 8px 16px;\n      background: none;\n      border: none;\n      color: var(--vscode-foreground);\n      cursor: pointer;\n      border-bottom: 2px solid transparent;\n      margin-bottom: -1px;\n    }\n    \n    .tab.active {\n      border-bottom-color: var(--vscode-focusBorder);\n      color: var(--vscode-textLink-foreground);\n    }\n    \n    .tab-content {\n      display: none;\n    }\n    \n    .tab-content.active {\n      display: block;\n    }\n    \n    .tool-list {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n    \n    .tool-card {\n      background-color: var(--vscode-editor-inactiveSelectionBackground);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 6px;\n      padding: 12px;\n    }\n    \n    .tool-card.disabled {\n      opacity: 0.6;\n    }\n    \n    .tool-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      margin-bottom: 8px;\n    }\n    \n    .tool-info h3 {\n      font-size: 13px;\n      font-weight: 600;\n      margin-bottom: 4px;\n    }\n    \n    .tool-id {\n      font-family: var(--vscode-editor-font-family);\n      font-size: 11px;\n      color: var(--vscode-descriptionForeground);\n    }\n    \n    .tool-badges {\n      display: flex;\n      gap: 4px;\n      flex-wrap: wrap;\n    }\n    \n    .badge {\n      padding: 2px 6px;\n      font-size: 10px;\n      border-radius: 10px;\n      background-color: var(--vscode-badge-background);\n      color: var(--vscode-badge-foreground);\n    }\n    \n    .badge.category {\n      background-color: var(--vscode-textLink-foreground);\n      color: white;\n    }\n    \n    .badge.builtin {\n      background-color: var(--vscode-editorInfo-foreground);\n    }\n    \n    .badge.status-active {\n      background-color: var(--vscode-terminal-ansiGreen);\n    }\n    \n    .badge.status-error {\n      background-color: var(--vscode-errorForeground);\n    }\n    \n    .badge.status-testing {\n      background-color: var(--vscode-editorWarning-foreground);\n    }\n    \n    .tool-description {\n      font-size: 12px;\n      color: var(--vscode-descriptionForeground);\n      margin-bottom: 8px;\n    }\n    \n    .tool-actions {\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n    }\n    \n    .tool-actions button {\n      padding: 4px 8px;\n      font-size: 11px;\n    }\n    \n    /* \u8868\u5355\u6837\u5F0F */\n    .form-group {\n      margin-bottom: 16px;\n    }\n    \n    .form-group label {\n      display: block;\n      margin-bottom: 4px;\n      font-size: 12px;\n      font-weight: 500;\n    }\n    \n    .form-group input,\n    .form-group select,\n    .form-group textarea {\n      width: 100%;\n      padding: 8px;\n      background-color: var(--vscode-input-background);\n      color: var(--vscode-input-foreground);\n      border: 1px solid var(--vscode-input-border);\n      border-radius: 4px;\n      font-family: inherit;\n      font-size: 12px;\n    }\n    \n    .form-group textarea {\n      min-height: 100px;\n      font-family: var(--vscode-editor-font-family);\n      resize: vertical;\n    }\n    \n    .form-group .hint {\n      font-size: 11px;\n      color: var(--vscode-descriptionForeground);\n      margin-top: 4px;\n    }\n    \n    .form-row {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n    }\n    \n    .param-list {\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 4px;\n      padding: 8px;\n      margin-top: 8px;\n    }\n    \n    .param-item {\n      display: grid;\n      grid-template-columns: 1fr 100px 2fr auto;\n      gap: 8px;\n      align-items: center;\n      padding: 8px 0;\n      border-bottom: 1px solid var(--vscode-panel-border);\n    }\n    \n    .param-item:last-child {\n      border-bottom: none;\n    }\n    \n    .param-item input,\n    .param-item select {\n      padding: 4px 8px;\n      font-size: 11px;\n    }\n    \n    .checkbox-group {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    \n    .checkbox-group input[type=\"checkbox\"] {\n      width: auto;\n    }\n    \n    /* \u6D4B\u8BD5\u9762\u677F */\n    .test-panel {\n      margin-top: 12px;\n      padding: 12px;\n      background-color: var(--vscode-editor-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 4px;\n    }\n    \n    .test-result {\n      margin-top: 12px;\n      padding: 8px;\n      border-radius: 4px;\n      font-family: var(--vscode-editor-font-family);\n      font-size: 11px;\n      max-height: 200px;\n      overflow: auto;\n    }\n    \n    .test-result.success {\n      background-color: rgba(0, 200, 0, 0.1);\n      border: 1px solid var(--vscode-terminal-ansiGreen);\n    }\n    \n    .test-result.error {\n      background-color: rgba(200, 0, 0, 0.1);\n      border: 1px solid var(--vscode-errorForeground);\n    }\n    \n    /* JSON\u7F16\u8F91\u5668 */\n    .json-editor {\n      font-family: var(--vscode-editor-font-family);\n      font-size: 12px;\n      min-height: 300px;\n    }\n    \n    /* \u7A7A\u72B6\u6001 */\n    .empty-state {\n      text-align: center;\n      padding: 40px 20px;\n      color: var(--vscode-descriptionForeground);\n    }\n    \n    .empty-state p {\n      margin-bottom: 16px;\n    }\n    \n    /* \u641C\u7D22 */\n    .search-box {\n      margin-bottom: 12px;\n    }\n    \n    .search-box input {\n      width: 100%;\n      padding: 8px 12px;\n      background-color: var(--vscode-input-background);\n      color: var(--vscode-input-foreground);\n      border: 1px solid var(--vscode-input-border);\n      border-radius: 4px;\n    }\n    \n    /* \u5206\u7C7B\u7B5B\u9009 */\n    .filter-row {\n      display: flex;\n      gap: 8px;\n      margin-bottom: 12px;\n      flex-wrap: wrap;\n    }\n    \n    .filter-chip {\n      padding: 4px 10px;\n      font-size: 11px;\n      border-radius: 12px;\n      background-color: var(--vscode-editor-inactiveSelectionBackground);\n      border: 1px solid var(--vscode-panel-border);\n      cursor: pointer;\n    }\n    \n    .filter-chip.active {\n      background-color: var(--vscode-button-background);\n      color: var(--vscode-button-foreground);\n      border-color: var(--vscode-button-background);\n    }\n    \n    /* \u5BFC\u5165\u5BFC\u51FA\u6A21\u6001\u6846 */\n    .modal-overlay {\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: rgba(0, 0, 0, 0.5);\n      z-index: 100;\n      align-items: center;\n      justify-content: center;\n    }\n    \n    .modal-overlay.active {\n      display: flex;\n    }\n    \n    .modal {\n      background-color: var(--vscode-editor-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 8px;\n      padding: 20px;\n      max-width: 600px;\n      width: 90%;\n      max-height: 80vh;\n      overflow: auto;\n    }\n    \n    .modal h3 {\n      margin-bottom: 16px;\n    }\n    \n    .modal-actions {\n      display: flex;\n      justify-content: flex-end;\n      gap: 8px;\n      margin-top: 16px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h2>\uD83D\uDD27 MCP\u5DE5\u5177\u7BA1\u7406</h2>\n    <div class=\"header-actions\">\n      <button id=\"btn-import\" class=\"secondary\">\u5BFC\u5165</button>\n      <button id=\"btn-export\" class=\"secondary\">\u5BFC\u51FA</button>\n      <button id=\"btn-new-tool\">+ \u65B0\u5EFA\u5DE5\u5177</button>\n    </div>\n  </div>\n  \n  <div class=\"tabs\">\n    <button class=\"tab active\" data-tab=\"list\" id=\"tab-btn-list\">\u5DE5\u5177\u5217\u8868</button>\n    <button class=\"tab\" data-tab=\"create\" id=\"tab-btn-create\">\u521B\u5EFA\u5DE5\u5177</button>\n    <button class=\"tab\" data-tab=\"config\" id=\"tab-btn-config\">\u8BBE\u7F6E</button>\n  </div>\n  \n  <!-- \u5DE5\u5177\u5217\u8868 -->\n  <div id=\"tab-list\" class=\"tab-content active\">\n    <div class=\"search-box\">\n      <input type=\"text\" id=\"searchInput\" placeholder=\"\u641C\u7D22\u5DE5\u5177...\">\n    </div>\n    \n    <div class=\"filter-row\" id=\"filter-row\">\n      <span class=\"filter-chip active\" data-filter=\"all\">\u5168\u90E8</span>\n      <span class=\"filter-chip\" data-filter=\"file\">\uD83D\uDCC1 \u6587\u4EF6</span>\n      <span class=\"filter-chip\" data-filter=\"code\">\uD83D\uDCBB \u4EE3\u7801</span>\n      <span class=\"filter-chip\" data-filter=\"api\">\uD83C\uDF10 API</span>\n      <span class=\"filter-chip\" data-filter=\"shell\">\u2328\uFE0F Shell</span>\n      <span class=\"filter-chip\" data-filter=\"web\">\uD83D\uDD17 Web</span>\n      <span class=\"filter-chip\" data-filter=\"utility\">\uD83D\uDD27 \u5DE5\u5177</span>\n      <span class=\"filter-chip\" data-filter=\"custom\">\uD83D\uDCE6 \u81EA\u5B9A\u4E49</span>\n    </div>\n    \n    <div id=\"toolList\" class=\"tool-list\">\n      <div class=\"empty-state\">\n        <p>\u52A0\u8F7D\u4E2D...</p>\n      </div>\n    </div>\n  </div>\n  \n  <!-- \u521B\u5EFA\u5DE5\u5177 -->\n  <div id=\"tab-create\" class=\"tab-content\">\n    <div class=\"form-group\">\n      <label>\u6267\u884C\u7C7B\u578B</label>\n      <select id=\"executionType\">\n        <option value=\"http\">HTTP\u8BF7\u6C42</option>\n        <option value=\"command\">\u547D\u4EE4\u884C</option>\n        <option value=\"script\">JavaScript\u811A\u672C</option>\n      </select>\n      <div class=\"hint\">\u9009\u62E9\u5DE5\u5177\u7684\u6267\u884C\u65B9\u5F0F</div>\n    </div>\n    \n    <div class=\"form-group\">\n      <label>\u5DE5\u5177\u5B9A\u4E49 (JSON)</label>\n      <textarea id=\"toolJson\" class=\"json-editor\" placeholder=\"\u5DE5\u5177JSON\u5B9A\u4E49...\"></textarea>\n      <div class=\"hint\">\u6309\u7167MCP\u89C4\u8303\u5B9A\u4E49\u5DE5\u5177\u3002\u70B9\u51FB\"\u52A0\u8F7D\u6A21\u677F\"\u83B7\u53D6\u793A\u4F8B\u3002</div>\n    </div>\n    \n    <div style=\"display: flex; gap: 8px;\">\n      <button id=\"btn-load-template\">\u52A0\u8F7D\u6A21\u677F</button>\n      <button id=\"btn-validate\">\u9A8C\u8BC1</button>\n      <button id=\"btn-register\">\u6CE8\u518C\u5DE5\u5177</button>\n    </div>\n    \n    <div id=\"createResult\" style=\"margin-top: 12px;\"></div>\n  </div>\n  \n  <!-- \u8BBE\u7F6E -->\n  <div id=\"tab-config\" class=\"tab-content\">\n    <div class=\"form-group\">\n      <div class=\"checkbox-group\">\n        <input type=\"checkbox\" id=\"configEnabled\" checked>\n        <label for=\"configEnabled\">\u542F\u7528MCP\u529F\u80FD</label>\n      </div>\n    </div>\n    \n    <div class=\"form-group\">\n      <label>Agent\u6700\u5927\u5DE5\u5177\u6570</label>\n      <input type=\"number\" id=\"configMaxTools\" value=\"5\" min=\"1\" max=\"20\">\n      <div class=\"hint\">Agent\u5355\u6B21\u8BF7\u6C42\u6700\u591A\u4F7F\u7528\u7684\u5DE5\u5177\u6570\u91CF</div>\n    </div>\n    \n    <div class=\"form-group\">\n      <label>\u9ED8\u8BA4\u8D85\u65F6 (\u6BEB\u79D2)</label>\n      <input type=\"number\" id=\"configTimeout\" value=\"30000\" min=\"1000\" max=\"300000\">\n    </div>\n    \n    <div class=\"form-group\">\n      <div class=\"checkbox-group\">\n        <input type=\"checkbox\" id=\"configLogAll\" checked>\n        <label for=\"configLogAll\">\u8BB0\u5F55\u6240\u6709\u6267\u884C\u65E5\u5FD7</label>\n      </div>\n    </div>\n    \n    <div class=\"form-group\">\n      <label>\u73AF\u5883\u53D8\u91CF (JSON)</label>\n      <textarea id=\"configEnvVars\" style=\"min-height: 80px;\">{}</textarea>\n      <div class=\"hint\">\u7528\u4E8EAPI\u5BC6\u94A5\u7B49\u654F\u611F\u4FE1\u606F\uFF0C\u683C\u5F0F: {\"API_KEY\": \"your-key\"}</div>\n    </div>\n    \n    <button id=\"btn-save-config\">\u4FDD\u5B58\u8BBE\u7F6E</button>\n  </div>\n  \n  <!-- \u5BFC\u5165\u6A21\u6001\u6846 -->\n  <div id=\"importModal\" class=\"modal-overlay\">\n    <div class=\"modal\">\n      <h3>\u5BFC\u5165\u5DE5\u5177</h3>\n      <div class=\"form-group\">\n        <label>\u5DE5\u5177JSON\u6570\u636E</label>\n        <textarea id=\"importData\" class=\"json-editor\" placeholder=\"\u7C98\u8D34\u5BFC\u51FA\u7684\u5DE5\u5177JSON...\"></textarea>\n      </div>\n      <div class=\"modal-actions\">\n        <button class=\"secondary\" id=\"btn-cancel-import\">\u53D6\u6D88</button>\n        <button id=\"btn-do-import\">\u5BFC\u5165</button>\n      </div>\n    </div>\n  </div>\n  \n  <!-- \u6D4B\u8BD5\u6A21\u6001\u6846 -->\n  <div id=\"testModal\" class=\"modal-overlay\">\n    <div class=\"modal\">\n      <h3 id=\"testModalTitle\">\u6D4B\u8BD5\u5DE5\u5177</h3>\n      <div id=\"testParamsForm\"></div>\n      <div id=\"testResultContainer\"></div>\n      <div class=\"modal-actions\">\n        <button class=\"secondary\" id=\"btn-close-test\">\u5173\u95ED</button>\n        <button id=\"runTestBtn\">\u8FD0\u884C\u6D4B\u8BD5</button>\n      </div>\n    </div>\n  </div>\n\n  <script nonce=\"${nonce}\">\n    const vscode = acquireVsCodeApi();\n    \n    let allTools = [];\n    let currentFilter = 'all';\n    let currentTestToolId = null;\n    \n    console.log('[MCP Panel] Script initializing...');\n    \n    // DOM\u52A0\u8F7D\u5B8C\u6210\u540E\u521D\u59CB\u5316\n    document.addEventListener('DOMContentLoaded', function() {\n      console.log('[MCP Panel] DOM loaded, binding events...');\n      initializeEventListeners();\n      \n      // \u5EF6\u8FDF\u8BF7\u6C42\u6570\u636E\n      setTimeout(function() {\n        vscode.postMessage({ type: 'getTools' });\n        vscode.postMessage({ type: 'getConfig' });\n      }, 100);\n    });\n    \n    // \u5907\u7528\u521D\u59CB\u5316\n    if (document.readyState === 'complete' || document.readyState === 'interactive') {\n      setTimeout(function() {\n        initializeEventListeners();\n        vscode.postMessage({ type: 'getTools' });\n        vscode.postMessage({ type: 'getConfig' });\n      }, 50);\n    }\n    \n    // \u521D\u59CB\u5316\u4E8B\u4EF6\u76D1\u542C\u5668\n    function initializeEventListeners() {\n      // Tab \u6309\u94AE\u4E8B\u4EF6\n      document.getElementById('tab-btn-list')?.addEventListener('click', () => showTab('list'));\n      document.getElementById('tab-btn-create')?.addEventListener('click', () => showTab('create'));\n      document.getElementById('tab-btn-config')?.addEventListener('click', () => showTab('config'));\n      \n      // Header \u6309\u94AE\u4E8B\u4EF6\n      document.getElementById('btn-import')?.addEventListener('click', showImportModal);\n      document.getElementById('btn-export')?.addEventListener('click', exportAllTools);\n      document.getElementById('btn-new-tool')?.addEventListener('click', () => showTab('create'));\n      \n      // \u521B\u5EFA\u5DE5\u5177\u9875\u9762\u6309\u94AE\n      document.getElementById('btn-load-template')?.addEventListener('click', loadTemplate);\n      document.getElementById('btn-validate')?.addEventListener('click', validateTool);\n      document.getElementById('btn-register')?.addEventListener('click', registerTool);\n      \n      // \u6267\u884C\u7C7B\u578B\u4E0B\u62C9\u6846\n      document.getElementById('executionType')?.addEventListener('change', loadTemplate);\n      \n      // \u641C\u7D22\u6846\n      document.getElementById('searchInput')?.addEventListener('input', filterTools);\n      \n      // \u7B5B\u9009\u5668\n      document.querySelectorAll('.filter-chip[data-filter]').forEach(chip => {\n        chip.addEventListener('click', function() {\n          setFilter(this.getAttribute('data-filter'));\n        });\n      });\n      \n      // \u8BBE\u7F6E\u9875\u9762\u4FDD\u5B58\u6309\u94AE\n      document.getElementById('btn-save-config')?.addEventListener('click', saveConfig);\n      \n      // \u5BFC\u5165\u6A21\u6001\u6846\u6309\u94AE\n      document.getElementById('btn-cancel-import')?.addEventListener('click', hideImportModal);\n      document.getElementById('btn-do-import')?.addEventListener('click', importTools);\n      \n      // \u6D4B\u8BD5\u6A21\u6001\u6846\u6309\u94AE\n      document.getElementById('btn-close-test')?.addEventListener('click', hideTestModal);\n      document.getElementById('runTestBtn')?.addEventListener('click', runTest);\n      \n      console.log('[MCP Panel] Event listeners bound');\n    }\n    \n    // \u5904\u7406\u6765\u81EA\u6269\u5C55\u7684\u6D88\u606F\n    window.addEventListener('message', event => {\n      const data = event.data;\n      console.log('[MCP Panel] Received message:', data.type);\n      \n      switch (data.type) {\n        case 'toolList':\n          allTools = data.tools || [];\n          console.log('[MCP Panel] Loaded', allTools.length, 'tools');\n          renderTools();\n          break;\n          \n        case 'config':\n          loadConfigToForm(data.config);\n          break;\n          \n        case 'toolTemplate':\n          const jsonEditor = document.getElementById('toolJson');\n          if (jsonEditor) {\n            jsonEditor.value = JSON.stringify(data.template, null, 2);\n          }\n          break;\n          \n        case 'registerResult':\n          showCreateResult(data);\n          if (data.success) {\n            vscode.postMessage({ type: 'getTools' });\n          }\n          break;\n          \n        case 'testStart':\n          const startBtn = document.getElementById('runTestBtn');\n          if (startBtn) {\n            startBtn.disabled = true;\n            startBtn.textContent = '\u8FD0\u884C\u4E2D...';\n          }\n          break;\n          \n        case 'testResult':\n          showTestResult(data.result);\n          const endBtn = document.getElementById('runTestBtn');\n          if (endBtn) {\n            endBtn.disabled = false;\n            endBtn.textContent = '\u8FD0\u884C\u6D4B\u8BD5';\n          }\n          vscode.postMessage({ type: 'getTools' });\n          break;\n          \n        case 'exportData':\n          downloadJson(data.data, 'mcp-tools-export.json');\n          break;\n          \n        case 'importResult':\n          alert(data.success \n            ? '\u5BFC\u5165\u6210\u529F: ' + data.imported + ' \u4E2A\u5DE5\u5177'\n            : '\u5BFC\u5165\u5931\u8D25: ' + (data.errors || []).join(', '));\n          hideImportModal();\n          vscode.postMessage({ type: 'getTools' });\n          break;\n          \n        case 'configUpdated':\n          loadConfigToForm(data.config);\n          break;\n      }\n    });\n    \n    // \u5207\u6362\u6807\u7B7E - \u4F7F\u7528data-tab\u5C5E\u6027\n    function showTab(tabName) {\n      console.log('[MCP Panel] Switching to tab:', tabName);\n      \n      // \u79FB\u9664\u6240\u6709active\u72B6\u6001\n      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));\n      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));\n      \n      // \u4F7F\u7528data\u5C5E\u6027\u627E\u5230\u5BF9\u5E94\u7684tab\u6309\u94AE\n      const tabButton = document.querySelector('.tab[data-tab=\"' + tabName + '\"]');\n      const tabContent = document.getElementById('tab-' + tabName);\n      \n      if (tabButton) {\n        tabButton.classList.add('active');\n      }\n      \n      if (tabContent) {\n        tabContent.classList.add('active');\n      }\n      \n      // \u5982\u679C\u5207\u6362\u5230\u8BBE\u7F6E\u9875\uFF0C\u8BF7\u6C42\u914D\u7F6E\u6570\u636E\n      if (tabName === 'config') {\n        vscode.postMessage({ type: 'getConfig' });\n      }\n      \n      // \u5982\u679C\u5207\u6362\u5230\u521B\u5EFA\u9875\u4E14\u7F16\u8F91\u5668\u4E3A\u7A7A\uFF0C\u52A0\u8F7D\u6A21\u677F\n      if (tabName === 'create') {\n        const jsonEditor = document.getElementById('toolJson');\n        if (jsonEditor && !jsonEditor.value.trim()) {\n          loadTemplate();\n        }\n      }\n    }\n    \n    // \u6E32\u67D3\u5DE5\u5177\u5217\u8868\n    function renderTools() {\n      const container = document.getElementById('toolList');\n      const searchQuery = document.getElementById('searchInput').value.toLowerCase();\n      \n      let filtered = allTools.filter(r => {\n        if (currentFilter !== 'all' && r.tool.category !== currentFilter) {\n          return false;\n        }\n        if (searchQuery) {\n          const tool = r.tool;\n          return tool.name.toLowerCase().includes(searchQuery) ||\n                 tool.description.toLowerCase().includes(searchQuery) ||\n                 tool.id.toLowerCase().includes(searchQuery);\n        }\n        return true;\n      });\n      \n      if (filtered.length === 0) {\n        container.innerHTML = '<div class=\"empty-state\"><p>\u6CA1\u6709\u627E\u5230\u5DE5\u5177</p><button id=\"btn-create-first\" class=\"primary\">\u521B\u5EFA\u7B2C\u4E00\u4E2A\u5DE5\u5177</button></div>';\n        // \u4F7F\u7528setTimeout\u786E\u4FDDDOM\u66F4\u65B0\u5B8C\u6210\u540E\u518D\u7ED1\u5B9A\u4E8B\u4EF6\n        setTimeout(function() {\n          const btn = document.getElementById('btn-create-first');\n          if (btn) {\n            btn.onclick = function(e) {\n              e.preventDefault();\n              console.log('[MCP Panel] Create first tool button clicked');\n              showTab('create');\n            };\n          }\n        }, 0);\n        return;\n      }\n      \n      container.innerHTML = filtered.map(r => renderToolCard(r)).join('');\n      // \u7ED1\u5B9A\u5DE5\u5177\u5361\u7247\u6309\u94AE\u4E8B\u4EF6\n      bindToolCardEvents();\n    }\n    \n    // \u7ED1\u5B9A\u5DE5\u5177\u5361\u7247\u6309\u94AE\u4E8B\u4EF6\uFF08\u4F7F\u7528\u4E8B\u4EF6\u59D4\u6258\uFF09\n    function bindToolCardEvents() {\n      const container = document.getElementById('toolList');\n      if (!container) return;\n      \n      // \u4F7F\u7528\u4E8B\u4EF6\u59D4\u6258\u5904\u7406\u5DE5\u5177\u5361\u7247\u4E2D\u7684\u6309\u94AE\u70B9\u51FB\n      container.onclick = function(event) {\n        // \u4F7F\u7528closest\u627E\u5230\u6700\u8FD1\u7684\u6309\u94AE\u5143\u7D20\uFF0C\u5904\u7406\u70B9\u51FB\u6309\u94AE\u5185\u6587\u672C\u7684\u60C5\u51B5\n        const target = event.target.closest('button[data-action]');\n        if (!target) return;\n        \n        const action = target.getAttribute('data-action');\n        const toolId = target.getAttribute('data-tool-id');\n        \n        if (!action || !toolId) return;\n        \n        console.log('[MCP Panel] Tool action:', action, 'toolId:', toolId);\n        \n        // \u963B\u6B62\u4E8B\u4EF6\u5192\u6CE1\n        event.preventDefault();\n        event.stopPropagation();\n        \n        switch (action) {\n          case 'test':\n            showTestModal(toolId);\n            break;\n          case 'copy':\n            copyToolCommand(toolId);\n            break;\n          case 'edit':\n            editTool(toolId);\n            break;\n          case 'toggle':\n            const enabled = target.getAttribute('data-enabled') === 'true';\n            toggleTool(toolId, enabled);\n            break;\n          case 'delete':\n            deleteTool(toolId);\n            break;\n        }\n      };\n    }\n    \n    // \u6E32\u67D3\u5355\u4E2A\u5DE5\u5177\u5361\u7247\n    function renderToolCard(registration) {\n      const tool = registration.tool;\n      const isBuiltin = registration.source === 'builtin';\n      const statusClass = 'status-' + (tool.metadata?.status || 'active');\n      \n      return \\`\n        <div class=\"tool-card \\${registration.enabled ? '' : 'disabled'}\">\n          <div class=\"tool-header\">\n            <div class=\"tool-info\">\n              <h3>\\${tool.name}</h3>\n              <div class=\"tool-id\">@mcp:\\${tool.id}</div>\n            </div>\n            <div class=\"tool-badges\">\n              <span class=\"badge category\">\\${getCategoryIcon(tool.category)} \\${tool.category}</span>\n              \\${isBuiltin ? '<span class=\"badge builtin\">\u5185\u7F6E</span>' : ''}\n              <span class=\"badge \\${statusClass}\">\\${tool.metadata?.status || 'active'}</span>\n              <span class=\"badge\">v\\${tool.version}</span>\n            </div>\n          </div>\n          <div class=\"tool-description\">\\${tool.description}</div>\n          <div class=\"tool-actions\">\n            <button data-action=\"test\" data-tool-id=\"\\${tool.id}\">\u6D4B\u8BD5</button>\n            <button data-action=\"copy\" data-tool-id=\"\\${tool.id}\" class=\"secondary\">\u590D\u5236\u547D\u4EE4</button>\n            \\${!isBuiltin ? \\`\n              <button data-action=\"edit\" data-tool-id=\"\\${tool.id}\" class=\"secondary\">\u7F16\u8F91</button>\n              <button data-action=\"toggle\" data-tool-id=\"\\${tool.id}\" data-enabled=\"\\${!registration.enabled}\" class=\"secondary\">\n                \\${registration.enabled ? '\u7981\u7528' : '\u542F\u7528'}\n              </button>\n              <button data-action=\"delete\" data-tool-id=\"\\${tool.id}\" class=\"danger\">\u5220\u9664</button>\n            \\` : ''}\n          </div>\n        </div>\n      \\`;\n    }\n    \n    function getCategoryIcon(category) {\n      const icons = {\n        file: '\uD83D\uDCC1', code: '\uD83D\uDCBB', api: '\uD83C\uDF10', database: '\uD83D\uDDC4\uFE0F',\n        shell: '\u2328\uFE0F', web: '\uD83D\uDD17', ai: '\uD83E\uDD16', utility: '\uD83D\uDD27', custom: '\uD83D\uDCE6'\n      };\n      return icons[category] || '\uD83D\uDCE6';\n    }\n    \n    // \u7B5B\u9009\n    function setFilter(filter) {\n      currentFilter = filter;\n      document.querySelectorAll('.filter-chip').forEach(chip => {\n        chip.classList.toggle('active', chip.textContent.toLowerCase().includes(filter) || (filter === 'all' && chip.textContent === '\u5168\u90E8'));\n      });\n      renderTools();\n    }\n    \n    function filterTools() {\n      renderTools();\n    }\n    \n    // \u52A0\u8F7D\u6A21\u677F\n    function loadTemplate() {\n      console.log('[MCP Panel] loadTemplate called');\n      const typeSelect = document.getElementById('executionType');\n      if (!typeSelect) {\n        console.error('[MCP Panel] executionType select not found');\n        return;\n      }\n      const type = typeSelect.value;\n      console.log('[MCP Panel] Loading template for type:', type);\n      vscode.postMessage({ type: 'getToolTemplate', executionType: type });\n    }\n    \n    // \u9A8C\u8BC1\u5DE5\u5177\n    function validateTool() {\n      console.log('[MCP Panel] validateTool called');\n      try {\n        const jsonEditor = document.getElementById('toolJson');\n        if (!jsonEditor) {\n          showCreateResult({ success: false, error: '\u65E0\u6CD5\u627E\u5230JSON\u7F16\u8F91\u5668' });\n          return;\n        }\n        \n        const json = jsonEditor.value;\n        if (!json || !json.trim()) {\n          showCreateResult({ success: false, error: '\u8BF7\u8F93\u5165\u5DE5\u5177\u5B9A\u4E49JSON' });\n          return;\n        }\n        \n        const tool = JSON.parse(json);\n        \n        const errors = [];\n        if (!tool.id) errors.push('\u7F3A\u5C11 id');\n        if (!tool.name) errors.push('\u7F3A\u5C11 name');\n        if (!tool.description) errors.push('\u7F3A\u5C11 description');\n        if (!tool.version) errors.push('\u7F3A\u5C11 version');\n        if (!tool.execution?.type) errors.push('\u7F3A\u5C11 execution.type');\n        \n        if (errors.length > 0) {\n          showCreateResult({ success: false, error: errors.join(', ') });\n        } else {\n          showCreateResult({ success: true, message: '\u2713 \u9A8C\u8BC1\u901A\u8FC7\uFF01\u53EF\u4EE5\u6CE8\u518C\u5DE5\u5177\u3002' });\n        }\n      } catch (e) {\n        showCreateResult({ success: false, error: 'JSON\u89E3\u6790\u5931\u8D25: ' + e.message });\n      }\n    }\n    \n    // \u6CE8\u518C\u5DE5\u5177\n    function registerTool() {\n      console.log('[MCP Panel] registerTool called');\n      try {\n        const jsonEditor = document.getElementById('toolJson');\n        if (!jsonEditor) {\n          showCreateResult({ success: false, error: '\u65E0\u6CD5\u627E\u5230JSON\u7F16\u8F91\u5668' });\n          return;\n        }\n        \n        const json = jsonEditor.value;\n        if (!json || !json.trim()) {\n          showCreateResult({ success: false, error: '\u8BF7\u8F93\u5165\u5DE5\u5177\u5B9A\u4E49JSON' });\n          return;\n        }\n        \n        const tool = JSON.parse(json);\n        console.log('[MCP Panel] Registering tool:', tool.id);\n        \n        showCreateResult({ success: true, message: '\u6B63\u5728\u6CE8\u518C\u5DE5\u5177...' });\n        vscode.postMessage({ type: 'registerTool', tool });\n      } catch (e) {\n        console.error('[MCP Panel] registerTool error:', e);\n        showCreateResult({ success: false, error: 'JSON\u89E3\u6790\u5931\u8D25: ' + e.message });\n      }\n    }\n    \n    function showCreateResult(result) {\n      const container = document.getElementById('createResult');\n      if (!container) return;\n      \n      if (result.success) {\n        container.innerHTML = '<div class=\"test-result success\">' + (result.message || '\u64CD\u4F5C\u6210\u529F\uFF01') + '</div>';\n      } else {\n        container.innerHTML = '<div class=\"test-result error\">\u9519\u8BEF: ' + (result.error || '\u672A\u77E5\u9519\u8BEF') + '</div>';\n      }\n    }\n    \n    // \u7F16\u8F91\u5DE5\u5177\n    function editTool(toolId) {\n      console.log('[MCP Panel] editTool called:', toolId);\n      const registration = allTools.find(r => r.tool.id === toolId);\n      if (registration) {\n        const jsonEditor = document.getElementById('toolJson');\n        if (jsonEditor) {\n          jsonEditor.value = JSON.stringify(registration.tool, null, 2);\n        }\n        showTab('create');\n      }\n    }\n    \n    // \u5207\u6362\u542F\u7528\u72B6\u6001\n    function toggleTool(toolId, enabled) {\n      console.log('[MCP Panel] toggleTool called:', toolId, enabled);\n      vscode.postMessage({ type: 'toggleTool', toolId, enabled });\n      // \u7ACB\u5373\u66F4\u65B0UI\n      const tool = allTools.find(r => r.tool.id === toolId);\n      if (tool) {\n        tool.enabled = enabled;\n        renderTools();\n      }\n    }\n    \n    // \u5220\u9664\u5DE5\u5177 - \u53D1\u9001\u5230\u540E\u7AEF\u5904\u7406\u786E\u8BA4\n    function deleteTool(toolId) {\n      console.log('[MCP Panel] Delete tool requested:', toolId);\n      // \u76F4\u63A5\u53D1\u9001\u5230\u540E\u7AEF\uFF0C\u7531VSCode API\u5904\u7406\u786E\u8BA4\u5BF9\u8BDD\u6846\n      vscode.postMessage({ type: 'deleteTool', toolId });\n    }\n    \n    // \u590D\u5236\u547D\u4EE4\n    function copyToolCommand(toolId) {\n      const text = '@mcp:' + toolId;\n      navigator.clipboard.writeText(text);\n      // \u7B80\u5355\u7684\u63D0\u793A\n      alert('\u5DF2\u590D\u5236: ' + text);\n    }\n    \n    // \u6D4B\u8BD5\u76F8\u5173\n    function showTestModal(toolId) {\n      console.log('[MCP Panel] showTestModal called:', toolId);\n      currentTestToolId = toolId;\n      const registration = allTools.find(r => r.tool.id === toolId);\n      if (!registration) {\n        console.error('[MCP Panel] Tool not found:', toolId);\n        return;\n      }\n      \n      const tool = registration.tool;\n      const titleEl = document.getElementById('testModalTitle');\n      if (titleEl) {\n        titleEl.textContent = '\u6D4B\u8BD5: ' + tool.name;\n      }\n      \n      // \u751F\u6210\u53C2\u6570\u8868\u5355\n      const paramsHtml = tool.parameters.map(p => \\`\n        <div class=\"form-group\">\n          <label>\\${p.name} \\${p.required ? '*' : ''} (\\${p.type})</label>\n          <input type=\"text\" id=\"test-param-\\${p.name}\" placeholder=\"\\${p.description}\" value=\"\\${p.default || ''}\">\n        </div>\n      \\`).join('');\n      \n      const paramsForm = document.getElementById('testParamsForm');\n      if (paramsForm) {\n        paramsForm.innerHTML = paramsHtml || '<p>\u6B64\u5DE5\u5177\u65E0\u9700\u53C2\u6570</p>';\n      }\n      \n      const resultContainer = document.getElementById('testResultContainer');\n      if (resultContainer) {\n        resultContainer.innerHTML = '';\n      }\n      \n      const modal = document.getElementById('testModal');\n      if (modal) {\n        modal.classList.add('active');\n      }\n    }\n    \n    function hideTestModal() {\n      const modal = document.getElementById('testModal');\n      if (modal) {\n        modal.classList.remove('active');\n      }\n      currentTestToolId = null;\n    }\n    \n    function runTest() {\n      console.log('[MCP Panel] runTest called, toolId:', currentTestToolId);\n      \n      if (!currentTestToolId) {\n        console.error('[MCP Panel] No tool selected for testing');\n        return;\n      }\n      \n      const registration = allTools.find(r => r.tool.id === currentTestToolId);\n      if (!registration) {\n        console.error('[MCP Panel] Tool not found:', currentTestToolId);\n        return;\n      }\n      \n      const params = {};\n      registration.tool.parameters.forEach(p => {\n        const input = document.getElementById('test-param-' + p.name);\n        if (input && input.value) {\n          // \u5C1D\u8BD5\u89E3\u6790JSON\n          try {\n            params[p.name] = JSON.parse(input.value);\n          } catch {\n            params[p.name] = input.value;\n          }\n        }\n      });\n      \n      console.log('[MCP Panel] Testing with params:', params);\n      \n      // \u7981\u7528\u6309\u94AE\n      const btn = document.getElementById('runTestBtn');\n      if (btn) {\n        btn.disabled = true;\n        btn.textContent = '\u8FD0\u884C\u4E2D...';\n      }\n      \n      vscode.postMessage({ type: 'testTool', toolId: currentTestToolId, params });\n    }\n    \n    function showTestResult(result) {\n      const container = document.getElementById('testResultContainer');\n      if (!container) return;\n      \n      const className = result.success ? 'success' : 'error';\n      const content = result.success \n        ? JSON.stringify(result.data, null, 2)\n        : result.error?.message || '\u6267\u884C\u5931\u8D25';\n      \n      container.innerHTML = \\`\n        <div class=\"test-result \\${className}\">\n          <strong>\\${result.success ? '\u2713 \u6210\u529F' : '\u2717 \u5931\u8D25'}</strong> (\u8017\u65F6: \\${result.stats?.duration || 0}ms)\n          <pre>\\${content}</pre>\n        </div>\n      \\`;\n    }\n    \n    // \u5BFC\u5165\u5BFC\u51FA\n    function showImportModal() {\n      const modal = document.getElementById('importModal');\n      if (modal) {\n        modal.classList.add('active');\n      }\n    }\n    \n    function hideImportModal() {\n      const modal = document.getElementById('importModal');\n      if (modal) {\n        modal.classList.remove('active');\n      }\n      const importData = document.getElementById('importData');\n      if (importData) {\n        importData.value = '';\n      }\n    }\n    \n    function importTools() {\n      const importData = document.getElementById('importData');\n      if (!importData) return;\n      \n      const data = importData.value;\n      if (!data.trim()) {\n        alert('\u8BF7\u8F93\u5165\u5DE5\u5177JSON\u6570\u636E');\n        return;\n      }\n      console.log('[MCP Panel] Importing tools...');\n      vscode.postMessage({ type: 'importTools', data });\n    }\n    \n    function exportAllTools() {\n      console.log('[MCP Panel] Exporting tools...');\n      vscode.postMessage({ type: 'exportTools' });\n    }\n    \n    function downloadJson(data, filename) {\n      const blob = new Blob([data], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      a.click();\n      URL.revokeObjectURL(url);\n    }\n    \n    // \u914D\u7F6E\n    function loadConfigToForm(config) {\n      console.log('[MCP Panel] Loading config to form');\n      if (!config) return;\n      \n      const enabledEl = document.getElementById('configEnabled');\n      const maxToolsEl = document.getElementById('configMaxTools');\n      const timeoutEl = document.getElementById('configTimeout');\n      const logAllEl = document.getElementById('configLogAll');\n      const envVarsEl = document.getElementById('configEnvVars');\n      \n      if (enabledEl) enabledEl.checked = config.enabled !== false;\n      if (maxToolsEl) maxToolsEl.value = config.maxToolsPerRequest || 5;\n      if (timeoutEl) timeoutEl.value = config.defaultTimeout || 30000;\n      if (logAllEl) logAllEl.checked = config.logAllExecutions !== false;\n      if (envVarsEl) envVarsEl.value = JSON.stringify(config.envVariables || {}, null, 2);\n    }\n    \n    function saveConfig() {\n      console.log('[MCP Panel] saveConfig called');\n      try {\n        const enabledEl = document.getElementById('configEnabled');\n        const maxToolsEl = document.getElementById('configMaxTools');\n        const timeoutEl = document.getElementById('configTimeout');\n        const logAllEl = document.getElementById('configLogAll');\n        const envVarsEl = document.getElementById('configEnvVars');\n        \n        if (!enabledEl || !maxToolsEl || !timeoutEl) {\n          alert('\u65E0\u6CD5\u627E\u5230\u914D\u7F6E\u8868\u5355\u5143\u7D20');\n          return;\n        }\n        \n        const config = {\n          enabled: enabledEl.checked,\n          maxToolsPerRequest: parseInt(maxToolsEl.value) || 5,\n          defaultTimeout: parseInt(timeoutEl.value) || 30000,\n          logAllExecutions: logAllEl ? logAllEl.checked : true,\n          envVariables: JSON.parse(envVarsEl?.value || '{}'),\n        };\n        \n        console.log('[MCP Panel] Saving config:', config);\n        vscode.postMessage({ type: 'updateConfig', config });\n      } catch (e) {\n        console.error('[MCP Panel] saveConfig error:', e);\n        alert('\u914D\u7F6E\u683C\u5F0F\u9519\u8BEF: ' + e.message);\n      }\n    }\n    \n    // \u2705 \u4FEE\u590D\uFF1A\u5C06\u51FD\u6570\u66B4\u9732\u5230\u5168\u5C40\u4F5C\u7528\u57DF\uFF0C\u4F7Fonclick\u5C5E\u6027\u80FD\u591F\u8BBF\u95EE\n    window.showTestModal = showTestModal;\n    window.copyToolCommand = copyToolCommand;\n    window.editTool = editTool;\n    window.toggleTool = toggleTool;\n    window.deleteTool = deleteTool;\n    window.showTab = showTab;\n    window.runTest = runTest;\n    window.hideTestModal = hideTestModal;\n    window.showImportModal = showImportModal;\n    window.hideImportModal = hideImportModal;\n    window.importTools = importTools;\n    window.exportAllTools = exportAllTools;\n    window.loadTemplate = loadTemplate;\n    window.validateTool = validateTool;\n    window.registerTool = registerTool;\n    window.saveConfig = saveConfig;\n    window.setFilter = setFilter;\n    \n    console.log('[MCP Panel] Functions exposed to global scope');\n  </script>\n</body>\n</html>`;\n  }\n}\n\nfunction getNonce(): string {\n  let text = '';\n  const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  for (let i = 0; i < 32; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n  return text;\n}\n", "/**\n * MCP (Model Context Protocol) \u6A21\u5757\n * \n * \u63D0\u4F9B\u5DE5\u5177\u6CE8\u518C\u3001\u6267\u884C\u548CAgent\u81EA\u52A8\u5316\u80FD\u529B\n */\n\nexport * from './types';\nexport { MCPRegistry } from './MCPRegistry';\nexport { MCPExecutor, ExecutionHistory } from './MCPExecutor';\nexport { MCPAgent, AgentStatus, AgentStep } from './MCPAgent';\nexport { \n  AutonomousAgent, \n  AutonomousAgentStatus, \n  AutonomousAgentRequest, \n  AutonomousAgentResult,\n  IterationRecord,\n  ThoughtStep,\n  ToolCall,\n  ExecutionResult,\n} from './AutonomousAgent';\nexport { MCPParser, MCPParseResult, MCPParseResultType } from './MCPParser';\nexport { MCPPanelProvider } from './MCPPanelProvider';\nexport { getBuiltinTools, builtinFunctions } from './builtins';\nexport { getAdditionalBuiltinTools, additionalBuiltinFunctions } from './additionalBuiltins';\n", "import * as vscode from 'vscode';\nimport { ChatViewProvider } from './extension/chatview';\nimport { ConfigManager } from './extension/ConfigManager';\nimport { SmartCodeEditor, CodeApplier, DiffContentProvider } from './extension/code-editor';\nimport { getNewFeaturesService, registerNewFeaturesCommands } from './extension/services/NewFeaturesService';\nimport { MCPPanelProvider } from './extension/mcp';\n\nlet chatViewProvider: ChatViewProvider;\nlet mcpPanelProvider: MCPPanelProvider;\nlet codeApplier: CodeApplier;\nlet diffProvider: DiffContentProvider;\n\nexport function activate(context: vscode.ExtensionContext) {\n  console.log('AI Code Assistant Lite is now active!');\n\n  // Initialize providers\n  chatViewProvider = new ChatViewProvider(context.extensionUri, context);\n  mcpPanelProvider = MCPPanelProvider.getInstance(context.extensionUri, context);\n  const configManager = new ConfigManager(context);\n  codeApplier = new CodeApplier();\n  diffProvider = new DiffContentProvider();\n\n  // Initialize SmartCodeEditor (for @mcp and @skill completions)\n  SmartCodeEditor.initialize(context);\n  console.log('SmartCodeEditor initialized with @mcp and @skill completions');\n\n  // Initialize New Features Service (i18n, Parallel Tasks)\n  const newFeaturesService = getNewFeaturesService(context);\n  registerNewFeaturesCommands(context, newFeaturesService);\n  console.log('New Features Service initialized');\n\n  // Register diff content provider\n  context.subscriptions.push(\n    vscode.workspace.registerTextDocumentContentProvider('ai-original', diffProvider),\n    vscode.workspace.registerTextDocumentContentProvider('ai-modified', diffProvider)\n  );\n\n  // Register webview providers\n  context.subscriptions.push(\n    vscode.window.registerWebviewViewProvider(ChatViewProvider.viewType, chatViewProvider),\n    vscode.window.registerWebviewViewProvider(MCPPanelProvider.viewType, mcpPanelProvider)\n  );\n\n  // Register commands\n  const commands: Array<{ id: string; handler: (...args: any[]) => any }> = [\n    // Chat commands\n    { id: 'aiAssistant.newChat', handler: () => chatViewProvider.newChat() },\n    { id: 'aiAssistant.clearChat', handler: () => chatViewProvider.newChat() },\n    { id: 'aiAssistant.stopTask', handler: () => chatViewProvider.stopTask() },\n    { id: 'aiAssistant.compactContext', handler: () => vscode.commands.executeCommand('aiAssistant.chatView.focus') },\n    \n    // Session commands\n    { id: 'aiAssistant.continueLastSession', handler: () => chatViewProvider.continueLastSession() },\n    { id: 'aiAssistant.resumeSession', handler: () => chatViewProvider.showSessionPicker() },\n    \n    // \u2705 \u6E05\u7A7A\u6240\u6709\u5386\u53F2\u6570\u636E\u547D\u4EE4\n    {\n      id: 'aiAssistant.clearAllData',\n      handler: async () => {\n        const confirm = await vscode.window.showWarningMessage(\n          '\u786E\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5386\u53F2\u6570\u636E\u5417\uFF1F\u8FD9\u5C06\u5220\u9664\u6240\u6709\u4F1A\u8BDD\u8BB0\u5F55\u3001\u56FE\u8868\u5386\u53F2\u548C\u6D4B\u8BD5\u5386\u53F2\uFF0C\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002',\n          { modal: true },\n          '\u786E\u8BA4\u6E05\u7A7A'\n        );\n        \n        if (confirm === '\u786E\u8BA4\u6E05\u7A7A') {\n          // \u6E05\u7A7A\u6240\u6709 globalState \u4E2D\u7684\u6269\u5C55\u6570\u636E\n          const keysToClean = [\n            'aiAssistant.sessions',\n            'aiAssistant.currentSessionId',\n            'diagramHistory',\n            'testHistory',\n            'aiAssistant.memory.v2',\n          ];\n          \n          for (const key of keysToClean) {\n            await context.globalState.update(key, undefined);\n          }\n          \n          // \u901A\u77E5 ChatViewProvider \u91CD\u7F6E\u72B6\u6001\n          chatViewProvider.clearAllDataAndReset();\n          \n          vscode.window.showInformationMessage('\u5DF2\u6E05\u7A7A\u6240\u6709\u5386\u53F2\u6570\u636E');\n        }\n      },\n    },\n    \n    // Focus command\n    { id: 'aiAssistant.focus', handler: () => vscode.commands.executeCommand('aiAssistant.chatView.focus') },\n    \n    // API Key configuration\n    {\n      id: 'aiAssistant.setApiKey',\n      handler: async () => {\n        const providers = ['deepseek', 'openai', 'anthropic', 'kimi', 'openrouter'];\n        const selected = await vscode.window.showQuickPick(providers, {\n          placeHolder: 'Select AI provider',\n        });\n        if (!selected) return;\n\n        const apiKey = await vscode.window.showInputBox({\n          prompt: `Enter API Key for ${selected}`,\n          password: true,\n          placeHolder: 'sk-...',\n        });\n        if (apiKey) {\n          await configManager.setApiKey(selected as any, apiKey);\n          vscode.window.showInformationMessage(`API Key for ${selected} has been saved`);\n        }\n      },\n    },\n\n    // Model switching\n    {\n      id: 'aiAssistant.switchModel',\n      handler: async () => {\n        const allModels = configManager.getAllModels();\n        const items: vscode.QuickPickItem[] = [];\n\n        for (const [provider, models] of Object.entries(allModels)) {\n          for (const model of models) {\n            items.push({\n              label: model.name,\n              description: provider,\n              detail: model.supportVision ? '\uD83D\uDC41 Supports vision' : undefined,\n            });\n          }\n        }\n\n        const selected = await vscode.window.showQuickPick(items, {\n          placeHolder: 'Select a model',\n        });\n\n        if (selected) {\n          const provider = selected.description as any;\n          const models = allModels[provider as keyof typeof allModels];\n          const model = models.find((m) => m.name === selected.label);\n          if (model) {\n            await configManager.updateModelConfig({ provider, model: model.id });\n            vscode.window.showInformationMessage(`Switched to ${model.name}`);\n          }\n        }\n      },\n    },\n\n    // ==================== \u667A\u80FD\u4EE3\u7801\u7F16\u8F91\u547D\u4EE4 ====================\n    \n    // \u5E94\u7528 AI \u751F\u6210\u7684\u4EE3\u7801\uFF08\u6838\u5FC3\u529F\u80FD\uFF09\n    {\n      id: 'aiAssistant.applyCode',\n      handler: async () => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) {\n          vscode.window.showWarningMessage('No active editor');\n          return;\n        }\n\n        // \u4ECE\u526A\u8D34\u677F\u83B7\u53D6\u4EE3\u7801\n        const clipboardText = await vscode.env.clipboard.readText();\n        if (!clipboardText) {\n          vscode.window.showWarningMessage('Clipboard is empty');\n          return;\n        }\n\n        const result = await codeApplier.smartInsert(editor.document, clipboardText);\n        if (result.success) {\n          vscode.window.showInformationMessage(result.message);\n        } else {\n          vscode.window.showErrorMessage(result.message);\n        }\n      },\n    },\n\n    // \u667A\u80FD\u66FF\u6362\u9009\u4E2D\u4EE3\u7801\n    {\n      id: 'aiAssistant.smartReplace',\n      handler: async () => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) {\n          vscode.window.showWarningMessage('No active editor');\n          return;\n        }\n\n        const selection = editor.selection;\n        const selectedText = editor.document.getText(selection);\n\n        if (!selectedText) {\n          vscode.window.showWarningMessage('No text selected');\n          return;\n        }\n\n        const newCode = await vscode.window.showInputBox({\n          prompt: 'Enter replacement code or paste from clipboard',\n          value: await vscode.env.clipboard.readText(),\n        });\n\n        if (newCode) {\n          const success = await SmartCodeEditor.replaceText(\n            editor.document,\n            selectedText,\n            newCode,\n            { adjustIndent: true }\n          );\n\n          if (success) {\n            vscode.window.showInformationMessage('Code replaced successfully');\n          } else {\n            vscode.window.showErrorMessage('Failed to replace code');\n          }\n        }\n      },\n    },\n\n    // \u5728\u951A\u70B9\u540E\u63D2\u5165\u4EE3\u7801\n    {\n      id: 'aiAssistant.insertAfter',\n      handler: async () => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) return;\n\n        const anchor = await vscode.window.showInputBox({\n          prompt: 'Enter the text after which to insert code',\n        });\n        if (!anchor) return;\n\n        const code = await vscode.env.clipboard.readText();\n        if (!code) {\n          vscode.window.showWarningMessage('Clipboard is empty');\n          return;\n        }\n\n        const success = await SmartCodeEditor.insertNearAnchor(\n          editor.document,\n          anchor,\n          code,\n          'after',\n          { adjustIndent: true }\n        );\n\n        if (success) {\n          vscode.window.showInformationMessage('Code inserted successfully');\n        } else {\n          vscode.window.showErrorMessage(`Could not find anchor text: \"${anchor}\"`);\n        }\n      },\n    },\n\n    // Code actions with AI\n    {\n      id: 'aiAssistant.explainCode',\n      handler: () => sendSelectedCodeWithAction('explain', 'Explain this code in detail:'),\n    },\n    {\n      id: 'aiAssistant.refactorCode',\n      handler: () => sendSelectedCodeWithAction('refactor', 'Refactor this code. Use SEARCH/REPLACE format:'),\n    },\n    {\n      id: 'aiAssistant.fixCode',\n      handler: () => sendSelectedCodeWithAction('fix', 'Find and fix bugs. Use SEARCH/REPLACE format:'),\n    },\n    {\n      id: 'aiAssistant.addComments',\n      handler: () => sendSelectedCodeWithAction('comment', 'Add comments. Use SEARCH/REPLACE format:'),\n    },\n    {\n      id: 'aiAssistant.optimizeCode',\n      handler: () => sendSelectedCodeWithAction('optimize', 'Optimize this code. Use SEARCH/REPLACE format:'),\n    },\n    {\n      id: 'aiAssistant.reviewCode',\n      handler: () => sendSelectedCodeWithAction('review', 'Review this code for issues and improvements:'),\n    },\n    {\n      id: 'aiAssistant.generateTests',\n      handler: () => sendSelectedCodeWithAction('test', 'Generate tests for this code:'),\n    },\n\n    // Generate diagram\n    {\n      id: 'aiAssistant.generateDiagram',\n      handler: async () => {\n        const editor = vscode.window.activeTextEditor;\n        const hasSelection = editor && !editor.selection.isEmpty;\n        \n        const types: vscode.QuickPickItem[] = [];\n        \n        if (hasSelection) {\n          types.push({ \n            label: '\uD83D\uDCCA \u6D41\u7A0B\u56FE (Flowchart)', \n            description: '\u6839\u636E\u9009\u4E2D\u4EE3\u7801',\n            detail: '\u5C55\u793A\u9009\u4E2D\u4EE3\u7801\u7684\u6267\u884C\u6D41\u7A0B'\n          });\n          types.push({ \n            label: '\u23F1\uFE0F \u65F6\u5E8F\u56FE (Sequence)', \n            description: '\u6839\u636E\u9009\u4E2D\u4EE3\u7801',\n            detail: '\u5C55\u793A\u9009\u4E2D\u4EE3\u7801\u4E2D\u7684\u8C03\u7528\u987A\u5E8F'\n          });\n          types.push({ \n            label: '\uD83C\uDFDB\uFE0F \u7C7B\u56FE (Class Diagram)', \n            description: '\u6839\u636E\u9009\u4E2D\u4EE3\u7801',\n            detail: '\u5C55\u793A\u9009\u4E2D\u4EE3\u7801\u4E2D\u7684\u7C7B\u7ED3\u6784'\n          });\n          types.push({ \n            label: '\uD83D\uDD04 \u72B6\u6001\u56FE (State Diagram)', \n            description: '\u6839\u636E\u9009\u4E2D\u4EE3\u7801',\n            detail: '\u5C55\u793A\u9009\u4E2D\u4EE3\u7801\u4E2D\u7684\u72B6\u6001\u8F6C\u6362'\n          });\n        }\n        \n        if (editor) {\n          types.push({ \n            label: '\uD83D\uDCC1 \u6839\u636E\u5F53\u524D\u6587\u4EF6\u751F\u6210', \n            description: editor.document.fileName.split(/[/\\\\]/).pop(),\n            detail: '\u5206\u6790\u5F53\u524D\u6253\u5F00\u7684\u6587\u4EF6'\n          });\n        }\n        \n        types.push({ \n          label: '\uD83C\uDFD7\uFE0F \u6839\u636E\u9879\u76EE\u7ED3\u6784\u751F\u6210', \n          description: '\u67B6\u6784\u56FE',\n          detail: '\u751F\u6210\u9879\u76EE\u6574\u4F53\u67B6\u6784\u56FE'\n        });\n        \n        types.push({ \n          label: '\uD83D\uDD17 ER\u56FE (ER Diagram)', \n          description: '\u6570\u636E\u5E93\u8868\u5173\u7CFB',\n          detail: '\u5C55\u793A\u6570\u636E\u5E93\u8868\u5173\u7CFB'\n        });\n        types.push({ \n          label: '\uD83D\uDCC5 \u7518\u7279\u56FE (Gantt)', \n          description: '\u9879\u76EE\u65F6\u95F4\u7EBF',\n          detail: '\u5C55\u793A\u9879\u76EE\u65F6\u95F4\u7EBF'\n        });\n        types.push({ \n          label: '\uD83E\uDDE0 \u601D\u7EF4\u5BFC\u56FE (Mind Map)', \n          description: '\u6982\u5FF5\u5C42\u7EA7',\n          detail: '\u5C55\u793A\u6982\u5FF5\u5C42\u7EA7'\n        });\n\n        const selected = await vscode.window.showQuickPick(types, {\n          placeHolder: hasSelection ? '\u9009\u62E9\u56FE\u8868\u7C7B\u578B\uFF08\u5C06\u5206\u6790\u9009\u4E2D\u7684\u4EE3\u7801\uFF09' : '\u9009\u62E9\u56FE\u8868\u7C7B\u578B',\n          matchOnDescription: true,\n          matchOnDetail: true,\n        });\n\n        if (!selected) return;\n        \n        await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n        await new Promise(resolve => setTimeout(resolve, 200));\n        \n        const label = selected.label;\n        \n        if (label.includes('\u6839\u636E\u5F53\u524D\u6587\u4EF6')) {\n          chatViewProvider.sendMessage('/diagram file');\n        } else if (label.includes('\u6839\u636E\u9879\u76EE\u7ED3\u6784')) {\n          chatViewProvider.sendMessage('/diagram project');\n        } else if (hasSelection && editor) {\n          const selectedText = editor.document.getText(editor.selection);\n          const language = editor.document.languageId;\n          \n          let diagramType = 'flowchart';\n          if (label.includes('\u65F6\u5E8F\u56FE')) diagramType = 'sequence';\n          else if (label.includes('\u7C7B\u56FE')) diagramType = 'class';\n          else if (label.includes('\u72B6\u6001\u56FE')) diagramType = 'state';\n          else if (label.includes('ER\u56FE')) diagramType = 'er';\n          else if (label.includes('\u7518\u7279\u56FE')) diagramType = 'gantt';\n          else if (label.includes('\u601D\u7EF4\u5BFC\u56FE')) diagramType = 'mindmap';\n          \n          chatViewProvider.sendMessage(`/diagram ${diagramType} code:\\n\\`\\`\\`${language}\\n${selectedText}\\n\\`\\`\\``);\n        } else {\n          let diagramType = 'flowchart';\n          if (label.includes('ER\u56FE')) diagramType = 'er';\n          else if (label.includes('\u7518\u7279\u56FE')) diagramType = 'gantt';\n          else if (label.includes('\u601D\u7EF4\u5BFC\u56FE')) diagramType = 'mindmap';\n          \n          const description = await vscode.window.showInputBox({\n            prompt: '\u8BF7\u8F93\u5165\u7B80\u5355\u63CF\u8FF0',\n            placeHolder: '\u4F8B\u5982\uFF1A\u7528\u6237\u767B\u5F55\u6D41\u7A0B\u3001\u9879\u76EE\u6A21\u5757\u5173\u7CFB',\n          });\n          \n          if (description) {\n            chatViewProvider.sendMessage(`/diagram ${diagramType} ${description}`);\n          }\n        }\n      },\n    },\n\n    // Test generation\n    {\n      id: 'aiAssistant.generateTestFile',\n      handler: async () => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) {\n          vscode.window.showWarningMessage('No active editor');\n          return;\n        }\n        await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n      },\n    },\n    \n    // Test generation via MCP tool (triggers actual TestHandler)\n    {\n      id: 'aiAssistant.triggerTestGeneration',\n      handler: async (filePath?: string) => {\n        const targetPath = filePath || vscode.window.activeTextEditor?.document.uri.fsPath;\n        if (!targetPath) {\n          vscode.window.showWarningMessage('\u8BF7\u5148\u6253\u5F00\u6216\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6');\n          return;\n        }\n        await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n        // \u901A\u8FC7 sendMessage \u89E6\u53D1 /gentest \u547D\u4EE4\n        chatViewProvider.sendMessage(`/gentest ${targetPath}`);\n      },\n    },\n\n    // Open settings\n    {\n      id: 'aiAssistant.openSettings',\n      handler: () => {\n        vscode.commands.executeCommand('workbench.action.openSettings', 'aiAssistant');\n      },\n    },\n\n    // ==================== MCP\u76F8\u5173\u547D\u4EE4 ====================\n    \n    // \u6253\u5F00MCP\u5DE5\u5177\u7BA1\u7406\u9762\u677F\n    {\n      id: 'aiAssistant.openMcpPanel',\n      handler: async () => {\n        try {\n          await vscode.commands.executeCommand('aiAssistant.mcpPanel.focus');\n        } catch (error) {\n          vscode.window.showInformationMessage(\n            '\u8BF7\u5728\u4FA7\u8FB9\u680FAI Assistant\u4E2D\u67E5\u770BMCP\u5DE5\u5177\u9762\u677F'\n          );\n        }\n      },\n    },\n    \n    // MCP\u5DE5\u5177\u5FEB\u901F\u6267\u884C\n    {\n      id: 'aiAssistant.mcpExecute',\n      handler: async () => {\n        const { MCPRegistry } = await import('./extension/mcp');\n        const registry = MCPRegistry.getInstance(context);\n        const tools = registry.getEnabledTools();\n        \n        if (tools.length === 0) {\n          vscode.window.showWarningMessage('\u6CA1\u6709\u53EF\u7528\u7684MCP\u5DE5\u5177');\n          return;\n        }\n        \n        const items = tools.map(t => ({\n          label: `$(tools) ${t.tool.name}`,\n          description: `@mcp:${t.tool.id}`,\n          detail: t.tool.description,\n          toolId: t.tool.id,\n        }));\n        \n        const selected = await vscode.window.showQuickPick(items, {\n          placeHolder: '\u9009\u62E9\u8981\u6267\u884C\u7684MCP\u5DE5\u5177',\n          matchOnDescription: true,\n          matchOnDetail: true,\n        });\n        \n        if (selected) {\n          await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n          await new Promise(resolve => setTimeout(resolve, 200));\n          chatViewProvider.sendMessage(`@mcp:${(selected as any).toolId}`);\n        }\n      },\n    },\n    \n    // MCP Agent\u6A21\u5F0F\n    {\n      id: 'aiAssistant.mcpAgent',\n      handler: async () => {\n        const task = await vscode.window.showInputBox({\n          prompt: '\u63CF\u8FF0\u4F60\u60F3\u8BA9AI Agent\u5B8C\u6210\u7684\u4EFB\u52A1',\n          placeHolder: '\u4F8B\u5982\uFF1A\u5206\u6790\u5F53\u524D\u9879\u76EE\u7684\u4EE3\u7801\u7ED3\u6784\u5E76\u751F\u6210\u6587\u6863',\n          ignoreFocusOut: true,\n        });\n        \n        if (task) {\n          await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n          await new Promise(resolve => setTimeout(resolve, 200));\n          chatViewProvider.sendMessage(`@mcp:agent ${task}`);\n        }\n      },\n    },\n  ];\n\n  // Register all commands\n  for (const cmd of commands) {\n    context.subscriptions.push(vscode.commands.registerCommand(cmd.id, cmd.handler));\n  }\n\n  // Helper function to send selected code with action type\n  async function sendSelectedCodeWithAction(action: string, prompt: string) {\n    const editor = vscode.window.activeTextEditor;\n    if (!editor) {\n      vscode.window.showWarningMessage('\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6\u5E76\u9009\u62E9\u4EE3\u7801');\n      return;\n    }\n\n    const selection = editor.selection;\n    const selectedText = editor.document.getText(selection);\n\n    if (!selectedText) {\n      vscode.window.showWarningMessage('\u8BF7\u5148\u9009\u62E9\u9700\u8981\u5904\u7406\u7684\u4EE3\u7801');\n      return;\n    }\n\n    const language = editor.document.languageId;\n    const filePath = editor.document.uri.fsPath;\n    const fileName = filePath.split(/[/\\\\]/).pop() || '';\n    \n    const actionLabels: Record<string, string> = {\n      'explain': '\u89E3\u91CA\u4EE3\u7801',\n      'fix': '\u4FEE\u590D\u4EE3\u7801',\n      'optimize': '\u4F18\u5316\u4EE3\u7801',\n      'comment': '\u6DFB\u52A0\u6CE8\u91CA',\n      'review': '\u4EE3\u7801\u5BA1\u67E5',\n      'refactor': '\u91CD\u6784\u4EE3\u7801',\n      'test': '\u751F\u6210\u6D4B\u8BD5',\n      'clearAllData': '\u6E05\u7A7A\u6240\u6709\u6570\u636E',\n    };\n    \n    const displayLabel = actionLabels[action] || action;\n    \n    const systemContext = {\n      action,\n      prompt,\n      fileName,\n      language,\n      code: selectedText,\n      useSearchReplace: !['explain', 'test', 'review', 'clearAllData'].includes(action),\n    };\n\n    await vscode.commands.executeCommand('aiAssistant.chatView.focus');\n    await new Promise(resolve => setTimeout(resolve, 200));\n    \n    chatViewProvider.sendMessageWithContext(displayLabel, systemContext);\n    \n    vscode.window.showInformationMessage(`\u6B63\u5728${displayLabel}...`);\n  }\n\n  // Handle -c and -r command line arguments\n  const args = process.argv;\n  if (args.includes('-c') || args.includes('--continue')) {\n    chatViewProvider.continueLastSession();\n  } else if (args.includes('-r') || args.includes('--resume')) {\n    chatViewProvider.showSessionPicker();\n  }\n\n  // Status bar item\n  const statusBarItem = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, 100);\n  statusBarItem.text = '$(comment-discussion) AI';\n  statusBarItem.tooltip = 'AI Code Assistant Lite';\n  statusBarItem.command = 'aiAssistant.focus';\n  statusBarItem.show();\n  context.subscriptions.push(statusBarItem);\n\n  // \u6CE8\u518C\u4EE3\u7801\u52A8\u4F5C\u63D0\u4F9B\u7A0B\u5E8F\uFF08\u53F3\u952E\u83DC\u5355\uFF09\n  context.subscriptions.push(\n    vscode.languages.registerCodeActionsProvider(\n      { pattern: '**/*' },\n      new AICodeActionProvider(),\n      { providedCodeActionKinds: AICodeActionProvider.providedCodeActionKinds }\n    )\n  );\n}\n\n/**\n * AI \u4EE3\u7801\u52A8\u4F5C\u63D0\u4F9B\u7A0B\u5E8F\n * \u5728\u7F16\u8F91\u5668\u53F3\u952E\u83DC\u5355\u4E2D\u6DFB\u52A0 AI \u76F8\u5173\u64CD\u4F5C\n */\nclass AICodeActionProvider implements vscode.CodeActionProvider {\n  static readonly providedCodeActionKinds = [\n    vscode.CodeActionKind.QuickFix,\n    vscode.CodeActionKind.Refactor,\n    vscode.CodeActionKind.Empty,\n  ];\n\n  provideCodeActions(\n    document: vscode.TextDocument,\n    range: vscode.Range | vscode.Selection\n  ): vscode.CodeAction[] {\n    if (range.isEmpty) return [];\n\n    const actions: vscode.CodeAction[] = [];\n\n    // AI Fix\n    const fixAction = new vscode.CodeAction('\uD83E\uDD16 AI Fix', vscode.CodeActionKind.QuickFix);\n    fixAction.command = { command: 'aiAssistant.fixCode', title: 'AI Fix' };\n    actions.push(fixAction);\n\n    // AI Refactor\n    const refactorAction = new vscode.CodeAction('\uD83E\uDD16 AI Refactor', vscode.CodeActionKind.Refactor);\n    refactorAction.command = { command: 'aiAssistant.refactorCode', title: 'AI Refactor' };\n    actions.push(refactorAction);\n\n    // AI Explain\n    const explainAction = new vscode.CodeAction('\uD83E\uDD16 AI Explain', vscode.CodeActionKind.Empty);\n    explainAction.command = { command: 'aiAssistant.explainCode', title: 'AI Explain' };\n    actions.push(explainAction);\n\n    // AI Add Comments\n    const commentAction = new vscode.CodeAction('\uD83E\uDD16 AI Add Comments', vscode.CodeActionKind.Refactor);\n    commentAction.command = { command: 'aiAssistant.addComments', title: 'AI Add Comments' };\n    actions.push(commentAction);\n\n    // AI clear Comments\n    const clearAction = new vscode.CodeAction('\uD83E\uDD16 AI Clear All Data', vscode.CodeActionKind.Refactor);\n    clearAction.command = { command: 'aiAssistant.clearAllData', title: 'AI Clear All Data' };\n    actions.push(clearAction);\n\n    return actions;\n  }\n}\n\nexport function deactivate() {\n  // Clean up SmartCodeEditor resources\n  SmartCodeEditor.dispose();\n  console.log('AI Code Assistant Lite deactivated');\n}\n", "import * as vscode from 'vscode';\nimport { Message, generateId } from '../../types/shared';\nimport { ChatService } from '../api/ChatService';\nimport { ConfigManager } from '../ConfigManager';\nimport { SessionManager } from '../session/SessionManager';\nimport { CommandParser } from '../commands/CommandParser';\nimport { DiagramGenerator } from '../diagram/DiagramGenerator';\nimport { TestGenerator } from '../test-generator/TestGenerator';\nimport { AutoFixService } from '../services/AutoFixService';\nimport { EnhancedProjectAnalyzer } from '../analyzer/EnhancedProjectAnalyzer';\nimport { SmartInputParser } from '../commands/SmartInputParser';\nimport { \n  ChatViewContext, \n  TaskType, \n  TaskStatus, \n  TaskState,\n  CodeActionContext \n} from './types';\nimport { TaskStateManager } from './utils/TaskStateManager';\nimport {\n  SessionHandler,\n  ChatMessageHandler,\n  DiagramHandler,\n  TestHandler,\n  CommandHandler,\n  ConfigHandler,\n  MCPHandler,\n} from './handlers';\nimport { MCPParser } from '../mcp';\nimport { SkillManager } from '../skills/package/SkillManager';\nimport { SkillExecutor } from '../skills/package/SkillExecutor';\n\n/**\n * Skill\u6267\u884C\u7ED3\u679C\u7C7B\u578B\n */\ninterface SkillExecutionResult {\n  id: string;\n  skillId: string;\n  skillName: string;\n  success: boolean;\n  output?: any;\n  error?: string;\n  duration: number;\n  logs: Array<{ level: string; message: string; timestamp: number }>;\n  mcpCalls: Array<{ toolId: string; params: any; result: any }>;\n}\n\n/**\n * ChatViewProvider - \u4E3B\u7C7B (\u4FEE\u6539\u7248)\n * \n * \u4FEE\u6539\u70B9\uFF1A\n * 1. Skill\u6267\u884C\u7ED3\u679C\u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u8FD4\u56DE\uFF0C\u4E0D\u6DF7\u5165chat\n * 2. \u96C6\u6210SkillManager\u548CSkillExecutor\n */\nexport class ChatViewProvider implements vscode.WebviewViewProvider {\n  public static readonly viewType = 'aiAssistant.chatView';\n\n  private _view?: vscode.WebviewView;\n  private _chatService?: ChatService;\n  \n  // \u670D\u52A1\u5B9E\u4F8B\n  private _configManager: ConfigManager;\n  private _sessionManager: SessionManager;\n  private _commandParser: CommandParser;\n  private _diagramGenerator: DiagramGenerator;\n  private _testGenerator: TestGenerator;\n  private _autoFixService: AutoFixService;\n  private _projectAnalyzer: EnhancedProjectAnalyzer;\n  private _inputParser: SmartInputParser;\n  \n  // [\u65B0\u589E] Skill\u76F8\u5173\n  private _skillManager: SkillManager | null;\n  private _skillExecutor: SkillExecutor;\n  \n  // \u72B6\u6001\u7BA1\u7406\n  private _taskStateManager: TaskStateManager;\n  private _currentStreamingMessage: Message | null = null;\n  private _messageHistory: string[] = [];\n  private _historyIndex = -1;\n  private _projectContext?: string;\n  private _lastGeneratedDiagram?: any;\n  private _lastGeneratedTest?: any;\n  \n  // \u5904\u7406\u5668\u5B9E\u4F8B\n  private _sessionHandler!: SessionHandler;\n  private _chatMessageHandler!: ChatMessageHandler;\n  private _diagramHandler!: DiagramHandler;\n  private _testHandler!: TestHandler;\n  private _commandHandler!: CommandHandler;\n  private _configHandler!: ConfigHandler;\n  private _mcpHandler!: MCPHandler;\n  \n  // \u9632\u6B62\u76D1\u542C\u5668\u91CD\u590D\u6CE8\u518C\n  private _visibilityListenerRegistered = false;\n\n  constructor(\n    private readonly _extensionUri: vscode.Uri,\n    private readonly _context: vscode.ExtensionContext\n  ) {\n    // \u521D\u59CB\u5316\u670D\u52A1\n    this._configManager = new ConfigManager(_context);\n    this._sessionManager = new SessionManager(_context);\n    this._commandParser = new CommandParser();\n    this._diagramGenerator = new DiagramGenerator(_context);\n    this._testGenerator = new TestGenerator(_context);\n    this._autoFixService = new AutoFixService(_context);\n    this._projectAnalyzer = new EnhancedProjectAnalyzer();\n    this._inputParser = new SmartInputParser();\n    \n    // [\u4FEE\u6539] Skill\u7EC4\u4EF6\u5C06\u5728MCPHandler\u521D\u59CB\u5316\u540E\u5EF6\u8FDF\u521D\u59CB\u5316\n    // \u56E0\u4E3ASkillManager\u9700\u8981MCPRegistry\u548CMCPExecutor\n    this._skillManager = null as any;\n    this._skillExecutor = SkillExecutor.getInstance(_context);\n    \n    // \u521D\u59CB\u5316\u4EFB\u52A1\u72B6\u6001\u7BA1\u7406\u5668\n    this._taskStateManager = new TaskStateManager((msg) => this._postMessage(msg));\n  }\n\n  /**\n   * \u521B\u5EFA\u5171\u4EAB\u4E0A\u4E0B\u6587\n   */\n  private _createContext(): ChatViewContext {\n    return {\n      extensionUri: this._extensionUri,\n      extensionContext: this._context,\n      view: this._view,\n      \n      chatService: this._chatService,\n      configManager: this._configManager,\n      sessionManager: this._sessionManager,\n      diagramGenerator: this._diagramGenerator,\n      testGenerator: this._testGenerator,\n      autoFixService: this._autoFixService,\n      projectAnalyzer: this._projectAnalyzer,\n      inputParser: this._inputParser,\n      commandParser: this._commandParser,\n      \n      taskStates: this._taskStateManager.getTaskStates(),\n      currentStreamingMessage: this._currentStreamingMessage,\n      messageHistory: this._messageHistory,\n      historyIndex: this._historyIndex,\n      projectContext: this._projectContext,\n      lastGeneratedDiagram: this._lastGeneratedDiagram,\n      lastGeneratedTest: this._lastGeneratedTest,\n      \n      postMessage: (msg) => this._postMessage(msg),\n      updateTaskStatus: (type, status, msg) => this._taskStateManager.updateStatus(type, status, msg),\n      isTaskRunning: (type) => this._taskStateManager.isRunning(type),\n      setProcessingContext: (processing) => this._setProcessingContext(processing),\n      ensureChatService: () => this._ensureChatService(),\n    };\n  }\n\n  /**\n   * \u521D\u59CB\u5316\u5904\u7406\u5668\n   */\n  private _initializeHandlers(): void {\n    const ctx = this._createContext();\n    \n    // \u521B\u5EFA\u5904\u7406\u5668\u65F6\uFF0C\u4F7F\u7528getter\u6765\u83B7\u53D6\u6700\u65B0\u7684\u4E0A\u4E0B\u6587\u503C\n    const createDynamicContext = (): ChatViewContext => ({\n      ...ctx,\n      view: this._view,\n      chatService: this._chatService,\n      currentStreamingMessage: this._currentStreamingMessage,\n      messageHistory: this._messageHistory,\n      historyIndex: this._historyIndex,\n      projectContext: this._projectContext,\n      lastGeneratedDiagram: this._lastGeneratedDiagram,\n      lastGeneratedTest: this._lastGeneratedTest,\n    });\n    \n    // \u4F7F\u7528Proxy\u6765\u52A8\u6001\u83B7\u53D6\u4E0A\u4E0B\u6587\n    const dynamicCtx = new Proxy({} as ChatViewContext, {\n      get: (_, prop) => {\n        const currentCtx = createDynamicContext();\n        const value = (currentCtx as any)[prop];\n        \n        // \u7279\u6B8A\u5904\u7406\uFF1A\u66F4\u65B0\u5171\u4EAB\u72B6\u6001\n        if (prop === 'currentStreamingMessage') {\n          return this._currentStreamingMessage;\n        }\n        if (prop === 'historyIndex') {\n          return this._historyIndex;\n        }\n        \n        return value;\n      },\n      set: (_, prop, value) => {\n        // \u5141\u8BB8Handler\u66F4\u65B0\u5171\u4EAB\u72B6\u6001\n        if (prop === 'currentStreamingMessage') {\n          this._currentStreamingMessage = value;\n          return true;\n        }\n        if (prop === 'historyIndex') {\n          this._historyIndex = value;\n          return true;\n        }\n        if (prop === 'projectContext') {\n          this._projectContext = value;\n          return true;\n        }\n        if (prop === 'lastGeneratedDiagram') {\n          this._lastGeneratedDiagram = value;\n          return true;\n        }\n        if (prop === 'lastGeneratedTest') {\n          this._lastGeneratedTest = value;\n          return true;\n        }\n        if (prop === 'chatService') {\n          this._chatService = value;\n          return true;\n        }\n        return false;\n      }\n    });\n    \n    this._sessionHandler = new SessionHandler(dynamicCtx);\n    this._chatMessageHandler = new ChatMessageHandler(dynamicCtx);\n    this._diagramHandler = new DiagramHandler(dynamicCtx);\n    this._testHandler = new TestHandler(dynamicCtx);\n    this._commandHandler = new CommandHandler(dynamicCtx);\n    this._configHandler = new ConfigHandler(dynamicCtx);\n    this._mcpHandler = new MCPHandler(dynamicCtx);\n    \n    // [\u4FEE\u6539] MCPHandler\u521D\u59CB\u5316\u540E\uFF0C\u7528\u5176Registry\u548CExecutor\u521D\u59CB\u5316SkillManager\n    try {\n      const registry = this._mcpHandler.getRegistry();\n      const executor = this._mcpHandler.getExecutor();\n      this._skillManager = SkillManager.getInstance(this._context, registry, executor);\n      // \u521D\u59CB\u5316\u5185\u7F6Eskill\u5305\u5E76\u6CE8\u518C\u7BA1\u7406\u547D\u4EE4\n      this._skillManager.initialize().then(() => {\n        console.log('[ChatViewProvider] SkillManager\u521D\u59CB\u5316\u5B8C\u6210');\n      }).catch(e => console.error('[SkillManager] \u521D\u59CB\u5316\u5931\u8D25:', e));\n      this._skillManager.registerCommands(this._context);\n    } catch (err) {\n      console.error('[ChatViewProvider] SkillManager\u521D\u59CB\u5316\u5931\u8D25:', err);\n    }\n  }\n\n  public async resolveWebviewView(\n    webviewView: vscode.WebviewView,\n    _context: vscode.WebviewViewResolveContext,\n    _token: vscode.CancellationToken\n  ): Promise<void> {\n    this._view = webviewView;\n\n    webviewView.webview.options = {\n      enableScripts: true,\n      localResourceRoots: [this._extensionUri],\n    };\n\n    webviewView.title = 'AI Chat';\n    webviewView.webview.html = this._getHtmlForWebview(webviewView.webview);\n\n    // \u521D\u59CB\u5316ChatService\n    const config = await this._configManager.getFullModelConfig();\n    if (config.apiKey) {\n      this._chatService = new ChatService(config);\n    }\n\n    // \u521D\u59CB\u5316\u5904\u7406\u5668\n    this._initializeHandlers();\n\n    // \u52A0\u8F7D\u6216\u521B\u5EFA\u4F1A\u8BDD\n    if (!this._sessionManager.currentSession) {\n      await this._sessionManager.continueLastSession();\n    }\n    if (!this._sessionManager.currentSession) {\n      this._sessionManager.createSession();\n    }\n\n    // \u6D88\u606F\u5904\u7406\n    webviewView.webview.onDidReceiveMessage(async (data: { type: string; [key: string]: any }) => {\n      await this._handleMessage(data);\n    });\n\n    // \u76D1\u542C\u53EF\u89C1\u6027\u53D8\u5316\n    if (!this._visibilityListenerRegistered) {\n      this._visibilityListenerRegistered = true;\n      webviewView.onDidChangeVisibility(async () => {\n        if (webviewView.visible) {\n          this._sessionHandler.sendCurrentStateWithStreaming();\n        }\n      });\n    }\n\n    // \u53D1\u9001\u521D\u59CB\u72B6\u6001\n    this._sessionHandler.sendCurrentStateWithStreaming();\n  }\n\n  /**\n   * \u6D88\u606F\u8DEF\u7531\n   */\n  private async _handleMessage(data: any): Promise<void> {\n    // \u5C1D\u8BD5\u5404\u4E2A\u5904\u7406\u5668\n    \n    // \u4F1A\u8BDD\u76F8\u5173\n    if (await this._sessionHandler.handle(data)) return;\n    \n    // \u914D\u7F6E\u76F8\u5173\n    if (await this._configHandler.handle(data)) return;\n    \n    // MCP\u76F8\u5173\n    if (await this._mcpHandler.handle(data)) return;\n    \n    // \u56FE\u8868\u76F8\u5173\n    if (await this._diagramHandler.handle(data)) return;\n    \n    // \u6D4B\u8BD5\u76F8\u5173\n    if (await this._testHandler.handle(data)) return;\n    \n    // \u804A\u5929\u6D88\u606F\u76F8\u5173\n    if (data.type === 'sendMessage') {\n      await this._handleSendMessage(data.message, data.attachments);\n      return;\n    }\n    if (await this._chatMessageHandler.handle(data)) return;\n    \n    // \u4EE3\u7801\u64CD\u4F5C\u76F8\u5173\n    if (data.type === 'saveCodeToFile') {\n      await this._saveCodeToFile(data.code, data.filename, data.language);\n      return;\n    }\n    if (data.type === 'insertCode') {\n      await this._insertCodeToEditor(data.code);\n      return;\n    }\n    if (data.type === 'replaceCode') {\n      await this._replaceCodeInEditor(data.original, data.replacement);\n      return;\n    }\n    \n    // [\u4FEE\u6539] Agent\u6280\u80FD\u76F8\u5173 - \u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u5904\u7406\n    if (data.type === 'executeSkill') {\n      await this._executeSkillDirect(data.skillId, data.params);\n      return;\n    }\n    if (data.type === 'getAvailableSkills') {\n      await this._getAvailableSkills();\n      return;\n    }\n    if (data.type === 'cancelSkill') {\n      this._cancelSkill(data.skillId);\n      return;\n    }\n    \n    // Skill\u7BA1\u7406\u64CD\u4F5C\n    if (data.type === 'skill:enable') {\n      await this._handleSkillEnable(data.skillId);\n      return;\n    }\n    if (data.type === 'skill:disable') {\n      await this._handleSkillDisable(data.skillId);\n      return;\n    }\n    if (data.type === 'skill:uninstall') {\n      await this._handleSkillUninstall(data.skillId);\n      return;\n    }\n    if (data.type === 'skill:installFromUrl') {\n      await this._handleSkillInstallFromUrl(data.url);\n      return;\n    }\n    if (data.type === 'skill:openInstallDialog') {\n      vscode.commands.executeCommand('aiAssistant.skill.install');\n      return;\n    }\n    if (data.type === 'skill:openCreateDialog') {\n      vscode.commands.executeCommand('aiAssistant.skill.create');\n      return;\n    }\n\n    console.warn('[ChatViewProvider] Unhandled message type:', data.type);\n  }\n\n  /**\n   * \u5904\u7406\u53D1\u9001\u6D88\u606F - \u96C6\u6210\u610F\u56FE\u8BC6\u522B\n   * \n   * \u8DEF\u7531\u4F18\u5148\u7EA7:\n   * 1. \u663E\u5F0F\u524D\u7F00 @mcp:xxx / @skill:xxx \u2192 \u76F4\u63A5\u8DEF\u7531\u5230\u5BF9\u5E94\u5904\u7406\u5668\n   * 2. \u659C\u6760\u547D\u4EE4 /xxx \u2192 CommandHandler\n   * 3. \u81EA\u7136\u8BED\u8A00\u8F93\u5165 \u2192 IntentClassifier \u5224\u65AD\u662F chat \u8FD8\u662F\u9700\u8981\u8C03\u7528\u5DE5\u5177\n   */\n  private async _handleSendMessage(content: string, attachments?: any[]): Promise<void> {\n    if (!content?.trim() && (!attachments || attachments.length === 0)) {\n      return;\n    }\n\n    // \u6DFB\u52A0\u5230\u5386\u53F2\u8BB0\u5F55\n    if (content?.trim()) {\n      this._messageHistory.push(content);\n      if (this._messageHistory.length > 100) {\n        this._messageHistory.shift();\n      }\n      this._historyIndex = -1;\n    }\n\n    // === 1. \u663E\u5F0F\u524D\u7F00\u8DEF\u7531 ===\n    \n    // @mcp \u6307\u4EE4\n    if (MCPParser.isMCPCommand(content)) {\n      const handled = await this._mcpHandler.handleMCPCommand(content);\n      if (handled) return;\n    }\n    \n    // @skill \u6307\u4EE4\n    if (this._isSkillCommand(content)) {\n      await this._handleSkillCommand(content);\n      return;\n    }\n\n    // === 2. \u659C\u6760\u547D\u4EE4 ===\n    const parsed = this._inputParser.parse(content);\n    if (parsed.type === 'command') {\n      const commandParsed = this._commandParser.parse(content);\n      if (commandParsed) {\n        await this._commandHandler.executeCommand(\n          commandParsed, \n          this._diagramHandler, \n          this._testHandler, \n          this._sessionHandler\n        );\n        return;\n      }\n    }\n\n    // === 3. \u81EA\u7136\u8BED\u8A00\u610F\u56FE\u8BC6\u522B ===\n    // IntentClassifier \u5728 ChatMessageHandler.handleSendMessage \u4E2D\u5DF2\u96C6\u6210\n    // \u5B83\u4F1A\u5224\u65AD\u662F\u7EAF chat \u8FD8\u662F\u9700\u8981\u63D0\u793A\u7528\u6237\u4F7F\u7528\u5DE5\u5177\n    await this._chatMessageHandler.handleSendMessage(content, attachments);\n  }\n  \n  /**\n   * \u68C0\u67E5\u662F\u5426\u662FSkill\u547D\u4EE4\n   */\n  private _isSkillCommand(input: string): boolean {\n    return input.trim().toLowerCase().startsWith('@skill');\n  }\n  \n  /**\n   * [\u4FEE\u6539] \u5904\u7406Skill\u547D\u4EE4 - \u7ED3\u679C\u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u8FD4\u56DE\n   */\n  private async _handleSkillCommand(input: string): Promise<void> {\n    const trimmed = input.trim();\n    \n    // \u89E3\u6790skill\u547D\u4EE4\n    const match = trimmed.match(/^@skill:?(\\w+[-\\w]*)?(?:\\s+(.*))?$/i);\n    \n    // \u6DFB\u52A0\u7528\u6237\u6D88\u606F\uFF08\u4EC5\u663E\u793A\u7528\u6237\u8F93\u5165\uFF09\n    const userMessage: Message = {\n      id: generateId(),\n      role: 'user',\n      content: input,\n      timestamp: Date.now(),\n    };\n    await this._sessionManager.addMessage(userMessage);\n    this._postMessage({ type: 'addMessage', message: userMessage });\n    \n    if (!match) {\n      // \u663E\u793Askill\u5E2E\u52A9\n      this._postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content: this._getSkillHelpText(),\n          timestamp: Date.now(),\n        }\n      });\n      return;\n    }\n    \n    const skillId = match[1];\n    const params = match[2];\n    \n    if (!skillId) {\n      // \u663E\u793Askill\u5E2E\u52A9\n      this._postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content: this._getSkillHelpText(),\n          timestamp: Date.now(),\n        }\n      });\n      return;\n    }\n    \n    // \u7279\u6B8A\u547D\u4EE4\n    if (skillId.toLowerCase() === 'list') {\n      await this._showSkillList();\n      return;\n    }\n    \n    // [\u4FEE\u6539] \u76F4\u63A5\u6267\u884Cskill\uFF0C\u7ED3\u679C\u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u8FD4\u56DE\n    await this._executeSkillDirect(skillId, params ? { input: params } : undefined);\n  }\n  \n  /**\n   * \u76F4\u63A5\u6267\u884CSkill - \u811A\u672C\u6267\u884C\uFF0C\u4E0D\u8C03\u7528LLM\n   */\n  private async _executeSkillDirect(skillId: string, params?: Record<string, any>): Promise<void> {\n    this._taskStateManager.updateStatus('skill', 'running', `\u6267\u884C\u6280\u80FD: ${skillId}`);\n    \n    // \u53D1\u9001\u6267\u884C\u5F00\u59CB\u901A\u77E5\n    this._postMessage({\n      type: 'skill:executionStart',\n      skillId,\n      params,\n    });\n    \n    const startTime = Date.now();\n    \n    try {\n      // \u68C0\u67E5SkillManager\u662F\u5426\u5DF2\u521D\u59CB\u5316\n      if (!this._skillManager) {\n        throw new Error('SkillManager\u672A\u521D\u59CB\u5316\uFF0C\u8BF7\u68C0\u67E5MCP\u914D\u7F6E');\n      }\n      \n      const skill = this._skillManager.getSkill(skillId);\n      \n      if (!skill) {\n        // Skill\u672A\u5B89\u88C5 - \u8FD4\u56DE\u63D0\u793A\u4FE1\u606F\uFF0C\u4E0D\u8C03\u7528LLM\n        const duration = Date.now() - startTime;\n        const errorMsg: Message = {\n          id: generateId(),\n          role: 'assistant',\n          content: `\u26A0\uFE0F \u6280\u80FD \\`${skillId}\\` \u672A\u5B89\u88C5\u3002\\n\\n\u8BF7\u4F7F\u7528 \\`@skill:list\\` \u67E5\u770B\u53EF\u7528\u6280\u80FD\uFF0C\u6216\u901A\u8FC7Skill\u5305\u7BA1\u7406\u5B89\u88C5:\\n- \u672C\u5730\u5B89\u88C5: \u5C06skill\u5305\u653E\u5165 skills \u76EE\u5F55\\n- Git\u5B89\u88C5: \u63D0\u4F9Bskill\u5305\u7684Git\u4ED3\u5E93\u5730\u5740`,\n          timestamp: Date.now(),\n        };\n        \n        await this._sessionManager.addMessage(errorMsg);\n        this._postMessage({ type: 'addMessage', message: errorMsg });\n        this._taskStateManager.updateStatus('skill', 'error', `\u6280\u80FD ${skillId} \u672A\u5B89\u88C5`);\n        return;\n      }\n      \n      const editor = vscode.window.activeTextEditor;\n      const workspaceContext = {\n        workspaceRoot: vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n        activeFile: editor?.document.fileName,\n        selectedCode: editor?.selection.isEmpty ? undefined : editor?.document.getText(editor.selection),\n      };\n      \n      // \u76F4\u63A5\u6267\u884Cskill\u811A\u672C\n      const result = await this._skillExecutor.execute(skill, params, workspaceContext);\n      const duration = Date.now() - startTime;\n      \n      // \u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u53D1\u9001\u7ED3\u679C\uFF08\u4F9B\u9762\u677F\u4F7F\u7528\uFF09\n      const executionResult: SkillExecutionResult = {\n        id: generateId(),\n        skillId,\n        skillName: skill.manifest.name,\n        success: result.success,\n        output: result.output,\n        error: result.error,\n        duration,\n        logs: result.logs || [],\n        mcpCalls: result.mcpCalls || [],\n      };\n      \n      this._postMessage({\n        type: 'skill:executionResult',\n        result: executionResult,\n      });\n      \n      // \u5C06\u7ED3\u679C\u4F5C\u4E3Achat\u6D88\u606F\u8FD4\u56DE\n      let chatContent: string;\n      if (result.success) {\n        const outputStr = result.output != null\n          ? (typeof result.output === 'string' ? result.output : JSON.stringify(result.output, null, 2))\n          : '(\u6267\u884C\u5B8C\u6210\uFF0C\u65E0\u8F93\u51FA)';\n        const truncated = outputStr.length > 3000 ? outputStr.slice(0, 3000) + '\\n...(\u5DF2\u622A\u65AD)' : outputStr;\n        \n        chatContent = `\u2705 **${skill.manifest.name}** \u6267\u884C\u5B8C\u6210 (${duration}ms)\\n\\n`;\n        chatContent += `\\`\\`\\`\\n${truncated}\\n\\`\\`\\``;\n        \n        // \u5982\u679C\u6709\u65E5\u5FD7\uFF0C\u6298\u53E0\u5C55\u793A\n        if (result.logs && result.logs.length > 0) {\n          chatContent += `\\n\\n<details>\\n<summary>\uD83D\uDCCB \u6267\u884C\u65E5\u5FD7 (${result.logs.length}\u6761)</summary>\\n\\n`;\n          for (const log of result.logs) {\n            const icon = log.level === 'error' ? '\u274C' : log.level === 'warn' ? '\u26A0\uFE0F' : '\u2139\uFE0F';\n            chatContent += `${icon} ${log.message}\\n`;\n          }\n          chatContent += `\\n</details>`;\n        }\n      } else {\n        chatContent = `\u274C **${skill.manifest.name}** \u6267\u884C\u5931\u8D25 (${duration}ms)\\n\\n${result.error}`;\n      }\n      \n      const resultMessage: Message = {\n        id: generateId(),\n        role: 'assistant',\n        content: chatContent,\n        timestamp: Date.now(),\n        metadata: {\n          type: 'skill_result',\n          skillId,\n          resultId: executionResult.id,\n        },\n      };\n      \n      await this._sessionManager.addMessage(resultMessage);\n      this._postMessage({ type: 'addMessage', message: resultMessage });\n      \n      this._taskStateManager.updateStatus('skill', result.success ? 'success' : 'error', \n        result.success ? '\u6280\u80FD\u6267\u884C\u5B8C\u6210' : result.error || '\u6267\u884C\u5931\u8D25');\n      \n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF';\n      const duration = Date.now() - startTime;\n      \n      this._postMessage({\n        type: 'skill:executionError',\n        skillId,\n        error: errorMessage,\n        duration,\n      });\n      \n      const errorMsg: Message = {\n        id: generateId(),\n        role: 'assistant',\n        content: `\u274C \u6280\u80FD \\`${skillId}\\` \u6267\u884C\u5931\u8D25 (${duration}ms): ${errorMessage}`,\n        timestamp: Date.now(),\n      };\n      \n      await this._sessionManager.addMessage(errorMsg);\n      this._postMessage({ type: 'addMessage', message: errorMsg });\n      \n      this._taskStateManager.updateStatus('skill', 'error', errorMessage);\n    }\n  }\n  \n  /**\n   * [\u65B0\u589E] \u83B7\u53D6\u53EF\u7528\u6280\u80FD\u5217\u8868\n   */\n  private async _getAvailableSkills(): Promise<void> {\n    const allSkills: Array<{ id: string; name: string; desc: string; type: string; version?: string; status?: string }> = [];\n    \n    if (this._skillManager) {\n      const installed = this._skillManager.getInstalledSkills();\n      for (const s of installed) {\n        allSkills.push({\n          id: s.manifest.id,\n          name: s.manifest.name,\n          desc: s.manifest.description,\n          type: s.installedAt === 0 ? 'builtin' : 'installed',\n          version: s.manifest.version,\n          status: s.status,\n        });\n      }\n    }\n    \n    this._postMessage({\n      type: 'skill:availableSkills',\n      skills: allSkills,\n    });\n  }\n  \n  /**\n   * [\u65B0\u589E] \u53D6\u6D88\u6280\u80FD\u6267\u884C\n   */\n  private _cancelSkill(skillId: string): void {\n    const cancelled = this._skillExecutor.cancel(skillId);\n    \n    this._postMessage({\n      type: 'skill:cancelled',\n      skillId,\n      success: cancelled,\n    });\n    \n    if (cancelled) {\n      this._taskStateManager.updateStatus('skill', 'idle', '\u5DF2\u53D6\u6D88');\n    }\n  }\n\n  // ========== Skill\u7BA1\u7406\u64CD\u4F5C ==========\n\n  private async _handleSkillEnable(skillId: string): Promise<void> {\n    if (!this._skillManager) return;\n    const result = await this._skillManager.enable(skillId);\n    this._postMessage({\n      type: 'skill:operationResult',\n      operation: 'enable',\n      skillId,\n      success: result.success,\n      error: result.error,\n    });\n    if (result.success) {\n      await this._getAvailableSkills(); // \u5237\u65B0\u6280\u80FD\u5217\u8868\n    }\n  }\n\n  private async _handleSkillDisable(skillId: string): Promise<void> {\n    if (!this._skillManager) return;\n    const result = await this._skillManager.disable(skillId);\n    this._postMessage({\n      type: 'skill:operationResult',\n      operation: 'disable',\n      skillId,\n      success: result.success,\n      error: result.error,\n    });\n    if (result.success) {\n      await this._getAvailableSkills();\n    }\n  }\n\n  private async _handleSkillUninstall(skillId: string): Promise<void> {\n    if (!this._skillManager) return;\n    const result = await this._skillManager.uninstall(skillId);\n    this._postMessage({\n      type: 'skill:operationResult',\n      operation: 'uninstall',\n      skillId,\n      success: result.success,\n      error: result.error,\n    });\n    if (result.success) {\n      await this._getAvailableSkills();\n    }\n  }\n\n  private async _handleSkillInstallFromUrl(url: string): Promise<void> {\n    if (!this._skillManager) return;\n    this._postMessage({ type: 'skill:installProgress', status: 'downloading', url });\n    const result = await this._skillManager.installFromUrl(url);\n    this._postMessage({\n      type: 'skill:operationResult',\n      operation: 'install',\n      success: result.success,\n      error: result.error,\n      skill: result.skill ? {\n        id: result.skill.manifest.id,\n        name: result.skill.manifest.name,\n        version: result.skill.manifest.version,\n      } : undefined,\n    });\n    if (result.success) {\n      await this._getAvailableSkills();\n    }\n  }\n  \n  /**\n   * \u83B7\u53D6Skill\u5E2E\u52A9\u6587\u672C\n   */\n  private _getSkillHelpText(): string {\n    let text = `# Skill \u6280\u80FD\u4F7F\u7528\u5E2E\u52A9\n\n## \u57FA\u672C\u8BED\u6CD5\n\\`@skill\\` - \u663E\u793A\u6B64\u5E2E\u52A9\n\\`@skill:list\\` - \u5217\u51FA\u6240\u6709\u53EF\u7528\u6280\u80FD\n\n## \u8C03\u7528\u6280\u80FD\n\\`@skill:\u6280\u80FDID\\` - \u8C03\u7528\u6307\u5B9A\u6280\u80FD\n\\`@skill:\u6280\u80FDID \u53C2\u6570\\` - \u5E26\u53C2\u6570\u8C03\u7528\n\n## \u53EF\u7528\u6280\u80FD\n\n| \u6280\u80FDID | \u540D\u79F0 | \u8BF4\u660E |\n|--------|------|------|\n`;\n    if (this._skillManager) {\n      const skills = this._skillManager.getInstalledSkills();\n      for (const s of skills) {\n        const icon = s.installedAt === 0 ? '\uD83D\uDCE6' : '\uD83D\uDCE5';\n        text += `| \\`${s.manifest.id}\\` | ${icon} ${s.manifest.name} | ${s.manifest.description} |\\n`;\n      }\n    }\n\n    if (!this._skillManager || this._skillManager.getInstalledSkills().length === 0) {\n      text += '| - | (\u65E0\u53EF\u7528\u6280\u80FD) | \u8BF7\u7B49\u5F85\u521D\u59CB\u5316\u5B8C\u6210\u6216\u5B89\u88C5\u6280\u80FD\u5305 |\\n';\n    }\n\n    text += `\n## \u7BA1\u7406\u6280\u80FD\n- \u547D\u4EE4\u9762\u677F: \\`Ctrl+Shift+P\\` \u2192 \u641C\u7D22 \"Skill\"\n- \u5B89\u88C5: \\`aiAssistant.skill.install\\`\n- \u7BA1\u7406: \\`aiAssistant.skill.manage\\`\n- \u521B\u5EFA: \\`aiAssistant.skill.create\\`\n\n## \u793A\u4F8B\n\\`@skill:code-reviewer\\`\n\\`@skill:test-architect src/utils.ts\\`\n\\`@skill:dependency-guardian\\`\n`;\n    return text;\n  }\n  \n  /**\n   * \u663E\u793A\u53EF\u7528\u6280\u80FD\u5217\u8868\n   */\n  private async _showSkillList(): Promise<void> {\n    const installedSkills = this._skillManager ? this._skillManager.getInstalledSkills() : [];\n    \n    let content = '# \uD83D\uDCE6 \u53EF\u7528\u6280\u80FD\u5217\u8868\\n\\n';\n    \n    // \u5206\u7C7B\uFF1A\u5185\u7F6E vs \u7528\u6237\u5B89\u88C5\n    const builtins = installedSkills.filter(s => s.installedAt === 0);\n    const userInstalled = installedSkills.filter(s => s.installedAt > 0);\n    \n    if (builtins.length > 0) {\n      content += '## \u5185\u7F6E\u6280\u80FD\\n\\n';\n      content += '| \u6280\u80FDID | \u540D\u79F0 | \u8BF4\u660E | \u72B6\u6001 |\\n';\n      content += '|--------|------|------|------|\\n';\n      for (const skill of builtins) {\n        const statusIcon = skill.status === 'active' ? '\u2705' : skill.status === 'disabled' ? '\u23F8\uFE0F' : '\u274C';\n        content += `| \\`${skill.manifest.id}\\` | ${skill.manifest.name} | ${skill.manifest.description} | ${statusIcon} |\\n`;\n      }\n    } else {\n      content += '> \u26A0\uFE0F \u6CA1\u6709\u627E\u5230\u5185\u7F6E\u6280\u80FD\u3002\u8BF7\u786E\u8BA4\u6269\u5C55\u5B89\u88C5\u5B8C\u6574\u3002\\n\\n';\n    }\n    \n    if (userInstalled.length > 0) {\n      content += '\\n## \u5DF2\u5B89\u88C5\u6280\u80FD\\n\\n';\n      content += '| \u6280\u80FDID | \u540D\u79F0 | \u7248\u672C | \u72B6\u6001 |\\n';\n      content += '|--------|------|------|------|\\n';\n      for (const skill of userInstalled) {\n        const statusIcon = skill.status === 'active' ? '\u2705' : skill.status === 'disabled' ? '\u23F8\uFE0F' : '\u274C';\n        content += `| \\`${skill.manifest.id}\\` | ${skill.manifest.name} | ${skill.manifest.version} | ${statusIcon} |\\n`;\n      }\n    }\n    \n    content += '\\n---\\n';\n    content += '\u4F7F\u7528\u65B9\u5F0F: `@skill:\u6280\u80FDID [\u53C2\u6570]`\\n';\n    content += '\u7BA1\u7406\u6280\u80FD: \u547D\u4EE4\u9762\u677F `Ctrl+Shift+P` \u2192 \u641C\u7D22 \"Skill\"\\n';\n    \n    this._postMessage({\n      type: 'addMessage',\n      message: {\n        id: generateId(),\n        role: 'assistant',\n        content,\n        timestamp: Date.now(),\n      }\n    });\n  }\n\n  /**\n   * \u786E\u4FDDChatService\u53EF\u7528\n   */\n  private async _ensureChatService(): Promise<ChatService | null> {\n    if (!this._chatService) {\n      const config = await this._configManager.getFullModelConfig();\n      if (!config.apiKey) {\n        return null;\n      }\n      this._chatService = new ChatService(config);\n    }\n    return this._chatService;\n  }\n\n  /**\n   * \u4FDD\u5B58\u4EE3\u7801\u5230\u6587\u4EF6\n   */\n  private async _saveCodeToFile(code: string, filename: string, language: string): Promise<void> {\n    try {\n      const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n      if (!workspaceRoot) {\n        vscode.window.showErrorMessage('\u8BF7\u5148\u6253\u5F00\u5DE5\u4F5C\u533A');\n        return;\n      }\n\n      const saveUri = await vscode.window.showSaveDialog({\n        defaultUri: vscode.Uri.file(`${workspaceRoot}/${filename}`),\n        filters: { 'All Files': ['*'] },\n      });\n\n      if (saveUri) {\n        const fs = require('fs');\n        fs.writeFileSync(saveUri.fsPath, code, 'utf-8');\n        \n        const document = await vscode.workspace.openTextDocument(saveUri);\n        await vscode.window.showTextDocument(document);\n        \n        vscode.window.showInformationMessage(`\u6587\u4EF6\u5DF2\u4FDD\u5B58: ${saveUri.fsPath}`);\n      }\n    } catch (error) {\n      vscode.window.showErrorMessage(`\u4FDD\u5B58\u5931\u8D25: ${error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF'}`);\n    }\n  }\n\n  /**\n   * \u63D2\u5165\u4EE3\u7801\u5230\u7F16\u8F91\u5668\n   */\n  private async _insertCodeToEditor(code: string): Promise<void> {\n    const editor = vscode.window.activeTextEditor;\n    if (!editor) {\n      vscode.window.showWarningMessage('\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6');\n      return;\n    }\n\n    await editor.edit(editBuilder => {\n      editBuilder.insert(editor.selection.active, code);\n    });\n  }\n\n  /**\n   * \u66FF\u6362\u7F16\u8F91\u5668\u4E2D\u7684\u4EE3\u7801\n   */\n  private async _replaceCodeInEditor(original: string, replacement: string): Promise<void> {\n    const editor = vscode.window.activeTextEditor;\n    if (!editor) {\n      vscode.window.showWarningMessage('\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6');\n      return;\n    }\n\n    const document = editor.document;\n    const fullText = document.getText();\n    const index = fullText.indexOf(original);\n    \n    if (index === -1) {\n      vscode.window.showWarningMessage('\u672A\u627E\u5230\u8981\u66FF\u6362\u7684\u4EE3\u7801');\n      return;\n    }\n\n    const startPos = document.positionAt(index);\n    const endPos = document.positionAt(index + original.length);\n    const range = new vscode.Range(startPos, endPos);\n\n    await editor.edit(editBuilder => {\n      editBuilder.replace(range, replacement);\n    });\n    \n    vscode.window.showInformationMessage('\u4EE3\u7801\u5DF2\u66FF\u6362');\n  }\n\n  private _setProcessingContext(processing: boolean): void {\n    vscode.commands.executeCommand('setContext', 'aiAssistant.isProcessing', processing);\n  }\n\n  private _postMessage(message: any): void {\n    this._view?.webview.postMessage(message);\n  }\n\n  private _getHtmlForWebview(webview: vscode.Webview): string {\n    const scriptUri = webview.asWebviewUri(\n      vscode.Uri.joinPath(this._extensionUri, 'dist', 'webview.js')\n    );\n    const styleUri = webview.asWebviewUri(\n      vscode.Uri.joinPath(this._extensionUri, 'dist', 'webview.css')\n    );\n\n    const nonce = this._getNonce();\n\n    return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src 'nonce-${nonce}'; img-src ${webview.cspSource} data: https: blob: https://mermaid.ink; font-src ${webview.cspSource}; frame-src blob: https:; connect-src https: https://mermaid.ink; worker-src 'none';\">\n  <link href=\"${styleUri}\" rel=\"stylesheet\">\n  <title>AI Assistant</title>\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script nonce=\"${nonce}\" src=\"${scriptUri}\"></script>\n</body>\n</html>`;\n  }\n\n  private _getNonce(): string {\n    let text = '';\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    for (let i = 0; i < 32; i++) {\n      text += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return text;\n  }\n\n  // ==================== \u516C\u5171\u65B9\u6CD5 ====================\n\n  public async newChat(): Promise<void> {\n    await this._sessionHandler.createNewChat();\n  }\n\n  public stopTask(): void {\n    this._chatMessageHandler.stopCurrentTask();\n  }\n\n  public async continueLastSession(): Promise<void> {\n    await this._sessionHandler.continueLastSession();\n  }\n\n  public async showSessionPicker(): Promise<void> {\n    await this._sessionHandler.showSessionPicker();\n  }\n\n  public clearAllDataAndReset(): void {\n    this._sessionHandler.clearAllDataAndReset();\n  }\n\n  public async sendMessage(content: string): Promise<void> {\n    if (!this._view) {\n      vscode.window.showWarningMessage('\u804A\u5929\u89C6\u56FE\u5C1A\u672A\u51C6\u5907\u597D\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5');\n      return;\n    }\n    await this._handleSendMessage(content);\n  }\n\n  public async sendMessageWithContext(\n    displayLabel: string, \n    systemContext: CodeActionContext\n  ): Promise<void> {\n    await this._chatMessageHandler.sendMessageWithContext(displayLabel, systemContext);\n  }\n}\n", "import * as vscode from 'vscode';\nimport { ModelConfig, Provider, AVAILABLE_MODELS } from '../types/shared';\n\nexport class ConfigManager {\n  private context: vscode.ExtensionContext;\n  private static readonly API_KEY_PREFIX = 'aiAssistant.apiKey.';\n\n  constructor(context: vscode.ExtensionContext) {\n    this.context = context;\n  }\n\n  async getApiKey(provider: Provider): Promise<string | undefined> {\n    return this.context.secrets.get(ConfigManager.API_KEY_PREFIX + provider);\n  }\n\n  async setApiKey(provider: Provider, apiKey: string): Promise<void> {\n    if (apiKey) {\n      await this.context.secrets.store(ConfigManager.API_KEY_PREFIX + provider, apiKey);\n    } else {\n      await this.context.secrets.delete(ConfigManager.API_KEY_PREFIX + provider);\n    }\n  }\n\n  async hasAnyApiKey(): Promise<boolean> {\n    const providers: Provider[] = ['deepseek', 'openai', 'anthropic', 'kimi', 'openrouter'];\n    for (const provider of providers) {\n      const key = await this.getApiKey(provider);\n      if (key) return true;\n    }\n    return false;\n  }\n\n  /**\n   * \u83B7\u53D6\u6240\u6709API Key\u7684\u72B6\u6001\uFF08\u662F\u5426\u5DF2\u4FDD\u5B58\u53CA\u9884\u89C8\uFF09\n   */\n  async getAllApiKeyStatus(): Promise<Record<string, { saved: boolean; preview: string }>> {\n    const providers: Provider[] = ['deepseek', 'openai', 'anthropic', 'kimi', 'openrouter'];\n    const status: Record<string, { saved: boolean; preview: string }> = {};\n    \n    for (const provider of providers) {\n      const key = await this.getApiKey(provider);\n      if (key) {\n        // \u663E\u793A\u524D10\u4E2A\u5B57\u7B26\u4F5C\u4E3A\u9884\u89C8\n        status[provider] = {\n          saved: true,\n          preview: key.slice(0, 10)\n        };\n      } else {\n        status[provider] = {\n          saved: false,\n          preview: ''\n        };\n      }\n    }\n    \n    return status;\n  }\n\n  getModelConfig(): ModelConfig {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      provider: config.get<Provider>('defaultProvider', 'deepseek'),\n      model: config.get<string>('defaultModel', 'deepseek-chat'),\n      temperature: config.get<number>('temperature', 0.7),\n      maxTokens: config.get<number>('maxTokens', 8192),  // \u63D0\u9AD8\u9ED8\u8BA4\u503C\uFF0C\u907F\u514D\u6D4B\u8BD5\u4EE3\u7801\u622A\u65AD\n    };\n  }\n\n  async getFullModelConfig(): Promise<ModelConfig> {\n    const config = this.getModelConfig();\n    config.apiKey = await this.getApiKey(config.provider);\n    return config;\n  }\n\n  async updateModelConfig(updates: Partial<ModelConfig>): Promise<void> {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    if (updates.provider !== undefined) {\n      await config.update('defaultProvider', updates.provider, vscode.ConfigurationTarget.Global);\n    }\n    if (updates.model !== undefined) {\n      await config.update('defaultModel', updates.model, vscode.ConfigurationTarget.Global);\n    }\n    if (updates.temperature !== undefined) {\n      await config.update('temperature', updates.temperature, vscode.ConfigurationTarget.Global);\n    }\n    if (updates.maxTokens !== undefined) {\n      await config.update('maxTokens', updates.maxTokens, vscode.ConfigurationTarget.Global);\n    }\n  }\n\n  getAvailableModels(provider: Provider) {\n    return AVAILABLE_MODELS[provider] || [];\n  }\n\n  getAllModels() {\n    return AVAILABLE_MODELS;\n  }\n\n  supportsVision(provider: Provider, model: string): boolean {\n    const models = this.getAvailableModels(provider);\n    const modelInfo = models.find((m) => m.id === model);\n    return modelInfo?.supportVision ?? false;\n  }\n\n  getSessionConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      maxSessions: config.get<number>('sessionHistory.maxSessions', 50),\n      autoSave: config.get<boolean>('sessionHistory.autoSave', true),\n    };\n  }\n\n  getCompressionConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      enabled: config.get<boolean>('contextCompression.enabled', true),\n      maxMessages: config.get<number>('contextCompression.maxMessages', 20),\n    };\n  }\n\n  getDiagramConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      defaultFormat: config.get<'mermaid' | 'plantuml' | 'd2'>('diagram.defaultFormat', 'mermaid'),\n    };\n  }\n\n  getVoiceConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      language: config.get<string>('voice.language', 'zh-CN'),\n    };\n  }\n\n  getTestConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      framework: config.get<string>('testGenerator.framework', 'auto'),\n    };\n  }\n\n  // ==================== V16 \u65B0\u529F\u80FD\u914D\u7F6E ====================\n\n  /**\n   * \u83B7\u53D6\u8BED\u8A00\u914D\u7F6E\n   */\n  getLanguageConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      language: config.get<'zh-CN' | 'en-US'>('language', 'zh-CN'),\n      autoDetect: config.get<boolean>('language.autoDetect', true),\n    };\n  }\n\n  /**\n   * \u8BBE\u7F6E\u8BED\u8A00\n   */\n  async setLanguage(language: 'zh-CN' | 'en-US'): Promise<void> {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    await config.update('language', language, vscode.ConfigurationTarget.Global);\n  }\n\n  /**\n   * \u83B7\u53D6\u5E76\u884C\u4EFB\u52A1\u914D\u7F6E\n   */\n  getParallelConfig() {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    return {\n      maxConcurrency: config.get<number>('parallel.maxConcurrency', 3),\n      stopOnError: config.get<boolean>('parallel.stopOnError', false),\n    };\n  }\n\n  /**\n   * \u8BBE\u7F6E\u5E76\u884C\u4EFB\u52A1\u914D\u7F6E\n   */\n  async setParallelConfig(updates: { maxConcurrency?: number; stopOnError?: boolean }): Promise<void> {\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    if (updates.maxConcurrency !== undefined) {\n      await config.update('parallel.maxConcurrency', updates.maxConcurrency, vscode.ConfigurationTarget.Global);\n    }\n    if (updates.stopOnError !== undefined) {\n      await config.update('parallel.stopOnError', updates.stopOnError, vscode.ConfigurationTarget.Global);\n    }\n  }\n}\n", "import * as vscode from 'vscode';\nimport {\n  Session,\n  SessionSummary,\n  Message,\n  generateId,\n  estimateTokens,\n  truncateText,\n} from '../../types/shared';\n\nconst SESSIONS_KEY = 'aiAssistant.sessions';\nconst CURRENT_SESSION_KEY = 'aiAssistant.currentSessionId';\n\n/**\n * \u4F1A\u8BDD\u7BA1\u7406\u5668\n * \u8D1F\u8D23\u4F1A\u8BDD\u7684\u521B\u5EFA\u3001\u4FDD\u5B58\u3001\u52A0\u8F7D\u3001\u538B\u7F29\u7B49\u64CD\u4F5C\n */\nexport class SessionManager {\n  private _context: vscode.ExtensionContext;\n  private _currentSession: Session | null = null;\n  private _messageHistory: string[] = []; // \u7528\u4E8E\u2191\u2193\u7FFB\u5386\u53F2\n\n  constructor(context: vscode.ExtensionContext) {\n    this._context = context;\n  }\n\n  /**\n   * \u83B7\u53D6\u5F53\u524D\u4F1A\u8BDD\n   */\n  get currentSession(): Session | null {\n    return this._currentSession;\n  }\n\n  /**\n   * \u83B7\u53D6\u6D88\u606F\u5386\u53F2\uFF08\u7528\u4E8E\u2191\u2193\u7FFB\u5386\u53F2\uFF09\n   */\n  get messageHistory(): string[] {\n    return this._messageHistory;\n  }\n\n  /**\n   * \u521B\u5EFA\u65B0\u4F1A\u8BDD\n   * \u2705 \u6DFB\u52A0\u65E5\u5FD7\u4EE5\u4FBF\u8C03\u8BD5\n   */\n  createSession(title?: string): Session {\n    const session: Session = {\n      id: generateId(),\n      title: title || `\u5BF9\u8BDD ${new Date().toLocaleString('zh-CN')}`,\n      messages: [],\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n      metadata: {},\n    };\n    this._currentSession = session;\n    this._messageHistory = [];\n    // \u540C\u6B65\u4FDD\u5B58 sessionId\uFF08\u4E0D\u7B49\u5F85\u5B8C\u6210\uFF0C\u56E0\u4E3A\u8FD9\u4E2A\u65B9\u6CD5\u662F\u540C\u6B65\u7684\uFF09\n    this._context.globalState.update(CURRENT_SESSION_KEY, session.id);\n    console.log('[SessionManager] New session created:', session.id);\n    return session;\n  }\n\n  /**\n   * \u52A0\u8F7D\u6307\u5B9A\u4F1A\u8BDD\n   * \u2705 \u4FEE\u590D\uFF1A\u6DFB\u52A0\u8BE6\u7EC6\u65E5\u5FD7\n   */\n  async loadSession(sessionId: string): Promise<Session | null> {\n    console.log('[SessionManager] Loading session:', sessionId);\n    const sessions = this._getAllSessions();\n    const session = sessions.find(s => s.id === sessionId);\n    if (session) {\n      this._currentSession = session;\n      this._messageHistory = session.messages\n        .filter(m => m.role === 'user')\n        .map(m => m.content);\n      await this._saveCurrentSessionId(session.id);\n      console.log('[SessionManager] Session loaded successfully:', session.id, 'messages:', session.messages.length);\n      return session;\n    }\n    console.log('[SessionManager] Session not found:', sessionId);\n    return null;\n  }\n\n  /**\n   * \u7EE7\u7EED\u4E0A\u6B21\u5BF9\u8BDD (-c \u53C2\u6570)\n   * \u2705 \u4FEE\u590D\uFF1A\u6DFB\u52A0\u8BE6\u7EC6\u65E5\u5FD7\u548C\u9519\u8BEF\u5904\u7406\n   */\n  async continueLastSession(): Promise<Session | null> {\n    try {\n      const lastSessionId = this._context.globalState.get<string>(CURRENT_SESSION_KEY);\n      console.log('[SessionManager] Attempting to continue last session, ID:', lastSessionId);\n      \n      if (lastSessionId) {\n        const session = await this.loadSession(lastSessionId);\n        if (session) {\n          console.log('[SessionManager] Successfully loaded session:', session.id, 'with', session.messages.length, 'messages');\n          return session;\n        }\n        console.log('[SessionManager] Failed to load session by ID, it may have been deleted');\n      }\n      \n      // \u5982\u679C\u6CA1\u6709\u4E0A\u6B21\u4F1A\u8BDDID\u6216\u52A0\u8F7D\u5931\u8D25\uFF0C\u5C1D\u8BD5\u83B7\u53D6\u6700\u8FD1\u7684\u4F1A\u8BDD\n      const sessions = this._getAllSessions();\n      console.log('[SessionManager] Total sessions in storage:', sessions.length);\n      \n      if (sessions.length > 0) {\n        const sorted = sessions.sort((a, b) => b.updatedAt - a.updatedAt);\n        console.log('[SessionManager] Loading most recent session:', sorted[0].id);\n        return this.loadSession(sorted[0].id);\n      }\n      \n      console.log('[SessionManager] No sessions found in storage');\n      return null;\n    } catch (error) {\n      console.error('[SessionManager] Error in continueLastSession:', error);\n      return null;\n    }\n  }\n\n  /**\n   * \u4FDD\u5B58\u5F53\u524D\u4F1A\u8BDD\n   * \u2705 \u4FEE\u590D\uFF1A\u786E\u4FDD\u6BCF\u6B21\u4FDD\u5B58\u90FD\u66F4\u65B0 currentSessionId\n   * \u2705 \u4FEE\u590D\uFF1A\u8FD4\u56DE Promise \u4EE5\u786E\u4FDD\u4FDD\u5B58\u5B8C\u6210\n   */\n  async saveCurrentSession(): Promise<void> {\n    if (!this._currentSession) {\n      console.log('[SessionManager] No current session to save');\n      return;\n    }\n    \n    this._currentSession.updatedAt = Date.now();\n    \n    // \u81EA\u52A8\u751F\u6210\u6807\u9898\n    if (this._currentSession.messages.length > 0 && \n        this._currentSession.title.startsWith('\u5BF9\u8BDD ')) {\n      const firstUserMsg = this._currentSession.messages.find(m => m.role === 'user');\n      if (firstUserMsg) {\n        this._currentSession.title = truncateText(firstUserMsg.content, 30);\n      }\n    }\n    \n    const sessions = this._getAllSessions();\n    const existingIndex = sessions.findIndex(s => s.id === this._currentSession!.id);\n    \n    if (existingIndex >= 0) {\n      sessions[existingIndex] = this._currentSession;\n    } else {\n      sessions.push(this._currentSession);\n    }\n    \n    // \u9650\u5236\u4F1A\u8BDD\u6570\u91CF\n    const maxSessions = vscode.workspace.getConfiguration('aiAssistant')\n      .get<number>('sessionHistory.maxSessions', 50);\n    \n    if (sessions.length > maxSessions) {\n      sessions.sort((a, b) => b.updatedAt - a.updatedAt);\n      sessions.splice(maxSessions);\n    }\n    \n    // \u2705 \u7B49\u5F85\u4FDD\u5B58\u5B8C\u6210\uFF0C\u786E\u4FDD\u72B6\u6001\u4E00\u81F4\n    await this._context.globalState.update(SESSIONS_KEY, sessions);\n    await this._saveCurrentSessionId(this._currentSession.id);\n    \n    console.log('[SessionManager] Session saved:', this._currentSession.id, 'messages:', this._currentSession.messages.length);\n  }\n\n  /**\n   * \u6DFB\u52A0\u6D88\u606F\u5230\u5F53\u524D\u4F1A\u8BDD\n   * \u2705 \u4FEE\u590D\uFF1A\u6539\u4E3A\u5F02\u6B65\u65B9\u6CD5\u4EE5\u786E\u4FDD\u4FDD\u5B58\u5B8C\u6210\n   */\n  async addMessage(message: Message): Promise<void> {\n    if (!this._currentSession) {\n      this.createSession();\n    }\n    \n    this._currentSession!.messages.push(message);\n    \n    // \u6DFB\u52A0\u5230\u5386\u53F2\uFF08\u4EC5\u7528\u6237\u6D88\u606F\uFF09\n    if (message.role === 'user') {\n      this._messageHistory.push(message.content);\n    }\n    \n    // \u68C0\u67E5\u662F\u5426\u9700\u8981\u81EA\u52A8\u538B\u7F29\n    const compressionEnabled = vscode.workspace.getConfiguration('aiAssistant')\n      .get<boolean>('contextCompression.enabled', true);\n    const maxMessages = vscode.workspace.getConfiguration('aiAssistant')\n      .get<number>('contextCompression.maxMessages', 20);\n    \n    if (compressionEnabled && this._currentSession!.messages.length > maxMessages) {\n      // \u6807\u8BB0\u9700\u8981\u538B\u7F29\uFF0C\u4F46\u4E0D\u7ACB\u5373\u6267\u884C\uFF08\u907F\u514D\u963B\u585E\uFF09\n      vscode.commands.executeCommand('aiAssistant.compactContext');\n    }\n    \n    await this.saveCurrentSession();\n  }\n\n  /**\n   * \u66F4\u65B0\u6700\u540E\u4E00\u6761\u6D88\u606F\uFF08\u7528\u4E8E\u6D41\u5F0F\u54CD\u5E94\uFF09\n   * \u2705 \u4FEE\u590D\uFF1A\u6539\u4E3A\u5F02\u6B65\u65B9\u6CD5\uFF0C\u786E\u4FDD\u4FDD\u5B58\u5B8C\u6210\n   */\n  async updateLastMessage(content: string, isComplete: boolean = false, forceSave: boolean = false): Promise<void> {\n    if (!this._currentSession || this._currentSession.messages.length === 0) return;\n    \n    const lastMsg = this._currentSession.messages[this._currentSession.messages.length - 1];\n    lastMsg.content = content;\n    lastMsg.isStreaming = !isComplete;\n    \n    // \u2705 \u4FEE\u590D\uFF1A\u7B49\u5F85\u4FDD\u5B58\u5B8C\u6210\uFF0C\u786E\u4FDD\u6570\u636E\u4E00\u81F4\u6027\n    if (isComplete || forceSave) {\n      await this.saveCurrentSession();\n    }\n  }\n\n  /**\n   * \u538B\u7F29\u4E0A\u4E0B\u6587\n   * \u5C06\u5386\u53F2\u6D88\u606F\u538B\u7F29\u4E3A\u6458\u8981\uFF0C\u53EA\u4FDD\u7559\u6700\u8FD1\u51E0\u6761\n   */\n  async compactContext(generateSummary: (messages: Message[]) => Promise<string>): Promise<{\n    originalCount: number;\n    compressedCount: number;\n    savedTokens: number;\n  }> {\n    if (!this._currentSession) {\n      return { originalCount: 0, compressedCount: 0, savedTokens: 0 };\n    }\n    \n    const keepRecent = vscode.workspace.getConfiguration('aiAssistant')\n      .get<number>('contextCompression.keepRecent', 4);\n    \n    const messages = this._currentSession.messages;\n    const originalCount = messages.length;\n    \n    if (originalCount <= keepRecent) {\n      return { originalCount, compressedCount: originalCount, savedTokens: 0 };\n    }\n    \n    // \u8BA1\u7B97\u539F\u59CB token \u6570\n    const originalTokens = messages.reduce((sum, m) => sum + estimateTokens(m.content), 0);\n    \n    // \u5206\u79BB\u8981\u538B\u7F29\u7684\u6D88\u606F\u548C\u8981\u4FDD\u7559\u7684\u6D88\u606F\n    const toCompress = messages.slice(0, -keepRecent);\n    const toKeep = messages.slice(-keepRecent);\n    \n    // \u751F\u6210\u6458\u8981\n    const summary = await generateSummary(toCompress);\n    \n    // \u521B\u5EFA\u6458\u8981\u6D88\u606F\n    const summaryMessage: Message = {\n      id: generateId(),\n      role: 'system',\n      content: `[\u5BF9\u8BDD\u6458\u8981]\\n${summary}\\n\\n---\\n\u4EE5\u4E0A\u662F\u4E4B\u524D\u5BF9\u8BDD\u7684\u6458\u8981\uFF0C\u8BF7\u57FA\u4E8E\u6B64\u7EE7\u7EED\u5BF9\u8BDD\u3002`,\n      timestamp: Date.now(),\n    };\n    \n    // \u66F4\u65B0\u4F1A\u8BDD\n    this._currentSession.messages = [summaryMessage, ...toKeep];\n    this._currentSession.metadata = {\n      ...this._currentSession.metadata,\n      summary,\n    };\n    \n    // \u8BA1\u7B97\u538B\u7F29\u540E token \u6570\n    const compressedTokens = this._currentSession.messages\n      .reduce((sum, m) => sum + estimateTokens(m.content), 0);\n    \n    this.saveCurrentSession();\n    \n    return {\n      originalCount,\n      compressedCount: this._currentSession.messages.length,\n      savedTokens: originalTokens - compressedTokens,\n    };\n  }\n\n  /**\n   * \u6E05\u9664\u5F53\u524D\u4F1A\u8BDD\u6D88\u606F\n   */\n  clearCurrentSession(): void {\n    if (this._currentSession) {\n      this._currentSession.messages = [];\n      this._currentSession.updatedAt = Date.now();\n      this.saveCurrentSession();\n    }\n  }\n\n  /**\n   * \u5220\u9664\u4F1A\u8BDD\n   */\n  deleteSession(sessionId: string): void {\n    const sessions = this._getAllSessions();\n    const filtered = sessions.filter(s => s.id !== sessionId);\n    this._context.globalState.update(SESSIONS_KEY, filtered);\n    \n    if (this._currentSession?.id === sessionId) {\n      this._currentSession = null;\n    }\n  }\n\n  /**\n   * \u91CD\u547D\u540D\u4F1A\u8BDD\n   */\n  renameSession(sessionId: string, newTitle: string): boolean {\n    const sessions = this._getAllSessions();\n    const session = sessions.find(s => s.id === sessionId);\n    \n    if (session) {\n      session.title = newTitle;\n      session.updatedAt = Date.now();\n      this._context.globalState.update(SESSIONS_KEY, sessions);\n      \n      // \u5982\u679C\u662F\u5F53\u524D\u4F1A\u8BDD\uFF0C\u4E5F\u66F4\u65B0\u5F53\u524D\u4F1A\u8BDD\u5BF9\u8C61\n      if (this._currentSession?.id === sessionId) {\n        this._currentSession.title = newTitle;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * \u83B7\u53D6\u6240\u6709\u4F1A\u8BDD\u6458\u8981\u5217\u8868\n   */\n  getSessionList(): SessionSummary[] {\n    const sessions = this._getAllSessions();\n    return sessions\n      .sort((a, b) => b.updatedAt - a.updatedAt)\n      .map(s => ({\n        id: s.id,\n        title: s.title,\n        preview: this._getSessionPreview(s),\n        messageCount: s.messages.length,\n        createdAt: s.createdAt,\n        updatedAt: s.updatedAt,\n      }));\n  }\n\n  /**\n   * \u83B7\u53D6\u6D88\u606F\u5386\u53F2\uFF08\u7528\u4E8E\u2191\u2193\u952E\uFF09\n   */\n  getMessageHistory(): string[] {\n    return [...this._messageHistory];\n  }\n\n  /**\n   * \u83B7\u53D6\u5F53\u524D\u4F1A\u8BDD\u7684\u6D88\u606F\u5217\u8868\n   */\n  getMessages(): Message[] {\n    return this._currentSession?.messages || [];\n  }\n\n  /**\n   * \u79FB\u9664\u6700\u540E\u4E00\u6761\u6D88\u606F\n   */\n  removeLastMessage(): Message | null {\n    if (!this._currentSession || this._currentSession.messages.length === 0) {\n      return null;\n    }\n    \n    const removedMessage = this._currentSession.messages.pop() || null;\n    this.saveCurrentSession();\n    return removedMessage;\n  }\n\n  /**\n   * \u901A\u8FC7ID\u79FB\u9664\u6D88\u606F\n   */\n  removeMessageById(messageId: string): Message | null {\n    if (!this._currentSession) {\n      return null;\n    }\n    \n    const index = this._currentSession.messages.findIndex(m => m.id === messageId);\n    if (index === -1) {\n      return null;\n    }\n    \n    const [removedMessage] = this._currentSession.messages.splice(index, 1);\n    \n    // \u5982\u679C\u662F\u7528\u6237\u6D88\u606F\uFF0C\u4E5F\u4ECE\u5386\u53F2\u4E2D\u79FB\u9664\n    if (removedMessage.role === 'user') {\n      const historyIndex = this._messageHistory.findIndex(h => h === removedMessage.content);\n      if (historyIndex !== -1) {\n        this._messageHistory.splice(historyIndex, 1);\n      }\n    }\n    \n    this.saveCurrentSession();\n    return removedMessage;\n  }\n\n  /**\n   * \u83B7\u53D6\u6240\u6709\u4F1A\u8BDD\uFF08\u5B8C\u6574\u5BF9\u8C61\uFF09\n   */\n  getAllSessions(): Session[] {\n    return this._getAllSessions();\n  }\n\n  /**\n   * \u6839\u636EID\u83B7\u53D6\u4F1A\u8BDD\uFF08\u4E0D\u52A0\u8F7D\u4E3A\u5F53\u524D\u4F1A\u8BDD\uFF09\n   */\n  getSessionById(sessionId: string): Session | null {\n    const sessions = this._getAllSessions();\n    return sessions.find(s => s.id === sessionId) || null;\n  }\n\n  /**\n   * \u6E05\u7406\u65E7\u4F1A\u8BDD\n   */\n  cleanupOldSessions(maxAge: number = 30 * 24 * 60 * 60 * 1000): number {\n    const sessions = this._getAllSessions();\n    const cutoff = Date.now() - maxAge;\n    const filtered = sessions.filter(s => s.updatedAt > cutoff);\n    const removed = sessions.length - filtered.length;\n    \n    if (removed > 0) {\n      this._context.globalState.update(SESSIONS_KEY, filtered);\n    }\n    \n    return removed;\n  }\n\n  // ============================================\n  // \u79C1\u6709\u65B9\u6CD5\n  // ============================================\n\n  private _getAllSessions(): Session[] {\n    return this._context.globalState.get<Session[]>(SESSIONS_KEY, []);\n  }\n\n  private async _saveCurrentSessionId(sessionId: string): Promise<void> {\n    await this._context.globalState.update(CURRENT_SESSION_KEY, sessionId);\n  }\n\n  private _getSessionPreview(session: Session): string {\n    const lastUserMsg = [...session.messages]\n      .reverse()\n      .find(m => m.role === 'user');\n    \n    if (lastUserMsg) {\n      return truncateText(lastUserMsg.content, 50);\n    }\n    return '\u7A7A\u5BF9\u8BDD';\n  }\n}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport { SLASH_COMMANDS, SlashCommand } from '../../types/shared';\n\n/**\n * \u547D\u4EE4\u89E3\u6790\u7ED3\u679C\n */\nexport interface ParsedCommand {\n  command: string;\n  args: string[];\n  raw: string;\n  isValid: boolean;\n  error?: string;\n}\n\n/**\n * \u547D\u4EE4\u89E3\u6790\u5668\n * \u89E3\u6790\u7528\u6237\u8F93\u5165\u7684\u659C\u6760\u547D\u4EE4\n */\nexport class CommandParser {\n  /**\n   * \u89E3\u6790\u8F93\u5165\n   */\n  parse(input: string): ParsedCommand | null {\n    const trimmed = input.trim();\n    \n    // \u68C0\u67E5\u662F\u5426\u662F\u547D\u4EE4\n    if (!trimmed.startsWith('/') && !trimmed.startsWith('!')) {\n      return null;\n    }\n    \n    // \u5904\u7406 ! \u5F00\u5934\u7684\u547D\u4EE4\uFF08\u7B49\u540C\u4E8E /run\uFF09\n    if (trimmed.startsWith('!')) {\n      const command = trimmed.substring(1).trim();\n      return {\n        command: 'run',\n        args: [command],\n        raw: trimmed,\n        isValid: command.length > 0,\n        error: command.length === 0 ? '\u8BF7\u6307\u5B9A\u8981\u6267\u884C\u7684\u547D\u4EE4' : undefined,\n      };\n    }\n    \n    // \u89E3\u6790 / \u547D\u4EE4\n    const parts = trimmed.substring(1).split(/\\s+/);\n    const commandName = parts[0].toLowerCase();\n    const args = parts.slice(1);\n    \n    // \u67E5\u627E\u547D\u4EE4\u5B9A\u4E49\n    const commandDef = this._findCommand(commandName);\n    \n    if (!commandDef) {\n      return {\n        command: commandName,\n        args,\n        raw: trimmed,\n        isValid: false,\n        error: `\u672A\u77E5\u547D\u4EE4: /${commandName}\uFF0C\u8F93\u5165 /help \u67E5\u770B\u5E2E\u52A9`,\n      };\n    }\n    \n    // \u9A8C\u8BC1\u53C2\u6570\n    const validation = this._validateArgs(commandDef, args);\n    \n    return {\n      command: commandDef.name,\n      args,\n      raw: trimmed,\n      isValid: validation.valid,\n      error: validation.error,\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u547D\u4EE4\u8865\u5168\u5EFA\u8BAE\n   */\n  getSuggestions(input: string): SlashCommand[] {\n    if (!input.startsWith('/')) {\n      return SLASH_COMMANDS;\n    }\n    \n    const partial = input.substring(1).toLowerCase();\n    \n    return SLASH_COMMANDS.filter(cmd => {\n      return cmd.name.startsWith(partial) ||\n        cmd.aliases?.some(a => a.startsWith(partial));\n    });\n  }\n\n  /**\n   * \u83B7\u53D6\u547D\u4EE4\u5E2E\u52A9\n   */\n  getHelp(commandName?: string): string {\n    if (commandName) {\n      const cmd = this._findCommand(commandName);\n      if (cmd) {\n        return this._formatCommandHelp(cmd);\n      }\n      return `\u672A\u77E5\u547D\u4EE4: ${commandName}`;\n    }\n    \n    // \u8FD4\u56DE\u6240\u6709\u547D\u4EE4\u5E2E\u52A9\n    let help = '\uD83D\uDCDA **\u53EF\u7528\u547D\u4EE4**\\n\\n';\n    \n    const categories = {\n      session: ['clear', 'compact', 'resume'],\n      project: ['init', 'file', 'search', 'run', 'build', 'test', 'git'],\n      generate: ['diagram', 'gentest'],\n      other: ['help'],\n    };\n    \n    help += '**\u4F1A\u8BDD\u7BA1\u7406**\\n';\n    categories.session.forEach(name => {\n      const cmd = SLASH_COMMANDS.find(c => c.name === name);\n      if (cmd) help += `  \\`${cmd.usage}\\` - ${cmd.description}\\n`;\n    });\n    \n    help += '\\n**\u9879\u76EE\u64CD\u4F5C**\\n';\n    categories.project.forEach(name => {\n      const cmd = SLASH_COMMANDS.find(c => c.name === name);\n      if (cmd) help += `  \\`${cmd.usage}\\` - ${cmd.description}\\n`;\n    });\n    \n    help += '\\n**\u751F\u6210\u529F\u80FD**\\n';\n    categories.generate.forEach(name => {\n      const cmd = SLASH_COMMANDS.find(c => c.name === name);\n      if (cmd) help += `  \\`${cmd.usage}\\` - ${cmd.description}\\n`;\n    });\n    \n    help += '\\n**\u5FEB\u6377\u952E**\\n';\n    help += '  `\u2191` / `\u2193` - \u7FFB\u9605\u5386\u53F2\u6D88\u606F\\n';\n    help += '  `Tab` - \u547D\u4EE4/\u8DEF\u5F84\u8865\u5168\\n';\n    help += '  `Alt+Enter` - \u8F93\u5165\u6362\u884C\\n';\n    help += '  `ESC` - \u505C\u6B62\u5F53\u524D\u4EFB\u52A1\\n';\n    help += '  `Ctrl+C` - \u53D6\u6D88\u8F93\u5165\\n';\n    \n    return help;\n  }\n\n  /**\n   * \u8DEF\u5F84\u8865\u5168\n   */\n  async getPathCompletions(partial: string): Promise<string[]> {\n    const workspaceFolder = vscode.workspace.workspaceFolders?.[0];\n    if (!workspaceFolder) return [];\n    \n    try {\n      const basePath = path.dirname(partial) || '.';\n      const prefix = path.basename(partial);\n      \n      const fullBasePath = path.isAbsolute(basePath)\n        ? basePath\n        : path.join(workspaceFolder.uri.fsPath, basePath);\n      \n      const entries = await vscode.workspace.fs.readDirectory(\n        vscode.Uri.file(fullBasePath)\n      );\n      \n      return entries\n        .filter(([name]) => name.startsWith(prefix))\n        .map(([name, type]) => {\n          const fullPath = path.join(basePath, name);\n          return type === vscode.FileType.Directory ? fullPath + '/' : fullPath;\n        })\n        .slice(0, 10); // \u9650\u5236\u6570\u91CF\n    } catch {\n      return [];\n    }\n  }\n\n  // ============================================\n  // \u79C1\u6709\u65B9\u6CD5\n  // ============================================\n\n  private _findCommand(nameOrAlias: string): SlashCommand | undefined {\n    return SLASH_COMMANDS.find(cmd =>\n      cmd.name === nameOrAlias ||\n      cmd.aliases?.includes(nameOrAlias)\n    );\n  }\n\n  private _validateArgs(\n    cmd: SlashCommand,\n    args: string[]\n  ): { valid: boolean; error?: string } {\n    if (!cmd.args) {\n      return { valid: true };\n    }\n    \n    const requiredArgs = cmd.args.filter(a => a.required);\n    \n    if (args.length < requiredArgs.length) {\n      const missing = requiredArgs[args.length];\n      return {\n        valid: false,\n        error: `\u7F3A\u5C11\u53C2\u6570: ${missing.name} - ${missing.description}`,\n      };\n    }\n    \n    return { valid: true };\n  }\n\n  private _formatCommandHelp(cmd: SlashCommand): string {\n    let help = `**/${cmd.name}** - ${cmd.description}\\n\\n`;\n    help += `\u7528\u6CD5: \\`${cmd.usage}\\`\\n`;\n    \n    if (cmd.aliases?.length) {\n      help += `\u522B\u540D: ${cmd.aliases.map(a => `\\`/${a}\\``).join(', ')}\\n`;\n    }\n    \n    if (cmd.args?.length) {\n      help += '\\n\u53C2\u6570:\\n';\n      cmd.args.forEach(arg => {\n        const required = arg.required ? '(\u5FC5\u9700)' : '(\u53EF\u9009)';\n        help += `  - \\`${arg.name}\\` ${required}: ${arg.description}\\n`;\n      });\n    }\n    \n    return help;\n  }\n}\n\n/**\n * \u8DEF\u5F84\u8865\u5168\u5668\n */\nexport class PathCompleter {\n  private _lastInput: string = '';\n  private _completions: string[] = [];\n  private _currentIndex: number = 0;\n\n  /**\n   * \u83B7\u53D6\u4E0B\u4E00\u4E2A\u8865\u5168\n   */\n  async getNextCompletion(input: string, parser: CommandParser): Promise<string | null> {\n    // \u5982\u679C\u8F93\u5165\u6539\u53D8\uFF0C\u91CD\u65B0\u83B7\u53D6\u8865\u5168\u5217\u8868\n    if (input !== this._lastInput) {\n      this._lastInput = input;\n      this._completions = await parser.getPathCompletions(input);\n      this._currentIndex = 0;\n    }\n    \n    if (this._completions.length === 0) {\n      return null;\n    }\n    \n    const completion = this._completions[this._currentIndex];\n    this._currentIndex = (this._currentIndex + 1) % this._completions.length;\n    \n    return completion;\n  }\n\n  /**\n   * \u91CD\u7F6E\u72B6\u6001\n   */\n  reset(): void {\n    this._lastInput = '';\n    this._completions = [];\n    this._currentIndex = 0;\n  }\n}\n", "import * as vscode from 'vscode';\nimport {\n  Diagram,\n  DiagramType,\n  DiagramFormat,\n  DIAGRAM_TEMPLATES,\n  generateId,\n} from '../../types/shared';\n\nconst DIAGRAMS_KEY = 'aiAssistant.diagrams';\n\n/**\n * \u6D41\u7A0B\u56FE\u751F\u6210\u5668\n * \u652F\u6301 AI \u751F\u6210\u548C\u624B\u52A8\u7F16\u8F91\n */\nexport class DiagramGenerator {\n  private _context: vscode.ExtensionContext;\n\n  constructor(context: vscode.ExtensionContext) {\n    this._context = context;\n  }\n\n  /**\n   * \u751F\u6210 AI \u63D0\u793A\u8BCD\n   */\n  generatePrompt(type: DiagramType, description?: string, code?: string): string {\n    const format = this._getDefaultFormat();\n    \n    let prompt = `\u8BF7\u751F\u6210\u4E00\u4E2A ${this._getTypeDisplayName(type)} (${format} \u683C\u5F0F)\u3002\\n\\n`;\n    \n    if (description) {\n      prompt += `\u9700\u6C42\u63CF\u8FF0\uFF1A${description}\\n\\n`;\n    }\n    \n    if (code) {\n      prompt += `\u57FA\u4E8E\u4EE5\u4E0B\u4EE3\u7801\uFF1A\\n\\`\\`\\`\\n${code}\\n\\`\\`\\`\\n\\n`;\n    }\n    \n    // \u6DFB\u52A0\u7C7B\u578B\u7279\u5B9A\u7684\u8BED\u6CD5\u6307\u5357\n    const syntaxGuide = this._getSyntaxGuide(type);\n    \n    prompt += `\u8BF7\u6CE8\u610F\uFF1A\n1. \u53EA\u8FD4\u56DE ${format} \u4EE3\u7801\uFF0C\u4E0D\u8981\u6DFB\u52A0\u989D\u5916\u89E3\u91CA\n2. \u4EE3\u7801\u9700\u8981\u7528 \\`\\`\\`${format} \u548C \\`\\`\\` \u5305\u88F9\n3. \u786E\u4FDD\u8BED\u6CD5\u6B63\u786E\uFF0C\u53EF\u4EE5\u76F4\u63A5\u6E32\u67D3\n4. \u4F7F\u7528\u4E2D\u6587\u6807\u7B7E\n5. \u4E25\u683C\u9075\u5FAA Mermaid \u5B98\u65B9\u8BED\u6CD5\n\n${syntaxGuide}\n\n\u53C2\u8003\u6A21\u677F\uFF1A\n\\`\\`\\`${format}\n${DIAGRAM_TEMPLATES[type]}\n\\`\\`\\`\n\n\uD83D\uDCDA \u5B98\u65B9\u8BED\u6CD5\u53C2\u8003\uFF1Ahttps://mermaid.js.org/syntax/${this._getSyntaxDocPath(type)}.html`;\n    \n    return prompt;\n  }\n\n  /**\n   * \u83B7\u53D6\u7C7B\u578B\u7279\u5B9A\u7684\u8BED\u6CD5\u6307\u5357\n   */\n  private _getSyntaxGuide(type: DiagramType): string {\n    const guides: Record<DiagramType, string> = {\n      flowchart: `Mermaid \u6D41\u7A0B\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 flowchart TB/LR/BT/RL \u58F0\u660E\u65B9\u5411\n- \u8282\u70B9\u5B9A\u4E49\uFF1AA[\u65B9\u5F62] B(\u5706\u89D2) C{\u83F1\u5F62} D((\u5706\u5F62)) E([\u4F53\u80B2\u573A\u5F62])\n- \u8FDE\u63A5\u7EBF\uFF1AA --> B (\u7BAD\u5934) A --- B (\u5B9E\u7EBF) A -.-> B (\u865A\u7EBF) A ==> B (\u7C97\u7EBF)\n- \u5B50\u56FE\uFF1Asubgraph \u540D\u79F0 ... end\n- \u6CE8\u610F\uFF1A\u8282\u70B9\u6587\u672C\u4E2D\u4E0D\u8981\u6709\u7279\u6B8A\u5B57\u7B26 [ ] { } ( ) < >`,\n      sequence: `Mermaid \u65F6\u5E8F\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 sequenceDiagram \u58F0\u660E\n- \u53C2\u4E0E\u8005\uFF1Aparticipant A as \u522B\u540D\n- \u6D88\u606F\uFF1AA->>B: \u6D88\u606F\u6587\u672C (\u5B9E\u7EBF\u7BAD\u5934) A-->>B: (\u865A\u7EBF\u7BAD\u5934)\n- \u6FC0\u6D3B\uFF1Aactivate A / deactivate A \u6216 A->>+B / A->>-B\n- \u5FAA\u73AF/\u6761\u4EF6\uFF1Aloop/alt/opt ... end\n- \u6CE8\u610F\uFF1A\u6D88\u606F\u6587\u672C\u4E0D\u8981\u6709\u7279\u6B8A\u5B57\u7B26`,\n      class: `Mermaid \u7C7B\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 classDiagram \u58F0\u660E\n- \u7C7B\u5B9A\u4E49\uFF1Aclass ClassName { +method() -field }\n- \u5173\u7CFB\uFF1AA <|-- B (\u7EE7\u627F) A *-- B (\u7EC4\u5408) A o-- B (\u805A\u5408)\n- \u6CE8\u610F\uFF1A\u65B9\u6CD5\u548C\u5C5E\u6027\u524D\u7528 + - # \u8868\u793A\u8BBF\u95EE\u7EA7\u522B`,\n      state: `Mermaid \u72B6\u6001\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 stateDiagram-v2 \u58F0\u660E\n- \u72B6\u6001\uFF1Astate \"\u63CF\u8FF0\" as s1\n- \u8F6C\u6362\uFF1As1 --> s2 : \u4E8B\u4EF6\n- \u7279\u6B8A\u72B6\u6001\uFF1A[*] --> s1 (\u5F00\u59CB) s1 --> [*] (\u7ED3\u675F)`,\n      er: `Mermaid ER\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 erDiagram \u58F0\u660E\n- \u5173\u7CFB\uFF1AA ||--o{ B : \"\u5173\u7CFB\"\n- \u57FA\u6570\uFF1A|o (\u96F6\u6216\u4E00) || (\u6070\u597D\u4E00) }o (\u96F6\u6216\u591A) }| (\u4E00\u6216\u591A)`,\n      gantt: `Mermaid \u7518\u7279\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 gantt \u58F0\u660E\n- \u5FC5\u987B\u6709 title \u548C dateFormat\n- \u4EFB\u52A1\uFF1A\u4EFB\u52A1\u540D :\u6807\u8BC6, \u5F00\u59CB\u65E5\u671F, \u6301\u7EED\u65F6\u95F4\n- section \u5206\u7EC4\u4EFB\u52A1`,\n      pie: `Mermaid \u997C\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 pie \u6216 pie showData \u58F0\u660E\n- \u53EF\u9009 title \u6807\u9898\n- \u6570\u636E\uFF1A\"\u6807\u7B7E\" : \u6570\u503C`,\n      mindmap: `Mermaid \u601D\u7EF4\u5BFC\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u4F7F\u7528 mindmap \u58F0\u660E\n- \u7F29\u8FDB\u8868\u793A\u5C42\u7EA7\n- \u6839\u8282\u70B9\u65E0\u7F29\u8FDB\uFF0C\u5B50\u8282\u70B9\u7528\u7A7A\u683C\u7F29\u8FDB`,\n      architecture: `Mermaid \u67B6\u6784\u56FE\u8BED\u6CD5\u8981\u70B9\uFF1A\n- \u63A8\u8350\u4F7F\u7528 flowchart TB \u914D\u5408 subgraph\n- \u4F7F\u7528\u591A\u4E2A subgraph \u5206\u5C42\u8868\u793A\u67B6\u6784\n- \u7528\u4E0D\u540C\u5F62\u72B6\u8282\u70B9\u533A\u5206\u7C7B\u578B`,\n    };\n    return guides[type] || '';\n  }\n\n  /**\n   * \u83B7\u53D6\u8BED\u6CD5\u6587\u6863\u8DEF\u5F84\n   */\n  private _getSyntaxDocPath(type: DiagramType): string {\n    const paths: Record<DiagramType, string> = {\n      flowchart: 'flowchart',\n      sequence: 'sequenceDiagram',\n      class: 'classDiagram',\n      state: 'stateDiagram',\n      er: 'entityRelationshipDiagram',\n      gantt: 'gantt',\n      pie: 'pie',\n      mindmap: 'mindmap',\n      architecture: 'flowchart',\n    };\n    return paths[type] || 'flowchart';\n  }\n\n  /**\n   * \u4ECE AI \u54CD\u5E94\u4E2D\u63D0\u53D6\u56FE\u8868\u4EE3\u7801\n   */\n  extractDiagramCode(response: string): string | null {\n    const format = this._getDefaultFormat();\n    \n    // \u5C1D\u8BD5\u5339\u914D\u4EE3\u7801\u5757\n    const patterns = [\n      new RegExp(`\\`\\`\\`${format}\\\\s*([\\\\s\\\\S]*?)\\`\\`\\``, 'i'),\n      new RegExp(`\\`\\`\\`mermaid\\\\s*([\\\\s\\\\S]*?)\\`\\`\\``, 'i'),\n      new RegExp(`\\`\\`\\`\\\\s*([\\\\s\\\\S]*?)\\`\\`\\``, 'i'),\n    ];\n    \n    for (const pattern of patterns) {\n      const match = response.match(pattern);\n      if (match && match[1]) {\n        return match[1].trim();\n      }\n    }\n    \n    // \u5982\u679C\u6CA1\u6709\u4EE3\u7801\u5757\uFF0C\u68C0\u67E5\u6574\u4E2A\u54CD\u5E94\u662F\u5426\u50CF\u662F\u56FE\u8868\u4EE3\u7801\n    if (this._looksLikeDiagramCode(response)) {\n      return response.trim();\n    }\n    \n    return null;\n  }\n\n  /**\n   * \u521B\u5EFA\u56FE\u8868\u5BF9\u8C61\n   */\n  createDiagram(\n    type: DiagramType,\n    code: string,\n    title?: string,\n    sessionId?: string\n  ): Diagram {\n    const diagram: Diagram = {\n      id: generateId(),\n      title: title || `${this._getTypeDisplayName(type)} - ${new Date().toLocaleString('zh-CN')}`,\n      type,\n      format: this._getDefaultFormat(),\n      code,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n      sessionId,\n    };\n    \n    this._saveDiagram(diagram);\n    return diagram;\n  }\n\n  /**\n   * \u66F4\u65B0\u56FE\u8868\n   */\n  updateDiagram(diagramId: string, code: string): Diagram | null {\n    const diagrams = this._getAllDiagrams();\n    const index = diagrams.findIndex(d => d.id === diagramId);\n    \n    if (index === -1) return null;\n    \n    diagrams[index].code = code;\n    diagrams[index].updatedAt = Date.now();\n    \n    this._context.globalState.update(DIAGRAMS_KEY, diagrams);\n    return diagrams[index];\n  }\n\n  /**\n   * \u83B7\u53D6\u56FE\u8868\n   */\n  getDiagram(diagramId: string): Diagram | null {\n    const diagrams = this._getAllDiagrams();\n    return diagrams.find(d => d.id === diagramId) || null;\n  }\n\n  /**\n   * \u83B7\u53D6\u6240\u6709\u56FE\u8868\n   */\n  getAllDiagrams(): Diagram[] {\n    return this._getAllDiagrams()\n      .sort((a, b) => b.updatedAt - a.updatedAt);\n  }\n\n  /**\n   * \u5220\u9664\u56FE\u8868\n   */\n  deleteDiagram(diagramId: string): boolean {\n    const diagrams = this._getAllDiagrams();\n    const filtered = diagrams.filter(d => d.id !== diagramId);\n    \n    if (filtered.length === diagrams.length) return false;\n    \n    this._context.globalState.update(DIAGRAMS_KEY, filtered);\n    return true;\n  }\n\n  /**\n   * \u91CD\u547D\u540D\u56FE\u8868\n   */\n  renameDiagram(diagramId: string, newTitle: string): boolean {\n    const diagrams = this._getAllDiagrams();\n    const index = diagrams.findIndex(d => d.id === diagramId);\n    \n    if (index === -1) return false;\n    \n    diagrams[index].title = newTitle;\n    diagrams[index].updatedAt = Date.now();\n    \n    this._context.globalState.update(DIAGRAMS_KEY, diagrams);\n    return true;\n  }\n\n  /**\n   * \u5BFC\u51FA\u56FE\u8868\n   */\n  async exportDiagram(\n    diagram: Diagram,\n    format: 'svg' | 'png' | 'md' | 'html'\n  ): Promise<string> {\n    switch (format) {\n      case 'md':\n        return this._exportAsMarkdown(diagram);\n      case 'html':\n        return this._exportAsHtml(diagram);\n      case 'svg':\n      case 'png':\n        // SVG/PNG \u9700\u8981\u5728\u524D\u7AEF\u6E32\u67D3\u540E\u5BFC\u51FA\n        throw new Error(`${format.toUpperCase()} \u5BFC\u51FA\u9700\u8981\u5728\u524D\u7AEF\u5B8C\u6210`);\n      default:\n        throw new Error(`\u4E0D\u652F\u6301\u7684\u5BFC\u51FA\u683C\u5F0F: ${format}`);\n    }\n  }\n\n  /**\n   * \u9A8C\u8BC1\u56FE\u8868\u4EE3\u7801\n   */\n  validateCode(code: string): { valid: boolean; error?: string } {\n    if (!code || code.trim().length === 0) {\n      return { valid: false, error: '\u4EE3\u7801\u4E0D\u80FD\u4E3A\u7A7A' };\n    }\n    \n    // \u57FA\u672C\u8BED\u6CD5\u68C0\u67E5\n    const trimmed = code.trim();\n    \n    // \u68C0\u67E5\u662F\u5426\u6709\u6709\u6548\u7684\u56FE\u8868\u7C7B\u578B\u58F0\u660E\n    const validStarts = [\n      'flowchart', 'graph', 'sequenceDiagram', 'classDiagram',\n      'stateDiagram', 'erDiagram', 'gantt', 'pie', 'mindmap',\n      'journey', 'gitGraph', 'C4Context', 'timeline',\n    ];\n    \n    const firstWord = trimmed.split(/\\s+/)[0].toLowerCase();\n    if (!validStarts.some(s => firstWord.startsWith(s.toLowerCase()))) {\n      return {\n        valid: false,\n        error: `\u65E0\u6548\u7684\u56FE\u8868\u7C7B\u578B\u3002\u652F\u6301\u7684\u7C7B\u578B: ${validStarts.join(', ')}`,\n      };\n    }\n    \n    // \u68C0\u67E5\u62EC\u53F7\u5339\u914D\n    const brackets = { '(': 0, '[': 0, '{': 0 };\n    for (const char of trimmed) {\n      if (char === '(') brackets['(']++;\n      if (char === ')') brackets['(']--;\n      if (char === '[') brackets['[']++;\n      if (char === ']') brackets['[']--;\n      if (char === '{') brackets['{']++;\n      if (char === '}') brackets['{']--;\n    }\n    \n    if (brackets['('] !== 0 || brackets['['] !== 0 || brackets['{'] !== 0) {\n      return { valid: false, error: '\u62EC\u53F7\u4E0D\u5339\u914D' };\n    }\n    \n    return { valid: true };\n  }\n\n  /**\n   * \u83B7\u53D6\u56FE\u8868\u6A21\u677F\n   */\n  getTemplate(type: DiagramType): string {\n    return DIAGRAM_TEMPLATES[type] || DIAGRAM_TEMPLATES.flowchart;\n  }\n\n  /**\n   * \u751F\u6210\u9879\u76EE\u67B6\u6784\u56FE\u63D0\u793A\u8BCD\n   */\n  generateArchitecturePrompt(projectInfo: {\n    name: string;\n    type: string;\n    structure: string;\n    dependencies?: string[];\n  }): string {\n    let prompt = `\u8BF7\u6839\u636E\u4EE5\u4E0B\u9879\u76EE\u4FE1\u606F\u751F\u6210\u67B6\u6784\u56FE (Mermaid \u683C\u5F0F)\uFF1A\n\n\u9879\u76EE\u540D\u79F0\uFF1A${projectInfo.name}\n\u9879\u76EE\u7C7B\u578B\uFF1A${projectInfo.type}\n\n\u9879\u76EE\u7ED3\u6784\uFF1A\n\\`\\`\\`\n${projectInfo.structure}\n\\`\\`\\`\n`;\n    \n    if (projectInfo.dependencies?.length) {\n      prompt += `\\n\u4E3B\u8981\u4F9D\u8D56\uFF1A${projectInfo.dependencies.join(', ')}\\n`;\n    }\n    \n    prompt += `\n\u8BF7\u751F\u6210\u4E00\u4E2A\u6E05\u6670\u7684\u67B6\u6784\u56FE\uFF0C\u5305\u542B\uFF1A\n1. \u4E3B\u8981\u6A21\u5757/\u7EC4\u4EF6\n2. \u6A21\u5757\u95F4\u7684\u4F9D\u8D56\u5173\u7CFB\n3. \u6570\u636E\u6D41\u5411\n4. \u4F7F\u7528\u4E2D\u6587\u6807\u7B7E\n\n\u4F7F\u7528 subgraph \u5206\u7EC4\u76F8\u5173\u7EC4\u4EF6\uFF0C\u7BAD\u5934\u8868\u793A\u4F9D\u8D56/\u6570\u636E\u6D41\u5411\u3002\n\u53EA\u8FD4\u56DE Mermaid \u4EE3\u7801\uFF0C\u7528 \\`\\`\\`mermaid \u548C \\`\\`\\` \u5305\u88F9\u3002`;\n    \n    return prompt;\n  }\n\n  /**\n   * \u4ECE\u4EE3\u7801\u751F\u6210\u6D41\u7A0B\u56FE\u63D0\u793A\u8BCD\n   */\n  generateFlowchartFromCodePrompt(code: string, language: string): string {\n    return `\u8BF7\u5206\u6790\u4EE5\u4E0B ${language} \u4EE3\u7801\uFF0C\u751F\u6210\u5BF9\u5E94\u7684\u6D41\u7A0B\u56FE (Mermaid \u683C\u5F0F)\uFF1A\n\n\\`\\`\\`${language}\n${code}\n\\`\\`\\`\n\n\u8981\u6C42\uFF1A\n1. \u5C55\u793A\u4EE3\u7801\u7684\u6267\u884C\u6D41\u7A0B\n2. \u5305\u542B\u6761\u4EF6\u5224\u65AD\u3001\u5FAA\u73AF\u7B49\u63A7\u5236\u6D41\n3. \u4F7F\u7528\u4E2D\u6587\u6807\u7B7E\n4. \u53EA\u8FD4\u56DE Mermaid \u4EE3\u7801\uFF0C\u7528 \\`\\`\\`mermaid \u548C \\`\\`\\` \u5305\u88F9`;\n  }\n\n  // ============================================\n  // \u79C1\u6709\u65B9\u6CD5\n  // ============================================\n\n  private _getDefaultFormat(): DiagramFormat {\n    return vscode.workspace.getConfiguration('aiAssistant')\n      .get<DiagramFormat>('diagram.defaultFormat', 'mermaid');\n  }\n\n  private _getTypeDisplayName(type: DiagramType): string {\n    const names: Record<DiagramType, string> = {\n      flowchart: '\u6D41\u7A0B\u56FE',\n      sequence: '\u65F6\u5E8F\u56FE',\n      class: '\u7C7B\u56FE',\n      state: '\u72B6\u6001\u56FE',\n      er: 'ER\u56FE',\n      gantt: '\u7518\u7279\u56FE',\n      pie: '\u997C\u56FE',\n      mindmap: '\u601D\u7EF4\u5BFC\u56FE',\n      architecture: '\u67B6\u6784\u56FE',\n    };\n    return names[type] || type;\n  }\n\n  private _getAllDiagrams(): Diagram[] {\n    return this._context.globalState.get<Diagram[]>(DIAGRAMS_KEY, []);\n  }\n\n  private _saveDiagram(diagram: Diagram): void {\n    const diagrams = this._getAllDiagrams();\n    diagrams.push(diagram);\n    \n    // \u9650\u5236\u6570\u91CF\n    if (diagrams.length > 100) {\n      diagrams.sort((a, b) => b.updatedAt - a.updatedAt);\n      diagrams.splice(100);\n    }\n    \n    this._context.globalState.update(DIAGRAMS_KEY, diagrams);\n  }\n\n  private _looksLikeDiagramCode(text: string): boolean {\n    const indicators = [\n      'flowchart', 'graph', 'sequenceDiagram', 'classDiagram',\n      'stateDiagram', 'erDiagram', 'gantt', 'pie', 'mindmap',\n      '-->', '---', '-.->',\n    ];\n    \n    return indicators.some(ind => text.includes(ind));\n  }\n\n  private _exportAsMarkdown(diagram: Diagram): string {\n    return `# ${diagram.title}\n\n\\`\\`\\`mermaid\n${diagram.code}\n\\`\\`\\`\n\n---\n*\u751F\u6210\u65F6\u95F4: ${new Date(diagram.createdAt).toLocaleString('zh-CN')}*\n`;\n  }\n\n  private _exportAsHtml(diagram: Diagram): string {\n    return `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>${diagram.title}</title>\n  <script src=\"https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js\"></script>\n  <style>\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      padding: 20px;\n      background: #f5f5f5;\n    }\n    h1 { color: #333; }\n    .mermaid {\n      background: white;\n      padding: 20px;\n      border-radius: 8px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n  </style>\n</head>\n<body>\n  <h1>${diagram.title}</h1>\n  <div class=\"mermaid\">\n${diagram.code}\n  </div>\n  <script>mermaid.initialize({ startOnLoad: true });</script>\n</body>\n</html>`;\n  }\n}\n", "import * as vscode from 'vscode';\nimport { ChatService } from '../api/ChatService';\nimport { ConfigManager } from '../ConfigManager';\n\n/**\n * \u4FEE\u590D\u8BF7\u6C42\u7C7B\u578B\n */\nexport type FixType = 'diagram' | 'test' | 'code';\n\n/**\n * \u4FEE\u590D\u8BF7\u6C42\n */\nexport interface FixRequest {\n  type: FixType;\n  code: string;\n  error: string;\n  context?: {\n    language?: string;\n    framework?: string;\n    fileName?: string;\n    originalError?: string;\n  };\n}\n\n/**\n * \u4FEE\u590D\u7ED3\u679C\n */\nexport interface FixResult {\n  success: boolean;\n  fixedCode?: string;\n  explanation?: string;\n  suggestions?: string[];\n  error?: string;\n}\n\n/**\n * \u6D41\u5F0F\u4FEE\u590D\u56DE\u8C03\n */\nexport interface StreamingFixCallbacks {\n  onChunk: (chunk: string, fullContent: string) => void;\n  onComplete: (result: FixResult) => void;\n  onError: (error: Error) => void;\n}\n\n/**\n * \u4FEE\u590D\u5386\u53F2\u8BB0\u5F55\n */\ninterface FixHistory {\n  timestamp: number;\n  type: FixType;\n  originalCode: string;\n  fixedCode: string;\n  error: string;\n}\n\n/**\n * \u589E\u5F3A\u7684\u81EA\u52A8\u4FEE\u590D\u670D\u52A1\n */\nexport class AutoFixService {\n  private _chatService?: ChatService;\n  private _configManager: ConfigManager;\n  private _fixHistory: FixHistory[] = [];\n  private _maxRetries = 3;\n\n  constructor(context: vscode.ExtensionContext) {\n    this._configManager = new ConfigManager(context);\n  }\n\n  /**\n   * \u521D\u59CB\u5316 ChatService\n   */\n  private async _ensureChatService(): Promise<boolean> {\n    if (!this._chatService) {\n      const config = await this._configManager.getFullModelConfig();\n      if (!config.apiKey) {\n        return false;\n      }\n      this._chatService = new ChatService(config);\n    }\n    return true;\n  }\n\n  /**\n   * \u81EA\u52A8\u4FEE\u590D\u56FE\u8868\u4EE3\u7801\n   */\n  async fixDiagram(code: string, error: string): Promise<FixResult> {\n    if (!await this._ensureChatService()) {\n      return { success: false, error: '\u8BF7\u5148\u914D\u7F6E API Key' };\n    }\n\n    const prompt = this._buildDiagramFixPrompt(code, error);\n    return await this._executeFixWithRetry(prompt, 'diagram', code);\n  }\n\n  /**\n   * \u6D41\u5F0F\u4FEE\u590D\u56FE\u8868\u4EE3\u7801\n   */\n  async fixDiagramStreaming(\n    code: string, \n    error: string, \n    callbacks: StreamingFixCallbacks\n  ): Promise<void> {\n    if (!await this._ensureChatService()) {\n      callbacks.onError(new Error('\u8BF7\u5148\u914D\u7F6E API Key'));\n      return;\n    }\n\n    const prompt = this._buildDiagramFixPrompt(code, error);\n    await this._executeStreamingFix(prompt, 'diagram', callbacks);\n  }\n\n  /**\n   * \u6D41\u5F0F\u4FEE\u590D\u6D4B\u8BD5\u4EE3\u7801\n   */\n  async fixTestStreaming(\n    code: string, \n    error: string, \n    framework: string | undefined,\n    language: string | undefined,\n    callbacks: StreamingFixCallbacks\n  ): Promise<void> {\n    if (!await this._ensureChatService()) {\n      callbacks.onError(new Error('\u8BF7\u5148\u914D\u7F6E API Key'));\n      return;\n    }\n\n    const prompt = this._buildTestFixPrompt(code, error, framework, language);\n    await this._executeStreamingFix(prompt, 'test', callbacks);\n  }\n\n  /**\n   * \u6D41\u5F0F\u4FEE\u590D\u901A\u7528\u4EE3\u7801\n   */\n  async fixCodeStreaming(\n    code: string,\n    error: string,\n    language: string | undefined,\n    context: string | undefined,\n    callbacks: StreamingFixCallbacks\n  ): Promise<void> {\n    if (!await this._ensureChatService()) {\n      callbacks.onError(new Error('\u8BF7\u5148\u914D\u7F6E API Key'));\n      return;\n    }\n\n    const prompt = this._buildCodeFixPrompt(code, error, language, context);\n    await this._executeStreamingFix(prompt, 'code', callbacks);\n  }\n\n  /**\n   * \u6267\u884C\u6D41\u5F0F\u4FEE\u590D\n   */\n  private async _executeStreamingFix(\n    prompt: string,\n    type: FixType,\n    callbacks: StreamingFixCallbacks\n  ): Promise<void> {\n    let fullResponse = '';\n    let lastSafePoint = 0;\n\n    try {\n      await this._chatService!.sendMessage(\n        [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n        {\n          onToken: (token) => {\n            fullResponse += token;\n            \n            // \u627E\u5230\u5B89\u5168\u7684 Markdown \u622A\u65AD\u70B9\u5E76\u53D1\u9001\n            const safePoint = this._findSafeMarkdownBreak(fullResponse);\n            if (safePoint > lastSafePoint + 20) { // \u81F3\u5C11\u79EF\u7D2F20\u5B57\u7B26\u518D\u53D1\u9001\n              callbacks.onChunk(fullResponse.slice(lastSafePoint, safePoint), fullResponse);\n              lastSafePoint = safePoint;\n            }\n          },\n          onComplete: () => {\n            // \u53D1\u9001\u5269\u4F59\u5185\u5BB9\n            if (lastSafePoint < fullResponse.length) {\n              callbacks.onChunk(fullResponse.slice(lastSafePoint), fullResponse);\n            }\n            \n            // \u63D0\u53D6\u4FEE\u590D\u540E\u7684\u4EE3\u7801\n            const fixedCode = this._extractFixedCode(fullResponse, type);\n            const explanation = this._extractExplanation(fullResponse);\n            \n            if (fixedCode) {\n              callbacks.onComplete({\n                success: true,\n                fixedCode,\n                explanation,\n              });\n            } else {\n              callbacks.onComplete({\n                success: false,\n                error: '\u65E0\u6CD5\u4ECE\u54CD\u5E94\u4E2D\u63D0\u53D6\u4FEE\u590D\u540E\u7684\u4EE3\u7801',\n              });\n            }\n          },\n          onError: (error) => {\n            // \u5373\u4F7F\u51FA\u9519\u4E5F\u8FD4\u56DE\u5DF2\u6536\u5230\u7684\u5185\u5BB9\uFF08\u5982\u679C\u6709\uFF09\n            if (fullResponse.length > 0) {\n              const fixedCode = this._extractFixedCode(fullResponse, type);\n              if (fixedCode) {\n                callbacks.onComplete({\n                  success: true,\n                  fixedCode,\n                  explanation: '\uFF08\u54CD\u5E94\u88AB\u4E2D\u65AD\uFF0C\u4F46\u5DF2\u63D0\u53D6\u5230\u4EE3\u7801\uFF09',\n                });\n                return;\n              }\n            }\n            callbacks.onError(error);\n          },\n        }\n      );\n    } catch (error) {\n      callbacks.onError(error instanceof Error ? error : new Error(String(error)));\n    }\n  }\n\n  /**\n   * \u627E\u5230\u5B89\u5168\u7684 Markdown \u622A\u65AD\u70B9\n   */\n  private _findSafeMarkdownBreak(content: string): number {\n    // \u68C0\u67E5\u662F\u5426\u5728\u4EE3\u7801\u5757\u5185\n    const codeBlockStarts = (content.match(/```/g) || []).length;\n    const isInCodeBlock = codeBlockStarts % 2 === 1;\n    \n    if (isInCodeBlock) {\n      // \u5728\u4EE3\u7801\u5757\u5185\uFF0C\u627E\u5230\u6700\u540E\u4E00\u4E2A\u5B8C\u6574\u884C\n      const lastNewline = content.lastIndexOf('\\n');\n      return lastNewline > 0 ? lastNewline : 0;\n    }\n    \n    // \u4E0D\u5728\u4EE3\u7801\u5757\u5185\uFF0C\u4F18\u5148\u627E\u5B8C\u6574\u4EE3\u7801\u5757\u7ED3\u675F\n    const lastCodeBlockEnd = content.lastIndexOf('```\\n');\n    if (lastCodeBlockEnd > 0) {\n      const afterBlock = content.indexOf('\\n', lastCodeBlockEnd + 4);\n      if (afterBlock > lastCodeBlockEnd) return afterBlock;\n      return lastCodeBlockEnd + 4;\n    }\n    \n    // \u627E\u5B8C\u6574\u6BB5\u843D\n    const lastParagraph = content.lastIndexOf('\\n\\n');\n    if (lastParagraph > 0) return lastParagraph + 2;\n    \n    // \u627E\u5B8C\u6574\u884C\n    const lastNewline = content.lastIndexOf('\\n');\n    if (lastNewline > 0) return lastNewline + 1;\n    \n    return content.length;\n  }\n\n  /**\n   * \u81EA\u52A8\u4FEE\u590D\u6D4B\u8BD5\u4EE3\u7801\n   */\n  async fixTest(\n    code: string, \n    error: string, \n    framework?: string,\n    language?: string\n  ): Promise<FixResult> {\n    if (!await this._ensureChatService()) {\n      return { success: false, error: '\u8BF7\u5148\u914D\u7F6E API Key' };\n    }\n\n    const prompt = this._buildTestFixPrompt(code, error, framework, language);\n    return await this._executeFixWithRetry(prompt, 'test', code);\n  }\n\n  /**\n   * \u81EA\u52A8\u4FEE\u590D\u901A\u7528\u4EE3\u7801\n   */\n  async fixCode(\n    code: string,\n    error: string,\n    language?: string,\n    context?: string\n  ): Promise<FixResult> {\n    if (!await this._ensureChatService()) {\n      return { success: false, error: '\u8BF7\u5148\u914D\u7F6E API Key' };\n    }\n\n    const prompt = this._buildCodeFixPrompt(code, error, language, context);\n    return await this._executeFixWithRetry(prompt, 'code', code);\n  }\n\n  /**\n   * \u667A\u80FD\u8BCA\u65AD\u9519\u8BEF\n   */\n  async diagnoseError(error: string, codeContext?: string): Promise<{\n    diagnosis: string;\n    possibleCauses: string[];\n    suggestedFixes: string[];\n  }> {\n    if (!await this._ensureChatService()) {\n      return {\n        diagnosis: '\u65E0\u6CD5\u8BCA\u65AD',\n        possibleCauses: ['\u8BF7\u5148\u914D\u7F6E API Key'],\n        suggestedFixes: [],\n      };\n    }\n\n    const prompt = `\u4F5C\u4E3A\u4EE3\u7801\u8BCA\u65AD\u4E13\u5BB6\uFF0C\u5206\u6790\u4EE5\u4E0B\u9519\u8BEF\uFF1A\n\n**\u9519\u8BEF\u4FE1\u606F\uFF1A**\n\\`\\`\\`\n${error}\n\\`\\`\\`\n\n${codeContext ? `**\u76F8\u5173\u4EE3\u7801\u4E0A\u4E0B\u6587\uFF1A**\\n\\`\\`\\`\\n${codeContext}\\n\\`\\`\\`\\n` : ''}\n\n\u8BF7\u63D0\u4F9B\uFF1A\n1. \u9519\u8BEF\u8BCA\u65AD\uFF08\u7B80\u6D01\u8BF4\u660E\u95EE\u9898\u672C\u8D28\uFF09\n2. \u53EF\u80FD\u539F\u56E0\uFF08\u5217\u51FA2-3\u4E2A\u53EF\u80FD\u7684\u539F\u56E0\uFF09\n3. \u4FEE\u590D\u5EFA\u8BAE\uFF08\u5177\u4F53\u7684\u4FEE\u590D\u6B65\u9AA4\uFF09\n\n\u8BF7\u7528\u4EE5\u4E0BJSON\u683C\u5F0F\u8FD4\u56DE\uFF1A\n\\`\\`\\`json\n{\n  \"diagnosis\": \"\u8BCA\u65AD\u7ED3\u679C\",\n  \"possibleCauses\": [\"\u539F\u56E01\", \"\u539F\u56E02\"],\n  \"suggestedFixes\": [\"\u4FEE\u590D\u6B65\u9AA41\", \"\u4FEE\u590D\u6B65\u9AA42\"]\n}\n\\`\\`\\``;\n\n    try {\n      let response = '';\n      await this._chatService!.sendMessage(\n        [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n        {\n          onToken: (token) => { response += token; },\n          onComplete: () => {},\n          onError: () => {},\n        }\n      );\n\n      // \u63D0\u53D6 JSON\n      const jsonMatch = response.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[1]);\n      }\n      \n      return {\n        diagnosis: '\u65E0\u6CD5\u89E3\u6790\u8BCA\u65AD\u7ED3\u679C',\n        possibleCauses: [],\n        suggestedFixes: [],\n      };\n    } catch {\n      return {\n        diagnosis: '\u8BCA\u65AD\u8FC7\u7A0B\u51FA\u9519',\n        possibleCauses: [],\n        suggestedFixes: [],\n      };\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u4FEE\u590D\u5386\u53F2\n   */\n  getFixHistory(): FixHistory[] {\n    return this._fixHistory.slice(-20); // \u8FD4\u56DE\u6700\u8FD120\u6761\n  }\n\n  /**\n   * \u6E05\u9664\u4FEE\u590D\u5386\u53F2\n   */\n  clearFixHistory(): void {\n    this._fixHistory = [];\n  }\n\n  // ==================== \u79C1\u6709\u65B9\u6CD5 ====================\n\n  /**\n   * \u6784\u5EFA\u56FE\u8868\u4FEE\u590D\u63D0\u793A\n   */\n  private _buildDiagramFixPrompt(code: string, error: string): string {\n    // \u68C0\u6D4B\u56FE\u8868\u7C7B\u578B\n    const diagramType = this._detectDiagramType(code);\n    const syntaxDoc = this._getMermaidSyntaxDoc(diagramType);\n    \n    return `\u4F60\u662F\u4E00\u4E2A Mermaid \u56FE\u8868\u4E13\u5BB6\u3002\u4EE5\u4E0B Mermaid \u4EE3\u7801\u5B58\u5728\u8BED\u6CD5\u9519\u8BEF\uFF0C\u8BF7\u4FEE\u590D\u5B83\u3002\n\n**\u9519\u8BEF\u4EE3\u7801\uFF1A**\n\\`\\`\\`mermaid\n${code}\n\\`\\`\\`\n\n**\u9519\u8BEF\u4FE1\u606F\uFF1A**\n${error}\n\n**Mermaid \u8BED\u6CD5\u8981\u70B9 (${diagramType})\uFF1A**\n${syntaxDoc}\n\n**\u5B98\u65B9\u8BED\u6CD5\u53C2\u8003\uFF1A** https://mermaid.js.org/syntax/${this._getDiagramSyntaxPath(diagramType)}.html\n\n**\u4FEE\u590D\u8981\u6C42\uFF1A**\n1. \u5206\u6790\u9519\u8BEF\u539F\u56E0\n2. \u4E25\u683C\u9075\u5FAA Mermaid \u5B98\u65B9\u8BED\u6CD5\u89C4\u8303\n3. \u4FEE\u590D\u8BED\u6CD5\u95EE\u9898\uFF0C\u4FDD\u6301\u539F\u6709\u56FE\u8868\u7ED3\u6784\u548C\u610F\u56FE\n4. \u786E\u4FDD\u4FEE\u590D\u540E\u7684\u4EE3\u7801\u53EF\u4EE5\u6B63\u786E\u6E32\u67D3\n5. \u8282\u70B9\u6587\u672C\u4E2D\u907F\u514D\u4F7F\u7528\u7279\u6B8A\u5B57\u7B26 [ ] { } ( ) < > | # ; \u7B49\n6. \u5982\u679C\u8282\u70B9\u6587\u672C\u9700\u8981\u5305\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u8BF7\u7528\u5F15\u53F7\u5305\u88F9\n\n\u8BF7\u6309\u4EE5\u4E0B\u683C\u5F0F\u8FD4\u56DE\uFF1A\n\n**\u9519\u8BEF\u5206\u6790\uFF1A**\n[\u7B80\u8981\u8BF4\u660E\u9519\u8BEF\u539F\u56E0]\n\n**\u4FEE\u590D\u540E\u4EE3\u7801\uFF1A**\n\\`\\`\\`mermaid\n[\u4FEE\u590D\u540E\u7684\u5B8C\u6574\u4EE3\u7801]\n\\`\\`\\`\n\n**\u4FEE\u6539\u8BF4\u660E\uFF1A**\n[\u8BF4\u660E\u505A\u4E86\u54EA\u4E9B\u4FEE\u6539]`;\n  }\n\n  /**\n   * \u68C0\u6D4B Mermaid \u56FE\u8868\u7C7B\u578B\n   */\n  private _detectDiagramType(code: string): string {\n    const trimmed = code.trim().toLowerCase();\n    if (trimmed.startsWith('flowchart') || trimmed.startsWith('graph')) return 'flowchart';\n    if (trimmed.startsWith('sequencediagram')) return 'sequence';\n    if (trimmed.startsWith('classdiagram')) return 'class';\n    if (trimmed.startsWith('statediagram')) return 'state';\n    if (trimmed.startsWith('erdiagram')) return 'er';\n    if (trimmed.startsWith('gantt')) return 'gantt';\n    if (trimmed.startsWith('pie')) return 'pie';\n    if (trimmed.startsWith('mindmap')) return 'mindmap';\n    return 'flowchart';\n  }\n\n  /**\n   * \u83B7\u53D6 Mermaid \u8BED\u6CD5\u6587\u6863\u8DEF\u5F84\n   */\n  private _getDiagramSyntaxPath(type: string): string {\n    const paths: Record<string, string> = {\n      flowchart: 'flowchart',\n      sequence: 'sequenceDiagram',\n      class: 'classDiagram',\n      state: 'stateDiagram',\n      er: 'entityRelationshipDiagram',\n      gantt: 'gantt',\n      pie: 'pie',\n      mindmap: 'mindmap',\n    };\n    return paths[type] || 'flowchart';\n  }\n\n  /**\n   * \u83B7\u53D6 Mermaid \u8BED\u6CD5\u8BF4\u660E\n   */\n  private _getMermaidSyntaxDoc(type: string): string {\n    const docs: Record<string, string> = {\n      flowchart: `- \u4F7F\u7528 flowchart TB/LR/BT/RL \u58F0\u660E\u65B9\u5411 (TB=\u4E0A\u5230\u4E0B, LR=\u5DE6\u5230\u53F3)\n- \u8282\u70B9\u5F62\u72B6: A[\u65B9\u5F62] B(\u5706\u89D2) C{\u83F1\u5F62} D((\u5706\u5F62)) E>\u65D7\u5E1C\u5F62] F([\u4F53\u80B2\u573A\u5F62])\n- \u8FDE\u63A5\u7EBF: A --> B (\u7BAD\u5934) A --- B (\u5B9E\u7EBF) A -.-> B (\u865A\u7EBF) A ==> B (\u7C97\u7BAD\u5934)\n- \u8FDE\u63A5\u6587\u5B57: A -->|\u6587\u5B57| B \u6216 A -- \u6587\u5B57 --> B\n- \u5B50\u56FE: subgraph \u6807\u9898 ... end\n- \u6CE8\u610F: \u8282\u70B9ID\u53EA\u80FD\u662F\u5B57\u6BCD\u6570\u5B57\u4E0B\u5212\u7EBF\uFF0C\u6587\u672C\u7528[]\u5305\u88F9`,\n      sequence: `- \u4F7F\u7528 sequenceDiagram \u58F0\u660E\n- \u53C2\u4E0E\u8005: participant A as \u522B\u540D\n- \u6D88\u606F\u7C7B\u578B: A->>B (\u5B9E\u7EBF\u7BAD\u5934) A-->>B (\u865A\u7EBF\u7BAD\u5934) A-)B (\u5F02\u6B65)\n- \u6FC0\u6D3B: activate A / deactivate A \u6216 A->>+B: / A->>-B:\n- \u6CE8\u91CA: Note right of A: \u5185\u5BB9\n- \u5FAA\u73AF/\u6761\u4EF6: loop/alt/opt/par ... end`,\n      class: `- \u4F7F\u7528 classDiagram \u58F0\u660E\n- \u7C7B\u5B9A\u4E49: class \u7C7B\u540D { +\u516C\u6709\u65B9\u6CD5() -\u79C1\u6709\u5C5E\u6027 #\u4FDD\u62A4 ~\u5305 }\n- \u5173\u7CFB: A <|-- B (\u7EE7\u627F) A *-- B (\u7EC4\u5408) A o-- B (\u805A\u5408) A --> B (\u5173\u8054)\n- \u57FA\u6570: \"1\" -- \"*\" \u8868\u793A\u4E00\u5BF9\u591A`,\n      state: `- \u4F7F\u7528 stateDiagram-v2 \u58F0\u660E\n- \u72B6\u6001\u5B9A\u4E49: state \"\u63CF\u8FF0\" as s1\n- \u8F6C\u6362: s1 --> s2 \u6216 s1 --> s2 : \u4E8B\u4EF6\n- \u7279\u6B8A: [*] --> s1 (\u5F00\u59CB) s1 --> [*] (\u7ED3\u675F)\n- \u590D\u5408: state \u7236\u72B6\u6001 { ... }`,\n      er: `- \u4F7F\u7528 erDiagram \u58F0\u660E\n- \u5B9E\u4F53\u548C\u5173\u7CFB: A ||--o{ B : \"\u6807\u7B7E\"\n- \u57FA\u6570\u7B26\u53F7: || (\u6070\u597D\u4E00\u4E2A) |o (\u96F6\u6216\u4E00\u4E2A) }| (\u4E00\u4E2A\u6216\u591A\u4E2A) }o (\u96F6\u6216\u591A\u4E2A)\n- \u5C5E\u6027: ENTITY { type name }`,\n      gantt: `- \u4F7F\u7528 gantt \u58F0\u660E\n- \u5FC5\u987B\u6709 title \u548C dateFormat (\u5982 YYYY-MM-DD)\n- \u4EFB\u52A1: \u4EFB\u52A1\u540D :\u72B6\u6001, \u5F00\u59CB, \u7ED3\u675F/\u6301\u7EED\n- \u72B6\u6001: done/active/crit \u6216 crit,done\n- \u5206\u7EC4: section \u540D\u79F0`,\n      pie: `- \u4F7F\u7528 pie \u6216 pie showData \u58F0\u660E\n- \u53EF\u9009 title \"\u6807\u9898\"\n- \u6570\u636E\u683C\u5F0F: \"\u6807\u7B7E\" : \u6570\u503C`,\n      mindmap: `- \u4F7F\u7528 mindmap \u58F0\u660E\n- \u5C42\u7EA7\u7528\u7F29\u8FDB\u8868\u793A\uFF082\u4E2A\u7A7A\u683C\uFF09\n- \u6839\u8282\u70B9\u65E0\u7F29\u8FDB\n- \u53EF\u7528\u5F62\u72B6: ((\u5706\u5F62)) [\u65B9\u5F62] (\u5706\u89D2)`,\n    };\n    return docs[type] || docs.flowchart;\n  }\n\n  /**\n   * \u6784\u5EFA\u6D4B\u8BD5\u4FEE\u590D\u63D0\u793A\n   */\n  private _buildTestFixPrompt(\n    code: string, \n    error: string, \n    framework?: string,\n    language?: string\n  ): string {\n    const lang = language || this._detectLanguage(code);\n    const fw = framework || this._detectTestFramework(code);\n\n    return `\u4F60\u662F\u4E00\u4E2A\u6D4B\u8BD5\u4EE3\u7801\u4E13\u5BB6\u3002\u4EE5\u4E0B ${fw || '\u5355\u5143\u6D4B\u8BD5'} \u6D4B\u8BD5\u4EE3\u7801\u6267\u884C\u5931\u8D25\uFF0C\u8BF7\u4FEE\u590D\u5B83\u3002\n\n**\u6D4B\u8BD5\u6846\u67B6\uFF1A** ${fw || '\u672A\u77E5'}\n**\u7F16\u7A0B\u8BED\u8A00\uFF1A** ${lang || '\u672A\u77E5'}\n\n**\u5931\u8D25\u7684\u6D4B\u8BD5\u4EE3\u7801\uFF1A**\n\\`\\`\\`${lang || ''}\n${code}\n\\`\\`\\`\n\n**\u9519\u8BEF\u4FE1\u606F\uFF1A**\n\\`\\`\\`\n${error}\n\\`\\`\\`\n\n**\u4FEE\u590D\u8981\u6C42\uFF1A**\n1. \u5206\u6790\u6D4B\u8BD5\u5931\u8D25\u7684\u539F\u56E0\n2. \u4FEE\u590D\u6D4B\u8BD5\u4EE3\u7801\u4E2D\u7684\u95EE\u9898\n3. \u786E\u4FDD\u6D4B\u8BD5\u903B\u8F91\u6B63\u786E\n4. \u4FDD\u6301\u539F\u6709\u6D4B\u8BD5\u8986\u76D6\u8303\u56F4\n5. \u5982\u679C\u662F\u65AD\u8A00\u95EE\u9898\uFF0C\u68C0\u67E5\u671F\u671B\u503C\u662F\u5426\u5408\u7406\n\n\u8BF7\u6309\u4EE5\u4E0B\u683C\u5F0F\u8FD4\u56DE\uFF1A\n\n**\u9519\u8BEF\u5206\u6790\uFF1A**\n[\u7B80\u8981\u8BF4\u660E\u6D4B\u8BD5\u5931\u8D25\u7684\u539F\u56E0]\n\n**\u4FEE\u590D\u540E\u4EE3\u7801\uFF1A**\n\\`\\`\\`${lang || ''}\n[\u4FEE\u590D\u540E\u7684\u5B8C\u6574\u6D4B\u8BD5\u4EE3\u7801]\n\\`\\`\\`\n\n**\u4FEE\u6539\u8BF4\u660E\uFF1A**\n[\u8BF4\u660E\u505A\u4E86\u54EA\u4E9B\u4FEE\u6539]\n\n**\u6CE8\u610F\u4E8B\u9879\uFF1A**\n[\u5982\u679C\u6709\u9700\u8981\u6CE8\u610F\u7684\u5730\u65B9\uFF0C\u8BF7\u8BF4\u660E]`;\n  }\n\n  /**\n   * \u6784\u5EFA\u901A\u7528\u4EE3\u7801\u4FEE\u590D\u63D0\u793A\n   */\n  private _buildCodeFixPrompt(\n    code: string,\n    error: string,\n    language?: string,\n    context?: string\n  ): string {\n    const lang = language || this._detectLanguage(code);\n\n    return `\u4F60\u662F\u4E00\u4E2A\u4EE3\u7801\u4FEE\u590D\u4E13\u5BB6\u3002\u4EE5\u4E0B\u4EE3\u7801\u5B58\u5728\u9519\u8BEF\uFF0C\u8BF7\u4FEE\u590D\u5B83\u3002\n\n**\u7F16\u7A0B\u8BED\u8A00\uFF1A** ${lang || '\u672A\u77E5'}\n\n**\u6709\u95EE\u9898\u7684\u4EE3\u7801\uFF1A**\n\\`\\`\\`${lang || ''}\n${code}\n\\`\\`\\`\n\n**\u9519\u8BEF\u4FE1\u606F\uFF1A**\n\\`\\`\\`\n${error}\n\\`\\`\\`\n\n${context ? `**\u4E0A\u4E0B\u6587\u4FE1\u606F\uFF1A**\\n${context}\\n` : ''}\n\n**\u4FEE\u590D\u8981\u6C42\uFF1A**\n1. \u5206\u6790\u9519\u8BEF\u539F\u56E0\n2. \u4FEE\u590D\u4EE3\u7801\u95EE\u9898\n3. \u4FDD\u6301\u4EE3\u7801\u98CE\u683C\u4E00\u81F4\n4. \u4E0D\u8981\u6539\u53D8\u4EE3\u7801\u7684\u4E3B\u8981\u903B\u8F91\n\n\u8BF7\u6309\u4EE5\u4E0B\u683C\u5F0F\u8FD4\u56DE\uFF1A\n\n**\u9519\u8BEF\u5206\u6790\uFF1A**\n[\u7B80\u8981\u8BF4\u660E\u9519\u8BEF\u539F\u56E0]\n\n**\u4FEE\u590D\u540E\u4EE3\u7801\uFF1A**\n\\`\\`\\`${lang || ''}\n[\u4FEE\u590D\u540E\u7684\u5B8C\u6574\u4EE3\u7801]\n\\`\\`\\`\n\n**\u4FEE\u6539\u8BF4\u660E\uFF1A**\n[\u8BF4\u660E\u505A\u4E86\u54EA\u4E9B\u4FEE\u6539]`;\n  }\n\n  /**\n   * \u6267\u884C\u5E26\u91CD\u8BD5\u7684\u4FEE\u590D\n   */\n  private async _executeFixWithRetry(\n    prompt: string,\n    type: FixType,\n    originalCode: string\n  ): Promise<FixResult> {\n    let lastError = '';\n    \n    for (let attempt = 0; attempt < this._maxRetries; attempt++) {\n      try {\n        const result = await this._executeFix(prompt, type);\n        \n        if (result.success && result.fixedCode) {\n          // \u9A8C\u8BC1\u4FEE\u590D\u7ED3\u679C\n          const isValid = await this._validateFix(type, result.fixedCode);\n          \n          if (isValid) {\n            // \u8BB0\u5F55\u6210\u529F\u7684\u4FEE\u590D\n            this._fixHistory.push({\n              timestamp: Date.now(),\n              type,\n              originalCode,\n              fixedCode: result.fixedCode,\n              error: lastError,\n            });\n            return result;\n          } else {\n            lastError = '\u4FEE\u590D\u540E\u7684\u4EE3\u7801\u4ECD\u6709\u95EE\u9898';\n            // \u5982\u679C\u9A8C\u8BC1\u5931\u8D25\uFF0C\u66F4\u65B0 prompt \u52A0\u5165\u65B0\u7684\u9519\u8BEF\u4FE1\u606F\n            prompt += `\\n\\n**\u6CE8\u610F\uFF1A** \u4E0A\u4E00\u6B21\u4FEE\u590D\u5C1D\u8BD5\u672A\u6210\u529F\uFF0C\u4FEE\u590D\u540E\u7684\u4EE3\u7801\u4ECD\u6709\u95EE\u9898\u3002\u8BF7\u91CD\u65B0\u5206\u6790\u5E76\u4FEE\u590D\u3002`;\n          }\n        } else {\n          lastError = result.error || '\u4FEE\u590D\u5931\u8D25';\n        }\n      } catch (e) {\n        lastError = e instanceof Error ? e.message : '\u672A\u77E5\u9519\u8BEF';\n      }\n    }\n\n    return {\n      success: false,\n      error: `\u4FEE\u590D\u5931\u8D25\uFF08\u5C1D\u8BD5 ${this._maxRetries} \u6B21\u540E\uFF09: ${lastError}`,\n      suggestions: [\n        '\u8BF7\u624B\u52A8\u68C0\u67E5\u4EE3\u7801',\n        '\u5C1D\u8BD5\u7B80\u5316\u4EE3\u7801\u540E\u91CD\u8BD5',\n        '\u68C0\u67E5\u662F\u5426\u6709\u8BED\u6CD5\u9519\u8BEF',\n      ],\n    };\n  }\n\n  /**\n   * \u6267\u884C\u5355\u6B21\u4FEE\u590D\n   */\n  private async _executeFix(prompt: string, type: FixType): Promise<FixResult> {\n    return new Promise((resolve) => {\n      let response = '';\n      \n      this._chatService!.sendMessage(\n        [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n        {\n          onToken: (token) => {\n            response += token;\n          },\n          onComplete: () => {\n            // \u63D0\u53D6\u4FEE\u590D\u540E\u7684\u4EE3\u7801\n            const fixedCode = this._extractFixedCode(response, type);\n            const explanation = this._extractExplanation(response);\n            \n            if (fixedCode) {\n              resolve({\n                success: true,\n                fixedCode,\n                explanation,\n              });\n            } else {\n              resolve({\n                success: false,\n                error: '\u65E0\u6CD5\u4ECE\u54CD\u5E94\u4E2D\u63D0\u53D6\u4FEE\u590D\u540E\u7684\u4EE3\u7801',\n              });\n            }\n          },\n          onError: (error) => {\n            resolve({\n              success: false,\n              error: error.message,\n            });\n          },\n        }\n      );\n    });\n  }\n\n  /**\n   * \u63D0\u53D6\u4FEE\u590D\u540E\u7684\u4EE3\u7801\n   */\n  private _extractFixedCode(response: string, type: FixType): string | null {\n    // \u6839\u636E\u7C7B\u578B\u4F7F\u7528\u4E0D\u540C\u7684\u63D0\u53D6\u903B\u8F91\n    let codeBlock: RegExpMatchArray | null;\n    \n    if (type === 'diagram') {\n      // \u4F18\u5148\u67E5\u627E mermaid \u4EE3\u7801\u5757\n      codeBlock = response.match(/```mermaid\\s*([\\s\\S]*?)\\s*```/);\n    } else {\n      // \u67E5\u627E\u4EFB\u610F\u8BED\u8A00\u7684\u4EE3\u7801\u5757\n      codeBlock = response.match(/```(?:\\w+)?\\s*([\\s\\S]*?)\\s*```/);\n    }\n\n    if (codeBlock && codeBlock[1]) {\n      return codeBlock[1].trim();\n    }\n\n    // \u5982\u679C\u6CA1\u6709\u627E\u5230\u4EE3\u7801\u5757\uFF0C\u5C1D\u8BD5\u67E5\u627E\u7F29\u8FDB\u7684\u4EE3\u7801\n    const lines = response.split('\\n');\n    const codeLines: string[] = [];\n    let inCode = false;\n\n    for (const line of lines) {\n      if (line.startsWith('    ') || line.startsWith('\\t')) {\n        inCode = true;\n        codeLines.push(line);\n      } else if (inCode && line.trim() === '') {\n        codeLines.push(line);\n      } else {\n        inCode = false;\n      }\n    }\n\n    if (codeLines.length > 3) {\n      return codeLines.join('\\n').trim();\n    }\n\n    return null;\n  }\n\n  /**\n   * \u63D0\u53D6\u89E3\u91CA\u8BF4\u660E\n   */\n  private _extractExplanation(response: string): string | undefined {\n    const sections = [\n      /\\*\\*\u9519\u8BEF\u5206\u6790[\uFF1A:]\\*\\*\\s*([\\s\\S]*?)(?=\\*\\*\u4FEE\u590D\u540E\u4EE3\u7801|```|$)/,\n      /\\*\\*\u4FEE\u6539\u8BF4\u660E[\uFF1A:]\\*\\*\\s*([\\s\\S]*?)(?=\\*\\*\u6CE8\u610F|$)/,\n    ];\n\n    const explanations: string[] = [];\n    \n    for (const pattern of sections) {\n      const match = response.match(pattern);\n      if (match && match[1]) {\n        let content = match[1].trim();\n        // \u6E05\u7406\u7A7A\u7684\u5217\u8868\u9879\uFF08\u5982 \"1.\" \u6216 \"- \" \u540E\u9762\u6CA1\u6709\u5185\u5BB9\uFF09\n        content = content\n          .split('\\n')\n          .filter(line => {\n            const trimmed = line.trim();\n            // \u8FC7\u6EE4\u6389\u7A7A\u884C\u548C\u53EA\u6709\u5217\u8868\u7B26\u53F7\u7684\u884C\n            if (!trimmed) return false;\n            if (/^(\\d+\\.|[-*])\\s*$/.test(trimmed)) return false;\n            // \u8FC7\u6EE4\u6389\u4E0D\u5B8C\u6574\u7684\u53E5\u5B50\uFF08\u4EE5\u5192\u53F7\u7ED3\u5C3E\u4F46\u6CA1\u6709\u540E\u7EED\u5185\u5BB9\uFF09\n            if (/[:\uFF1A]\\s*$/.test(trimmed) && trimmed.length < 30) return false;\n            return true;\n          })\n          .join('\\n');\n        \n        if (content && content.length > 5) {\n          explanations.push(content);\n        }\n      }\n    }\n\n    // \u5982\u679C\u6CA1\u6709\u63D0\u53D6\u5230\u5185\u5BB9\uFF0C\u8FD4\u56DE\u9ED8\u8BA4\u6D88\u606F\n    if (explanations.length === 0) {\n      return '\u5DF2\u81EA\u52A8\u4FEE\u590D\u4EE3\u7801\u4E2D\u7684\u8BED\u6CD5\u95EE\u9898';\n    }\n\n    return explanations.join('\\n\\n');\n  }\n\n  /**\n   * \u9A8C\u8BC1\u4FEE\u590D\u7ED3\u679C\n   */\n  private async _validateFix(type: FixType, code: string): Promise<boolean> {\n    if (type === 'diagram') {\n      return this._validateMermaid(code);\n    }\n    // \u5BF9\u4E8E\u6D4B\u8BD5\u548C\u4EE3\u7801\uFF0C\u7B80\u5355\u68C0\u67E5\u662F\u5426\u4E3A\u7A7A\n    return code.trim().length > 10;\n  }\n\n  /**\n   * \u9A8C\u8BC1 Mermaid \u4EE3\u7801\n   */\n  private _validateMermaid(code: string): boolean {\n    // \u57FA\u672C\u8BED\u6CD5\u68C0\u67E5\n    const validStartPatterns = [\n      /^flowchart\\s+/m,\n      /^graph\\s+/m,\n      /^sequenceDiagram/m,\n      /^classDiagram/m,\n      /^stateDiagram/m,\n      /^erDiagram/m,\n      /^gantt/m,\n      /^pie/m,\n      /^mindmap/m,\n    ];\n\n    return validStartPatterns.some(pattern => pattern.test(code.trim()));\n  }\n\n  /**\n   * \u68C0\u6D4B\u7F16\u7A0B\u8BED\u8A00\n   */\n  private _detectLanguage(code: string): string {\n    if (code.includes('import React') || code.includes('from \\'react\\'')) {\n      return 'typescript';\n    }\n    if (code.includes('def ') || code.includes('import ')) {\n      if (code.includes('async def') || code.includes('await ')) {\n        return 'python';\n      }\n    }\n    if (code.includes('func ') && code.includes('package ')) {\n      return 'go';\n    }\n    if (code.includes('fn ') && code.includes('let ')) {\n      return 'rust';\n    }\n    if (code.includes('public class') || code.includes('private ')) {\n      return 'java';\n    }\n    if (code.includes('const ') || code.includes('let ') || code.includes('function ')) {\n      return 'typescript';\n    }\n    return '';\n  }\n\n  /**\n   * \u68C0\u6D4B\u6D4B\u8BD5\u6846\u67B6\n   */\n  private _detectTestFramework(code: string): string {\n    if (code.includes('describe(') && code.includes('it(')) {\n      if (code.includes('vitest')) return 'Vitest';\n      if (code.includes('@jest')) return 'Jest';\n      return 'Jest/Mocha';\n    }\n    if (code.includes('pytest') || code.includes('def test_')) {\n      return 'pytest';\n    }\n    if (code.includes('@Test') || code.includes('junit')) {\n      return 'JUnit';\n    }\n    if (code.includes('func Test')) {\n      return 'Go testing';\n    }\n    return '';\n  }\n}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\n\n/**\n * \u9879\u76EE\u5206\u6790\u7ED3\u679C\n */\nexport interface ProjectAnalysis {\n  // \u57FA\u672C\u4FE1\u606F\n  name: string;\n  root: string;\n  type: string;\n  framework?: string;\n  language: string;\n  \n  // \uD83C\uDD95 \u9879\u76EE\u529F\u80FD\u63CF\u8FF0\n  projectPurpose: ProjectPurpose;\n  \n  // \uD83C\uDD95 \u6267\u884C\u6D41\u7A0B\u5206\u6790\n  executionFlow: ExecutionFlow;\n  \n  // \u7ED3\u6784\u5206\u6790\n  structure: DirectoryNode;\n  entryPoints: string[];\n  configFiles: string[];\n  \n  // \u4EE3\u7801\u7EDF\u8BA1\n  codeStats: CodeStats;\n  \n  // \u4F9D\u8D56\u5206\u6790\n  dependencies: DependencyInfo;\n  \n  // \u6A21\u5757\u5206\u6790\n  modules: ModuleInfo[];\n  \n  // \u67B6\u6784\u5206\u6790\n  architecture: ArchitectureInfo;\n  \n  // \u8D28\u91CF\u6307\u6807\n  qualityIndicators: QualityIndicators;\n  \n  // \u53EF\u7528\u811A\u672C\n  scripts: ScriptInfo[];\n  \n  // AI \u4E0A\u4E0B\u6587\u6458\u8981\n  contextSummary: string;\n  \n  // \uD83C\uDD95 Markdown \u6587\u6863\u4FE1\u606F\n  markdownDocs: MarkdownDocInfo[];\n}\n\n/**\n * \uD83C\uDD95 Markdown \u6587\u6863\u4FE1\u606F\n */\nexport interface MarkdownDocInfo {\n  /** \u6587\u4EF6\u540D */\n  filename: string;\n  /** \u76F8\u5BF9\u8DEF\u5F84 */\n  relativePath: string;\n  /** \u6587\u6863\u6807\u9898\uFF08\u4ECE # \u63D0\u53D6\uFF09 */\n  title: string;\n  /** \u6587\u6863\u6458\u8981\uFF08\u524D2000\u5B57\u7B26\uFF0C\u79FB\u9664\u4EE3\u7801\u5757\u548CMarkdown\u6807\u8BB0\uFF09 */\n  summary: string;\n  /** \u6587\u6863\u7C7B\u578B */\n  docType: 'readme' | 'changelog' | 'contributing' | 'api' | 'guide' | 'architecture' | 'other';\n  /** \u4E3B\u8981\u7AE0\u8282\uFF08## \u6807\u9898\uFF09 */\n  sections: string[];\n  /** \u6587\u4EF6\u5927\u5C0F\uFF08\u5B57\u8282\uFF09 */\n  size: number;\n}\n\n/**\n * \uD83C\uDD95 \u9879\u76EE\u529F\u80FD\u63CF\u8FF0\n */\nexport interface ProjectPurpose {\n  // \u9879\u76EE\u7B80\u4ECB\uFF08\u4ECE README \u6216 package.json \u63D0\u53D6\uFF09\n  description: string;\n  // \u9879\u76EE\u7C7B\u522B\n  category: ProjectCategory;\n  // \u4E3B\u8981\u529F\u80FD\u70B9\n  features: string[];\n  // \u76EE\u6807\u7528\u6237/\u4F7F\u7528\u573A\u666F\n  targetAudience?: string;\n  // \u5173\u952E\u6280\u672F\u6808\n  techStack: string[];\n}\n\nexport type ProjectCategory = \n  | 'web-frontend'      // \u524D\u7AEF\u5E94\u7528\n  | 'web-backend'       // \u540E\u7AEF\u670D\u52A1\n  | 'fullstack'         // \u5168\u6808\u5E94\u7528\n  | 'cli-tool'          // \u547D\u4EE4\u884C\u5DE5\u5177\n  | 'library'           // \u5E93/SDK\n  | 'vscode-extension'  // VSCode \u63D2\u4EF6\n  | 'mobile-app'        // \u79FB\u52A8\u5E94\u7528\n  | 'desktop-app'       // \u684C\u9762\u5E94\u7528\n  | 'api-service'       // API \u670D\u52A1\n  | 'data-processing'   // \u6570\u636E\u5904\u7406\n  | 'ml-ai'             // \u673A\u5668\u5B66\u4E60/AI\n  | 'unknown';\n\n/**\n * \uD83C\uDD95 \u6267\u884C\u6D41\u7A0B\u5206\u6790\n */\nexport interface ExecutionFlow {\n  // \u4E3B\u5165\u53E3\u6587\u4EF6\n  mainEntry: EntryPoint | null;\n  // \u542F\u52A8\u547D\u4EE4\n  startCommand: string | null;\n  // \u6267\u884C\u6D41\u7A0B\u6B65\u9AA4\n  flowSteps: FlowStep[];\n  // \u6838\u5FC3\u6A21\u5757\u4F9D\u8D56\u56FE\n  moduleDependencies: ModuleDependency[];\n  // \u6570\u636E\u6D41\u5411\n  dataFlow: string;\n}\n\nexport interface EntryPoint {\n  file: string;\n  type: 'main' | 'index' | 'app' | 'server' | 'cli' | 'extension';\n  description: string;\n  // \u5165\u53E3\u6587\u4EF6\u5BFC\u51FA\u7684\u4E3B\u8981\u5185\u5BB9\n  exports?: string[];\n}\n\nexport interface FlowStep {\n  order: number;\n  description: string;\n  file?: string;\n  type: 'init' | 'config' | 'middleware' | 'route' | 'handler' | 'render' | 'export';\n}\n\nexport interface ModuleDependency {\n  from: string;\n  to: string;\n  type: 'import' | 'require' | 'dynamic';\n}\n\nexport interface DirectoryNode {\n  name: string;\n  type: 'file' | 'directory';\n  path: string;\n  children?: DirectoryNode[];\n  size?: number;\n  language?: string;\n}\n\nexport interface CodeStats {\n  totalFiles: number;\n  totalLines: number;\n  byLanguage: Record<string, { files: number; lines: number }>;\n  byDirectory: Record<string, { files: number; lines: number }>;\n}\n\nexport interface DependencyInfo {\n  runtime: string[];\n  development: string[];\n  total: number;\n  outdated?: string[];\n  security?: string[];\n}\n\nexport interface ModuleInfo {\n  name: string;\n  path: string;\n  type: string;\n  exports?: string[];\n  imports?: string[];\n  description?: string;\n}\n\nexport interface ArchitectureInfo {\n  pattern?: string;  // MVC, MVVM, Microservices, etc.\n  layers: string[];\n  dataFlow?: string;\n  keyComponents: string[];\n}\n\nexport interface QualityIndicators {\n  hasTests: boolean;\n  testCoverage?: number;\n  hasLinting: boolean;\n  hasTypeScript: boolean;\n  hasCI: boolean;\n  hasDocumentation: boolean;\n  securityScore?: number;\n}\n\nexport interface ScriptInfo {\n  name: string;\n  command: string;\n  description?: string;\n}\n\n/**\n * \u589E\u5F3A\u7684\u9879\u76EE\u5206\u6790\u5668\n */\nexport class EnhancedProjectAnalyzer {\n  private _ignoreDirs = [\n    'node_modules', '.git', 'dist', 'build', '__pycache__', \n    'venv', '.venv', 'target', 'coverage', '.next', '.nuxt',\n    'vendor', 'bin', 'obj', '.idea', '.vscode'\n  ];\n  \n  private _ignoreFiles = [\n    '.DS_Store', 'Thumbs.db', '.gitignore', '.npmrc',\n    'package-lock.json', 'yarn.lock', 'pnpm-lock.yaml'\n  ];\n\n  /**\n   * \u6267\u884C\u5B8C\u6574\u7684\u9879\u76EE\u5206\u6790\n   */\n  async analyzeProject(workspaceRoot: string): Promise<ProjectAnalysis> {\n    const name = path.basename(workspaceRoot);\n    \n    // \u5E76\u884C\u6267\u884C\u5404\u9879\u5206\u6790\n    const [\n      projectType,\n      structure,\n      codeStats,\n      modules,\n      qualityIndicators,\n    ] = await Promise.all([\n      this._detectProjectType(workspaceRoot),\n      this._buildStructure(workspaceRoot, 3),\n      this._analyzeCodeStats(workspaceRoot),\n      this._analyzeModules(workspaceRoot),\n      this._analyzeQuality(workspaceRoot),\n    ]);\n\n    const dependencies = await this._analyzeDependencies(workspaceRoot, projectType.type);\n    const architecture = this._inferArchitecture(structure, projectType);\n    const entryPoints = this._findEntryPoints(workspaceRoot, projectType);\n    const configFiles = this._findConfigFiles(workspaceRoot);\n    const scripts = this._extractScripts(workspaceRoot, projectType.type);\n    \n    // \uD83C\uDD95 \u5206\u6790\u9879\u76EE\u529F\u80FD\n    const projectPurpose = await this._analyzeProjectPurpose(workspaceRoot, projectType, dependencies);\n    \n    // \uD83C\uDD95 \u5206\u6790\u6267\u884C\u6D41\u7A0B\n    const executionFlow = await this._analyzeExecutionFlow(workspaceRoot, projectType, entryPoints, modules);\n    \n    // \uD83C\uDD95 \u626B\u63CF Markdown \u6587\u6863\n    const markdownDocs = await this._scanMarkdownDocs(workspaceRoot);\n    \n    // \u751F\u6210 AI \u4E0A\u4E0B\u6587\u6458\u8981\uFF08\u589E\u5F3A\u7248\uFF0C\u5305\u542B MD \u6587\u6863\uFF09\n    const contextSummary = this._generateContextSummary({\n      name,\n      type: projectType.type,\n      framework: projectType.framework,\n      language: projectType.language,\n      codeStats,\n      modules,\n      architecture,\n      projectPurpose,\n      executionFlow,\n      markdownDocs,\n    });\n\n    return {\n      name,\n      root: workspaceRoot,\n      type: projectType.type,\n      framework: projectType.framework,\n      language: projectType.language,\n      projectPurpose,\n      executionFlow,\n      structure,\n      entryPoints,\n      configFiles,\n      codeStats,\n      dependencies,\n      modules,\n      architecture,\n      qualityIndicators,\n      scripts,\n      contextSummary,\n      markdownDocs,\n    };\n  }\n\n  /**\n   * \u751F\u6210\u7B80\u6D01\u7684\u9879\u76EE\u62A5\u544A\uFF08\u7528\u4E8E\u663E\u793A\uFF09\n   * \u4F18\u5316\u7248\uFF1A\u79FB\u9664\u5197\u4F59\u4FE1\u606F\uFF0C\u805A\u7126\u4E8E\u771F\u6B63\u6709\u4EF7\u503C\u7684\u5185\u5BB9\n   */\n  generateReport(analysis: ProjectAnalysis): string {\n    const sections: string[] = [];\n\n    // \u6807\u9898\n    sections.push(`## \uD83E\uDD16 \u9879\u76EE\u5206\u6790: ${analysis.name}\\n`);\n\n    // \u9879\u76EE\u7B80\u4ECB\uFF08\u6700\u91CD\u8981\uFF09\n    if (analysis.projectPurpose) {\n      const desc = analysis.projectPurpose.description;\n      const category = this._getCategoryLabel(analysis.projectPurpose.category);\n      \n      if (desc && desc !== '\u672A\u68C0\u6D4B\u5230\u9879\u76EE\u63CF\u8FF0') {\n        sections.push(`> ${desc}\\n`);\n      }\n      \n      // \u7B80\u6D01\u7684\u4E00\u884C\u6982\u8981\n      const techStack = analysis.projectPurpose.techStack.slice(0, 4).join(', ');\n      sections.push(`**${category}** | ${analysis.language}${techStack ? ` | ${techStack}` : ''}\\n`);\n    } else {\n      sections.push(`**${analysis.type}** | ${analysis.language}\\n`);\n    }\n\n    // \u6838\u5FC3\u5165\u53E3\uFF08\u5982\u679C\u6709\uFF09\n    if (analysis.executionFlow?.mainEntry) {\n      sections.push(`\uD83D\uDCCD **\u5165\u53E3**: \\`${analysis.executionFlow.mainEntry.file}\\``);\n      if (analysis.executionFlow.startCommand) {\n        sections.push(`\u25B6\uFE0F **\u542F\u52A8**: \\`${analysis.executionFlow.startCommand}\\``);\n      }\n      sections.push('');\n    }\n\n    // \u9879\u76EE\u89C4\u6A21\uFF08\u7B80\u6D01\u7248\uFF09\n    const totalLines = analysis.codeStats.totalLines;\n    const totalFiles = analysis.codeStats.totalFiles;\n    const sizeDesc = totalLines > 10000 ? '\u5927\u578B' : totalLines > 3000 ? '\u4E2D\u578B' : '\u5C0F\u578B';\n    sections.push(`\uD83D\uDCCA **\u89C4\u6A21**: ${sizeDesc}\u9879\u76EE (${totalFiles} \u6587\u4EF6, ${totalLines.toLocaleString()} \u884C)\\n`);\n\n    // \u6838\u5FC3\u6A21\u5757\uFF08\u66F4\u7B80\u6D01\uFF09\n    if (analysis.modules.length > 0) {\n      const coreModules = analysis.modules\n        .filter(m => m.description || ['src', 'app', 'lib', 'core'].includes(m.name.toLowerCase()))\n        .slice(0, 5);\n      \n      if (coreModules.length > 0) {\n        sections.push(`\uD83D\uDCE6 **\u6838\u5FC3\u6A21\u5757**`);\n        for (const mod of coreModules) {\n          sections.push(`- \\`${mod.name}/\\` ${mod.description || ''}`);\n        }\n        sections.push('');\n      }\n    }\n\n    // \u5173\u952E\u4F9D\u8D56\uFF08\u53EA\u663E\u793A\u6700\u91CD\u8981\u7684\uFF09\n    if (analysis.dependencies.runtime.length > 0) {\n      const keyDeps = analysis.dependencies.runtime.slice(0, 6);\n      sections.push(`\uD83D\uDCDA **\u5173\u952E\u4F9D\u8D56**: ${keyDeps.join(', ')}${analysis.dependencies.runtime.length > 6 ? '...' : ''}\\n`);\n    }\n\n    // \u53EF\u7528\u547D\u4EE4\uFF08\u53EA\u663E\u793A\u6700\u5E38\u7528\u7684\uFF09\n    if (analysis.scripts.length > 0) {\n      const importantScripts = analysis.scripts\n        .filter(s => ['dev', 'start', 'build', 'test'].includes(s.name.toLowerCase()))\n        .slice(0, 4);\n      \n      if (importantScripts.length > 0) {\n        const scriptStr = importantScripts.map(s => `\\`${s.name}\\``).join(' | ');\n        sections.push(`\uD83D\uDD27 **\u547D\u4EE4**: ${scriptStr}\\n`);\n      }\n    }\n\n    // \u5206\u9694\u7EBF\u548C AI \u5206\u6790\u63D0\u793A\n    sections.push(`---`);\n    sections.push(`\uD83D\uDCAC **\u73B0\u5728\u53EF\u4EE5\u95EE\u6211**\uFF1A`);\n    sections.push(`- \u8FD9\u4E2A\u9879\u76EE\u662F\u505A\u4EC0\u4E48\u7684\uFF1F\u67B6\u6784\u662F\u600E\u6837\u7684\uFF1F`);\n    sections.push(`- \u5E2E\u6211\u7406\u89E3 [\u67D0\u4E2A\u6587\u4EF6/\u6A21\u5757] \u7684\u903B\u8F91`);\n    sections.push(`- \u6211\u60F3\u6DFB\u52A0 [\u67D0\u4E2A\u529F\u80FD]\uFF0C\u5E94\u8BE5\u600E\u4E48\u505A\uFF1F`);\n\n    return sections.join('\\n');\n  }\n\n  /**\n   * \u83B7\u53D6\u9879\u76EE\u7C7B\u522B\u7684\u4E2D\u6587\u6807\u7B7E\n   */\n  private _getCategoryLabel(category: ProjectCategory): string {\n    const labels: Record<ProjectCategory, string> = {\n      'web-frontend': '\uD83C\uDF10 \u524D\u7AEF\u5E94\u7528',\n      'web-backend': '\u2699\uFE0F \u540E\u7AEF\u670D\u52A1',\n      'fullstack': '\uD83D\uDD04 \u5168\u6808\u5E94\u7528',\n      'cli-tool': '\uD83D\uDCBB \u547D\u4EE4\u884C\u5DE5\u5177',\n      'library': '\uD83D\uDCDA \u5E93/SDK',\n      'vscode-extension': '\uD83E\uDDE9 VSCode \u63D2\u4EF6',\n      'mobile-app': '\uD83D\uDCF1 \u79FB\u52A8\u5E94\u7528',\n      'desktop-app': '\uD83D\uDDA5\uFE0F \u684C\u9762\u5E94\u7528',\n      'api-service': '\uD83D\uDD0C API \u670D\u52A1',\n      'data-processing': '\uD83D\uDCCA \u6570\u636E\u5904\u7406',\n      'ml-ai': '\uD83E\uDD16 \u673A\u5668\u5B66\u4E60/AI',\n      'unknown': '\u2753 \u672A\u77E5\u7C7B\u578B',\n    };\n    return labels[category] || category;\n  }\n\n  /**\n   * \u83B7\u53D6\u6587\u6863\u7C7B\u578B\u7684\u4E2D\u6587\u6807\u7B7E\n   */\n  private _getDocTypeLabel(docType: MarkdownDocInfo['docType']): string {\n    const labels: Record<MarkdownDocInfo['docType'], string> = {\n      'readme': '\u8BF4\u660E\u6587\u6863',\n      'changelog': '\u66F4\u65B0\u65E5\u5FD7',\n      'contributing': '\u8D21\u732E\u6307\u5357',\n      'api': 'API\u6587\u6863',\n      'guide': '\u4F7F\u7528\u6307\u5357',\n      'architecture': '\u67B6\u6784\u6587\u6863',\n      'other': '\u5176\u4ED6',\n    };\n    return labels[docType] || '\u6587\u6863';\n  }\n\n  /**\n   * \u6E32\u67D3\u6811\u5F62\u7ED3\u6784\uFF08\u4F7F\u7528ASCII\u6811\u5F62\u7B26\u53F7\uFF09\n   */\n  private _renderTreeStructure(node: DirectoryNode, prefix: string = '', isLast: boolean = true): string {\n    let result = '';\n    const nodePrefix = prefix + (isLast ? '\u2514\u2500\u2500 ' : '\u251C\u2500\u2500 ');\n    const childPrefix = prefix + (isLast ? '    ' : '\u2502   ');\n    \n    // \u5982\u679C\u662F\u6839\u8282\u70B9\n    if (prefix === '') {\n      result = `${node.name}/\\n`;\n    } else {\n      const icon = node.type === 'directory' ? '\uD83D\uDCC1' : '\uD83D\uDCC4';\n      const name = node.type === 'directory' ? `${node.name}/` : node.name;\n      result = `${nodePrefix}${icon} ${name}\\n`;\n    }\n    \n    // \u5904\u7406\u5B50\u8282\u70B9\n    if (node.children && node.children.length > 0) {\n      // \u6392\u5E8F\uFF1A\u6587\u4EF6\u5939\u5728\u524D\uFF0C\u6587\u4EF6\u5728\u540E\n      const sortedChildren = [...node.children].sort((a, b) => {\n        if (a.type === b.type) return a.name.localeCompare(b.name);\n        return a.type === 'directory' ? -1 : 1;\n      });\n      \n      // \u9650\u5236\u663E\u793A\u6570\u91CF\n      const displayLimit = 12;\n      const childrenToShow = sortedChildren.slice(0, displayLimit);\n      const hasMore = sortedChildren.length > displayLimit;\n      \n      childrenToShow.forEach((child, index) => {\n        const isChildLast = index === childrenToShow.length - 1 && !hasMore;\n        result += this._renderTreeStructure(child, prefix === '' ? '' : childPrefix, isChildLast);\n      });\n      \n      if (hasMore) {\n        result += `${childPrefix}\u2514\u2500\u2500 ... (\u8FD8\u6709 ${sortedChildren.length - displayLimit} \u4E2A\u9879\u76EE)\\n`;\n      }\n    }\n    \n    return result;\n  }\n\n  /**\n   * \u751F\u6210 AI \u4E0A\u4E0B\u6587\u6458\u8981 - \u589E\u5F3A\u7248\n   * \u5305\u542B\u9879\u76EE\u63CF\u8FF0\u3001README\u6458\u8981\u7B49\u66F4\u6709\u4EF7\u503C\u7684\u4FE1\u606F\n   */\n  generateContextForAI(analysis: ProjectAnalysis): string {\n    const sections: string[] = [];\n    \n    // \u9879\u76EE\u57FA\u672C\u4FE1\u606F\n    sections.push(`## \u9879\u76EE\u4E0A\u4E0B\u6587`);\n    sections.push(`**\u9879\u76EE**: ${analysis.name}`);\n    sections.push(`**\u7C7B\u578B**: ${analysis.type}${analysis.framework ? ` (${analysis.framework})` : ''}`);\n    sections.push(`**\u8BED\u8A00**: ${analysis.language}`);\n    sections.push(`**\u89C4\u6A21**: ${analysis.codeStats.totalFiles} \u6587\u4EF6, ${analysis.codeStats.totalLines.toLocaleString()} \u884C`);\n    \n    // \u9879\u76EE\u63CF\u8FF0\uFF08\u6765\u81EA README \u6216 package.json\uFF09\n    if (analysis.projectPurpose?.description) {\n      sections.push(`\\n**\u9879\u76EE\u63CF\u8FF0**: ${analysis.projectPurpose.description}`);\n    }\n    \n    // \u6280\u672F\u6808\n    if (analysis.projectPurpose?.techStack?.length > 0) {\n      sections.push(`**\u6280\u672F\u6808**: ${analysis.projectPurpose.techStack.join(', ')}`);\n    }\n    \n    // \u5165\u53E3\u548C\u542F\u52A8\u547D\u4EE4\n    if (analysis.executionFlow?.mainEntry) {\n      sections.push(`\\n**\u4E3B\u5165\u53E3**: ${analysis.executionFlow.mainEntry.file}`);\n    }\n    if (analysis.executionFlow?.startCommand) {\n      sections.push(`**\u542F\u52A8\u547D\u4EE4**: ${analysis.executionFlow.startCommand}`);\n    }\n    \n    // \u76EE\u5F55\u7ED3\u6784\n    if (analysis.modules.length > 0) {\n      sections.push(`\\n**\u76EE\u5F55\u7ED3\u6784**:`);\n      for (const m of analysis.modules.slice(0, 10)) {\n        sections.push(`- ${m.name}/: ${m.description || m.type}`);\n      }\n    }\n    \n    // \u67B6\u6784\u4FE1\u606F\n    if (analysis.architecture.pattern) {\n      sections.push(`\\n**\u67B6\u6784\u6A21\u5F0F**: ${analysis.architecture.pattern}`);\n    }\n    if (analysis.architecture.keyComponents.length > 0) {\n      sections.push(`**\u6838\u5FC3\u6A21\u5757**: ${analysis.architecture.keyComponents.join(', ')}`);\n    }\n    \n    // \u4E3B\u8981\u4F9D\u8D56\n    if (analysis.dependencies.runtime.length > 0) {\n      sections.push(`\\n**\u4E3B\u8981\u4F9D\u8D56**: ${analysis.dependencies.runtime.slice(0, 12).join(', ')}`);\n    }\n    \n    // README \u6458\u8981\uFF08\u6700\u91CD\u8981\u7684\u4E0A\u4E0B\u6587\uFF09\n    if (analysis.markdownDocs?.length > 0) {\n      const readme = analysis.markdownDocs.find(d => d.docType === 'readme');\n      if (readme?.summary) {\n        sections.push(`\\n**README \u6458\u8981**:`);\n        sections.push(readme.summary.slice(0, 800));\n      }\n    }\n    \n    sections.push(`\\n---`);\n    sections.push(`\u8BF7\u57FA\u4E8E\u4EE5\u4E0A\u9879\u76EE\u4E0A\u4E0B\u6587\u6765\u56DE\u7B54\u7528\u6237\u7684\u95EE\u9898\u3002`);\n    \n    return sections.join('\\n');\n  }\n\n  // ==================== \u79C1\u6709\u65B9\u6CD5 ====================\n\n  private async _detectProjectType(root: string): Promise<{\n    type: string;\n    framework?: string;\n    language: string;\n  }> {\n    const files = fs.readdirSync(root);\n    let type = '';\n    let framework: string | undefined;\n    let language = '';\n    \n    // \u6536\u96C6\u6240\u6709\u8BED\u8A00\u68C0\u6D4B\u7ED3\u679C\n    const detectedLanguages: Map<string, number> = new Map();\n\n    // Node.js / JavaScript / TypeScript\n    if (files.includes('package.json')) {\n      type = 'Node.js';\n      language = 'JavaScript';\n      \n      try {\n        const pkg = JSON.parse(fs.readFileSync(path.join(root, 'package.json'), 'utf-8'));\n        const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n        \n        // \u68C0\u6D4B\u6846\u67B6\n        if (deps['react'] && deps['next']) framework = 'Next.js';\n        else if (deps['react']) framework = 'React';\n        else if (deps['vue'] && deps['nuxt']) framework = 'Nuxt.js';\n        else if (deps['vue']) framework = 'Vue.js';\n        else if (deps['@angular/core']) framework = 'Angular';\n        else if (deps['svelte']) framework = 'Svelte';\n        else if (deps['express']) framework = 'Express';\n        else if (deps['fastify']) framework = 'Fastify';\n        else if (deps['nestjs'] || deps['@nestjs/core']) framework = 'NestJS';\n        else if (deps['koa']) framework = 'Koa';\n        else if (deps['vscode']) framework = 'VS Code Extension';\n        else if (deps['electron']) framework = 'Electron';\n        \n        // TypeScript \u68C0\u6D4B\n        if (deps['typescript'] || files.includes('tsconfig.json')) {\n          language = 'TypeScript';\n        }\n      } catch {}\n    }\n    // Python\n    else if (files.includes('requirements.txt') || files.includes('setup.py') || files.includes('pyproject.toml')) {\n      type = 'Python';\n      language = 'Python';\n      \n      if (files.includes('manage.py')) framework = 'Django';\n      else {\n        // \u68C0\u67E5\u5E38\u89C1\u6846\u67B6\n        const checkFiles = ['app.py', 'main.py', 'run.py'];\n        for (const f of checkFiles) {\n          if (files.includes(f)) {\n            try {\n              const content = fs.readFileSync(path.join(root, f), 'utf-8');\n              if (content.includes('Flask')) framework = 'Flask';\n              else if (content.includes('FastAPI')) framework = 'FastAPI';\n              else if (content.includes('Django')) framework = 'Django';\n            } catch {}\n          }\n        }\n      }\n    }\n    // Go\n    else if (files.includes('go.mod')) {\n      type = 'Go';\n      language = 'Go';\n      \n      try {\n        const modContent = fs.readFileSync(path.join(root, 'go.mod'), 'utf-8');\n        if (modContent.includes('gin-gonic')) framework = 'Gin';\n        else if (modContent.includes('echo')) framework = 'Echo';\n        else if (modContent.includes('fiber')) framework = 'Fiber';\n      } catch {}\n    }\n    // Rust\n    else if (files.includes('Cargo.toml')) {\n      type = 'Rust';\n      language = 'Rust';\n    }\n    // Java\n    else if (files.includes('pom.xml')) {\n      type = 'Java (Maven)';\n      language = 'Java';\n      framework = 'Maven';\n    }\n    else if (files.includes('build.gradle') || files.includes('build.gradle.kts')) {\n      type = 'Java (Gradle)';\n      language = 'Java';\n      framework = 'Gradle';\n    }\n    \n    // \u5982\u679C\u8FD8\u6CA1\u6709\u68C0\u6D4B\u5230\u7C7B\u578B\uFF0C\u901A\u8FC7\u6587\u4EF6\u626B\u63CF\u6765\u5224\u65AD\n    if (!type || !language) {\n      const languageCounts = await this._scanProjectLanguages(root);\n      \n      // \u627E\u51FA\u6700\u4E3B\u8981\u7684\u8BED\u8A00\n      let maxCount = 0;\n      let primaryLang = '';\n      for (const [lang, count] of Object.entries(languageCounts)) {\n        if (count > maxCount) {\n          maxCount = count;\n          primaryLang = lang;\n        }\n      }\n      \n      if (primaryLang) {\n        language = primaryLang;\n        // \u6839\u636E\u4E3B\u8981\u8BED\u8A00\u63A8\u65AD\u9879\u76EE\u7C7B\u578B\n        const langToType: Record<string, string> = {\n          'TypeScript': 'TypeScript \u9879\u76EE',\n          'JavaScript': 'JavaScript \u9879\u76EE',\n          'Python': 'Python \u9879\u76EE',\n          'Java': 'Java \u9879\u76EE',\n          'Go': 'Go \u9879\u76EE',\n          'Rust': 'Rust \u9879\u76EE',\n          'C': 'C/C++ \u9879\u76EE',\n          'C++': 'C/C++ \u9879\u76EE',\n          'Ruby': 'Ruby \u9879\u76EE',\n          'PHP': 'PHP \u9879\u76EE',\n          'Swift': 'Swift \u9879\u76EE',\n          'Kotlin': 'Kotlin \u9879\u76EE',\n          'Vue': 'Vue.js \u9879\u76EE',\n          'HTML': 'Web \u9879\u76EE',\n          'CSS': 'Web \u9879\u76EE',\n        };\n        type = langToType[primaryLang] || `${primaryLang} \u9879\u76EE`;\n      }\n    }\n    \n    // \u6700\u7EC8\u7684\u9ED8\u8BA4\u503C\n    if (!type) type = '\u901A\u7528\u9879\u76EE';\n    if (!language) language = '\u6DF7\u5408\u8BED\u8A00';\n\n    return { type, framework, language };\n  }\n  \n  /**\n   * \u626B\u63CF\u9879\u76EE\u76EE\u5F55\u7EDF\u8BA1\u5404\u8BED\u8A00\u6587\u4EF6\u6570\u91CF\n   */\n  private async _scanProjectLanguages(root: string): Promise<Record<string, number>> {\n    const counts: Record<string, number> = {};\n    \n    const walk = (dir: string, depth: number = 0) => {\n      if (depth > 3) return; // \u9650\u5236\u6DF1\u5EA6\n      \n      try {\n        const entries = fs.readdirSync(dir, { withFileTypes: true });\n        \n        for (const entry of entries) {\n          if (entry.name.startsWith('.') || this._ignoreDirs.includes(entry.name)) {\n            continue;\n          }\n          \n          const fullPath = path.join(dir, entry.name);\n          \n          if (entry.isDirectory()) {\n            walk(fullPath, depth + 1);\n          } else {\n            const lang = this._getLanguage(entry.name);\n            if (lang !== 'Unknown') {\n              counts[lang] = (counts[lang] || 0) + 1;\n            }\n          }\n        }\n      } catch {}\n    };\n    \n    walk(root);\n    return counts;\n  }\n\n  private async _buildStructure(dir: string, maxDepth: number, currentDepth = 0): Promise<DirectoryNode> {\n    const name = path.basename(dir);\n    const node: DirectoryNode = {\n      name,\n      type: 'directory',\n      path: dir,\n      children: [],\n    };\n\n    if (currentDepth >= maxDepth) {\n      return node;\n    }\n\n    try {\n      const entries = fs.readdirSync(dir, { withFileTypes: true });\n      \n      for (const entry of entries) {\n        if (entry.name.startsWith('.') || \n            this._ignoreDirs.includes(entry.name) ||\n            this._ignoreFiles.includes(entry.name)) {\n          continue;\n        }\n\n        const fullPath = path.join(dir, entry.name);\n        \n        if (entry.isDirectory()) {\n          const childNode = await this._buildStructure(fullPath, maxDepth, currentDepth + 1);\n          node.children?.push(childNode);\n        } else {\n          node.children?.push({\n            name: entry.name,\n            type: 'file',\n            path: fullPath,\n            language: this._getLanguage(entry.name),\n          });\n        }\n      }\n    } catch {}\n\n    return node;\n  }\n\n  private async _analyzeCodeStats(root: string): Promise<CodeStats> {\n    const stats: CodeStats = {\n      totalFiles: 0,\n      totalLines: 0,\n      byLanguage: {},\n      byDirectory: {},\n    };\n\n    const walk = (dir: string, relDir: string = '') => {\n      try {\n        const entries = fs.readdirSync(dir, { withFileTypes: true });\n        \n        for (const entry of entries) {\n          if (entry.name.startsWith('.') || this._ignoreDirs.includes(entry.name)) {\n            continue;\n          }\n\n          const fullPath = path.join(dir, entry.name);\n          const relPath = path.join(relDir, entry.name);\n\n          if (entry.isDirectory()) {\n            walk(fullPath, relPath);\n          } else {\n            const ext = path.extname(entry.name).toLowerCase();\n            const lang = this._getLanguage(entry.name);\n            \n            if (lang !== 'Unknown') {\n              const lines = this._countLines(fullPath);\n              \n              stats.totalFiles++;\n              stats.totalLines += lines;\n\n              if (!stats.byLanguage[lang]) {\n                stats.byLanguage[lang] = { files: 0, lines: 0 };\n              }\n              stats.byLanguage[lang].files++;\n              stats.byLanguage[lang].lines += lines;\n\n              const topDir = relDir.split(path.sep)[0] || '/';\n              if (!stats.byDirectory[topDir]) {\n                stats.byDirectory[topDir] = { files: 0, lines: 0 };\n              }\n              stats.byDirectory[topDir].files++;\n              stats.byDirectory[topDir].lines += lines;\n            }\n          }\n        }\n      } catch {}\n    };\n\n    walk(root);\n    return stats;\n  }\n\n  private async _analyzeModules(root: string): Promise<ModuleInfo[]> {\n    const modules: ModuleInfo[] = [];\n    const srcDirs = ['src', 'app', 'lib', 'components', 'pages', 'api', 'services', \n                     'utils', 'hooks', 'store', 'models', 'controllers', 'views', \n                     'routes', 'middleware', 'config', 'types', 'interfaces'];\n\n    for (const dir of srcDirs) {\n      const dirPath = path.join(root, dir);\n      if (fs.existsSync(dirPath) && fs.statSync(dirPath).isDirectory()) {\n        const mod: ModuleInfo = {\n          name: dir,\n          path: dirPath,\n          type: this._inferModuleType(dir),\n          description: this._getModuleDescription(dir),\n        };\n        \n        // \u5206\u6790\u5B50\u6A21\u5757\n        try {\n          const subDirs = fs.readdirSync(dirPath, { withFileTypes: true })\n            .filter(d => d.isDirectory() && !d.name.startsWith('.'))\n            .map(d => d.name);\n          \n          if (subDirs.length > 0) {\n            mod.exports = subDirs.slice(0, 10);\n          }\n        } catch {}\n        \n        modules.push(mod);\n      }\n    }\n\n    return modules;\n  }\n\n  private async _analyzeDependencies(root: string, projectType: string): Promise<DependencyInfo> {\n    const deps: DependencyInfo = {\n      runtime: [],\n      development: [],\n      total: 0,\n    };\n\n    if (projectType.includes('Node')) {\n      try {\n        const pkg = JSON.parse(fs.readFileSync(path.join(root, 'package.json'), 'utf-8'));\n        deps.runtime = Object.keys(pkg.dependencies || {});\n        deps.development = Object.keys(pkg.devDependencies || {});\n        deps.total = deps.runtime.length + deps.development.length;\n      } catch {}\n    } else if (projectType === 'Python') {\n      try {\n        if (fs.existsSync(path.join(root, 'requirements.txt'))) {\n          const content = fs.readFileSync(path.join(root, 'requirements.txt'), 'utf-8');\n          deps.runtime = content.split('\\n')\n            .filter(l => l.trim() && !l.startsWith('#'))\n            .map(l => l.split('==')[0].split('>=')[0].trim());\n          deps.total = deps.runtime.length;\n        }\n      } catch {}\n    }\n\n    return deps;\n  }\n\n  private async _analyzeQuality(root: string): Promise<QualityIndicators> {\n    const files = fs.readdirSync(root);\n    \n    return {\n      hasTests: files.some(f => ['test', 'tests', '__tests__', 'spec'].includes(f)) ||\n                files.some(f => f.includes('.test.') || f.includes('.spec.')),\n      hasLinting: files.includes('.eslintrc.js') || files.includes('.eslintrc.json') || \n                  files.includes('.prettierrc') || files.includes('pylint.cfg'),\n      hasTypeScript: files.includes('tsconfig.json'),\n      hasCI: files.includes('.github') || files.includes('.gitlab-ci.yml') || \n             files.includes('Jenkinsfile') || files.includes('.circleci'),\n      hasDocumentation: files.includes('README.md') || files.includes('docs') ||\n                        files.includes('CHANGELOG.md'),\n    };\n  }\n\n  private _inferArchitecture(structure: DirectoryNode, projectType: { type: string; framework?: string }): ArchitectureInfo {\n    const dirs = structure.children?.map(c => c.name) || [];\n    const layers: string[] = [];\n    const keyComponents: string[] = [];\n    let pattern: string | undefined;\n\n    // \u68C0\u6D4B\u67B6\u6784\u6A21\u5F0F\n    if (dirs.includes('controllers') && dirs.includes('models') && dirs.includes('views')) {\n      pattern = 'MVC';\n      layers.push('Views', 'Controllers', 'Models');\n    } else if (dirs.includes('components') && dirs.includes('store')) {\n      pattern = 'Flux/Redux';\n      layers.push('Components', 'Actions', 'Store');\n    } else if (dirs.includes('pages') && dirs.includes('components')) {\n      pattern = 'Component-Based';\n      layers.push('Pages', 'Components', 'Utils');\n    } else if (dirs.includes('domain') && dirs.includes('infrastructure')) {\n      pattern = 'Clean Architecture';\n      layers.push('Presentation', 'Domain', 'Infrastructure');\n    } else if (dirs.includes('services') && dirs.includes('api')) {\n      pattern = 'Service-Oriented';\n      layers.push('API', 'Services', 'Data');\n    }\n\n    // \u8BC6\u522B\u6838\u5FC3\u7EC4\u4EF6\n    const importantDirs = ['src', 'app', 'lib', 'core', 'api', 'services'];\n    for (const dir of importantDirs) {\n      if (dirs.includes(dir)) {\n        keyComponents.push(dir);\n      }\n    }\n\n    return {\n      pattern,\n      layers,\n      keyComponents,\n    };\n  }\n\n  /**\n   * \uD83C\uDD95 \u5206\u6790\u9879\u76EE\u529F\u80FD\u548C\u7528\u9014\n   */\n  private async _analyzeProjectPurpose(\n    root: string, \n    projectType: { type: string; framework?: string; language: string },\n    dependencies: DependencyInfo\n  ): Promise<ProjectPurpose> {\n    let description = '';\n    let category: ProjectCategory = 'unknown';\n    const features: string[] = [];\n    const techStack: string[] = [];\n    let targetAudience: string | undefined;\n\n    // 1. \u4ECE package.json \u63D0\u53D6\u63CF\u8FF0\n    try {\n      const pkgPath = path.join(root, 'package.json');\n      if (fs.existsSync(pkgPath)) {\n        const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n        if (pkg.description) {\n          description = pkg.description;\n        }\n        // \u4ECE keywords \u63D0\u53D6\u7279\u6027\n        if (pkg.keywords && Array.isArray(pkg.keywords)) {\n          features.push(...pkg.keywords.slice(0, 5));\n        }\n      }\n    } catch {}\n\n    // 2. \u4ECE README.md \u63D0\u53D6\u66F4\u591A\u4FE1\u606F\n    try {\n      const readmePath = path.join(root, 'README.md');\n      if (fs.existsSync(readmePath)) {\n        const readme = fs.readFileSync(readmePath, 'utf-8');\n        \n        // \u63D0\u53D6\u7B2C\u4E00\u6BB5\u4F5C\u4E3A\u63CF\u8FF0\uFF08\u5982\u679C package.json \u6CA1\u6709\uFF09\n        if (!description) {\n          const firstParagraph = readme.match(/^#[^#].*\\n\\n([^#\\n][^\\n]+)/m);\n          if (firstParagraph) {\n            description = firstParagraph[1].trim().slice(0, 200);\n          }\n        }\n        \n        // \u63D0\u53D6\u529F\u80FD\u7279\u6027\uFF08\u4ECE ## Features \u6216 ## \u529F\u80FD \u90E8\u5206\uFF09\n        const featuresMatch = readme.match(/##\\s*(Features|\u529F\u80FD|\u7279\u6027)[^\\n]*\\n([\\s\\S]*?)(?=\\n##|$)/i);\n        if (featuresMatch) {\n          const featureList = featuresMatch[2].match(/[-*]\\s+(.+)/g);\n          if (featureList) {\n            features.push(...featureList.slice(0, 8).map(f => f.replace(/^[-*]\\s+/, '').trim()));\n          }\n        }\n      }\n    } catch {}\n\n    // 3. \u5224\u65AD\u9879\u76EE\u7C7B\u522B\n    category = this._detectProjectCategory(projectType, dependencies, root);\n\n    // 4. \u6784\u5EFA\u6280\u672F\u6808\n    if (projectType.framework) {\n      techStack.push(projectType.framework);\n    }\n    techStack.push(projectType.language);\n    \n    // \u4ECE\u4F9D\u8D56\u63A8\u65AD\u6280\u672F\u6808\n    const techDeps = this._extractTechStackFromDeps(dependencies.runtime);\n    techStack.push(...techDeps);\n\n    // 5. \u63A8\u65AD\u76EE\u6807\u7528\u6237\n    targetAudience = this._inferTargetAudience(category, features);\n\n    return {\n      description: description || `${projectType.type} \u9879\u76EE`,\n      category,\n      features: [...new Set(features)].slice(0, 10),\n      targetAudience,\n      techStack: [...new Set(techStack)].slice(0, 8),\n    };\n  }\n\n  /**\n   * \u68C0\u6D4B\u9879\u76EE\u7C7B\u522B\n   */\n  private _detectProjectCategory(\n    projectType: { type: string; framework?: string },\n    dependencies: DependencyInfo,\n    root: string\n  ): ProjectCategory {\n    const deps = dependencies.runtime.join(' ').toLowerCase();\n    const devDeps = dependencies.development.join(' ').toLowerCase();\n    const framework = projectType.framework?.toLowerCase() || '';\n    const files = fs.readdirSync(root);\n\n    // VSCode \u63D2\u4EF6\n    if (deps.includes('vscode') || files.includes('.vscodeignore')) {\n      return 'vscode-extension';\n    }\n\n    // CLI \u5DE5\u5177\n    if (deps.includes('commander') || deps.includes('yargs') || deps.includes('inquirer') || \n        deps.includes('chalk') || deps.includes('ora') || deps.includes('argparse')) {\n      return 'cli-tool';\n    }\n\n    // \u524D\u7AEF\u5E94\u7528\n    if (framework.includes('react') || framework.includes('vue') || framework.includes('angular') ||\n        framework.includes('svelte') || framework.includes('next') || framework.includes('nuxt')) {\n      if (deps.includes('express') || deps.includes('fastify') || deps.includes('koa')) {\n        return 'fullstack';\n      }\n      return 'web-frontend';\n    }\n\n    // \u540E\u7AEF\u670D\u52A1\n    if (deps.includes('express') || deps.includes('fastify') || deps.includes('koa') ||\n        deps.includes('nestjs') || deps.includes('hapi') || deps.includes('flask') ||\n        deps.includes('django') || deps.includes('fastapi')) {\n      return 'web-backend';\n    }\n\n    // API \u670D\u52A1\n    if (deps.includes('graphql') || deps.includes('apollo') || deps.includes('trpc') ||\n        files.includes('swagger.json') || files.includes('openapi.yaml')) {\n      return 'api-service';\n    }\n\n    // \u5E93/SDK\n    if (files.includes('rollup.config.js') || files.includes('tsup.config.ts') ||\n        devDeps.includes('rollup') || devDeps.includes('tsup') ||\n        projectType.type.toLowerCase().includes('library')) {\n      return 'library';\n    }\n\n    // \u79FB\u52A8\u5E94\u7528\n    if (deps.includes('react-native') || deps.includes('expo') || \n        files.includes('android') || files.includes('ios')) {\n      return 'mobile-app';\n    }\n\n    // \u684C\u9762\u5E94\u7528\n    if (deps.includes('electron') || deps.includes('tauri')) {\n      return 'desktop-app';\n    }\n\n    // \u6570\u636E\u5904\u7406\n    if (deps.includes('pandas') || deps.includes('numpy') || deps.includes('dask') ||\n        deps.includes('apache-spark')) {\n      return 'data-processing';\n    }\n\n    // ML/AI\n    if (deps.includes('tensorflow') || deps.includes('pytorch') || deps.includes('torch') ||\n        deps.includes('transformers') || deps.includes('langchain') || deps.includes('openai')) {\n      return 'ml-ai';\n    }\n\n    return 'unknown';\n  }\n\n  /**\n   * \u4ECE\u4F9D\u8D56\u63D0\u53D6\u6280\u672F\u6808\n   */\n  private _extractTechStackFromDeps(deps: string[]): string[] {\n    const techStack: string[] = [];\n    const techMap: Record<string, string> = {\n      'react': 'React',\n      'vue': 'Vue.js',\n      'angular': 'Angular',\n      'svelte': 'Svelte',\n      'express': 'Express.js',\n      'fastify': 'Fastify',\n      'nestjs': 'NestJS',\n      'next': 'Next.js',\n      'nuxt': 'Nuxt.js',\n      'prisma': 'Prisma',\n      'typeorm': 'TypeORM',\n      'mongoose': 'MongoDB',\n      'redis': 'Redis',\n      'graphql': 'GraphQL',\n      'socket.io': 'WebSocket',\n      'tailwindcss': 'Tailwind CSS',\n      'electron': 'Electron',\n      'vscode': 'VSCode API',\n    };\n\n    for (const dep of deps) {\n      const depLower = dep.toLowerCase();\n      for (const [key, value] of Object.entries(techMap)) {\n        if (depLower.includes(key)) {\n          techStack.push(value);\n        }\n      }\n    }\n\n    return [...new Set(techStack)];\n  }\n\n  /**\n   * \u63A8\u65AD\u76EE\u6807\u7528\u6237\n   */\n  private _inferTargetAudience(category: ProjectCategory, features: string[]): string | undefined {\n    const audienceMap: Record<ProjectCategory, string> = {\n      'web-frontend': '\u524D\u7AEF\u5F00\u53D1\u8005\u548C\u7EC8\u7AEF\u7528\u6237',\n      'web-backend': '\u540E\u7AEF\u5F00\u53D1\u8005',\n      'fullstack': '\u5168\u6808\u5F00\u53D1\u8005',\n      'cli-tool': '\u5F00\u53D1\u8005\u548C\u7CFB\u7EDF\u7BA1\u7406\u5458',\n      'library': '\u5F00\u53D1\u8005\uFF08\u4F5C\u4E3A\u4F9D\u8D56\u4F7F\u7528\uFF09',\n      'vscode-extension': 'VSCode \u7528\u6237\u548C\u5F00\u53D1\u8005',\n      'mobile-app': '\u79FB\u52A8\u7AEF\u7528\u6237',\n      'desktop-app': '\u684C\u9762\u7AEF\u7528\u6237',\n      'api-service': 'API \u6D88\u8D39\u8005\u548C\u5F00\u53D1\u8005',\n      'data-processing': '\u6570\u636E\u5206\u6790\u5E08\u548C\u6570\u636E\u5DE5\u7A0B\u5E08',\n      'ml-ai': 'AI/ML \u5DE5\u7A0B\u5E08\u548C\u7814\u7A76\u4EBA\u5458',\n      'unknown': '',\n    };\n    return audienceMap[category] || '';\n  }\n\n  /**\n   * \uD83C\uDD95 \u5206\u6790\u6267\u884C\u6D41\u7A0B\n   */\n  private async _analyzeExecutionFlow(\n    root: string,\n    projectType: { type: string; framework?: string; language: string },\n    entryPoints: string[],\n    modules: ModuleInfo[]\n  ): Promise<ExecutionFlow> {\n    let mainEntry: EntryPoint | null = null;\n    let startCommand: string | null = null;\n    const flowSteps: FlowStep[] = [];\n    const moduleDependencies: ModuleDependency[] = [];\n\n    // 1. \u786E\u5B9A\u4E3B\u5165\u53E3\u6587\u4EF6\n    mainEntry = await this._findMainEntry(root, projectType, entryPoints);\n\n    // 2. \u786E\u5B9A\u542F\u52A8\u547D\u4EE4\n    startCommand = this._findStartCommand(root, projectType);\n\n    // 3. \u5206\u6790\u6267\u884C\u6D41\u7A0B\u6B65\u9AA4\n    if (mainEntry) {\n      const steps = await this._analyzeFlowSteps(root, mainEntry, projectType);\n      flowSteps.push(...steps);\n    }\n\n    // 4. \u5206\u6790\u6A21\u5757\u4F9D\u8D56\u5173\u7CFB\n    const deps = await this._analyzeModuleDependencies(root, mainEntry?.file);\n    moduleDependencies.push(...deps);\n\n    // 5. \u751F\u6210\u6570\u636E\u6D41\u63CF\u8FF0\n    const dataFlow = this._generateDataFlowDescription(projectType, flowSteps);\n\n    return {\n      mainEntry,\n      startCommand,\n      flowSteps,\n      moduleDependencies,\n      dataFlow,\n    };\n  }\n\n  /**\n   * \u67E5\u627E\u4E3B\u5165\u53E3\u6587\u4EF6\n   */\n  private async _findMainEntry(\n    root: string,\n    projectType: { type: string; framework?: string },\n    entryPoints: string[]\n  ): Promise<EntryPoint | null> {\n    // \u4F18\u5148\u4ECE package.json \u7684 main \u5B57\u6BB5\u83B7\u53D6\n    try {\n      const pkgPath = path.join(root, 'package.json');\n      if (fs.existsSync(pkgPath)) {\n        const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n        \n        // VSCode \u63D2\u4EF6\u5165\u53E3\n        if (pkg.main && pkg.engines?.vscode) {\n          return {\n            file: pkg.main,\n            type: 'extension',\n            description: 'VSCode \u63D2\u4EF6\u5165\u53E3\uFF0C\u5B9A\u4E49 activate/deactivate \u51FD\u6570',\n            exports: ['activate', 'deactivate'],\n          };\n        }\n        \n        // \u666E\u901A Node.js \u9879\u76EE\u5165\u53E3\n        if (pkg.main) {\n          return {\n            file: pkg.main,\n            type: 'main',\n            description: 'Node.js \u6A21\u5757\u4E3B\u5165\u53E3',\n          };\n        }\n      }\n    } catch {}\n\n    // \u6839\u636E\u6846\u67B6\u7C7B\u578B\u5224\u65AD\n    const framework = projectType.framework?.toLowerCase() || '';\n    \n    if (framework.includes('next')) {\n      return {\n        file: 'pages/_app.tsx \u6216 app/layout.tsx',\n        type: 'app',\n        description: 'Next.js \u5E94\u7528\u5165\u53E3\uFF0C\u5904\u7406\u9875\u9762\u521D\u59CB\u5316\u548C\u8DEF\u7531',\n      };\n    }\n    \n    if (framework.includes('react')) {\n      for (const entry of ['src/index.tsx', 'src/index.js', 'src/main.tsx', 'src/main.js']) {\n        if (fs.existsSync(path.join(root, entry))) {\n          return {\n            file: entry,\n            type: 'index',\n            description: 'React \u5E94\u7528\u5165\u53E3\uFF0C\u6E32\u67D3\u6839\u7EC4\u4EF6\u5230 DOM',\n          };\n        }\n      }\n    }\n\n    if (framework.includes('vue')) {\n      for (const entry of ['src/main.ts', 'src/main.js']) {\n        if (fs.existsSync(path.join(root, entry))) {\n          return {\n            file: entry,\n            type: 'main',\n            description: 'Vue \u5E94\u7528\u5165\u53E3\uFF0C\u521B\u5EFA\u548C\u6302\u8F7D Vue \u5B9E\u4F8B',\n          };\n        }\n      }\n    }\n\n    // \u540E\u7AEF\u670D\u52A1\u5165\u53E3\n    for (const entry of ['src/index.ts', 'src/app.ts', 'src/server.ts', 'src/main.ts']) {\n      if (fs.existsSync(path.join(root, entry))) {\n        return {\n          file: entry,\n          type: 'server',\n          description: '\u670D\u52A1\u7AEF\u5165\u53E3\uFF0C\u521D\u59CB\u5316\u914D\u7F6E\u5E76\u542F\u52A8\u670D\u52A1',\n        };\n      }\n    }\n\n    // \u4ECE\u5DF2\u77E5\u5165\u53E3\u70B9\u9009\u62E9\n    if (entryPoints.length > 0) {\n      return {\n        file: entryPoints[0],\n        type: 'index',\n        description: '\u9879\u76EE\u4E3B\u5165\u53E3\u6587\u4EF6',\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * \u67E5\u627E\u542F\u52A8\u547D\u4EE4\n   */\n  private _findStartCommand(root: string, projectType: { type: string }): string | null {\n    try {\n      const pkgPath = path.join(root, 'package.json');\n      if (fs.existsSync(pkgPath)) {\n        const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n        \n        // VSCode \u63D2\u4EF6\n        if (pkg.engines?.vscode) {\n          return 'F5 (\u5728 VSCode \u4E2D\u6309 F5 \u542F\u52A8\u8C03\u8BD5)';\n        }\n        \n        // \u4F18\u5148\u8FD4\u56DE dev/start \u547D\u4EE4\n        if (pkg.scripts?.dev) return 'npm run dev';\n        if (pkg.scripts?.start) return 'npm start';\n        if (pkg.scripts?.serve) return 'npm run serve';\n      }\n    } catch {}\n\n    // Python \u9879\u76EE\n    if (projectType.type === 'Python') {\n      if (fs.existsSync(path.join(root, 'main.py'))) return 'python main.py';\n      if (fs.existsSync(path.join(root, 'app.py'))) return 'python app.py';\n    }\n\n    // Go \u9879\u76EE\n    if (projectType.type === 'Go') {\n      return 'go run .';\n    }\n\n    return null;\n  }\n\n  /**\n   * \u5206\u6790\u6267\u884C\u6D41\u7A0B\u6B65\u9AA4\n   */\n  private async _analyzeFlowSteps(\n    root: string,\n    mainEntry: EntryPoint,\n    projectType: { type: string; framework?: string }\n  ): Promise<FlowStep[]> {\n    const steps: FlowStep[] = [];\n    const framework = projectType.framework?.toLowerCase() || '';\n\n    // \u6839\u636E\u9879\u76EE\u7C7B\u578B\u751F\u6210\u5178\u578B\u6267\u884C\u6D41\u7A0B\n    if (mainEntry.type === 'extension') {\n      // VSCode \u63D2\u4EF6\u6D41\u7A0B\n      steps.push(\n        { order: 1, description: 'VSCode \u52A0\u8F7D\u63D2\u4EF6\uFF0C\u8BFB\u53D6 package.json \u914D\u7F6E', type: 'init' },\n        { order: 2, description: '\u89E6\u53D1\u6FC0\u6D3B\u6761\u4EF6\u65F6\u8C03\u7528 activate() \u51FD\u6570', file: mainEntry.file, type: 'init' },\n        { order: 3, description: '\u6CE8\u518C\u547D\u4EE4\u3001\u89C6\u56FE\u3001Provider \u7B49', type: 'config' },\n        { order: 4, description: '\u76D1\u542C\u7528\u6237\u64CD\u4F5C\u548C\u4E8B\u4EF6', type: 'handler' },\n        { order: 5, description: '\u63D2\u4EF6\u505C\u7528\u65F6\u8C03\u7528 deactivate() \u6E05\u7406\u8D44\u6E90', type: 'handler' },\n      );\n    } else if (framework.includes('next')) {\n      // Next.js \u6D41\u7A0B\n      steps.push(\n        { order: 1, description: '\u52A0\u8F7D next.config.js \u914D\u7F6E', type: 'config' },\n        { order: 2, description: '\u521D\u59CB\u5316 _app.tsx \u5305\u88C5\u7EC4\u4EF6', type: 'init' },\n        { order: 3, description: '\u6839\u636E URL \u5339\u914D pages/ \u6216 app/ \u4E0B\u7684\u8DEF\u7531', type: 'route' },\n        { order: 4, description: '\u6267\u884C getServerSideProps/getStaticProps \u83B7\u53D6\u6570\u636E', type: 'handler' },\n        { order: 5, description: '\u6E32\u67D3\u9875\u9762\u7EC4\u4EF6\u5E76\u8FD4\u56DE HTML', type: 'render' },\n      );\n    } else if (framework.includes('react')) {\n      // React \u6D41\u7A0B\n      steps.push(\n        { order: 1, description: '\u52A0\u8F7D\u5165\u53E3\u6587\u4EF6\u548C\u6839\u7EC4\u4EF6', file: mainEntry.file, type: 'init' },\n        { order: 2, description: 'ReactDOM.render() \u6302\u8F7D\u5230 DOM', type: 'init' },\n        { order: 3, description: '\u8DEF\u7531\u89E3\u6790\uFF0C\u5339\u914D\u5BF9\u5E94\u9875\u9762\u7EC4\u4EF6', type: 'route' },\n        { order: 4, description: '\u7EC4\u4EF6\u751F\u547D\u5468\u671F\u6267\u884C\uFF0C\u83B7\u53D6\u6570\u636E', type: 'handler' },\n        { order: 5, description: '\u6E32\u67D3\u865A\u62DF DOM \u5E76\u66F4\u65B0\u771F\u5B9E DOM', type: 'render' },\n      );\n    } else if (framework.includes('express') || framework.includes('fastify') || framework.includes('koa')) {\n      // \u540E\u7AEF\u670D\u52A1\u6D41\u7A0B\n      steps.push(\n        { order: 1, description: '\u52A0\u8F7D\u73AF\u5883\u53D8\u91CF\u548C\u914D\u7F6E', type: 'config' },\n        { order: 2, description: '\u521D\u59CB\u5316\u6570\u636E\u5E93\u8FDE\u63A5', type: 'init' },\n        { order: 3, description: '\u6CE8\u518C\u4E2D\u95F4\u4EF6\uFF08\u65E5\u5FD7\u3001\u8BA4\u8BC1\u3001CORS\u7B49\uFF09', type: 'middleware' },\n        { order: 4, description: '\u6CE8\u518C\u8DEF\u7531\u548C\u63A7\u5236\u5668', type: 'route' },\n        { order: 5, description: '\u542F\u52A8 HTTP \u670D\u52A1\u5668\u76D1\u542C\u7AEF\u53E3', file: mainEntry.file, type: 'init' },\n        { order: 6, description: '\u63A5\u6536\u8BF7\u6C42 \u2192 \u4E2D\u95F4\u4EF6\u5904\u7406 \u2192 \u8DEF\u7531\u5206\u53D1 \u2192 \u8FD4\u56DE\u54CD\u5E94', type: 'handler' },\n      );\n    } else {\n      // \u901A\u7528\u6D41\u7A0B\n      steps.push(\n        { order: 1, description: '\u7A0B\u5E8F\u542F\u52A8\uFF0C\u52A0\u8F7D\u5165\u53E3\u6587\u4EF6', file: mainEntry.file, type: 'init' },\n        { order: 2, description: '\u521D\u59CB\u5316\u914D\u7F6E\u548C\u4F9D\u8D56', type: 'config' },\n        { order: 3, description: '\u6267\u884C\u4E3B\u8981\u4E1A\u52A1\u903B\u8F91', type: 'handler' },\n      );\n    }\n\n    return steps;\n  }\n\n  /**\n   * \u5206\u6790\u6A21\u5757\u4F9D\u8D56\u5173\u7CFB\n   */\n  private async _analyzeModuleDependencies(\n    root: string,\n    mainEntryFile?: string\n  ): Promise<ModuleDependency[]> {\n    const dependencies: ModuleDependency[] = [];\n    \n    if (!mainEntryFile) return dependencies;\n\n    try {\n      const entryPath = path.join(root, mainEntryFile);\n      if (!fs.existsSync(entryPath)) return dependencies;\n\n      const content = fs.readFileSync(entryPath, 'utf-8');\n      \n      // \u63D0\u53D6 import \u8BED\u53E5\n      const importMatches = content.matchAll(/import\\s+(?:.*\\s+from\\s+)?['\"](\\.\\/[^'\"]+|\\.\\.\\/[^'\"]+)['\"]/g);\n      for (const match of importMatches) {\n        dependencies.push({\n          from: mainEntryFile,\n          to: match[1],\n          type: 'import',\n        });\n      }\n\n      // \u63D0\u53D6 require \u8BED\u53E5\n      const requireMatches = content.matchAll(/require\\(['\"](\\.\\/[^'\"]+|\\.\\.\\/[^'\"]+)['\"]\\)/g);\n      for (const match of requireMatches) {\n        dependencies.push({\n          from: mainEntryFile,\n          to: match[1],\n          type: 'require',\n        });\n      }\n    } catch {}\n\n    return dependencies.slice(0, 20);\n  }\n\n  /**\n   * \u751F\u6210\u6570\u636E\u6D41\u63CF\u8FF0\n   */\n  private _generateDataFlowDescription(\n    projectType: { type: string; framework?: string },\n    flowSteps: FlowStep[]\n  ): string {\n    const framework = projectType.framework?.toLowerCase() || '';\n\n    if (framework.includes('react') || framework.includes('vue')) {\n      return '\u7528\u6237\u4EA4\u4E92 \u2192 \u4E8B\u4EF6\u5904\u7406 \u2192 \u72B6\u6001\u66F4\u65B0 \u2192 \u7EC4\u4EF6\u91CD\u6E32\u67D3 \u2192 DOM \u66F4\u65B0';\n    }\n    \n    if (framework.includes('next') || framework.includes('nuxt')) {\n      return '\u8BF7\u6C42 \u2192 \u670D\u52A1\u7AEF\u6E32\u67D3/\u6570\u636E\u83B7\u53D6 \u2192 \u9875\u9762\u7EC4\u4EF6 \u2192 \u5BA2\u6237\u7AEF Hydration \u2192 \u4EA4\u4E92';\n    }\n\n    if (framework.includes('express') || framework.includes('fastify')) {\n      return '\u5BA2\u6237\u7AEF\u8BF7\u6C42 \u2192 \u4E2D\u95F4\u4EF6\u94FE \u2192 \u8DEF\u7531\u5339\u914D \u2192 \u63A7\u5236\u5668\u5904\u7406 \u2192 \u6570\u636E\u5E93\u64CD\u4F5C \u2192 \u54CD\u5E94\u8FD4\u56DE';\n    }\n\n    if (projectType.type.includes('extension')) {\n      return 'VSCode \u4E8B\u4EF6 \u2192 \u547D\u4EE4/Provider \u2192 \u4E1A\u52A1\u5904\u7406 \u2192 Webview/\u7F16\u8F91\u5668\u66F4\u65B0';\n    }\n\n    return '\u8F93\u5165 \u2192 \u5904\u7406 \u2192 \u8F93\u51FA';\n  }\n\n  /**\n   * \u67E5\u627E\u9879\u76EE\u5165\u53E3\u70B9\n   */\n  private _findEntryPoints(root: string, projectType: { type: string; framework?: string }): string[] {\n    const entryPoints: string[] = [];\n    const files = fs.readdirSync(root);\n    \n    // \u901A\u7528\u5165\u53E3\u6587\u4EF6\n    const commonEntries = ['index.ts', 'index.js', 'main.ts', 'main.js', 'app.ts', 'app.js',\n                          'main.py', 'app.py', 'run.py', 'main.go', 'cmd/main.go'];\n    \n    for (const entry of commonEntries) {\n      if (fs.existsSync(path.join(root, entry))) {\n        entryPoints.push(entry);\n      }\n    }\n\n    // \u68C0\u67E5 src \u76EE\u5F55\n    if (fs.existsSync(path.join(root, 'src'))) {\n      for (const entry of commonEntries) {\n        if (fs.existsSync(path.join(root, 'src', entry))) {\n          entryPoints.push(`src/${entry}`);\n        }\n      }\n    }\n\n    return entryPoints.slice(0, 5);\n  }\n\n  private _findConfigFiles(root: string): string[] {\n    const configPatterns = [\n      'package.json', 'tsconfig.json', '.eslintrc.js', '.prettierrc',\n      'vite.config.ts', 'webpack.config.js', 'rollup.config.js',\n      'requirements.txt', 'pyproject.toml', 'setup.py',\n      'go.mod', 'Cargo.toml', 'pom.xml', 'build.gradle',\n      'docker-compose.yml', 'Dockerfile', '.env.example',\n    ];\n    \n    const files = fs.readdirSync(root);\n    return files.filter(f => configPatterns.includes(f));\n  }\n\n  private _extractScripts(root: string, projectType: string): ScriptInfo[] {\n    const scripts: ScriptInfo[] = [];\n    \n    if (projectType.includes('Node')) {\n      try {\n        const pkg = JSON.parse(fs.readFileSync(path.join(root, 'package.json'), 'utf-8'));\n        if (pkg.scripts) {\n          for (const [name, cmd] of Object.entries(pkg.scripts)) {\n            scripts.push({\n              name: `npm run ${name}`,\n              command: String(cmd),\n              description: this._getScriptDescription(name),\n            });\n          }\n        }\n      } catch {}\n    }\n    \n    return scripts.slice(0, 10);\n  }\n\n  private _generateContextSummary(info: any): string {\n    const parts: string[] = [];\n    \n    // \u57FA\u672C\u63CF\u8FF0\n    parts.push(`${info.name} \u662F\u4E00\u4E2A ${info.type} \u9879\u76EE${info.framework ? `\uFF08${info.framework}\uFF09` : ''}\uFF0C\u4E3B\u8981\u4F7F\u7528 ${info.language} \u5F00\u53D1\u3002`);\n    \n    // \u9879\u76EE\u529F\u80FD\n    if (info.projectPurpose?.description) {\n      parts.push(`\u9879\u76EE\u529F\u80FD: ${info.projectPurpose.description}`);\n    }\n    \n    // \u4EE3\u7801\u89C4\u6A21\n    parts.push(`\u9879\u76EE\u5305\u542B ${info.codeStats.totalFiles} \u4E2A\u4EE3\u7801\u6587\u4EF6\uFF0C\u7EA6 ${info.codeStats.totalLines.toLocaleString()} \u884C\u4EE3\u7801\u3002`);\n    \n    // \u5165\u53E3\u548C\u6267\u884C\u6D41\u7A0B\n    if (info.executionFlow?.mainEntry) {\n      parts.push(`\u4E3B\u5165\u53E3\u6587\u4EF6: ${info.executionFlow.mainEntry.file}\u3002`);\n    }\n    if (info.executionFlow?.startCommand) {\n      parts.push(`\u542F\u52A8\u547D\u4EE4: ${info.executionFlow.startCommand}\u3002`);\n    }\n    \n    // \u4E3B\u8981\u6A21\u5757\n    if (info.modules?.length > 0) {\n      parts.push(`\u4E3B\u8981\u6A21\u5757\u5305\u62EC: ${info.modules.slice(0, 5).map((m: any) => m.name).join(', ')}\u3002`);\n    }\n    \n    // \u6280\u672F\u6808\n    if (info.projectPurpose?.techStack?.length > 0) {\n      parts.push(`\u6280\u672F\u6808: ${info.projectPurpose.techStack.join(', ')}\u3002`);\n    }\n    \n    return parts.join(' ');\n  }\n\n  private _renderStructure(node: DirectoryNode, indent: number, maxDepth: number): string {\n    if (indent >= maxDepth) return '';\n    \n    const prefix = '  '.repeat(indent);\n    let result = '';\n    \n    if (node.type === 'directory') {\n      result += `${prefix}\uD83D\uDCC1 ${node.name}/\\n`;\n      if (node.children) {\n        for (const child of node.children.slice(0, 15)) {\n          result += this._renderStructure(child, indent + 1, maxDepth);\n        }\n        if (node.children.length > 15) {\n          result += `${prefix}  ... (${node.children.length - 15} more)\\n`;\n        }\n      }\n    } else {\n      result += `${prefix}\uD83D\uDCC4 ${node.name}\\n`;\n    }\n    \n    return result;\n  }\n\n  private _getLanguage(filename: string): string {\n    const ext = path.extname(filename).toLowerCase();\n    const langMap: Record<string, string> = {\n      '.ts': 'TypeScript',\n      '.tsx': 'TypeScript',\n      '.js': 'JavaScript',\n      '.jsx': 'JavaScript',\n      '.py': 'Python',\n      '.go': 'Go',\n      '.java': 'Java',\n      '.rs': 'Rust',\n      '.vue': 'Vue',\n      '.svelte': 'Svelte',\n      '.css': 'CSS',\n      '.scss': 'SCSS',\n      '.less': 'Less',\n      '.html': 'HTML',\n      '.json': 'JSON',\n      '.yaml': 'YAML',\n      '.yml': 'YAML',\n      '.md': 'Markdown',\n      '.sql': 'SQL',\n      '.sh': 'Shell',\n      '.bash': 'Shell',\n    };\n    return langMap[ext] || 'Unknown';\n  }\n\n  private _countLines(filePath: string): number {\n    try {\n      const content = fs.readFileSync(filePath, 'utf-8');\n      return content.split('\\n').length;\n    } catch {\n      return 0;\n    }\n  }\n\n  private _inferModuleType(dirName: string): string {\n    const typeMap: Record<string, string> = {\n      'src': '\u6E90\u4EE3\u7801',\n      'app': '\u5E94\u7528\u7A0B\u5E8F',\n      'lib': '\u5E93',\n      'components': 'UI\u7EC4\u4EF6',\n      'pages': '\u9875\u9762',\n      'api': 'API\u63A5\u53E3',\n      'services': '\u670D\u52A1\u5C42',\n      'utils': '\u5DE5\u5177\u51FD\u6570',\n      'hooks': 'React Hooks',\n      'store': '\u72B6\u6001\u7BA1\u7406',\n      'models': '\u6570\u636E\u6A21\u578B',\n      'controllers': '\u63A7\u5236\u5668',\n      'views': '\u89C6\u56FE',\n      'routes': '\u8DEF\u7531',\n      'middleware': '\u4E2D\u95F4\u4EF6',\n      'config': '\u914D\u7F6E',\n      'types': '\u7C7B\u578B\u5B9A\u4E49',\n      'interfaces': '\u63A5\u53E3\u5B9A\u4E49',\n    };\n    return typeMap[dirName] || '\u6A21\u5757';\n  }\n\n  private _getModuleDescription(dirName: string): string {\n    const descMap: Record<string, string> = {\n      'src': '\u4E3B\u8981\u6E90\u4EE3\u7801\u76EE\u5F55',\n      'app': '\u5E94\u7528\u7A0B\u5E8F\u5165\u53E3',\n      'lib': '\u53EF\u590D\u7528\u5E93\u4EE3\u7801',\n      'components': 'UI \u7EC4\u4EF6\u5E93',\n      'pages': '\u9875\u9762\u7EC4\u4EF6',\n      'api': 'API \u63A5\u53E3\u5B9A\u4E49',\n      'services': '\u4E1A\u52A1\u903B\u8F91\u670D\u52A1',\n      'utils': '\u901A\u7528\u5DE5\u5177\u51FD\u6570',\n      'hooks': 'React Hooks',\n      'store': '\u5168\u5C40\u72B6\u6001\u7BA1\u7406',\n      'models': '\u6570\u636E\u6A21\u578B\u5B9A\u4E49',\n      'controllers': '\u8BF7\u6C42\u63A7\u5236\u5668',\n      'views': '\u89C6\u56FE\u6A21\u677F',\n      'routes': '\u8DEF\u7531\u914D\u7F6E',\n      'middleware': '\u4E2D\u95F4\u4EF6',\n      'config': '\u914D\u7F6E\u6587\u4EF6',\n      'types': 'TypeScript \u7C7B\u578B',\n    };\n    return descMap[dirName] || '';\n  }\n\n  private _getScriptDescription(name: string): string {\n    const descMap: Record<string, string> = {\n      'dev': '\u5F00\u53D1\u6A21\u5F0F',\n      'start': '\u542F\u52A8\u5E94\u7528',\n      'build': '\u6784\u5EFA\u9879\u76EE',\n      'test': '\u8FD0\u884C\u6D4B\u8BD5',\n      'lint': '\u4EE3\u7801\u68C0\u67E5',\n      'format': '\u683C\u5F0F\u5316\u4EE3\u7801',\n      'deploy': '\u90E8\u7F72',\n      'watch': '\u76D1\u542C\u6A21\u5F0F',\n    };\n    return descMap[name] || '';\n  }\n\n  /**\n   * \uD83C\uDD95 \u626B\u63CF\u9879\u76EE\u4E2D\u7684 Markdown \u6587\u6863\n   */\n  private async _scanMarkdownDocs(root: string): Promise<MarkdownDocInfo[]> {\n    const docs: MarkdownDocInfo[] = [];\n    const maxDocs = 20; // \u6700\u591A\u626B\u63CF20\u4E2A\u6587\u6863\n    const maxDepth = 3; // \u6700\u5927\u626B\u63CF\u6DF1\u5EA6\n    \n    const scanDir = (dir: string, depth: number): void => {\n      if (depth > maxDepth || docs.length >= maxDocs) return;\n      \n      try {\n        const items = fs.readdirSync(dir);\n        \n        for (const item of items) {\n          if (docs.length >= maxDocs) break;\n          \n          // \u8DF3\u8FC7\u5FFD\u7565\u7684\u76EE\u5F55\n          if (this._ignoreDirs.includes(item)) continue;\n          \n          const fullPath = path.join(dir, item);\n          \n          try {\n            const stat = fs.statSync(fullPath);\n            \n            if (stat.isDirectory()) {\n              scanDir(fullPath, depth + 1);\n            } else if (item.toLowerCase().endsWith('.md')) {\n              const docInfo = this._parseMarkdownDoc(fullPath, root);\n              if (docInfo) {\n                docs.push(docInfo);\n              }\n            }\n          } catch {\n            // \u5FFD\u7565\u65E0\u6CD5\u8BBF\u95EE\u7684\u6587\u4EF6\n          }\n        }\n      } catch {\n        // \u5FFD\u7565\u65E0\u6CD5\u8BBF\u95EE\u7684\u76EE\u5F55\n      }\n    };\n    \n    scanDir(root, 0);\n    \n    // \u6309\u6587\u6863\u7C7B\u578B\u548C\u5927\u5C0F\u6392\u5E8F\uFF08README\u4F18\u5148\uFF0C\u7136\u540E\u6309\u5927\u5C0F\uFF09\n    docs.sort((a, b) => {\n      if (a.docType === 'readme' && b.docType !== 'readme') return -1;\n      if (b.docType === 'readme' && a.docType !== 'readme') return 1;\n      return b.size - a.size;\n    });\n    \n    return docs;\n  }\n\n  /**\n   * \u89E3\u6790\u5355\u4E2A Markdown \u6587\u6863\n   */\n  private _parseMarkdownDoc(filePath: string, root: string): MarkdownDocInfo | null {\n    try {\n      const stat = fs.statSync(filePath);\n      const content = fs.readFileSync(filePath, 'utf-8');\n      const filename = path.basename(filePath);\n      const relativePath = path.relative(root, filePath);\n      \n      // \u63D0\u53D6\u6807\u9898\uFF08\u7B2C\u4E00\u4E2A # \u6807\u9898\uFF09\n      const titleMatch = content.match(/^#\\s+(.+)$/m);\n      const title = titleMatch ? titleMatch[1].trim() : filename.replace('.md', '');\n      \n      // \u786E\u5B9A\u6587\u6863\u7C7B\u578B\n      const docType = this._detectDocType(filename, relativePath);\n      \n      // \u63D0\u53D6\u7AE0\u8282\uFF08## \u6807\u9898\uFF09\n      const sectionMatches = content.matchAll(/^##\\s+(.+)$/gm);\n      const sections: string[] = [];\n      for (const match of sectionMatches) {\n        sections.push(match[1].trim());\n        if (sections.length >= 10) break;\n      }\n      \n      // \u751F\u6210\u6458\u8981\uFF08\u79FB\u9664\u4EE3\u7801\u5757\u548CMarkdown\u6807\u8BB0\uFF09\n      const summary = this._generateDocSummary(content);\n      \n      return {\n        filename,\n        relativePath,\n        title,\n        summary,\n        docType,\n        sections,\n        size: stat.size,\n      };\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * \u68C0\u6D4B\u6587\u6863\u7C7B\u578B\n   */\n  private _detectDocType(filename: string, relativePath: string): MarkdownDocInfo['docType'] {\n    const lowerName = filename.toLowerCase();\n    const lowerPath = relativePath.toLowerCase();\n    \n    if (lowerName === 'readme.md') return 'readme';\n    if (lowerName.includes('changelog')) return 'changelog';\n    if (lowerName.includes('contributing')) return 'contributing';\n    if (lowerName.includes('api') || lowerPath.includes('api')) return 'api';\n    if (lowerName.includes('guide') || lowerName.includes('tutorial')) return 'guide';\n    if (lowerName.includes('architecture') || lowerName.includes('design')) return 'architecture';\n    \n    return 'other';\n  }\n\n  /**\n   * \u751F\u6210\u6587\u6863\u6458\u8981\n   */\n  private _generateDocSummary(content: string): string {\n    let summary = content;\n    \n    // \u79FB\u9664\u4EE3\u7801\u5757\n    summary = summary.replace(/```[\\s\\S]*?```/g, '');\n    \n    // \u79FB\u9664\u884C\u5185\u4EE3\u7801\n    summary = summary.replace(/`[^`]+`/g, '');\n    \n    // \u79FB\u9664\u94FE\u63A5\uFF0C\u4FDD\u7559\u6587\u672C\n    summary = summary.replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1');\n    \n    // \u79FB\u9664\u56FE\u7247\n    summary = summary.replace(/!\\[.*?\\]\\(.*?\\)/g, '');\n    \n    // \u79FB\u9664\u6807\u9898\u6807\u8BB0\n    summary = summary.replace(/^#+\\s*/gm, '');\n    \n    // \u79FB\u9664\u52A0\u7C97\u548C\u659C\u4F53\u6807\u8BB0\n    summary = summary.replace(/\\*\\*([^*]+)\\*\\*/g, '$1');\n    summary = summary.replace(/\\*([^*]+)\\*/g, '$1');\n    summary = summary.replace(/__([^_]+)__/g, '$1');\n    summary = summary.replace(/_([^_]+)_/g, '$1');\n    \n    // \u79FB\u9664\u5217\u8868\u6807\u8BB0\n    summary = summary.replace(/^[\\s]*[-*+]\\s*/gm, '');\n    summary = summary.replace(/^[\\s]*\\d+\\.\\s*/gm, '');\n    \n    // \u538B\u7F29\u7A7A\u767D\n    summary = summary.replace(/\\n{3,}/g, '\\n\\n');\n    summary = summary.trim();\n    \n    // \u622A\u65AD\u52302000\u5B57\u7B26\n    if (summary.length > 2000) {\n      summary = summary.slice(0, 2000) + '...';\n    }\n    \n    return summary;\n  }\n}\n\n// \u5BFC\u51FA\u5355\u4F8B\nexport const projectAnalyzer = new EnhancedProjectAnalyzer();\n", "/**\n * \u667A\u80FD\u8F93\u5165\u89E3\u6790\u5668\n * \u533A\u5206\u7528\u6237\u7684\u81EA\u7136\u8BED\u8A00\u63D0\u95EE\u548C\u6267\u884C\u6307\u4EE4\n */\n\n// \u8F93\u5165\u7C7B\u578B\u679A\u4E3E\nexport enum InputType {\n  COMMAND = 'command',           // \u659C\u6760\u547D\u4EE4 /xxx\n  SHELL_COMMAND = 'shell',       // Shell \u547D\u4EE4 !xxx\n  NATURAL_QUESTION = 'question', // \u81EA\u7136\u8BED\u8A00\u63D0\u95EE\n  NATURAL_REQUEST = 'request',   // \u81EA\u7136\u8BED\u8A00\u8BF7\u6C42\uFF08\u8981\u6C42AI\u505A\u67D0\u4E8B\uFF09\n  CODE_REQUEST = 'code',         // \u4EE3\u7801\u76F8\u5173\u8BF7\u6C42\n  MIXED = 'mixed'                // \u6DF7\u5408\u7C7B\u578B\n}\n\n// \u89E3\u6790\u7ED3\u679C\nexport interface ParsedInput {\n  type: InputType;\n  originalInput: string;\n  cleanInput: string;\n  confidence: number;  // 0-1 \u7684\u7F6E\u4FE1\u5EA6\n  suggestion?: string; // \u5EFA\u8BAE\u63D0\u793A\n  detectedIntent?: string; // \u68C0\u6D4B\u5230\u7684\u610F\u56FE\n  possibleCommand?: string; // \u53EF\u80FD\u5BF9\u5E94\u7684\u547D\u4EE4\n}\n\n// \u5173\u952E\u8BCD\u6A21\u5F0F\nconst QUESTION_PATTERNS = [\n  // \u4E2D\u6587\u7591\u95EE\u8BCD\n  /^(\u4EC0\u4E48|\u600E\u4E48|\u5982\u4F55|\u4E3A\u4EC0\u4E48|\u54EA\u4E2A|\u54EA\u91CC|\u8C01|\u591A\u5C11|\u662F\u5426|\u80FD\u5426|\u53EF\u4EE5\u5417|\u662F\u4E0D\u662F)/,\n  /[\uFF1F?]$/,\n  /(\u5417|\u5462|\u5427)[\uFF1F?]?$/,\n  // \u82F1\u6587\u7591\u95EE\u8BCD\n  /^(what|how|why|where|when|who|which|can|could|would|should|is|are|do|does)/i,\n  /\\?$/,\n];\n\nconst REQUEST_PATTERNS = [\n  // \u4E2D\u6587\u8BF7\u6C42\u8BCD\n  /^(\u8BF7|\u5E2E\u6211|\u5E2E\u5FD9|\u80FD\u4E0D\u80FD|\u53EF\u4EE5|\u9EBB\u70E6|\u7ED9\u6211|\u6211\u60F3|\u6211\u8981|\u6211\u9700\u8981|\u521B\u5EFA|\u751F\u6210|\u5199|\u7F16\u5199|\u4FEE\u6539|\u4F18\u5316|\u91CD\u6784|\u89E3\u91CA|\u5206\u6790)/,\n  /(\u4E00\u4E0B|\u4E00\u4E2A|\u5E2E\u6211)$/,\n  // \u82F1\u6587\u8BF7\u6C42\u8BCD\n  /^(please|help|create|generate|write|modify|fix|explain|analyze|refactor|optimize|make)/i,\n];\n\nconst CODE_PATTERNS = [\n  // \u4EE3\u7801\u76F8\u5173\u5173\u952E\u8BCD\n  /\u4EE3\u7801|\u51FD\u6570|\u65B9\u6CD5|\u7C7B|\u63A5\u53E3|\u53D8\u91CF|bug|\u62A5\u9519|\u9519\u8BEF|\u5F02\u5E38|\u6D4B\u8BD5|\u5355\u5143\u6D4B\u8BD5/,\n  /code|function|method|class|interface|variable|bug|error|exception|test|unit test/i,\n  // \u4EE3\u7801\u5757\u6807\u8BC6\n  /```[\\s\\S]*```/,\n  // \u6587\u4EF6\u6269\u5C55\u540D\n  /\\.(ts|tsx|js|jsx|py|go|java|rs|vue|css|html|json|md)(\\s|$)/i,\n];\n\n// \u53EF\u80FD\u662F\u547D\u4EE4\u7684\u81EA\u7136\u8BED\u8A00\u6620\u5C04\n// \u4F7F\u7528\u66F4\u7CBE\u786E\u7684\u5339\u914D\u89C4\u5219\uFF0C\u907F\u514D\u8BEF\u5339\u914D\nconst NATURAL_TO_COMMAND_MAP: Record<string, { pattern: RegExp; command: string }> = {\n  // \u9879\u76EE\u76F8\u5173 - \u9700\u8981\u660E\u786E\u7684\u9879\u76EE\u5206\u6790\u610F\u56FE\n  '\u5206\u6790\u9879\u76EE': { pattern: /^(\u5206\u6790|\u4E86\u89E3|\u67E5\u770B|\u521D\u59CB\u5316)(\u4E00\u4E0B|\u4E0B)?\u9879\u76EE/, command: '/init' },\n  '\u9879\u76EE\u7ED3\u6784': { pattern: /^(\u67E5\u770B|\u663E\u793A|\u770B\u4E0B)?\u9879\u76EE(\u7ED3\u6784|\u4FE1\u606F|\u6982\u89C8)/, command: '/init' },\n  \n  // \u6587\u4EF6\u76F8\u5173 - \u9700\u8981\u660E\u786E\u7684\u6587\u4EF6\u64CD\u4F5C\u610F\u56FE\n  '\u8BFB\u53D6\u6587\u4EF6': { pattern: /^(\u8BFB\u53D6|\u6253\u5F00|\u67E5\u770B)(\u4E00\u4E0B)?\u6587\u4EF6\\s*[:\uFF1A]?\\s*\\S+/, command: '/file' },\n  '\u641C\u7D22\u4EE3\u7801': { pattern: /^(\u641C\u7D22|\u67E5\u627E|\u627E)(\u4E00\u4E0B)?(\u4EE3\u7801|\u6587\u4EF6)\\s*[:\uFF1A]?\\s*\\S+/, command: '/search' },\n  \n  // Git\u76F8\u5173 - \u9700\u8981\u660E\u786E\u7684git\u64CD\u4F5C\u610F\u56FE\n  '\u67E5\u770B\u72B6\u6001': { pattern: /^(\u67E5\u770B|\u663E\u793A)git?\u72B6\u6001/, command: '/git status' },\n  '\u63D0\u4EA4\u4EE3\u7801': { pattern: /^(git\\s+)?commit|^\u63D0\u4EA4(\u4EE3\u7801|\u66F4\u6539)/, command: '/git commit' },\n  '\u63A8\u9001\u4EE3\u7801': { pattern: /^(git\\s+)?push|^\u63A8\u9001(\u4EE3\u7801)?/, command: '/git push' },\n  '\u62C9\u53D6\u4EE3\u7801': { pattern: /^(git\\s+)?pull|^\u62C9\u53D6(\u4EE3\u7801)?/, command: '/git pull' },\n  \n  // \u56FE\u8868\u76F8\u5173 - \u9700\u8981\u660E\u786E\u7684\u56FE\u8868\u7C7B\u578B\n  '\u751F\u6210\u6D41\u7A0B\u56FE': { pattern: /^(\u751F\u6210|\u753B|\u521B\u5EFA)(\u4E00\u4E2A|\u4E00\u5F20)?\u6D41\u7A0B\u56FE/, command: '/diagram flowchart' },\n  '\u751F\u6210\u65F6\u5E8F\u56FE': { pattern: /^(\u751F\u6210|\u753B|\u521B\u5EFA)(\u4E00\u4E2A|\u4E00\u5F20)?\u65F6\u5E8F\u56FE/, command: '/diagram sequence' },\n  '\u751F\u6210\u7C7B\u56FE': { pattern: /^(\u751F\u6210|\u753B|\u521B\u5EFA)(\u4E00\u4E2A|\u4E00\u5F20)?\u7C7B\u56FE/, command: '/diagram class' },\n  '\u751F\u6210\u67B6\u6784\u56FE': { pattern: /^(\u751F\u6210|\u753B|\u521B\u5EFA)(\u4E00\u4E2A|\u4E00\u5F20)?\u67B6\u6784\u56FE/, command: '/diagram architecture' },\n  \n  // \u6D4B\u8BD5\u76F8\u5173 - \u9700\u8981\u660E\u786E\u7684\u6D4B\u8BD5\u751F\u6210\u610F\u56FE\n  '\u751F\u6210\u6D4B\u8BD5': { pattern: /^(\u751F\u6210|\u5199|\u521B\u5EFA)(\u4E00\u4E0B)?(\u5355\u5143)?\u6D4B\u8BD5/, command: '/gentest' },\n  '\u8FD0\u884C\u6D4B\u8BD5': { pattern: /^(\u8FD0\u884C|\u6267\u884C)(\u4E00\u4E0B)?\u6D4B\u8BD5/, command: '/test' },\n  \n  // \u6784\u5EFA\u76F8\u5173\n  '\u6784\u5EFA\u9879\u76EE': { pattern: /^(\u6784\u5EFA|\u7F16\u8BD1)(\u4E00\u4E0B)?\u9879\u76EE/, command: '/build' },\n  \n  // \u5E2E\u52A9 - \u53EA\u5728\u660E\u786E\u8981\u6C42\u5E2E\u52A9\u65F6\u5339\u914D\uFF0C\u6392\u9664\"\u5E2E\u6211\"\u3001\"\u5E2E\u5FD9\"\u7B49\n  '\u5E2E\u52A9': { pattern: /^(\u67E5\u770B)?\u5E2E\u52A9$|^\u547D\u4EE4\u5217\u8868$|^\u600E\u4E48\u7528$|^\\/help$/, command: '/help' },\n};\n\n/**\n * \u667A\u80FD\u8F93\u5165\u89E3\u6790\u5668\n */\nexport class SmartInputParser {\n  /**\n   * \u89E3\u6790\u7528\u6237\u8F93\u5165\n   */\n  parse(input: string): ParsedInput {\n    const trimmed = input.trim();\n    \n    // \u7A7A\u8F93\u5165\n    if (!trimmed) {\n      return {\n        type: InputType.NATURAL_QUESTION,\n        originalInput: input,\n        cleanInput: '',\n        confidence: 1,\n      };\n    }\n    \n    // \u660E\u786E\u7684\u547D\u4EE4\u683C\u5F0F\n    if (trimmed.startsWith('/')) {\n      return this._parseCommand(trimmed);\n    }\n    \n    // Shell \u547D\u4EE4\u683C\u5F0F\n    if (trimmed.startsWith('!')) {\n      return this._parseShellCommand(trimmed);\n    }\n    \n    // \u81EA\u7136\u8BED\u8A00\u5206\u6790\n    return this._parseNaturalLanguage(trimmed);\n  }\n\n  /**\n   * \u89E3\u6790\u659C\u6760\u547D\u4EE4\n   */\n  private _parseCommand(input: string): ParsedInput {\n    return {\n      type: InputType.COMMAND,\n      originalInput: input,\n      cleanInput: input,\n      confidence: 1,\n      detectedIntent: 'execute_command',\n    };\n  }\n\n  /**\n   * \u89E3\u6790 Shell \u547D\u4EE4\n   */\n  private _parseShellCommand(input: string): ParsedInput {\n    const command = input.substring(1).trim();\n    return {\n      type: InputType.SHELL_COMMAND,\n      originalInput: input,\n      cleanInput: command,\n      confidence: 1,\n      detectedIntent: 'run_shell',\n      possibleCommand: `/run ${command}`,\n    };\n  }\n\n  /**\n   * \u89E3\u6790\u81EA\u7136\u8BED\u8A00\n   */\n  private _parseNaturalLanguage(input: string): ParsedInput {\n    const lowerInput = input.toLowerCase();\n    let confidence = 0.5;\n    let type = InputType.NATURAL_QUESTION;\n    let detectedIntent: string | undefined;\n    let possibleCommand: string | undefined;\n    let suggestion: string | undefined;\n\n    // \u68C0\u67E5\u662F\u5426\u5339\u914D\u5DF2\u77E5\u7684\u547D\u4EE4\u6620\u5C04\uFF08\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u7CBE\u786E\u5339\u914D\uFF09\n    for (const [name, info] of Object.entries(NATURAL_TO_COMMAND_MAP)) {\n      if (info.pattern.test(input)) {\n        possibleCommand = info.command;\n        suggestion = `\uD83D\uDCA1 \u68C0\u6D4B\u5230\u53EF\u80FD\u60F3\u6267\u884C: ${info.command}\uFF0C\u76F4\u63A5\u8F93\u5165\u547D\u4EE4\u4F1A\u66F4\u5FEB\u54E6`;\n        confidence = 0.7;\n        type = InputType.MIXED;\n        detectedIntent = 'command_hint';\n        break;\n      }\n    }\n\n    // \u68C0\u67E5\u662F\u5426\u662F\u95EE\u9898\n    const isQuestion = QUESTION_PATTERNS.some(p => p.test(input));\n    if (isQuestion) {\n      type = InputType.NATURAL_QUESTION;\n      confidence = Math.max(confidence, 0.8);\n      detectedIntent = 'asking_question';\n    }\n\n    // \u68C0\u67E5\u662F\u5426\u662F\u8BF7\u6C42\n    const isRequest = REQUEST_PATTERNS.some(p => p.test(input));\n    if (isRequest) {\n      type = InputType.NATURAL_REQUEST;\n      confidence = Math.max(confidence, 0.8);\n      detectedIntent = 'making_request';\n    }\n\n    // \u68C0\u67E5\u662F\u5426\u6D89\u53CA\u4EE3\u7801\n    const isCodeRelated = CODE_PATTERNS.some(p => p.test(input));\n    if (isCodeRelated) {\n      type = InputType.CODE_REQUEST;\n      confidence = Math.max(confidence, 0.85);\n      detectedIntent = 'code_related';\n    }\n\n    // \u7279\u6B8A\u60C5\u51B5\uFF1A\u68C0\u6D4B\u770B\u8D77\u6765\u50CF\u547D\u4EE4\u4F46\u6CA1\u6709\u659C\u6760\u7684\u8F93\u5165\n    const commandLikePatterns = [\n      /^(init|help|clear|search|build|test|git|diagram|gentest)\\s*/i,\n    ];\n    \n    for (const pattern of commandLikePatterns) {\n      const match = input.match(pattern);\n      if (match) {\n        possibleCommand = `/${match[1].toLowerCase()}${input.substring(match[0].length).trim() ? ' ' + input.substring(match[0].length).trim() : ''}`;\n        suggestion = `\uD83D\uDCA1 \u4F60\u662F\u5426\u60F3\u6267\u884C\u547D\u4EE4\uFF1F\u8BD5\u8BD5\u8F93\u5165: ${possibleCommand}`;\n        break;\n      }\n    }\n\n    return {\n      type,\n      originalInput: input,\n      cleanInput: input,\n      confidence,\n      suggestion,\n      detectedIntent,\n      possibleCommand,\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u8F93\u5165\u63D0\u793A\n   */\n  getInputHints(input: string): string[] {\n    const hints: string[] = [];\n    const parsed = this.parse(input);\n    \n    if (parsed.suggestion) {\n      hints.push(parsed.suggestion);\n    }\n\n    // \u6839\u636E\u8F93\u5165\u7C7B\u578B\u7ED9\u51FA\u63D0\u793A\n    if (parsed.type === InputType.NATURAL_QUESTION) {\n      hints.push('\uD83D\uDCAC \u8FD9\u770B\u8D77\u6765\u662F\u4E00\u4E2A\u95EE\u9898\uFF0CAI \u5C06\u76F4\u63A5\u56DE\u7B54');\n    } else if (parsed.type === InputType.NATURAL_REQUEST) {\n      hints.push('\uD83D\uDD27 \u8FD9\u770B\u8D77\u6765\u662F\u4E00\u4E2A\u8BF7\u6C42\uFF0CAI \u5C06\u5C1D\u8BD5\u5E2E\u4F60\u5B8C\u6210');\n    } else if (parsed.type === InputType.CODE_REQUEST) {\n      hints.push('\uD83D\uDCBB \u68C0\u6D4B\u5230\u4EE3\u7801\u76F8\u5173\u5185\u5BB9\uFF0CAI \u5C06\u4EE5\u4EE3\u7801\u89C6\u89D2\u5206\u6790');\n    }\n\n    return hints;\n  }\n\n  /**\n   * \u5EFA\u8BAE\u8F6C\u6362\u4E3A\u547D\u4EE4\n   */\n  suggestCommand(input: string): string | null {\n    const parsed = this.parse(input);\n    return parsed.possibleCommand || null;\n  }\n\n  /**\n   * \u5224\u65AD\u662F\u5426\u5E94\u8BE5\u76F4\u63A5\u6267\u884C\u547D\u4EE4\n   */\n  shouldExecuteAsCommand(input: string): boolean {\n    return input.startsWith('/') || input.startsWith('!');\n  }\n\n  /**\n   * \u667A\u80FD\u5224\u65AD\u7528\u6237\u610F\u56FE\u5E76\u7ED9\u51FA\u5EFA\u8BAE\n   */\n  analyzeIntent(input: string): {\n    primaryIntent: string;\n    secondaryIntents: string[];\n    suggestedActions: Array<{ label: string; action: string }>;\n  } {\n    const parsed = this.parse(input);\n    const intents: string[] = [];\n    const actions: Array<{ label: string; action: string }> = [];\n\n    // \u5206\u6790\u4E3B\u8981\u610F\u56FE\n    let primaryIntent = '\u5BF9\u8BDD';\n    \n    if (parsed.type === InputType.COMMAND) {\n      primaryIntent = '\u6267\u884C\u547D\u4EE4';\n    } else if (parsed.type === InputType.SHELL_COMMAND) {\n      primaryIntent = '\u8FD0\u884C\u7EC8\u7AEF\u547D\u4EE4';\n    } else if (parsed.type === InputType.CODE_REQUEST) {\n      primaryIntent = '\u4EE3\u7801\u5904\u7406';\n      intents.push('\u53EF\u80FD\u9700\u8981\u751F\u6210\u4EE3\u7801', '\u53EF\u80FD\u9700\u8981\u4FEE\u590D\u4EE3\u7801', '\u53EF\u80FD\u9700\u8981\u89E3\u91CA\u4EE3\u7801');\n      actions.push(\n        { label: '\u751F\u6210\u6D4B\u8BD5', action: '/gentest' },\n        { label: '\u751F\u6210\u56FE\u8868', action: '/diagram' }\n      );\n    } else if (parsed.type === InputType.NATURAL_REQUEST) {\n      primaryIntent = '\u8BF7\u6C42\u5E2E\u52A9';\n      if (parsed.possibleCommand) {\n        actions.push({ label: `\u6267\u884C: ${parsed.possibleCommand}`, action: parsed.possibleCommand });\n      }\n    }\n\n    return {\n      primaryIntent,\n      secondaryIntents: intents,\n      suggestedActions: actions,\n    };\n  }\n}\n\n// \u5BFC\u51FA\u5355\u4F8B\nexport const smartInputParser = new SmartInputParser();\n", "import { TaskType, TaskStatus, TaskState, ChatViewContext } from '../types';\n\n/**\n * \u4EFB\u52A1\u72B6\u6001\u7BA1\u7406\u5668\n * \u5904\u7406\u4EFB\u52A1\u72B6\u6001\u7684\u66F4\u65B0\u3001\u68C0\u67E5\u548C\u53D6\u6D88\n */\nexport class TaskStateManager {\n  private taskStates: Record<TaskType, TaskState>;\n  private postMessage: (message: any) => void;\n\n  constructor(postMessage: (message: any) => void) {\n    this.postMessage = postMessage;\n    this.taskStates = {\n      chat: { status: 'idle', timestamp: 0 },\n      diagram: { status: 'idle', timestamp: 0 },\n      test: { status: 'idle', timestamp: 0 },\n      command: { status: 'idle', timestamp: 0 },\n      skill: { status: 'idle', timestamp: 0 },\n      mcp: { status: 'idle', timestamp: 0 },\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u6240\u6709\u4EFB\u52A1\u72B6\u6001\n   */\n  getTaskStates(): Record<TaskType, TaskState> {\n    return this.taskStates;\n  }\n\n  /**\n   * \u83B7\u53D6\u7279\u5B9A\u4EFB\u52A1\u7684\u72B6\u6001\n   */\n  getTaskState(taskType: TaskType): TaskState {\n    return this.taskStates[taskType];\n  }\n\n  /**\n   * \u68C0\u67E5\u7279\u5B9A\u4EFB\u52A1\u662F\u5426\u6B63\u5728\u8FD0\u884C\n   */\n  isRunning(taskType: TaskType): boolean {\n    return this.taskStates[taskType].status === 'running';\n  }\n\n  /**\n   * \u68C0\u67E5chat\u4EFB\u52A1\u662F\u5426\u6B63\u5728\u5904\u7406\uFF08\u5411\u540E\u517C\u5BB9\uFF09\n   */\n  get isProcessing(): boolean {\n    return this.taskStates.chat.status === 'running';\n  }\n\n  /**\n   * \u66F4\u65B0\u4EFB\u52A1\u72B6\u6001\n   */\n  updateStatus(taskType: TaskType, status: TaskStatus, message?: string): void {\n    const now = Date.now();\n    this.taskStates[taskType] = {\n      ...this.taskStates[taskType],\n      status,\n      message,\n      timestamp: now,\n    };\n    \n    // \u53EA\u6709\u975Echat\u7C7B\u578B\u7684\u4EFB\u52A1\u624D\u53D1\u9001\u5230\u4EFB\u52A1\u72B6\u6001\u680F\n    // chat\u7C7B\u578B\u7684\u4EFB\u52A1\u72B6\u6001\u5728chatbox\u4E2D\u663E\u793A\n    if (taskType !== 'chat') {\n      this.postMessage({\n        type: 'taskStatus',\n        taskType,\n        status,\n        message,\n        timestamp: now,\n      });\n    }\n    \n    // \u5982\u679C\u6210\u529F\uFF0C3\u79D2\u540E\u81EA\u52A8\u6062\u590D\u4E3Aidle\n    if (status === 'success') {\n      setTimeout(() => {\n        if (this.taskStates[taskType].status === 'success' && \n            this.taskStates[taskType].timestamp === now) {\n          this.updateStatus(taskType, 'idle');\n        }\n      }, 3000);\n    }\n    \n    // \u5982\u679C\u9519\u8BEF\uFF0C5\u79D2\u540E\u81EA\u52A8\u6062\u590D\u4E3Aidle\n    if (status === 'error') {\n      setTimeout(() => {\n        if (this.taskStates[taskType].status === 'error' && \n            this.taskStates[taskType].timestamp === now) {\n          this.updateStatus(taskType, 'idle');\n        }\n      }, 5000);\n    }\n  }\n\n  /**\n   * \u53D6\u6D88\u7279\u5B9A\u4EFB\u52A1\n   */\n  cancelTask(taskType: TaskType): void {\n    const taskState = this.taskStates[taskType];\n    if (taskState.abortController) {\n      taskState.abortController.abort();\n    }\n    this.updateStatus(taskType, 'idle', '\u5DF2\u53D6\u6D88');\n  }\n\n  /**\n   * \u8BBE\u7F6E\u4EFB\u52A1\u7684AbortController\n   */\n  setAbortController(taskType: TaskType, controller: AbortController): void {\n    this.taskStates[taskType].abortController = controller;\n  }\n\n  /**\n   * \u91CD\u7F6E\u6240\u6709\u4EFB\u52A1\u72B6\u6001\n   */\n  resetAll(): void {\n    for (const taskType of Object.keys(this.taskStates) as TaskType[]) {\n      this.taskStates[taskType] = { status: 'idle', timestamp: 0 };\n    }\n  }\n}\n", "import * as vscode from 'vscode';\nimport { ChatViewContext, MessageHandler } from '../types';\nimport { Message, generateId } from '../../../types/shared';\n\n/**\n * \u4F1A\u8BDD\u5904\u7406\u5668\n * \u5904\u7406\u4F1A\u8BDD\u76F8\u5173\u7684\u64CD\u4F5C\uFF1A\u521B\u5EFA\u3001\u52A0\u8F7D\u3001\u5220\u9664\u3001\u91CD\u547D\u540D\u7B49\n */\nexport class SessionHandler implements MessageHandler {\n  constructor(private ctx: ChatViewContext) {}\n\n  async handle(data: any): Promise<boolean> {\n    switch (data.type) {\n      case 'newChat':\n        await this.createNewChat();\n        return true;\n      case 'clearChat':\n        await this.clearChat();\n        return true;\n      case 'renameSession':\n        this.renameSession(data.sessionId, data.newTitle);\n        return true;\n      case 'deleteSession':\n        this.deleteSession(data.sessionId);\n        return true;\n      case 'getSessionList':\n        this.sendSessionList();\n        return true;\n      case 'loadSession':\n        await this.loadSession(data.sessionId);\n        return true;\n      case 'verifySessionState':\n        await this.verifySessionState(data.sessionId);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * \u521B\u5EFA\u65B0\u4F1A\u8BDD\n   */\n  async createNewChat(): Promise<void> {\n    const newSession = this.ctx.sessionManager.createSession();\n    console.log('[SessionHandler] Created new chat session:', newSession.id);\n    this.ctx.postMessage({\n      type: 'chatCleared',\n      sessionId: newSession.id,\n    });\n  }\n\n  /**\n   * \u6E05\u7A7A\u5F53\u524D\u4F1A\u8BDD\n   */\n  async clearChat(): Promise<void> {\n    await this.createNewChat();\n  }\n\n  /**\n   * \u91CD\u547D\u540D\u4F1A\u8BDD\n   */\n  renameSession(sessionId: string, newTitle: string): void {\n    const success = this.ctx.sessionManager.renameSession(sessionId, newTitle);\n    if (success) {\n      this.sendSessionList();\n      vscode.window.showInformationMessage(`\u4F1A\u8BDD\u5DF2\u91CD\u547D\u540D\u4E3A: ${newTitle}`);\n    } else {\n      vscode.window.showErrorMessage('\u91CD\u547D\u540D\u5931\u8D25');\n    }\n  }\n\n  /**\n   * \u5220\u9664\u4F1A\u8BDD\n   */\n  deleteSession(sessionId: string): void {\n    this.ctx.sessionManager.deleteSession(sessionId);\n    this.sendSessionList();\n    vscode.window.showInformationMessage('\u4F1A\u8BDD\u5DF2\u5220\u9664');\n  }\n\n  /**\n   * \u53D1\u9001\u4F1A\u8BDD\u5217\u8868\n   */\n  sendSessionList(): void {\n    const sessions = this.ctx.sessionManager.getSessionList();\n    this.ctx.postMessage({ type: 'sessionList', sessions });\n  }\n\n  /**\n   * \u52A0\u8F7D\u4F1A\u8BDD\n   */\n  async loadSession(sessionId: string): Promise<void> {\n    const session = await this.ctx.sessionManager.loadSession(sessionId);\n    if (session) {\n      this.ctx.postMessage({\n        type: 'sessionLoaded',\n        messages: session.messages || [],\n        sessionId: session.id,\n        sessionTitle: session.title,\n      });\n      vscode.window.showInformationMessage(`\u5DF2\u5207\u6362\u5230\u4F1A\u8BDD: ${session.title}`);\n    } else {\n      vscode.window.showErrorMessage('\u65E0\u6CD5\u52A0\u8F7D\u4F1A\u8BDD');\n    }\n  }\n\n  /**\n   * \u9A8C\u8BC1\u4F1A\u8BDD\u72B6\u6001\n   * \u5904\u7406\u524D\u7AEF\u548C\u540E\u7AEF\u4F1A\u8BDD\u72B6\u6001\u540C\u6B65\n   */\n  async verifySessionState(requestedSessionId?: string): Promise<void> {\n    console.log('[SessionHandler] Verifying session state, requested sessionId:', requestedSessionId);\n    \n    // \u5982\u679C\u524D\u7AEF\u4F20\u6765\u4E86\u7279\u5B9A\u7684sessionId\uFF0C\u4F18\u5148\u5C1D\u8BD5\u6062\u590D\u8BE5\u4F1A\u8BDD\n    if (requestedSessionId) {\n      const currentSession = this.ctx.sessionManager.currentSession;\n      \n      // \u60C5\u51B51\uFF1A\u540E\u7AEF\u5F53\u524D\u4F1A\u8BDD\u5C31\u662F\u8BF7\u6C42\u7684\u4F1A\u8BDD -> \u76F4\u63A5\u8FD4\u56DE\n      if (currentSession && currentSession.id === requestedSessionId) {\n        console.log('[SessionHandler] Session already matches, no action needed');\n        return;\n      }\n      \n      // \u60C5\u51B52\uFF1A\u540E\u7AEF\u4F1A\u8BDD\u4E0D\u5339\u914D\u6216\u4E22\u5931 -> \u5C1D\u8BD5\u4ECE\u5B58\u50A8\u52A0\u8F7D\n      console.log('[SessionHandler] Loading requested session from storage:', requestedSessionId);\n      const loaded = await this.ctx.sessionManager.loadSession(requestedSessionId);\n      if (loaded) {\n        console.log('[SessionHandler] Session restored successfully:', loaded.id, 'messages:', loaded.messages.length);\n        this.ctx.postMessage({\n          type: 'sessionLoaded',\n          messages: loaded.messages || [],\n          sessionId: loaded.id,\n          sessionTitle: loaded.title,\n        });\n        return;\n      }\n      \n      // \u60C5\u51B53\uFF1A\u8BF7\u6C42\u7684\u4F1A\u8BDD\u4E0D\u5B58\u5728\uFF08\u53EF\u80FD\u88AB\u5220\u9664\u4E86\uFF09\n      console.log('[SessionHandler] Requested session not found, trying last session...');\n    }\n    \n    // \u5982\u679C\u6CA1\u6709\u6307\u5B9AsessionId\u6216\u52A0\u8F7D\u5931\u8D25\uFF0C\u5C1D\u8BD5\u6062\u590D\u6700\u540E\u4E00\u4E2A\u4F1A\u8BDD\n    if (!this.ctx.sessionManager.currentSession) {\n      console.log('[SessionHandler] No current session, restoring last session...');\n      const restored = await this.ctx.sessionManager.continueLastSession();\n      if (restored) {\n        console.log('[SessionHandler] Last session restored:', restored.id);\n        this.ctx.postMessage({\n          type: 'sessionLoaded',\n          messages: restored.messages || [],\n          sessionId: restored.id,\n          sessionTitle: restored.title,\n        });\n        return;\n      }\n      \n      // \u771F\u7684\u6CA1\u6709\u4EFB\u4F55\u4F1A\u8BDD -> \u521B\u5EFA\u65B0\u4F1A\u8BDD\n      console.log('[SessionHandler] No sessions available, creating new session');\n      const newSession = this.ctx.sessionManager.createSession();\n      this.ctx.postMessage({\n        type: 'chatCleared',\n        sessionId: newSession.id,\n      });\n    }\n  }\n\n  /**\n   * \u663E\u793A\u4F1A\u8BDD\u9009\u62E9\u5668\n   */\n  async showSessionPicker(): Promise<void> {\n    const sessions = this.ctx.sessionManager.getSessionList();\n    \n    if (sessions.length === 0) {\n      vscode.window.showInformationMessage('\u6682\u65E0\u4F1A\u8BDD\u5386\u53F2');\n      return;\n    }\n    \n    const items: vscode.QuickPickItem[] = sessions.map(s => ({\n      label: s.title,\n      description: `${s.messageCount} \u6761\u6D88\u606F`,\n      detail: new Date(s.updatedAt).toLocaleString(),\n      id: s.id,\n    }));\n    \n    const selected = await vscode.window.showQuickPick(items, {\n      placeHolder: '\u9009\u62E9\u4E00\u4E2A\u4F1A\u8BDD\u6062\u590D',\n      matchOnDescription: true,\n    });\n    \n    if (selected) {\n      await this.loadSession((selected as any).id);\n    }\n  }\n\n  /**\n   * \u7EE7\u7EED\u4E0A\u4E00\u4E2A\u4F1A\u8BDD\n   */\n  async continueLastSession(): Promise<void> {\n    await this.ctx.sessionManager.continueLastSession();\n    this.sendCurrentState();\n  }\n\n  /**\n   * \u53D1\u9001\u5F53\u524D\u72B6\u6001\n   */\n  sendCurrentState(): void {\n    const session = this.ctx.sessionManager.currentSession;\n    const modelConfig = this.ctx.configManager.getModelConfig();\n\n    this.ctx.postMessage({\n      type: 'init',\n      messages: session?.messages || [],\n      modelConfig,\n      allModels: this.ctx.configManager.getAllModels(),\n      sessionId: session?.id || null,\n    });\n  }\n\n  /**\n   * \u53D1\u9001\u5F53\u524D\u72B6\u6001\uFF08\u5305\u62EC\u6D41\u5F0F\u6D88\u606F\uFF09\n   */\n  sendCurrentStateWithStreaming(): void {\n    const session = this.ctx.sessionManager.currentSession;\n    const modelConfig = this.ctx.configManager.getModelConfig();\n    \n    let messages = [...(session?.messages || [])];\n    \n    // \u5982\u679C\u6709\u6B63\u5728\u8FDB\u884C\u7684\u6D41\u5F0F\u6D88\u606F\uFF0C\u786E\u4FDD\u4F7F\u7528\u6700\u65B0\u5185\u5BB9\n    if (this.ctx.currentStreamingMessage) {\n      const streamingMsgId = this.ctx.currentStreamingMessage.id;\n      const savedMsgIndex = messages.findIndex(m => m.id === streamingMsgId);\n      \n      if (savedMsgIndex !== -1) {\n        messages[savedMsgIndex] = { ...this.ctx.currentStreamingMessage };\n        console.log('[SessionHandler] Using latest streaming message content:', streamingMsgId);\n      }\n    }\n\n    this.ctx.postMessage({\n      type: 'init',\n      messages,\n      modelConfig,\n      allModels: this.ctx.configManager.getAllModels(),\n      sessionId: session?.id || null,\n      isStreaming: this.ctx.isTaskRunning('chat') && !!this.ctx.currentStreamingMessage,\n    });\n    \n    // \u5982\u679C\u6709\u6B63\u5728\u8FDB\u884C\u7684\u6D41\u5F0F\u6D88\u606F\uFF0C\u7EE7\u7EED\u53D1\u9001\u6D41\u5F0F\u66F4\u65B0\n    if (this.ctx.isTaskRunning('chat') && this.ctx.currentStreamingMessage) {\n      this.ctx.postMessage({\n        type: 'resumeStreaming',\n        messageId: this.ctx.currentStreamingMessage.id,\n        content: this.ctx.currentStreamingMessage.content,\n      });\n    }\n  }\n\n  /**\n   * \u6E05\u7A7A\u6240\u6709\u6570\u636E\u5E76\u91CD\u7F6E\u72B6\u6001\n   */\n  clearAllDataAndReset(): void {\n    const newSession = this.ctx.sessionManager.createSession();\n    this.ctx.postMessage({ \n      type: 'chatCleared',\n      sessionId: newSession.id,\n    });\n    console.log('[SessionHandler] All data cleared, new session created:', newSession.id);\n  }\n}\n", "import * as vscode from 'vscode';\nimport { ChatViewContext, MessageHandler, CodeActionContext } from '../types';\nimport { Message, generateId, Attachment } from '../../../types/shared';\nimport { ChatService } from '../../api/ChatService';\nimport { i18n } from '../../i18n';\nimport { MemoryManager } from '../../memory/MemoryManager';\nimport { IntentClassifier, IntentResult } from '../../agent/IntentClassifier';\n\n/**\n * \u804A\u5929\u6D88\u606F\u5904\u7406\u5668\n * \n * \u6838\u5FC3\u6539\u8FDB\uFF1A\n * 1. \u96C6\u6210 IntentClassifier \u505A\u610F\u56FE\u8BC6\u522B\uFF0C\u533A\u5206 chat / tool / command\n * 2. \u7CBE\u7B80\u8BB0\u5FC6\u96C6\u6210\uFF1A\u53EA\u7528 MemoryManager.buildContextString() \u6CE8\u5165\n * 3. MCP/Skill \u6267\u884C\u7ED3\u679C\u901A\u8FC7 chat \u6D88\u606F\u8FD4\u56DE\n */\nexport class ChatMessageHandler implements MessageHandler {\n  private memoryManager: MemoryManager;\n  private intentClassifier: IntentClassifier;\n  \n  constructor(private ctx: ChatViewContext) {\n    this.memoryManager = MemoryManager.getInstance(ctx.extensionContext);\n    this.intentClassifier = new IntentClassifier();\n  }\n\n  async handle(data: any): Promise<boolean> {\n    switch (data.type) {\n      case 'sendMessage':\n        await this.handleSendMessage(data.message, data.attachments);\n        return true;\n      case 'cancelRequest':\n        await this.stopCurrentTask();\n        return true;\n      case 'regenerate':\n        await this.handleRegenerate();\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * \u5904\u7406\u53D1\u9001\u6D88\u606F - \u5165\u53E3\uFF0C\u505A\u610F\u56FE\u8BC6\u522B\n   */\n  async handleSendMessage(content: string, attachments?: Attachment[]): Promise<void> {\n    if (!content?.trim() && (!attachments || attachments.length === 0)) {\n      return;\n    }\n\n    // \u5386\u53F2\u8BB0\u5F55\n    if (content?.trim()) {\n      this.ctx.messageHistory.push(content);\n      if (this.ctx.messageHistory.length > 100) {\n        this.ctx.messageHistory.shift();\n      }\n      this.ctx.historyIndex = -1;\n    }\n\n    // \u5982\u679C\u6B63\u5728\u5904\u7406\u4E2D\uFF0C\u5148\u6253\u65AD\n    if (this.ctx.isTaskRunning('chat')) {\n      await this.stopChatTask();\n      await new Promise(resolve => setTimeout(resolve, 50));\n    }\n\n    // \u89E3\u6790\u8F93\u5165\uFF08\u4FDD\u6301\u539F\u6709\u7684\u547D\u4EE4/shell\u68C0\u6D4B\uFF09\n    const parsed = this.ctx.inputParser.parse(content);\n\n    if (parsed.type === 'command') {\n      const commandParsed = this.ctx.commandParser.parse(content);\n      if (commandParsed) {\n        return; // \u547D\u4EE4\u7531CommandHandler\u5904\u7406\n      }\n    }\n\n    // ========== \u610F\u56FE\u8BC6\u522B ==========\n    const editor = vscode.window.activeTextEditor;\n    const intentResult = this.intentClassifier.classify(content, {\n      hasSelectedCode: editor ? !editor.selection.isEmpty : false,\n      currentFile: editor?.document.fileName,\n    });\n\n    // \u6839\u636E\u610F\u56FE\u8DEF\u7531\uFF08\u4EC5\u5728\u6CA1\u6709\u663E\u5F0F @mcp/@skill \u524D\u7F00\u65F6\u4F7F\u7528\uFF09\n    // @mcp \u548C @skill \u7531 ChatViewProvider._handleSendMessage \u5DF2\u7ECF\u5148\u62E6\u622A\u4E86\n    // \u8FD9\u91CC\u5904\u7406\u7684\u662F\u81EA\u7136\u8BED\u8A00\u8F93\u5165\u7684\u610F\u56FE\u8BC6\u522B\n    if (intentResult.type === 'skill' && intentResult.skillId) {\n      // \u610F\u56FE\u8BC6\u522B\u5224\u65AD\u9700\u8981\u8C03\u7528\u6280\u80FD\u65F6\uFF0C\u63D0\u793A\u7528\u6237\u6216\u81EA\u52A8\u8C03\u7528\n      const hint = `\uD83D\uDCA1 \u68C0\u6D4B\u5230\u4F60\u53EF\u80FD\u60F3\u4F7F\u7528\u6280\u80FD \\`@skill:${intentResult.skillId}\\`\uFF0C\u6B63\u5728\u4E3A\u4F60\u8C03\u7528...`;\n      this.ctx.postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content: hint,\n          timestamp: Date.now(),\n          metadata: { type: 'intent_hint' },\n        },\n      });\n      // \u8FD9\u91CC\u4E0D\u76F4\u63A5\u8C03\u7528\u6280\u80FD\uFF08\u907F\u514D\u5FAA\u73AF\uFF09\uFF0C\u800C\u662F\u5C06\u610F\u56FE\u4FE1\u606F\u4F20\u9012\u7ED9chat\n      // \u8BA9AI\u5728\u56DE\u590D\u4E2D\u5EFA\u8BAE\u4F7F\u7528\u6280\u80FD\u6216\u76F4\u63A5\u5728prompt\u4E2D\u5F15\u5BFC\n    }\n\n    // \u9ED8\u8BA4\uFF1A\u53D1\u9001\u7ED9AI\n    await this.sendAIRequest(content, attachments);\n  }\n\n  /**\n   * \u53D1\u9001AI\u8BF7\u6C42\uFF08\u96C6\u6210\u7B80\u5316\u8BB0\u5FC6\uFF09\n   */\n  async sendAIRequest(\n    content: string, \n    attachments?: Attachment[],\n    options?: { skipUserMessage?: boolean; displayContent?: string }\n  ): Promise<void> {\n    const chatService = await this.ctx.ensureChatService();\n    if (!chatService) {\n      this.ctx.postMessage({\n        type: 'error',\n        message: 'Please configure an API key first',\n      });\n      return;\n    }\n\n    this.ctx.updateTaskStatus('chat', 'running', '\u6B63\u5728\u601D\u8003...');\n    this.ctx.setProcessingContext(true);\n\n    // \u6DFB\u52A0\u7528\u6237\u6D88\u606F\n    if (!options?.skipUserMessage) {\n      const userMessage: Message = {\n        id: generateId(),\n        role: 'user',\n        content: options?.displayContent || content,\n        timestamp: Date.now(),\n        attachments,\n      };\n      await this.ctx.sessionManager.addMessage(userMessage);\n      this.ctx.postMessage({ type: 'addMessage', message: userMessage });\n      \n      // \u4ECE\u7528\u6237\u6D88\u606F\u4E2D\u63D0\u53D6\u8BB0\u5FC6\n      this.memoryManager.extractFromMessage(userMessage);\n    }\n\n    const assistantMessage: Message = {\n      id: generateId(),\n      role: 'assistant',\n      content: '',\n      timestamp: Date.now(),\n      isStreaming: true,\n    };\n    \n    this.ctx.currentStreamingMessage = assistantMessage;\n    await this.ctx.sessionManager.addMessage(assistantMessage);\n    \n    let lastSaveTime = Date.now();\n    const SAVE_INTERVAL = 1000;\n\n    this.ctx.postMessage({ type: 'addMessage', message: assistantMessage, streaming: true });\n\n    // \u6784\u5EFA\u6D88\u606F\u5217\u8868\n    const messages = this.ctx.sessionManager.getMessages();\n    const messagesForAI = messages.map((msg, index) => {\n      if (index === messages.length - 1 && msg.role === 'user' && options?.displayContent) {\n        return { ...msg, content };\n      }\n      return msg;\n    });\n\n    // \u6784\u5EFA\u7CFB\u7EDF\u63D0\u793A\uFF08\u542B\u8BB0\u5FC6\u4E0A\u4E0B\u6587\uFF09\n    const systemPromptBase = i18n.getAISystemPrompt('general');\n    const languageInstruction = i18n.isChinese() \n      ? '\\n\\n=== \u8BED\u8A00\u8BBE\u7F6E\uFF08\u6700\u9AD8\u4F18\u5148\u7EA7\uFF09===\\n\u4F60\u5FC5\u987B\u4F7F\u7528\u7B80\u4F53\u4E2D\u6587\u56DE\u590D\u6240\u6709\u5185\u5BB9\u3002\\n- \u6240\u6709\u89E3\u91CA\u3001\u8BF4\u660E\u5FC5\u987B\u7528\u4E2D\u6587\\n- \u4EE3\u7801\u6CE8\u91CA\u4F7F\u7528\u4E2D\u6587\\n- \u4E13\u4E1A\u672F\u8BED\u53EF\u4FDD\u7559\u82F1\u6587\u4F46\u9700\u9644\u5E26\u4E2D\u6587\u89E3\u91CA\\n- \u7EDD\u5BF9\u4E0D\u8981\u4F7F\u7528\u82F1\u6587\u56DE\u590D\uFF08\u9664\u975E\u662F\u4EE3\u7801\u672C\u8EAB\uFF09'\n      : '\\n\\n=== Language Setting (Highest Priority) ===\\nYou MUST respond in English for all content.\\n- All explanations must be in English\\n- Code comments in English\\n- Do not respond in Chinese';\n    \n    // \u7B80\u5316\u7684\u8BB0\u5FC6\u6CE8\u5165\n    const memoryContext = this.memoryManager.buildContextString(content);\n    \n    const systemMessage: Message = {\n      id: 'system-language',\n      role: 'system' as const,\n      content: systemPromptBase + memoryContext + languageInstruction,\n      timestamp: Date.now(),\n    };\n    const messagesWithSystem = [systemMessage, ...messagesForAI];\n\n    try {\n      await chatService.sendMessage(messagesWithSystem, {\n        onToken: async (token) => {\n          assistantMessage.content += token;\n          if (this.ctx.currentStreamingMessage) {\n            this.ctx.currentStreamingMessage.content = assistantMessage.content;\n          }\n          this.ctx.postMessage({\n            type: 'updateMessage',\n            messageId: assistantMessage.id,\n            content: assistantMessage.content,\n          });\n          \n          const now = Date.now();\n          if (now - lastSaveTime > SAVE_INTERVAL && assistantMessage.content.length > 0) {\n            lastSaveTime = now;\n            await this.ctx.sessionManager.updateLastMessage(assistantMessage.content, false, true);\n          }\n        },\n        onComplete: async (fullResponse) => {\n          assistantMessage.content = fullResponse;\n          assistantMessage.isStreaming = false;\n          this.ctx.currentStreamingMessage = null;\n          \n          await this.ctx.sessionManager.updateLastMessage(fullResponse, true);\n          \n          this.ctx.postMessage({\n            type: 'completeMessage',\n            messageId: assistantMessage.id,\n            content: fullResponse,\n          });\n          this.ctx.setProcessingContext(false);\n          this.ctx.updateTaskStatus('chat', 'success', '\u56DE\u590D\u5B8C\u6210');\n        },\n        onError: (error) => {\n          this.ctx.currentStreamingMessage = null;\n          this.ctx.postMessage({\n            type: 'error',\n            message: error.message,\n            messageId: assistantMessage.id,\n          });\n          this.ctx.setProcessingContext(false);\n          this.ctx.updateTaskStatus('chat', 'error', error.message);\n        },\n      }, { requestId: 'chat' });\n    } catch (error) {\n      this.ctx.currentStreamingMessage = null;\n      this.ctx.postMessage({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      });\n      this.ctx.setProcessingContext(false);\n      this.ctx.updateTaskStatus('chat', 'error', error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF');\n    }\n  }\n\n  /**\n   * \u5904\u7406\u91CD\u65B0\u751F\u6210\n   */\n  async handleRegenerate(): Promise<void> {\n    const messages = this.ctx.sessionManager.getMessages();\n    \n    let lastUserMessageIndex = -1;\n    for (let i = messages.length - 1; i >= 0; i--) {\n      if (messages[i].role === 'user') {\n        lastUserMessageIndex = i;\n        break;\n      }\n    }\n\n    if (lastUserMessageIndex === -1) {\n      this.ctx.postMessage({ type: 'error', message: '\u6CA1\u6709\u53EF\u91CD\u65B0\u751F\u6210\u7684\u6D88\u606F' });\n      return;\n    }\n\n    const lastUserMessage = messages[lastUserMessageIndex];\n\n    for (let i = messages.length - 1; i > lastUserMessageIndex; i--) {\n      this.ctx.postMessage({ type: 'removeMessage', messageId: messages[i].id });\n    }\n    \n    while (this.ctx.sessionManager.getMessages().length > lastUserMessageIndex + 1) {\n      await this.ctx.sessionManager.removeLastMessage();\n    }\n\n    await this.sendAIRequest(lastUserMessage.content, lastUserMessage.attachments, {\n      skipUserMessage: true,\n    });\n  }\n\n  /**\n   * \u505C\u6B62\u6240\u6709\u6B63\u5728\u8FD0\u884C\u7684\u4EFB\u52A1\n   */\n  async stopCurrentTask(): Promise<void> {\n    let hasRunningTask = false;\n    \n    if (this.ctx.isTaskRunning('chat')) {\n      hasRunningTask = true;\n      await this.stopChatTaskInternal();\n    }\n    \n    const otherTaskTypes: Array<'diagram' | 'test' | 'command' | 'skill'> = ['diagram', 'test', 'command', 'skill'];\n    for (const taskType of otherTaskTypes) {\n      if (this.ctx.isTaskRunning(taskType)) {\n        hasRunningTask = true;\n        this.ctx.updateTaskStatus(taskType, 'idle', '\u5DF2\u53D6\u6D88');\n      }\n    }\n    \n    if (hasRunningTask && this.ctx.chatService) {\n      this.ctx.chatService.cancel();\n    }\n    \n    this.ctx.postMessage({ type: 'taskStopped' });\n  }\n\n  async stopChatTask(): Promise<void> {\n    if (!this.ctx.isTaskRunning('chat')) {\n      return;\n    }\n    await this.stopChatTaskInternal();\n    \n    if (this.ctx.chatService) {\n      this.ctx.chatService.cancelRequest('chat');\n    }\n  }\n\n  private async stopChatTaskInternal(): Promise<void> {\n    if (this.ctx.currentStreamingMessage) {\n      const hasContent = this.ctx.currentStreamingMessage.content.trim().length > 0;\n      \n      const session = this.ctx.sessionManager.currentSession;\n      if (session) {\n        const existingMsg = session.messages.find(m => m.id === this.ctx.currentStreamingMessage!.id);\n        \n        if (hasContent) {\n          if (!existingMsg) {\n            await this.ctx.sessionManager.addMessage(this.ctx.currentStreamingMessage);\n          } else if (existingMsg.content !== this.ctx.currentStreamingMessage.content) {\n            await this.ctx.sessionManager.updateLastMessage(this.ctx.currentStreamingMessage.content, true);\n          }\n        } else if (existingMsg) {\n          const msgIndex = session.messages.findIndex(m => m.id === this.ctx.currentStreamingMessage!.id);\n          if (msgIndex !== -1) {\n            session.messages.splice(msgIndex, 1);\n            await this.ctx.sessionManager.saveCurrentSession();\n          }\n        }\n      }\n      \n      this.ctx.postMessage({\n        type: 'completeMessage',\n        messageId: this.ctx.currentStreamingMessage.id,\n        content: this.ctx.currentStreamingMessage.content,\n        interrupted: true,\n      });\n      \n      this.ctx.currentStreamingMessage = null;\n    }\n    \n    this.ctx.updateTaskStatus('chat', 'idle', '\u5DF2\u505C\u6B62');\n    this.ctx.setProcessingContext(false);\n  }\n\n  /**\n   * \u53D1\u9001\u5E26\u7CFB\u7EDF\u4E0A\u4E0B\u6587\u7684\u6D88\u606F\uFF08\u7528\u4E8E\u4EE3\u7801\u64CD\u4F5C\uFF09\n   */\n  async sendMessageWithContext(\n    displayLabel: string, \n    systemContext: CodeActionContext\n  ): Promise<void> {\n    if (this.ctx.isTaskRunning('chat')) {\n      await this.stopChatTask();\n      await new Promise(resolve => setTimeout(resolve, 50));\n    }\n\n    const chatService = await this.ctx.ensureChatService();\n    if (!chatService) {\n      this.ctx.postMessage({\n        type: 'error',\n        message: '\u8BF7\u5148\u914D\u7F6E API Key',\n      });\n      return;\n    }\n\n    this.ctx.updateTaskStatus('chat', 'running', `\u6B63\u5728${displayLabel}...`);\n    this.ctx.setProcessingContext(true);\n\n    const codePreview = systemContext.code.length > 150 \n      ? systemContext.code.slice(0, 150) + '...' \n      : systemContext.code;\n    \n    const displayMessage = `${displayLabel}\\n\\n\\`\\`\\`${systemContext.language}\\n${codePreview}\\n\\`\\`\\``;\n    \n    const userMessage: Message = {\n      id: generateId(),\n      role: 'user',\n      content: displayMessage,\n      timestamp: Date.now(),\n    };\n\n    await this.ctx.sessionManager.addMessage(userMessage);\n    this.ctx.postMessage({ type: 'addMessage', message: userMessage });\n\n    const fullPrompt = this.buildCodeActionPrompt(systemContext);\n    \n    const messagesForAI = this.ctx.sessionManager.getMessages().map(msg => {\n      if (msg.id === userMessage.id) {\n        return { ...msg, content: fullPrompt };\n      }\n      return msg;\n    });\n\n    const assistantMessage: Message = {\n      id: generateId(),\n      role: 'assistant',\n      content: '',\n      timestamp: Date.now(),\n      isStreaming: true,\n    };\n\n    await this.ctx.sessionManager.addMessage(assistantMessage);\n    this.ctx.currentStreamingMessage = assistantMessage;\n    \n    let lastSaveTime = Date.now();\n    const SAVE_INTERVAL = 1000;\n\n    this.ctx.postMessage({ type: 'addMessage', message: assistantMessage, streaming: true });\n\n    const systemPromptBase = i18n.getAISystemPrompt('code');\n    const languageInstruction = i18n.isChinese() \n      ? '\\n\\n=== \u8BED\u8A00\u8BBE\u7F6E\uFF08\u6700\u9AD8\u4F18\u5148\u7EA7\uFF09===\\n\u4F60\u5FC5\u987B\u4F7F\u7528\u7B80\u4F53\u4E2D\u6587\u56DE\u590D\u6240\u6709\u5185\u5BB9\u3002'\n      : '\\n\\n=== Language Setting (Highest Priority) ===\\nYou MUST respond in English.';\n    \n    const memoryContext = this.memoryManager.buildContextString(displayLabel + ' ' + systemContext.code);\n    \n    const systemMessage: Message = {\n      id: 'system-language',\n      role: 'system' as const,\n      content: systemPromptBase + memoryContext + languageInstruction,\n      timestamp: Date.now(),\n    };\n    const messagesWithSystem = [systemMessage, ...messagesForAI];\n\n    try {\n      await chatService.sendMessage(messagesWithSystem, {\n        onToken: (token) => {\n          assistantMessage.content += token;\n          if (this.ctx.currentStreamingMessage) {\n            this.ctx.currentStreamingMessage.content = assistantMessage.content;\n          }\n          this.ctx.postMessage({\n            type: 'updateMessage',\n            messageId: assistantMessage.id,\n            content: assistantMessage.content,\n          });\n          \n          const now = Date.now();\n          if (now - lastSaveTime > SAVE_INTERVAL && assistantMessage.content.length > 0) {\n            lastSaveTime = now;\n            this.ctx.sessionManager.updateLastMessage(assistantMessage.content, false, true);\n          }\n        },\n        onComplete: async (fullResponse) => {\n          assistantMessage.content = fullResponse;\n          assistantMessage.isStreaming = false;\n          this.ctx.currentStreamingMessage = null;\n          this.ctx.sessionManager.updateLastMessage(fullResponse, true);\n          \n          this.ctx.postMessage({\n            type: 'completeMessage',\n            messageId: assistantMessage.id,\n            content: fullResponse,\n          });\n          this.ctx.setProcessingContext(false);\n          this.ctx.updateTaskStatus('chat', 'success', `${displayLabel}\u5B8C\u6210`);\n        },\n        onError: (error) => {\n          this.ctx.currentStreamingMessage = null;\n          this.ctx.postMessage({\n            type: 'error',\n            message: error.message,\n          });\n          this.ctx.setProcessingContext(false);\n          this.ctx.updateTaskStatus('chat', 'error', error.message);\n        },\n      }, { requestId: 'chat' });\n    } catch (error) {\n      this.ctx.currentStreamingMessage = null;\n      const errorMsg = error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF';\n      this.ctx.postMessage({\n        type: 'error',\n        message: errorMsg,\n      });\n      this.ctx.setProcessingContext(false);\n      this.ctx.updateTaskStatus('chat', 'error', errorMsg);\n    }\n  }\n\n  private buildCodeActionPrompt(ctx: CodeActionContext): string {\n    const isChinese = i18n.isChinese();\n    \n    let prompt = `${ctx.prompt}\n\n**${isChinese ? '\u6587\u4EF6' : 'File'}:** \\`${ctx.fileName}\\`\n**${isChinese ? '\u8BED\u8A00' : 'Language'}:** ${ctx.language}\n\n\\`\\`\\`${ctx.language}\n${ctx.code}\n\\`\\`\\``;\n    \n    if (ctx.useSearchReplace) {\n      if (isChinese) {\n        prompt += `\n\n**\u56DE\u590D\u8981\u6C42\uFF1A**\n1. \u9996\u5148\uFF0C\u7B80\u8981\u5206\u6790\u4EE3\u7801\u5B58\u5728\u7684\u95EE\u9898\u6216\u53EF\u4EE5\u6539\u8FDB\u7684\u5730\u65B9\uFF082-4\u70B9\uFF09\n2. \u7136\u540E\uFF0C\u8BF4\u660E\u4F60\u7684\u4FEE\u6539\u601D\u8DEF\n3. \u6700\u540E\uFF0C\u4F7F\u7528\u4EE5\u4E0B\u683C\u5F0F\u8FD4\u56DE\u4EE3\u7801\u4FEE\u6539\uFF1A\n\n\\`\\`\\`\n<<<<<<< SEARCH\n[\u8981\u67E5\u627E\u7684\u539F\u59CB\u4EE3\u7801]\n=======\n[\u66FF\u6362\u540E\u7684\u65B0\u4EE3\u7801]\n>>>>>>> REPLACE\n\\`\\`\\`\n\n4. \u5728\u4EE3\u7801\u4FEE\u6539\u540E\uFF0C\u7B80\u8981\u603B\u7ED3\u4E3B\u8981\u4FEE\u6539\u5185\u5BB9`;\n      } else {\n        prompt += `\n\n**Response Requirements:**\n1. First, briefly analyze the issues or improvements in the code\n2. Then, explain your modification approach\n3. Finally, use the SEARCH/REPLACE format to return code changes\n4. After the code changes, briefly summarize the modifications`;\n      }\n    }\n    \n    return prompt;\n  }\n  \n  getMemoryManager(): MemoryManager {\n    return this.memoryManager;\n  }\n\n  getIntentClassifier(): IntentClassifier {\n    return this.intentClassifier;\n  }\n}\n", "/**\n * \u56FD\u9645\u5316 (i18n) \u7CFB\u7EDF\n * \u652F\u6301\u4E2D\u6587\u548C\u82F1\u6587\u7684AI\u56DE\u590D\u548CUI\u6587\u672C\n */\n\nimport * as vscode from 'vscode';\n\n/** \u652F\u6301\u7684\u8BED\u8A00 */\nexport type SupportedLanguage = 'zh-CN' | 'en-US';\n\n/** \u8BED\u8A00\u914D\u7F6E\u4FE1\u606F */\nexport interface LanguageInfo {\n  code: SupportedLanguage;\n  name: string;\n  nativeName: string;\n  aiPromptSuffix: string;\n}\n\n/** \u6240\u6709\u652F\u6301\u7684\u8BED\u8A00 */\nexport const SUPPORTED_LANGUAGES: LanguageInfo[] = [\n  {\n    code: 'zh-CN',\n    name: 'Chinese (Simplified)',\n    nativeName: '\u7B80\u4F53\u4E2D\u6587',\n    aiPromptSuffix: '\u8BF7\u4F7F\u7528\u4E2D\u6587\u56DE\u590D\u3002',\n  },\n  {\n    code: 'en-US',\n    name: 'English (US)',\n    nativeName: 'English',\n    aiPromptSuffix: 'Please respond in English.',\n  },\n];\n\n/** \u7FFB\u8BD1\u952E\u503C */\nexport interface Translations {\n  // \u901A\u7528\n  common: {\n    confirm: string;\n    cancel: string;\n    save: string;\n    delete: string;\n    edit: string;\n    copy: string;\n    close: string;\n    loading: string;\n    error: string;\n    success: string;\n    warning: string;\n    info: string;\n    yes: string;\n    no: string;\n    ok: string;\n    retry: string;\n    refresh: string;\n    search: string;\n    clear: string;\n    reset: string;\n  };\n  \n  // \u804A\u5929\u76F8\u5173\n  chat: {\n    newConversation: string;\n    clearContext: string;\n    compactContext: string;\n    sendMessage: string;\n    stopGeneration: string;\n    regenerate: string;\n    inputPlaceholder: string;\n    thinking: string;\n    generating: string;\n    completed: string;\n    error: string;\n    noApiKey: string;\n    selectProvider: string;\n    selectModel: string;\n    temperature: string;\n    maxTokens: string;\n  };\n  \n  // \u4EFB\u52A1\u72B6\u6001\n  task: {\n    idle: string;\n    running: string;\n    success: string;\n    failed: string;\n    cancelled: string;\n    pending: string;\n    \n    // \u5177\u4F53\u4EFB\u52A1\n    generatingDiagram: string;\n    diagramCompleted: string;\n    generatingTest: string;\n    testCompleted: string;\n    executingCommand: string;\n    commandCompleted: string;\n    executingSkill: string;\n    skillCompleted: string;\n    \n    // \u5E76\u884C\u4EFB\u52A1\n    parallelTasksRunning: string;\n    parallelTasksCompleted: string;\n    taskProgress: string;\n  };\n  \n  // \u56FE\u8868\u76F8\u5173\n  diagram: {\n    title: string;\n    flowchart: string;\n    sequence: string;\n    class: string;\n    state: string;\n    er: string;\n    gantt: string;\n    pie: string;\n    mindmap: string;\n    architecture: string;\n    generate: string;\n    export: string;\n    edit: string;\n    preview: string;\n    save: string;\n    history: string;\n    invalidCode: string;\n  };\n  \n  // \u6D4B\u8BD5\u76F8\u5173\n  test: {\n    title: string;\n    generate: string;\n    run: string;\n    save: string;\n    fix: string;\n    refine: string;\n    framework: string;\n    coverage: string;\n    passed: string;\n    failed: string;\n    skipped: string;\n    history: string;\n  };\n  \n  // MCP \u76F8\u5173\n  mcp: {\n    title: string;\n    serverManagement: string;\n    addServer: string;\n    removeServer: string;\n    connectServer: string;\n    disconnectServer: string;\n    serverStatus: string;\n    connected: string;\n    disconnected: string;\n    connecting: string;\n    error: string;\n    tools: string;\n    resources: string;\n    prompts: string;\n    demoConfigs: string;\n    importConfig: string;\n    exportConfig: string;\n  };\n  \n  // \u6280\u80FD\u76F8\u5173\n  skill: {\n    title: string;\n    dependencyCheck: string;\n    testArchitect: string;\n    codeReviewer: string;\n    excelProcessor: string;\n    wordProcessor: string;\n    pptProcessor: string;\n    toolMaker: string;\n    executing: string;\n    completed: string;\n    failed: string;\n  };\n  \n  // \u9519\u8BEF\u6D88\u606F\n  errors: {\n    networkError: string;\n    apiKeyMissing: string;\n    apiKeyInvalid: string;\n    modelNotFound: string;\n    rateLimited: string;\n    serverError: string;\n    timeout: string;\n    unknown: string;\n    noWorkspace: string;\n    fileNotFound: string;\n    permissionDenied: string;\n  };\n  \n  // AI \u7CFB\u7EDF\u63D0\u793A\n  ai: {\n    systemPrompt: string;\n    codeAssistantPrompt: string;\n    diagramAssistantPrompt: string;\n    testAssistantPrompt: string;\n  };\n}\n\n/** \u4E2D\u6587\u7FFB\u8BD1 */\nconst ZH_CN: Translations = {\n  common: {\n    confirm: '\u786E\u8BA4',\n    cancel: '\u53D6\u6D88',\n    save: '\u4FDD\u5B58',\n    delete: '\u5220\u9664',\n    edit: '\u7F16\u8F91',\n    copy: '\u590D\u5236',\n    close: '\u5173\u95ED',\n    loading: '\u52A0\u8F7D\u4E2D...',\n    error: '\u9519\u8BEF',\n    success: '\u6210\u529F',\n    warning: '\u8B66\u544A',\n    info: '\u4FE1\u606F',\n    yes: '\u662F',\n    no: '\u5426',\n    ok: '\u786E\u5B9A',\n    retry: '\u91CD\u8BD5',\n    refresh: '\u5237\u65B0',\n    search: '\u641C\u7D22',\n    clear: '\u6E05\u9664',\n    reset: '\u91CD\u7F6E',\n  },\n  \n  chat: {\n    newConversation: '\u65B0\u5EFA\u5BF9\u8BDD',\n    clearContext: '\u6E05\u9664\u4E0A\u4E0B\u6587',\n    compactContext: '\u538B\u7F29\u4E0A\u4E0B\u6587',\n    sendMessage: '\u53D1\u9001\u6D88\u606F',\n    stopGeneration: '\u505C\u6B62\u751F\u6210',\n    regenerate: '\u91CD\u65B0\u751F\u6210',\n    inputPlaceholder: '\u8F93\u5165\u6D88\u606F... \u6309 Enter \u53D1\u9001\uFF0CShift+Enter \u6362\u884C',\n    thinking: '\u601D\u8003\u4E2D...',\n    generating: '\u751F\u6210\u4E2D...',\n    completed: '\u5DF2\u5B8C\u6210',\n    error: '\u51FA\u9519\u4E86',\n    noApiKey: '\u8BF7\u5148\u8BBE\u7F6E API Key',\n    selectProvider: '\u9009\u62E9\u63D0\u4F9B\u5546',\n    selectModel: '\u9009\u62E9\u6A21\u578B',\n    temperature: '\u6E29\u5EA6',\n    maxTokens: '\u6700\u5927 Token \u6570',\n  },\n  \n  task: {\n    idle: '\u7A7A\u95F2',\n    running: '\u8FD0\u884C\u4E2D',\n    success: '\u6210\u529F',\n    failed: '\u5931\u8D25',\n    cancelled: '\u5DF2\u53D6\u6D88',\n    pending: '\u7B49\u5F85\u4E2D',\n    \n    generatingDiagram: '\u6B63\u5728\u751F\u6210\u6D41\u7A0B\u56FE...',\n    diagramCompleted: '\u6D41\u7A0B\u56FE\u751F\u6210\u5B8C\u6210',\n    generatingTest: '\u6B63\u5728\u751F\u6210\u6D4B\u8BD5\u4EE3\u7801...',\n    testCompleted: '\u6D4B\u8BD5\u751F\u6210\u5B8C\u6210',\n    executingCommand: '\u6B63\u5728\u6267\u884C\u547D\u4EE4...',\n    commandCompleted: '\u547D\u4EE4\u6267\u884C\u5B8C\u6210',\n    executingSkill: '\u6B63\u5728\u6267\u884C\u6280\u80FD...',\n    skillCompleted: '\u6280\u80FD\u6267\u884C\u5B8C\u6210',\n    \n    parallelTasksRunning: '\u6B63\u5728\u5E76\u884C\u6267\u884C {count} \u4E2A\u4EFB\u52A1...',\n    parallelTasksCompleted: '\u5DF2\u5B8C\u6210 {completed}/{total} \u4E2A\u4EFB\u52A1',\n    taskProgress: '\u4EFB\u52A1\u8FDB\u5EA6: {progress}%',\n  },\n  \n  diagram: {\n    title: '\u6D41\u7A0B\u56FE',\n    flowchart: '\u6D41\u7A0B\u56FE',\n    sequence: '\u65F6\u5E8F\u56FE',\n    class: '\u7C7B\u56FE',\n    state: '\u72B6\u6001\u56FE',\n    er: 'ER\u56FE',\n    gantt: '\u7518\u7279\u56FE',\n    pie: '\u997C\u56FE',\n    mindmap: '\u601D\u7EF4\u5BFC\u56FE',\n    architecture: '\u67B6\u6784\u56FE',\n    generate: '\u751F\u6210\u56FE\u8868',\n    export: '\u5BFC\u51FA\u56FE\u8868',\n    edit: '\u7F16\u8F91\u56FE\u8868',\n    preview: '\u9884\u89C8',\n    save: '\u4FDD\u5B58\u56FE\u8868',\n    history: '\u5386\u53F2\u8BB0\u5F55',\n    invalidCode: '\u56FE\u8868\u4EE3\u7801\u65E0\u6548',\n  },\n  \n  test: {\n    title: '\u6D4B\u8BD5',\n    generate: '\u751F\u6210\u6D4B\u8BD5',\n    run: '\u8FD0\u884C\u6D4B\u8BD5',\n    save: '\u4FDD\u5B58\u6D4B\u8BD5',\n    fix: '\u4FEE\u590D\u6D4B\u8BD5',\n    refine: '\u4F18\u5316\u6D4B\u8BD5',\n    framework: '\u6D4B\u8BD5\u6846\u67B6',\n    coverage: '\u8986\u76D6\u7387',\n    passed: '\u901A\u8FC7',\n    failed: '\u5931\u8D25',\n    skipped: '\u8DF3\u8FC7',\n    history: '\u6D4B\u8BD5\u5386\u53F2',\n  },\n  \n  mcp: {\n    title: 'MCP \u670D\u52A1\u5668',\n    serverManagement: '\u670D\u52A1\u5668\u7BA1\u7406',\n    addServer: '\u6DFB\u52A0\u670D\u52A1\u5668',\n    removeServer: '\u79FB\u9664\u670D\u52A1\u5668',\n    connectServer: '\u8FDE\u63A5\u670D\u52A1\u5668',\n    disconnectServer: '\u65AD\u5F00\u8FDE\u63A5',\n    serverStatus: '\u670D\u52A1\u5668\u72B6\u6001',\n    connected: '\u5DF2\u8FDE\u63A5',\n    disconnected: '\u672A\u8FDE\u63A5',\n    connecting: '\u8FDE\u63A5\u4E2D...',\n    error: '\u8FDE\u63A5\u9519\u8BEF',\n    tools: '\u53EF\u7528\u5DE5\u5177',\n    resources: '\u53EF\u7528\u8D44\u6E90',\n    prompts: '\u53EF\u7528\u63D0\u793A',\n    demoConfigs: 'Demo \u914D\u7F6E',\n    importConfig: '\u5BFC\u5165\u914D\u7F6E',\n    exportConfig: '\u5BFC\u51FA\u914D\u7F6E',\n  },\n  \n  skill: {\n    title: 'AI \u6280\u80FD',\n    dependencyCheck: '\u4F9D\u8D56\u5B89\u5168\u68C0\u67E5',\n    testArchitect: '\u6D4B\u8BD5\u67B6\u6784\u5E08',\n    codeReviewer: '\u4EE3\u7801\u5BA1\u67E5',\n    excelProcessor: 'Excel \u5904\u7406',\n    wordProcessor: 'Word \u5904\u7406',\n    pptProcessor: 'PPT \u5904\u7406',\n    toolMaker: '\u5DE5\u5177\u5236\u4F5C',\n    executing: '\u6B63\u5728\u6267\u884C...',\n    completed: '\u6267\u884C\u5B8C\u6210',\n    failed: '\u6267\u884C\u5931\u8D25',\n  },\n  \n  errors: {\n    networkError: '\u7F51\u7EDC\u8FDE\u63A5\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8BBE\u7F6E',\n    apiKeyMissing: 'API Key \u672A\u8BBE\u7F6E\uFF0C\u8BF7\u5728\u8BBE\u7F6E\u4E2D\u914D\u7F6E',\n    apiKeyInvalid: 'API Key \u65E0\u6548\uFF0C\u8BF7\u68C0\u67E5\u914D\u7F6E',\n    modelNotFound: '\u6A21\u578B\u4E0D\u5B58\u5728\u6216\u4E0D\u53EF\u7528',\n    rateLimited: '\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5',\n    serverError: '\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n    timeout: '\u8BF7\u6C42\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5',\n    unknown: '\u672A\u77E5\u9519\u8BEF',\n    noWorkspace: '\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u9879\u76EE\u6587\u4EF6\u5939',\n    fileNotFound: '\u6587\u4EF6\u4E0D\u5B58\u5728',\n    permissionDenied: '\u6743\u9650\u4E0D\u8DB3',\n  },\n  \n  ai: {\n    systemPrompt: '\u4F60\u662F\u4E00\u4E2A\u4E13\u4E1A\u7684\u7F16\u7A0B\u52A9\u624B\uFF0C\u64C5\u957F\u4EE3\u7801\u5206\u6790\u3001\u95EE\u9898\u89E3\u7B54\u548C\u6280\u672F\u6307\u5BFC\u3002\u8BF7\u4F7F\u7528\u4E2D\u6587\u56DE\u590D\u7528\u6237\u7684\u95EE\u9898\uFF0C\u4FDD\u6301\u4E13\u4E1A\u3001\u6E05\u6670\u3001\u6709\u5E2E\u52A9\u7684\u6001\u5EA6\u3002',\n    codeAssistantPrompt: '\u4F60\u662F\u4E00\u4E2A\u4EE3\u7801\u4E13\u5BB6\u3002\u8BF7\u5206\u6790\u4EE3\u7801\u5E76\u63D0\u4F9B\u4E13\u4E1A\u7684\u5EFA\u8BAE\u3002\u4F7F\u7528\u4E2D\u6587\u56DE\u590D\u3002',\n    diagramAssistantPrompt: '\u4F60\u662F\u4E00\u4E2A\u56FE\u8868\u751F\u6210\u4E13\u5BB6\u3002\u8BF7\u6839\u636E\u9700\u6C42\u751F\u6210\u6E05\u6670\u3001\u4E13\u4E1A\u7684\u56FE\u8868\u4EE3\u7801\u3002\u4F7F\u7528\u4E2D\u6587\u6807\u7B7E\u3002',\n    testAssistantPrompt: '\u4F60\u662F\u4E00\u4E2A\u6D4B\u8BD5\u4E13\u5BB6\u3002\u8BF7\u751F\u6210\u5168\u9762\u3001\u53EF\u9760\u7684\u6D4B\u8BD5\u4EE3\u7801\u3002\u4F7F\u7528\u4E2D\u6587\u6CE8\u91CA\u3002',\n  },\n};\n\n/** \u82F1\u6587\u7FFB\u8BD1 */\nconst EN_US: Translations = {\n  common: {\n    confirm: 'Confirm',\n    cancel: 'Cancel',\n    save: 'Save',\n    delete: 'Delete',\n    edit: 'Edit',\n    copy: 'Copy',\n    close: 'Close',\n    loading: 'Loading...',\n    error: 'Error',\n    success: 'Success',\n    warning: 'Warning',\n    info: 'Info',\n    yes: 'Yes',\n    no: 'No',\n    ok: 'OK',\n    retry: 'Retry',\n    refresh: 'Refresh',\n    search: 'Search',\n    clear: 'Clear',\n    reset: 'Reset',\n  },\n  \n  chat: {\n    newConversation: 'New Conversation',\n    clearContext: 'Clear Context',\n    compactContext: 'Compact Context',\n    sendMessage: 'Send Message',\n    stopGeneration: 'Stop Generation',\n    regenerate: 'Regenerate',\n    inputPlaceholder: 'Type a message... Press Enter to send, Shift+Enter for new line',\n    thinking: 'Thinking...',\n    generating: 'Generating...',\n    completed: 'Completed',\n    error: 'Error occurred',\n    noApiKey: 'Please set up your API Key first',\n    selectProvider: 'Select Provider',\n    selectModel: 'Select Model',\n    temperature: 'Temperature',\n    maxTokens: 'Max Tokens',\n  },\n  \n  task: {\n    idle: 'Idle',\n    running: 'Running',\n    success: 'Success',\n    failed: 'Failed',\n    cancelled: 'Cancelled',\n    pending: 'Pending',\n    \n    generatingDiagram: 'Generating diagram...',\n    diagramCompleted: 'Diagram generation completed',\n    generatingTest: 'Generating test code...',\n    testCompleted: 'Test generation completed',\n    executingCommand: 'Executing command...',\n    commandCompleted: 'Command execution completed',\n    executingSkill: 'Executing skill...',\n    skillCompleted: 'Skill execution completed',\n    \n    parallelTasksRunning: 'Running {count} tasks in parallel...',\n    parallelTasksCompleted: 'Completed {completed}/{total} tasks',\n    taskProgress: 'Task progress: {progress}%',\n  },\n  \n  diagram: {\n    title: 'Diagram',\n    flowchart: 'Flowchart',\n    sequence: 'Sequence Diagram',\n    class: 'Class Diagram',\n    state: 'State Diagram',\n    er: 'ER Diagram',\n    gantt: 'Gantt Chart',\n    pie: 'Pie Chart',\n    mindmap: 'Mind Map',\n    architecture: 'Architecture Diagram',\n    generate: 'Generate Diagram',\n    export: 'Export Diagram',\n    edit: 'Edit Diagram',\n    preview: 'Preview',\n    save: 'Save Diagram',\n    history: 'History',\n    invalidCode: 'Invalid diagram code',\n  },\n  \n  test: {\n    title: 'Test',\n    generate: 'Generate Test',\n    run: 'Run Test',\n    save: 'Save Test',\n    fix: 'Fix Test',\n    refine: 'Refine Test',\n    framework: 'Test Framework',\n    coverage: 'Coverage',\n    passed: 'Passed',\n    failed: 'Failed',\n    skipped: 'Skipped',\n    history: 'Test History',\n  },\n  \n  mcp: {\n    title: 'MCP Server',\n    serverManagement: 'Server Management',\n    addServer: 'Add Server',\n    removeServer: 'Remove Server',\n    connectServer: 'Connect Server',\n    disconnectServer: 'Disconnect',\n    serverStatus: 'Server Status',\n    connected: 'Connected',\n    disconnected: 'Disconnected',\n    connecting: 'Connecting...',\n    error: 'Connection Error',\n    tools: 'Available Tools',\n    resources: 'Available Resources',\n    prompts: 'Available Prompts',\n    demoConfigs: 'Demo Configs',\n    importConfig: 'Import Config',\n    exportConfig: 'Export Config',\n  },\n  \n  skill: {\n    title: 'AI Skills',\n    dependencyCheck: 'Dependency Security Check',\n    testArchitect: 'Test Architect',\n    codeReviewer: 'Code Reviewer',\n    excelProcessor: 'Excel Processor',\n    wordProcessor: 'Word Processor',\n    pptProcessor: 'PPT Processor',\n    toolMaker: 'Tool Maker',\n    executing: 'Executing...',\n    completed: 'Execution completed',\n    failed: 'Execution failed',\n  },\n  \n  errors: {\n    networkError: 'Network connection error, please check your network',\n    apiKeyMissing: 'API Key not set, please configure in settings',\n    apiKeyInvalid: 'Invalid API Key, please check configuration',\n    modelNotFound: 'Model not found or unavailable',\n    rateLimited: 'Rate limited, please try again later',\n    serverError: 'Server error, please try again later',\n    timeout: 'Request timeout, please retry',\n    unknown: 'Unknown error',\n    noWorkspace: 'Please open a project folder first',\n    fileNotFound: 'File not found',\n    permissionDenied: 'Permission denied',\n  },\n  \n  ai: {\n    systemPrompt: 'You are a professional programming assistant skilled in code analysis, problem solving, and technical guidance. Please respond in English and maintain a professional, clear, and helpful attitude.',\n    codeAssistantPrompt: 'You are a code expert. Please analyze the code and provide professional advice. Respond in English.',\n    diagramAssistantPrompt: 'You are a diagram generation expert. Please generate clear and professional diagram code based on requirements. Use English labels.',\n    testAssistantPrompt: 'You are a testing expert. Please generate comprehensive and reliable test code. Use English comments.',\n  },\n};\n\n/** \u6240\u6709\u7FFB\u8BD1 */\nconst TRANSLATIONS: Record<SupportedLanguage, Translations> = {\n  'zh-CN': ZH_CN,\n  'en-US': EN_US,\n};\n\n/**\n * \u56FD\u9645\u5316\u7BA1\u7406\u5668\n */\nexport class I18nManager {\n  private static instance: I18nManager | null = null;\n  private currentLanguage: SupportedLanguage = 'zh-CN';\n  private context: vscode.ExtensionContext | null = null;\n\n  private constructor() {}\n\n  static getInstance(): I18nManager {\n    if (!I18nManager.instance) {\n      I18nManager.instance = new I18nManager();\n    }\n    return I18nManager.instance;\n  }\n\n  /**\n   * \u521D\u59CB\u5316\n   */\n  initialize(context: vscode.ExtensionContext): void {\n    this.context = context;\n    \n    // \u4ECE\u914D\u7F6E\u8BFB\u53D6\u8BED\u8A00\u8BBE\u7F6E\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    const savedLanguage = config.get<SupportedLanguage>('language');\n    \n    if (savedLanguage && TRANSLATIONS[savedLanguage]) {\n      this.currentLanguage = savedLanguage;\n    } else {\n      // \u6839\u636E VS Code \u8BED\u8A00\u81EA\u52A8\u68C0\u6D4B\n      const vscodeLanguage = vscode.env.language;\n      if (vscodeLanguage.startsWith('zh')) {\n        this.currentLanguage = 'zh-CN';\n      } else {\n        this.currentLanguage = 'en-US';\n      }\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u5F53\u524D\u8BED\u8A00\n   */\n  getCurrentLanguage(): SupportedLanguage {\n    return this.currentLanguage;\n  }\n\n  /**\n   * \u83B7\u53D6\u8BED\u8A00\u4FE1\u606F\n   */\n  getLanguageInfo(): LanguageInfo {\n    return SUPPORTED_LANGUAGES.find(l => l.code === this.currentLanguage)!;\n  }\n\n  /**\n   * \u8BBE\u7F6E\u8BED\u8A00\n   */\n  async setLanguage(language: SupportedLanguage): Promise<void> {\n    if (!TRANSLATIONS[language]) {\n      throw new Error(`Unsupported language: ${language}`);\n    }\n    \n    this.currentLanguage = language;\n    \n    // \u4FDD\u5B58\u5230\u914D\u7F6E\n    const config = vscode.workspace.getConfiguration('aiAssistant');\n    await config.update('language', language, vscode.ConfigurationTarget.Global);\n  }\n\n  /**\n   * \u83B7\u53D6\u7FFB\u8BD1\u6587\u672C\n   */\n  t<K extends keyof Translations>(\n    category: K,\n    key: keyof Translations[K]\n  ): string {\n    const translations = TRANSLATIONS[this.currentLanguage];\n    const categoryTranslations = translations[category] as Record<string, string>;\n    return categoryTranslations[key as string] || `[${String(category)}.${String(key)}]`;\n  }\n\n  /**\n   * \u83B7\u53D6\u5E26\u53C2\u6570\u7684\u7FFB\u8BD1\u6587\u672C\n   */\n  tf<K extends keyof Translations>(\n    category: K,\n    key: keyof Translations[K],\n    params: Record<string, string | number>\n  ): string {\n    let text = this.t(category, key);\n    \n    for (const [param, value] of Object.entries(params)) {\n      text = text.replace(`{${param}}`, String(value));\n    }\n    \n    return text;\n  }\n\n  /**\n   * \u83B7\u53D6 AI \u7CFB\u7EDF\u63D0\u793A\n   */\n  getAISystemPrompt(type: 'general' | 'code' | 'diagram' | 'test' = 'general'): string {\n    const translations = TRANSLATIONS[this.currentLanguage];\n    \n    switch (type) {\n      case 'code':\n        return translations.ai.codeAssistantPrompt;\n      case 'diagram':\n        return translations.ai.diagramAssistantPrompt;\n      case 'test':\n        return translations.ai.testAssistantPrompt;\n      default:\n        return translations.ai.systemPrompt;\n    }\n  }\n\n  /**\n   * \u83B7\u53D6 AI \u56DE\u590D\u8BED\u8A00\u63D0\u793A\u540E\u7F00\n   */\n  getAILanguageSuffix(): string {\n    return this.getLanguageInfo().aiPromptSuffix;\n  }\n\n  /**\n   * \u83B7\u53D6\u5B8C\u6574\u7684 AI \u7CFB\u7EDF\u63D0\u793A\uFF08\u5305\u542B\u8BED\u8A00\u6307\u793A\uFF09\n   */\n  getFullAIPrompt(type: 'general' | 'code' | 'diagram' | 'test' = 'general'): string {\n    return `${this.getAISystemPrompt(type)}\\n\\n${this.getAILanguageSuffix()}`;\n  }\n\n  /**\n   * \u83B7\u53D6\u6240\u6709\u652F\u6301\u7684\u8BED\u8A00\n   */\n  getSupportedLanguages(): LanguageInfo[] {\n    return SUPPORTED_LANGUAGES;\n  }\n\n  /**\n   * \u68C0\u67E5\u662F\u5426\u4E3A\u4E2D\u6587\n   */\n  isChinese(): boolean {\n    return this.currentLanguage === 'zh-CN';\n  }\n\n  /**\n   * \u68C0\u67E5\u662F\u5426\u4E3A\u82F1\u6587\n   */\n  isEnglish(): boolean {\n    return this.currentLanguage === 'en-US';\n  }\n}\n\n// \u5BFC\u51FA\u4FBF\u6377\u51FD\u6570\nexport const i18n = I18nManager.getInstance();\n\nexport function t<K extends keyof Translations>(\n  category: K,\n  key: keyof Translations[K]\n): string {\n  return i18n.t(category, key);\n}\n\nexport function tf<K extends keyof Translations>(\n  category: K,\n  key: keyof Translations[K],\n  params: Record<string, string | number>\n): string {\n  return i18n.tf(category, key, params);\n}\n", "/**\n * \u8BB0\u5FC6\u7BA1\u7406\u7CFB\u7EDF (v2 \u4F18\u5316\u7248)\n * \n * \u4E24\u5C42\u8BB0\u5FC6\uFF1A\n * - \u77ED\u671F\u8BB0\u5FC6 (Short-term): \u5F53\u524D\u4F1A\u8BDD + \u6700\u8FD1\u5BF9\u8BDD\u7684\u5173\u952E\u4FE1\u606F\uFF0C\u81EA\u52A8\u8FC7\u671F\n * - \u957F\u671F\u8BB0\u5FC6 (Long-term): \u7ECF\u8FC7\u7B5B\u9009\u548C\u538B\u7F29\u540E\u6301\u4E45\u4FDD\u5B58\u7684\u7528\u6237\u504F\u597D\u548C\u9879\u76EE\u77E5\u8BC6\n * \n * v2 \u4F18\u5316\u70B9\uFF1A\n * - \u5173\u952E\u8BCD\u7F13\u5B58\uFF0C\u907F\u514D\u91CD\u590D\u8BA1\u7B97\n * - \u9632\u6296\u4FDD\u5B58\uFF0C\u51CF\u5C11IO\n * - \u4F18\u5316\u76F8\u4F3C\u5EA6\u7B97\u6CD5\uFF08Jaccard\u7CFB\u6570 + \u5185\u5BB9\u54C8\u5E0C\uFF09\n * - \u66F4\u7CBE\u786E\u7684\u664B\u5347\u548C\u6DD8\u6C70\u7B56\u7565\n */\n\nimport * as vscode from 'vscode';\nimport { Message, estimateTokens } from '../../types/shared';\n\n// ============================================\n// \u7C7B\u578B\u5B9A\u4E49\n// ============================================\n\nexport interface MemoryEntry {\n  id: string;\n  type: 'preference' | 'project' | 'fact' | 'summary';\n  content: string;\n  keywords: string[];\n  importance: number;\n  accessCount: number;\n  lastAccessed: number;\n  createdAt: number;\n  expiresAt?: number;\n}\n\nexport interface MemoryStats {\n  shortTermCount: number;\n  longTermCount: number;\n  totalTokens: number;\n}\n\nexport interface MemoryRetrievalResult {\n  memories: MemoryEntry[];\n  relevanceScore: number;\n  tokenCount: number;\n}\n\n// ============================================\n// \u5E38\u91CF\n// ============================================\n\nconst STORAGE_KEY = 'aiAssistant.memory.v2';\nconst SHORT_TERM_TTL = 2 * 60 * 60 * 1000;      // 2\u5C0F\u65F6\nconst SHORT_TERM_MAX = 40;\nconst LONG_TERM_MAX = 100;\nconst PROMOTE_ACCESS = 3;\nconst PROMOTE_IMPORTANCE = 0.7;\nconst COMPRESS_INTERVAL = 30 * 60 * 1000;\nconst CLEANUP_INTERVAL = 10 * 60 * 1000;\nconst SAVE_DEBOUNCE = 3000;                       // 3\u79D2\u9632\u6296\n\n// \u505C\u7528\u8BCD\u96C6\u5408\nconst STOP_WORDS = new Set([\n  '\u7684', '\u4E86', '\u662F', '\u5728', '\u6211', '\u6709', '\u548C', '\u5C31', '\u4E0D', '\u4EBA', '\u90FD', '\u4E00',\n  '\u4E00\u4E2A', '\u8FD9', '\u90A3', '\u4F60', '\u5B83', '\u4E5F', '\u5F88', '\u5230', '\u8BF4', '\u8981', '\u4F1A',\n  'the', 'a', 'an', 'is', 'are', 'was', 'be', 'to', 'of', 'in', 'for',\n  'on', 'with', 'at', 'by', 'this', 'that', 'it', 'he', 'she', 'we',\n  'they', 'i', 'me', 'my', 'do', 'does', 'did', 'has', 'have', 'had',\n  'can', 'will', 'would', 'should', 'could', 'may',\n]);\n\n// ============================================\n// MemoryManager\n// ============================================\n\nexport class MemoryManager {\n  private static instance: MemoryManager | null = null;\n\n  private context: vscode.ExtensionContext;\n  private shortTerm: MemoryEntry[] = [];\n  private longTerm: MemoryEntry[] = [];\n  private cleanupTimer?: ReturnType<typeof setInterval>;\n  private compressTimer?: ReturnType<typeof setInterval>;\n  private saveTimer?: ReturnType<typeof setTimeout>;\n  private dirty = false;\n\n  // \u5173\u952E\u8BCD\u7F13\u5B58\n  private keywordCache = new Map<string, string[]>();\n  private readonly CACHE_MAX = 200;\n\n  private constructor(context: vscode.ExtensionContext) {\n    this.context = context;\n    this.load();\n    this.startTimers();\n  }\n\n  static getInstance(context: vscode.ExtensionContext): MemoryManager {\n    if (!MemoryManager.instance) {\n      MemoryManager.instance = new MemoryManager(context);\n    }\n    return MemoryManager.instance;\n  }\n\n  // ============================================\n  // \u5199\u5165\n  // ============================================\n\n  addShortTerm(entry: Pick<MemoryEntry, 'type' | 'content' | 'keywords' | 'importance'>): void {\n    const existing = this.shortTerm.find(e =>\n      e.type === entry.type && this.similarity(e.content, entry.content) > 0.8\n    );\n    if (existing) {\n      existing.lastAccessed = Date.now();\n      existing.accessCount++;\n      existing.importance = Math.max(existing.importance, entry.importance);\n      this.markDirty();\n      return;\n    }\n\n    this.shortTerm.push({\n      id: `st_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,\n      ...entry,\n      accessCount: 0,\n      lastAccessed: Date.now(),\n      createdAt: Date.now(),\n      expiresAt: Date.now() + SHORT_TERM_TTL,\n    });\n\n    if (this.shortTerm.length > SHORT_TERM_MAX) {\n      this.evictShortTerm();\n    }\n    this.markDirty();\n  }\n\n  addLongTerm(entry: Pick<MemoryEntry, 'type' | 'content' | 'keywords' | 'importance'>): void {\n    const existing = this.longTerm.find(e =>\n      e.type === entry.type && this.similarity(e.content, entry.content) > 0.8\n    );\n    if (existing) {\n      existing.lastAccessed = Date.now();\n      existing.accessCount++;\n      existing.importance = Math.max(existing.importance, entry.importance);\n      this.markDirty();\n      return;\n    }\n\n    this.longTerm.push({\n      id: `lt_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,\n      ...entry,\n      accessCount: 0,\n      lastAccessed: Date.now(),\n      createdAt: Date.now(),\n    });\n\n    if (this.longTerm.length > LONG_TERM_MAX) {\n      this.compressLongTerm();\n    }\n    this.markDirty();\n  }\n\n  // ============================================\n  // \u4ECE\u6D88\u606F\u4E2D\u63D0\u53D6\u8BB0\u5FC6\n  // ============================================\n\n  extractFromMessage(message: Message): void {\n    if (message.role !== 'user') return;\n    const text = message.content;\n    if (!text || text.length < 5) return;\n\n    // \u504F\u597D\u63D0\u53D6\n    const prefPatterns = [\n      /\u6211(\u559C\u6B22|\u504F\u597D|\u4E60\u60EF|\u60F3\u8981|\u9700\u8981|\u901A\u5E38|\u4E00\u822C)(.{4,60})/g,\n      /\u8BF7(\u4F7F\u7528|\u91C7\u7528|\u9075\u5FAA|\u7528)(.{4,40})/g,\n    ];\n    for (const p of prefPatterns) {\n      let m;\n      while ((m = p.exec(text)) !== null) {\n        this.addShortTerm({\n          type: 'preference',\n          content: m[0].trim(),\n          keywords: this.extractKeywords(m[0]),\n          importance: 0.65,\n        });\n      }\n    }\n\n    // \u6280\u672F\u6808\u63D0\u53D6\n    const techPattern = /(?:\u4F7F\u7528|\u91C7\u7528|\u57FA\u4E8E)\\s*(React|Vue|Angular|Next\\.?js|TypeScript|JavaScript|Python|Go|Rust|Java|Spring|Django|Flask|Express)/gi;\n    let m;\n    while ((m = techPattern.exec(text)) !== null) {\n      this.addShortTerm({\n        type: 'project',\n        content: `\u9879\u76EE\u6280\u672F: ${m[0].trim()}`,\n        keywords: this.extractKeywords(m[0]),\n        importance: 0.75,\n      });\n    }\n  }\n\n  compressSession(sessionId: string, messages: Message[]): void {\n    if (messages.length < 6) return;\n\n    const topics = new Set<string>();\n    messages\n      .filter(m => m.role === 'user')\n      .forEach(m => this.extractKeywords(m.content).slice(0, 3).forEach(k => topics.add(k)));\n\n    const topicStr = [...topics].slice(0, 8).join(', ');\n    this.addLongTerm({\n      type: 'summary',\n      content: `\u4F1A\u8BDD(${messages.length}\u6761)\u8BA8\u8BBA\u4E86: ${topicStr}`,\n      keywords: [...topics].slice(0, 10),\n      importance: 0.5,\n    });\n  }\n\n  // ============================================\n  // \u68C0\u7D22\n  // ============================================\n\n  retrieve(query: string, limit: number = 5): MemoryRetrievalResult {\n    const qKeywords = this.extractKeywords(query);\n    if (qKeywords.length === 0) {\n      return { memories: [], relevanceScore: 0, tokenCount: 0 };\n    }\n\n    const scored: Array<MemoryEntry & { score: number }> = [];\n    const allEntries = [...this.shortTerm, ...this.longTerm];\n\n    for (const entry of allEntries) {\n      const score = this.relevanceScore(qKeywords, entry);\n      if (score > 0.1) {\n        scored.push({ ...entry, score });\n      }\n    }\n\n    scored.sort((a, b) => b.score - a.score);\n    const top = scored.slice(0, limit);\n\n    // \u66F4\u65B0\u8BBF\u95EE\u8BA1\u6570\n    for (const item of top) {\n      const original = allEntries.find(e => e.id === item.id);\n      if (original) {\n        original.accessCount++;\n        original.lastAccessed = Date.now();\n      }\n    }\n\n    if (top.length > 0) this.markDirty();\n\n    return {\n      memories: top,\n      relevanceScore: top.length > 0 ? top[0].score : 0,\n      tokenCount: top.reduce((s, e) => s + estimateTokens(e.content), 0),\n    };\n  }\n\n  buildContextString(query: string, maxTokens: number = 800): string {\n    const result = this.retrieve(query, 6);\n    if (result.memories.length === 0) return '';\n\n    const typeLabels: Record<string, string> = {\n      preference: '\u504F\u597D', project: '\u9879\u76EE', summary: '\u5386\u53F2', fact: '\u4FE1\u606F',\n    };\n\n    let context = '\\n\\n=== \u76F8\u5173\u8BB0\u5FC6 ===\\n';\n    let tokens = 0;\n\n    for (const mem of result.memories) {\n      const entryTokens = estimateTokens(mem.content);\n      if (tokens + entryTokens > maxTokens) break;\n      context += `- [${typeLabels[mem.type] || '\u4FE1\u606F'}] ${mem.content}\\n`;\n      tokens += entryTokens;\n    }\n\n    context += '\u8BF7\u5728\u56DE\u590D\u65F6\u9002\u5F53\u8003\u8651\u4E0A\u8FF0\u4FE1\u606F\u3002\\n';\n    return context;\n  }\n\n  // ============================================\n  // \u6E05\u6D17 & \u538B\u7F29\n  // ============================================\n\n  cleanup(): void {\n    const now = Date.now();\n    const toPromote: MemoryEntry[] = [];\n    const kept: MemoryEntry[] = [];\n\n    for (const entry of this.shortTerm) {\n      const expired = entry.expiresAt && entry.expiresAt < now;\n\n      if (entry.accessCount >= PROMOTE_ACCESS || entry.importance >= PROMOTE_IMPORTANCE) {\n        toPromote.push(entry);\n        continue;\n      }\n\n      if (!expired) {\n        kept.push(entry);\n      }\n    }\n\n    const changed = kept.length !== this.shortTerm.length || toPromote.length > 0;\n    this.shortTerm = kept;\n\n    for (const entry of toPromote) {\n      this.addLongTerm({\n        type: entry.type,\n        content: entry.content,\n        keywords: entry.keywords,\n        importance: Math.min(entry.importance + 0.1, 1),\n      });\n    }\n\n    if (changed) this.markDirty();\n  }\n\n  compressLongTerm(): void {\n    if (this.longTerm.length <= LONG_TERM_MAX * 0.8) return;\n\n    const merged: MemoryEntry[] = [];\n    const used = new Set<string>();\n\n    for (let i = 0; i < this.longTerm.length; i++) {\n      if (used.has(this.longTerm[i].id)) continue;\n\n      const current = { ...this.longTerm[i] };\n\n      for (let j = i + 1; j < this.longTerm.length; j++) {\n        if (used.has(this.longTerm[j].id)) continue;\n\n        if (this.similarity(current.content, this.longTerm[j].content) > 0.6) {\n          used.add(this.longTerm[j].id);\n          current.accessCount += this.longTerm[j].accessCount;\n          current.importance = Math.max(current.importance, this.longTerm[j].importance);\n          current.lastAccessed = Math.max(current.lastAccessed, this.longTerm[j].lastAccessed);\n          const kw = new Set([...current.keywords, ...this.longTerm[j].keywords]);\n          current.keywords = [...kw].slice(0, 15);\n        }\n      }\n\n      merged.push(current);\n    }\n\n    if (merged.length > LONG_TERM_MAX) {\n      merged.sort((a, b) => {\n        const scoreA = a.importance * 0.5 + Math.min(a.accessCount * 0.1, 0.3) + (a.type === 'preference' ? 0.2 : 0);\n        const scoreB = b.importance * 0.5 + Math.min(b.accessCount * 0.1, 0.3) + (b.type === 'preference' ? 0.2 : 0);\n        return scoreB - scoreA;\n      });\n      this.longTerm = merged.slice(0, LONG_TERM_MAX);\n    } else {\n      this.longTerm = merged;\n    }\n\n    this.markDirty();\n  }\n\n  private evictShortTerm(): void {\n    this.shortTerm.sort((a, b) => {\n      const now = Date.now();\n      const scoreA = a.importance * 0.6 + Math.min(a.accessCount * 0.1, 0.2) + (a.expiresAt ? Math.max(0, (a.expiresAt - now) / SHORT_TERM_TTL * 0.2) : 0);\n      const scoreB = b.importance * 0.6 + Math.min(b.accessCount * 0.1, 0.2) + (b.expiresAt ? Math.max(0, (b.expiresAt - now) / SHORT_TERM_TTL * 0.2) : 0);\n      return scoreB - scoreA;\n    });\n    this.shortTerm = this.shortTerm.slice(0, SHORT_TERM_MAX);\n  }\n\n  // ============================================\n  // \u7EDF\u8BA1 & \u7BA1\u7406\n  // ============================================\n\n  getStats(): MemoryStats {\n    const allEntries = [...this.shortTerm, ...this.longTerm];\n    return {\n      shortTermCount: this.shortTerm.length,\n      longTermCount: this.longTerm.length,\n      totalTokens: allEntries.reduce((s, e) => s + estimateTokens(e.content), 0),\n    };\n  }\n\n  clearAll(): void {\n    this.shortTerm = [];\n    this.longTerm = [];\n    this.keywordCache.clear();\n    this.save();\n  }\n\n  // ============================================\n  // \u6301\u4E45\u5316\uFF08\u5E26\u9632\u6296\uFF09\n  // ============================================\n\n  private markDirty(): void {\n    this.dirty = true;\n    // \u9632\u6296\u4FDD\u5B58\n    if (this.saveTimer) clearTimeout(this.saveTimer);\n    this.saveTimer = setTimeout(() => {\n      if (this.dirty) this.save();\n    }, SAVE_DEBOUNCE);\n  }\n\n  private save(): void {\n    this.context.globalState.update(STORAGE_KEY, {\n      shortTerm: this.shortTerm,\n      longTerm: this.longTerm,\n      savedAt: Date.now(),\n    });\n    this.dirty = false;\n  }\n\n  private load(): void {\n    const data = this.context.globalState.get<any>(STORAGE_KEY);\n    if (data) {\n      this.shortTerm = data.shortTerm || [];\n      this.longTerm = data.longTerm || [];\n    }\n    this.cleanup();\n  }\n\n  private startTimers(): void {\n    this.cleanupTimer = setInterval(() => {\n      this.cleanup();\n    }, CLEANUP_INTERVAL);\n\n    this.compressTimer = setInterval(() => {\n      this.compressLongTerm();\n    }, COMPRESS_INTERVAL);\n  }\n\n  dispose(): void {\n    if (this.cleanupTimer) clearInterval(this.cleanupTimer);\n    if (this.compressTimer) clearInterval(this.compressTimer);\n    if (this.saveTimer) clearTimeout(this.saveTimer);\n    if (this.dirty) this.save();\n  }\n\n  // ============================================\n  // \u5DE5\u5177\u65B9\u6CD5\uFF08\u5E26\u7F13\u5B58\uFF09\n  // ============================================\n\n  extractKeywords(text: string): string[] {\n    // \u7F13\u5B58\u68C0\u67E5\n    const cacheKey = text.substring(0, 100);\n    const cached = this.keywordCache.get(cacheKey);\n    if (cached) return cached;\n\n    const words = text.toLowerCase()\n      .replace(/[^\\w\\u4e00-\\u9fa5\\s]/g, ' ')\n      .split(/\\s+/)\n      .filter(w => w.length > 1 && !STOP_WORDS.has(w));\n\n    const result = [...new Set(words)].slice(0, 15);\n\n    // \u7F13\u5B58\u7BA1\u7406\n    if (this.keywordCache.size > this.CACHE_MAX) {\n      const firstKey = this.keywordCache.keys().next().value;\n      if (firstKey !== undefined) this.keywordCache.delete(firstKey);\n    }\n    this.keywordCache.set(cacheKey, result);\n\n    return result;\n  }\n\n  private relevanceScore(queryKeywords: string[], entry: MemoryEntry): number {\n    if (queryKeywords.length === 0 || entry.keywords.length === 0) return 0;\n\n    let matches = 0;\n    const contentLower = entry.content.toLowerCase();\n\n    for (const qk of queryKeywords) {\n      if (entry.keywords.includes(qk) || contentLower.includes(qk)) {\n        matches++;\n      }\n    }\n\n    const keywordScore = matches / queryKeywords.length;\n    const importanceBonus = entry.importance * 0.15;\n    const accessBonus = Math.min(entry.accessCount * 0.03, 0.15);\n    const recencyBonus = entry.lastAccessed > Date.now() - 3600000 ? 0.1 : 0;\n\n    return keywordScore + importanceBonus + accessBonus + recencyBonus;\n  }\n\n  private similarity(a: string, b: string): number {\n    const wordsA = new Set(this.extractKeywords(a));\n    const wordsB = new Set(this.extractKeywords(b));\n    if (wordsA.size === 0 && wordsB.size === 0) return 1;\n    if (wordsA.size === 0 || wordsB.size === 0) return 0;\n\n    let intersection = 0;\n    for (const w of wordsA) {\n      if (wordsB.has(w)) intersection++;\n    }\n    return intersection / (wordsA.size + wordsB.size - intersection);\n  }\n}\n\nexport { MemoryManager as default };\n", "/**\n * Intent Classifier - \u610F\u56FE\u5206\u7C7B\u5668 (v2)\n * \n * \u6838\u5FC3\u804C\u8D23\uFF1A\u51C6\u786E\u533A\u5206\u7528\u6237\u8F93\u5165\u7684\u610F\u56FE\u8DEF\u7531\n * \n * \u8DEF\u7531\u903B\u8F91\uFF1A\n *   /\u547D\u4EE4      \u2192 command\n *   @mcp:xxx  \u2192 mcp_tool (\u663E\u5F0F)\n *   @skill:xxx\u2192 skill (\u663E\u5F0F)\n *   \u81EA\u7136\u8BED\u8A00\uFF1A\n *     \u4EE3\u7801\u64CD\u4F5C(\u6709\u9009\u4E2D\u4EE3\u7801) \u2192 code_action (AI\u76F4\u63A5\u5904\u7406)\n *     skill\u5173\u952E\u8BCD\u5339\u914D     \u2192 skill (\u9700\u8981\u7279\u5B9A\u6280\u80FD\u5305)\n *     MCP\u5173\u952E\u8BCD\u5339\u914D       \u2192 mcp_tool (\u9700\u8981\u5916\u90E8\u5DE5\u5177)\n *     \u5176\u4ED6               \u2192 chat (\u666E\u901A\u5BF9\u8BDD)\n * \n * \u5173\u952E\u539F\u5219\uFF1A\n * - \u4EE3\u7801\u89E3\u91CA/\u4FEE\u590D/\u4F18\u5316/\u6CE8\u91CA = chat (AI\u672C\u8EAB\u5C31\u80FD\u505A)\n * - \u6587\u4EF6\u8BFB\u5199/\u7EC8\u7AEF/\u641C\u7D22 = mcp_tool (\u9700\u8981\u5916\u90E8\u5DE5\u5177)\n * - \u5B89\u5168\u68C0\u67E5/\u6D4B\u8BD5\u67B6\u6784/\u4EE3\u7801\u5BA1\u67E5\u62A5\u544A = skill (\u9700\u8981\u7279\u5B9Askill\u5305)\n */\n\n/** \u610F\u56FE\u7C7B\u578B */\nexport type IntentType =\n  | 'chat'           // \u666E\u901A\u5BF9\u8BDD / \u4EE3\u7801\u64CD\u4F5C\n  | 'code_action'    // \u4EE3\u7801\u64CD\u4F5C\uFF08\u5E26\u9009\u4E2D\u4EE3\u7801\u4E0A\u4E0B\u6587\uFF09\n  | 'skill'          // \u6280\u80FD\u5305\u8C03\u7528\n  | 'mcp_tool'       // MCP\u5DE5\u5177\u8C03\u7528\n  | 'command';       // \u659C\u6760\u547D\u4EE4\n\n/** \u4EE3\u7801\u64CD\u4F5C\u7C7B\u578B */\nexport type CodeActionType =\n  | 'explain' | 'fix' | 'optimize' | 'comment'\n  | 'review' | 'refactor' | 'test';\n\n/** \u610F\u56FE\u5206\u7C7B\u7ED3\u679C */\nexport interface IntentResult {\n  type: IntentType;\n  confidence: number;\n  codeAction?: CodeActionType;\n  skillId?: string;\n  skillParams?: Record<string, any>;\n  mcpToolHint?: string;\n  command?: { name: string; args: string };\n  rawInput: string;\n  processedPrompt?: string;\n}\n\n/** Skill\u89E6\u53D1\u89C4\u5219\uFF08\u53EF\u52A8\u6001\u6CE8\u5165\uFF09 */\nexport interface SkillTriggerRule {\n  skillId: string;\n  patterns: RegExp[];\n  priority: number;\n}\n\n/**\n * \u610F\u56FE\u5206\u7C7B\u5668\n */\nexport class IntentClassifier {\n  /** \u52A8\u6001\u6CE8\u518C\u7684skill\u89E6\u53D1\u89C4\u5219 */\n  private dynamicSkillTriggers: SkillTriggerRule[] = [];\n\n  /** \u5185\u7F6Eskill\u89E6\u53D1\u89C4\u5219 */\n  private readonly builtinSkillTriggers: SkillTriggerRule[] = [\n    {\n      skillId: 'dependency-guardian',\n      priority: 10,\n      patterns: [\n        /npm\\s+audit/i,\n        /(\u5B89\u5168|\u6F0F\u6D1E)\\s*(\u68C0\u67E5|\u626B\u63CF|\u5BA1\u8BA1|\u68C0\u6D4B)/i,\n        /\u4F9D\u8D56\\s*(\u5B89\u5168|\u6F0F\u6D1E|\u68C0\u67E5)/i,\n        /security\\s+(audit|check|scan)/i,\n      ],\n    },\n    {\n      skillId: 'code-reviewer',\n      priority: 10,\n      patterns: [\n        /(\u5168\u9762|\u6DF1\u5EA6|\u5B8C\u6574)\\s*\u4EE3\u7801\\s*\u5BA1\u67E5/i,\n        /code\\s*review\\s*(\u62A5\u544A|report)/i,\n        /(\u9879\u76EE|\u5168\u5C40)\\s*\u4EE3\u7801\\s*(\u5BA1\u67E5|\u68C0\u67E5|\u626B\u63CF)/i,\n      ],\n    },\n    {\n      skillId: 'test-architect',\n      priority: 10,\n      patterns: [\n        /\u6D4B\u8BD5\\s*(\u67B6\u6784|\u65B9\u6848|\u7B56\u7565|\u89C4\u5212)/i,\n        /(\u8BBE\u8BA1|\u89C4\u5212)\\s*\u6D4B\u8BD5\\s*(\u67B6\u6784|\u65B9\u6848|\u7B56\u7565)/i,\n        /test\\s+(architecture|strategy|plan)/i,\n      ],\n    },\n    {\n      skillId: 'tool-maker',\n      priority: 5,\n      patterns: [\n        /\u5199\\s*(\u4E00\u4E2A|\u4E2A)?\\s*(\u811A\u672C|\u5DE5\u5177|cli)\\s*[:\uFF1A]?\\s*\\S+/i,\n        /\u521B\u5EFA\\s*(\u4E00\u4E2A)?\\s*(\u811A\u672C|\u5DE5\u5177|cli)\\s*[:\uFF1A]?\\s*\\S+/i,\n        /(\u6279\u91CF\u91CD\u547D\u540D|\u65E5\u5FD7\u5206\u6790|\u56FE\u7247\u538B\u7F29|\u6587\u4EF6\u6574\u7406).*(\u5DE5\u5177|\u811A\u672C)/i,\n        /(\u5DE5\u5177|\u811A\u672C).*(\u6279\u91CF\u91CD\u547D\u540D|\u65E5\u5FD7\u5206\u6790|\u56FE\u7247\u538B\u7F29|\u6587\u4EF6\u6574\u7406)/i,\n      ],\n    },\n  ];\n\n  /** MCP\u89E6\u53D1\u89C4\u5219 */\n  private readonly mcpTriggers = [\n    {\n      toolHint: 'builtin_read_file',\n      patterns: [\n        /^(\u8BFB\u53D6|\u6253\u5F00|\u67E5\u770B)\\s*(\u6587\u4EF6|\u4EE3\u7801|\u5185\u5BB9)\\s*[:\uFF1A]?\\s*\\S+/i,\n        /^read\\s+(file|content)\\s+\\S+/i,\n      ],\n    },\n    {\n      toolHint: 'builtin_search_code',\n      patterns: [\n        /^(\u641C\u7D22|\u67E5\u627E|\u68C0\u7D22|grep)\\s*(\u4EE3\u7801|\u6587\u4EF6|\u9879\u76EE)\\s*[:\uFF1A]?\\s*\\S+/i,\n        /^(search|find|grep)\\s+(code|file|project)\\s+\\S+/i,\n      ],\n    },\n    {\n      toolHint: 'builtin_shell_exec',\n      patterns: [\n        /^(\u6267\u884C|\u8FD0\u884C)\\s*(\u547D\u4EE4|shell|\u7EC8\u7AEF|\u811A\u672C)\\s*[:\uFF1A]?\\s*\\S+/i,\n        /^(run|execute)\\s+(command|script|shell)\\s+\\S+/i,\n      ],\n    },\n  ];\n\n  /** \u4EE3\u7801\u64CD\u4F5C\u6A21\u5F0F */\n  private readonly codeActionPatterns: Array<{ pattern: RegExp; action: CodeActionType }> = [\n    { pattern: /^(\u89E3\u91CA|explain|\u8BF4\u660E|\u5206\u6790|\u8BB2\u89E3|\u8FD9\u6BB5?\u4EE3\u7801.*(\u505A\u4EC0\u4E48|\u5E72\u4EC0\u4E48|\u610F\u601D|\u4F5C\u7528)|what does|what is)/i, action: 'explain' },\n    { pattern: /^(\u4FEE\u590D|fix|\u4FEE\u6539\u9519\u8BEF|\u4FEE\u6B63|debug|\u89E3\u51B3.*bug)/i, action: 'fix' },\n    { pattern: /^(\u4F18\u5316|optimize|\u6539\u8FDB|\u63D0\u5347\u6027\u80FD|performance)/i, action: 'optimize' },\n    { pattern: /^(\u6DFB\u52A0?\u6CE8\u91CA|\u52A0\u6CE8\u91CA|comment|document)/i, action: 'comment' },\n    { pattern: /^(\u5BA1\u67E5|review|\u68C0\u67E5\u4EE3\u7801|\u68C0\u89C6|code review|cr)/i, action: 'review' },\n    { pattern: /^(\u91CD\u6784|refactor)/i, action: 'refactor' },\n  ];\n\n  /** \u5DF2\u77E5\u547D\u4EE4\u96C6\u5408 */\n  private readonly knownCommands = new Set([\n    'help', 'clear', 'init', 'search', 'run', 'new',\n    'gst', 'gpl', 'gps', 'gcm', 'gaa', 'gco', 'gentest',\n    'diagram', 'test', 'report', 'build', 'file', 'skill',\n  ]);\n\n  /** \u6280\u80FD\u547D\u4EE4\u6620\u5C04 */\n  private readonly skillCommandMap: Record<string, string> = {\n    'audit': 'dependency-guardian',\n    'review': 'code-reviewer',\n    'testplan': 'test-architect',\n    'tool': 'tool-maker',\n  };\n\n  // ========== \u516C\u5F00\u65B9\u6CD5 ==========\n\n  /**\n   * \u6CE8\u518C\u989D\u5916\u7684skill\u89E6\u53D1\u89C4\u5219\n   */\n  registerSkillTriggers(rules: SkillTriggerRule[]): void {\n    for (const rule of rules) {\n      const idx = this.dynamicSkillTriggers.findIndex(r => r.skillId === rule.skillId);\n      if (idx >= 0) {\n        this.dynamicSkillTriggers[idx] = rule;\n      } else {\n        this.dynamicSkillTriggers.push(rule);\n      }\n    }\n    this.dynamicSkillTriggers.sort((a, b) => b.priority - a.priority);\n  }\n\n  /**\n   * \u79FB\u9664skill\u89E6\u53D1\u89C4\u5219\n   */\n  removeSkillTrigger(skillId: string): void {\n    this.dynamicSkillTriggers = this.dynamicSkillTriggers.filter(r => r.skillId !== skillId);\n  }\n\n  /**\n   * \u83B7\u53D6\u5DF2\u6CE8\u518C\u7684\u89E6\u53D1\u89C4\u5219\n   */\n  getRegisteredTriggers(): SkillTriggerRule[] {\n    return [...this.builtinSkillTriggers, ...this.dynamicSkillTriggers];\n  }\n\n  /**\n   * \u5206\u7C7B\u7528\u6237\u8F93\u5165\u7684\u610F\u56FE\n   */\n  classify(input: string, context?: {\n    hasSelectedCode?: boolean;\n    currentFile?: string;\n    projectType?: string;\n  }): IntentResult {\n    const trimmed = input.trim();\n\n    // 1. \u659C\u6760\u547D\u4EE4\n    if (trimmed.startsWith('/')) {\n      return this.parseSlashCommand(trimmed);\n    }\n\n    // 2. \u663E\u5F0F @mcp:xxx\n    const mcpMatch = trimmed.match(/^@mcp[\uFF1A:]\\s*(\\S+)\\s*(.*)?$/i);\n    if (mcpMatch) {\n      return {\n        type: 'mcp_tool',\n        confidence: 1.0,\n        mcpToolHint: mcpMatch[1],\n        rawInput: trimmed,\n        processedPrompt: mcpMatch[2] || '',\n      };\n    }\n\n    // 3. \u663E\u5F0F @skill:xxx\n    const skillMatch = trimmed.match(/^@skill[\uFF1A:]\\s*(\\S+)\\s*(.*)?$/i);\n    if (skillMatch) {\n      let skillParams: Record<string, any> | undefined;\n      const paramsStr = skillMatch[2]?.trim();\n      if (paramsStr) {\n        try { skillParams = JSON.parse(paramsStr); } catch { skillParams = { userInput: paramsStr }; }\n      }\n      return {\n        type: 'skill', confidence: 1.0,\n        skillId: skillMatch[1], skillParams,\n        rawInput: trimmed,\n      };\n    }\n\n    // 4. \u6709\u9009\u4E2D\u4EE3\u7801\u65F6\u4F18\u5148\u68C0\u6D4B\u4EE3\u7801\u64CD\u4F5C\n    if (context?.hasSelectedCode) {\n      const action = this.detectCodeAction(trimmed);\n      if (action && action.confidence >= 0.8) return action;\n    }\n\n    // 5. Skill\u89E6\u53D1\u68C0\u6D4B\n    const skillIntent = this.detectSkillIntent(trimmed);\n    if (skillIntent) return skillIntent;\n\n    // 6. MCP\u5DE5\u5177\u89E6\u53D1\u68C0\u6D4B\n    const mcpIntent = this.detectMCPToolIntent(trimmed);\n    if (mcpIntent) return mcpIntent;\n\n    // 7. \u65E0\u9009\u4E2D\u4EE3\u7801\u7684\u4EE3\u7801\u64CD\u4F5C\uFF08\u964D\u4F4E\u8981\u6C42\uFF09\n    const codeAction = this.detectCodeAction(trimmed);\n    if (codeAction && codeAction.confidence >= 0.7) return codeAction;\n\n    // 8. \u9ED8\u8BA4\uFF1A\u666E\u901A\u5BF9\u8BDD\n    return { type: 'chat', confidence: 1.0, rawInput: trimmed, processedPrompt: trimmed };\n  }\n\n  // ========== \u5185\u90E8\u65B9\u6CD5 ==========\n\n  private detectMCPToolIntent(input: string): IntentResult | null {\n    for (const trigger of this.mcpTriggers) {\n      for (const pattern of trigger.patterns) {\n        if (pattern.test(input)) {\n          return {\n            type: 'mcp_tool', confidence: 0.8,\n            mcpToolHint: trigger.toolHint,\n            rawInput: input, processedPrompt: input,\n          };\n        }\n      }\n    }\n    return null;\n  }\n\n  private detectSkillIntent(input: string): IntentResult | null {\n    const allTriggers = [...this.builtinSkillTriggers, ...this.dynamicSkillTriggers]\n      .sort((a, b) => b.priority - a.priority);\n\n    for (const trigger of allTriggers) {\n      for (const pattern of trigger.patterns) {\n        if (pattern.test(input)) {\n          return {\n            type: 'skill', confidence: 0.9,\n            skillId: trigger.skillId,\n            skillParams: { userInput: input },\n            rawInput: input,\n          };\n        }\n      }\n    }\n    return null;\n  }\n\n  private parseSlashCommand(input: string): IntentResult {\n    const match = input.match(/^\\/(\\w+)(?:\\s+(.*))?$/);\n    if (!match) {\n      return { type: 'chat', confidence: 0.5, rawInput: input };\n    }\n\n    const [, command, args] = match;\n    const cmd = command.toLowerCase();\n\n    if (this.knownCommands.has(cmd)) {\n      return {\n        type: 'command', confidence: 1.0,\n        rawInput: input, command: { name: command, args: args || '' },\n      };\n    }\n\n    if (this.skillCommandMap[cmd]) {\n      return {\n        type: 'skill', confidence: 1.0,\n        skillId: this.skillCommandMap[cmd],\n        rawInput: input,\n        command: { name: command, args: args || '' },\n        skillParams: args ? { userInput: args } : undefined,\n      };\n    }\n\n    return { type: 'chat', confidence: 0.8, rawInput: input, processedPrompt: input };\n  }\n\n  private detectCodeAction(input: string): IntentResult | null {\n    for (const { pattern, action } of this.codeActionPatterns) {\n      if (pattern.test(input)) {\n        return {\n          type: 'code_action', confidence: 0.85,\n          codeAction: action, rawInput: input,\n          processedPrompt: this.buildCodeActionPrompt(action, input),\n        };\n      }\n    }\n    return null;\n  }\n\n  private buildCodeActionPrompt(action: CodeActionType, input: string): string {\n    const map: Record<CodeActionType, string> = {\n      explain: `\u8BF7\u8BE6\u7EC6\u89E3\u91CA\u4EE5\u4E0B\u4EE3\u7801\u7684\u529F\u80FD\u548C\u5B9E\u73B0\u903B\u8F91\uFF1A\\n\\n${input}`,\n      fix: `\u8BF7\u68C0\u67E5\u5E76\u4FEE\u590D\u4EE5\u4E0B\u4EE3\u7801\u4E2D\u7684\u95EE\u9898\u3002\u4F7F\u7528 SEARCH/REPLACE \u683C\u5F0F\uFF1A\\n\\n${input}`,\n      optimize: `\u8BF7\u4F18\u5316\u4EE5\u4E0B\u4EE3\u7801\u3002\u4F7F\u7528 SEARCH/REPLACE \u683C\u5F0F\uFF1A\\n\\n${input}`,\n      comment: `\u8BF7\u4E3A\u4EE5\u4E0B\u4EE3\u7801\u6DFB\u52A0\u6E05\u6670\u6CE8\u91CA\u3002\u4F7F\u7528 SEARCH/REPLACE \u683C\u5F0F\uFF1A\\n\\n${input}`,\n      review: `\u8BF7\u5BF9\u4EE5\u4E0B\u4EE3\u7801\u8FDB\u884C\u5BA1\u67E5\uFF0C\u6307\u51FA\u95EE\u9898\u548C\u6539\u8FDB\u5EFA\u8BAE\uFF1A\\n\\n${input}`,\n      refactor: `\u8BF7\u91CD\u6784\u4EE5\u4E0B\u4EE3\u7801\u3002\u4F7F\u7528 SEARCH/REPLACE \u683C\u5F0F\uFF1A\\n\\n${input}`,\n      test: `\u8BF7\u4E3A\u4EE5\u4E0B\u4EE3\u7801\u751F\u6210\u5355\u5143\u6D4B\u8BD5\uFF1A\\n\\n${input}`,\n    };\n    return map[action] || input;\n  }\n}\n\n/** \u5BFC\u51FA\u5355\u4F8B */\nexport const intentClassifier = new IntentClassifier();\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ChatViewContext, MessageHandler } from '../types';\nimport { Message, generateId, DiagramType, Diagram } from '../../../types/shared';\nimport { i18n } from '../../i18n';\n\n/**\n * \u56FE\u8868\u5904\u7406\u5668\n * \u5904\u7406\u56FE\u8868\u751F\u6210\u3001\u66F4\u65B0\u3001\u5BFC\u51FA\u7B49\u529F\u80FD\n */\nexport class DiagramHandler implements MessageHandler {\n  constructor(private ctx: ChatViewContext) {}\n\n  async handle(data: any): Promise<boolean> {\n    switch (data.type) {\n      case 'generateDiagram':\n        await this.generateDiagram(data.diagramType, data.description);\n        return true;\n      case 'updateDiagram':\n        await this.updateDiagram(data.diagramId, data.code);\n        return true;\n      case 'exportDiagram':\n        await this.exportDiagram(data.diagramId, data.format);\n        return true;\n      case 'getDiagramHistory':\n        this.sendDiagramHistory();\n        return true;\n      case 'loadDiagram':\n        this.loadDiagram(data.diagramId);\n        return true;\n      case 'autoFixDiagram':\n        await this.autoFixDiagram(data.code, data.error);\n        return true;\n      case 'renameDiagram':\n        this.renameDiagram(data.diagramId, data.newTitle);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * \u751F\u6210\u56FE\u8868\n   */\n  async generateDiagram(diagramType: string, description: string): Promise<void> {\n    const chatService = await this.ctx.ensureChatService();\n    if (!chatService) {\n      this.ctx.postMessage({\n        type: 'error',\n        message: 'Please configure an API key first',\n      });\n      return;\n    }\n\n    const prompt = this.ctx.diagramGenerator.generatePrompt(diagramType as DiagramType, description);\n    let response = '';\n\n    this.ctx.updateTaskStatus('diagram', 'running', '\u6B63\u5728\u751F\u6210\u56FE\u8868...');\n\n    const diagramRequestId = `diagram-${Date.now()}`;\n\n    await chatService.sendMessage(\n      [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n      {\n        onToken: (token) => {\n          response += token;\n        },\n        onComplete: async () => {\n          const code = this.ctx.diagramGenerator.extractDiagramCode(response);\n          if (code) {\n            const typeLabels: Record<string, string> = {\n              flowchart: '\u6D41\u7A0B\u56FE',\n              sequence: '\u65F6\u5E8F\u56FE',\n              class: '\u7C7B\u56FE',\n              state: '\u72B6\u6001\u56FE',\n              er: 'ER\u56FE',\n              gantt: '\u7518\u7279\u56FE',\n              pie: '\u997C\u56FE',\n              mindmap: '\u601D\u7EF4\u5BFC\u56FE',\n              architecture: '\u67B6\u6784\u56FE',\n            };\n            \n            const shortDesc = description.length > 20 ? description.slice(0, 20) + '...' : description;\n            const title = `${typeLabels[diagramType] || diagramType} - ${shortDesc}`;\n            \n            const diagram = this.ctx.diagramGenerator.createDiagram(\n              diagramType as DiagramType,\n              code,\n              title\n            );\n            \n            // \u4FDD\u5B58\u5230\u5386\u53F2\n            await this.saveDiagramToHistory(diagram);\n            \n            // \u4FDD\u5B58\u56FE\u8868\u4E0A\u4E0B\u6587\n            this.ctx.lastGeneratedDiagram = {\n              type: diagramType,\n              code,\n              description,\n              timestamp: Date.now(),\n            };\n            \n            this.ctx.postMessage({ type: 'diagramGenerated', diagram });\n            this.ctx.updateTaskStatus('diagram', 'success', '\u56FE\u8868\u751F\u6210\u5B8C\u6210');\n          } else {\n            this.ctx.postMessage({ type: 'error', message: '\u65E0\u6CD5\u4ECE\u54CD\u5E94\u4E2D\u63D0\u53D6\u56FE\u8868\u4EE3\u7801' });\n            this.ctx.updateTaskStatus('diagram', 'error', '\u63D0\u53D6\u4EE3\u7801\u5931\u8D25');\n          }\n        },\n        onError: (error) => {\n          this.ctx.postMessage({ type: 'error', message: error.message });\n          this.ctx.updateTaskStatus('diagram', 'error', error.message);\n        },\n      },\n      { maxTokens: 8192, requestId: diagramRequestId }\n    );\n  }\n\n  /**\n   * \u4ECE\u9009\u4E2D\u4EE3\u7801\u751F\u6210\u56FE\u8868\n   */\n  async generateFromSelection(diagramType: string): Promise<void> {\n    const editor = vscode.window.activeTextEditor;\n    if (!editor || editor.selection.isEmpty) {\n      this.ctx.postMessage({ type: 'error', message: '\u8BF7\u5148\u9009\u4E2D\u4E00\u4E9B\u4EE3\u7801' });\n      return;\n    }\n\n    const selectedText = editor.document.getText(editor.selection);\n    const language = editor.document.languageId;\n    \n    const description = `\u6839\u636E\u4EE5\u4E0B${language}\u4EE3\u7801\u751F\u6210${diagramType}\uFF1A\\n\\`\\`\\`${language}\\n${selectedText}\\n\\`\\`\\``;\n    \n    await this.generateDiagram(diagramType, description);\n  }\n\n  /**\n   * \u4ECE\u6587\u4EF6\u751F\u6210\u56FE\u8868\n   */\n  async generateFromFile(filePath?: string, diagramType?: string): Promise<void> {\n    const editor = vscode.window.activeTextEditor;\n    const targetPath = filePath || editor?.document.uri.fsPath;\n\n    if (!targetPath) {\n      this.ctx.postMessage({ type: 'error', message: '\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6' });\n      return;\n    }\n\n    let content: string;\n    try {\n      content = fs.readFileSync(targetPath, 'utf-8');\n    } catch (err) {\n      this.ctx.postMessage({ type: 'error', message: `\u65E0\u6CD5\u8BFB\u53D6\u6587\u4EF6: ${targetPath}` });\n      return;\n    }\n\n    const language = path.extname(targetPath).slice(1);\n    const fileName = path.basename(targetPath);\n    const type = diagramType || 'flowchart';\n    \n    const description = `\u5206\u6790 ${fileName} \u6587\u4EF6\u5E76\u751F\u6210${type}\uFF1A\\n\\`\\`\\`${language}\\n${content.slice(0, 5000)}\\n\\`\\`\\``;\n    \n    await this.generateDiagram(type, description);\n  }\n\n  /**\n   * \u4ECE\u63CF\u8FF0\u751F\u6210\u56FE\u8868\n   */\n  async generateFromDescription(description: string): Promise<void> {\n    // \u667A\u80FD\u68C0\u6D4B\u56FE\u8868\u7C7B\u578B\n    let diagramType = 'flowchart';\n    const lowerDesc = description.toLowerCase();\n    \n    if (lowerDesc.includes('\u5E8F\u5217') || lowerDesc.includes('sequence') || lowerDesc.includes('\u65F6\u5E8F')) {\n      diagramType = 'sequence';\n    } else if (lowerDesc.includes('\u7C7B') || lowerDesc.includes('class')) {\n      diagramType = 'class';\n    } else if (lowerDesc.includes('\u72B6\u6001') || lowerDesc.includes('state')) {\n      diagramType = 'state';\n    } else if (lowerDesc.includes('er') || lowerDesc.includes('\u6570\u636E\u5E93') || lowerDesc.includes('\u8868')) {\n      diagramType = 'er';\n    } else if (lowerDesc.includes('\u7518\u7279') || lowerDesc.includes('gantt') || lowerDesc.includes('\u65F6\u95F4\u7EBF')) {\n      diagramType = 'gantt';\n    } else if (lowerDesc.includes('\u601D\u7EF4\u5BFC\u56FE') || lowerDesc.includes('mindmap')) {\n      diagramType = 'mindmap';\n    } else if (lowerDesc.includes('\u67B6\u6784') || lowerDesc.includes('architecture')) {\n      diagramType = 'architecture';\n    }\n    \n    await this.generateDiagram(diagramType, description);\n  }\n\n  /**\n   * \u4ECE\u9879\u76EE\u7ED3\u6784\u751F\u6210\u67B6\u6784\u56FE\n   */\n  async generateFromProject(): Promise<void> {\n    const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n    if (!workspaceRoot) {\n      this.ctx.postMessage({ type: 'error', message: '\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u5DE5\u4F5C\u533A' });\n      return;\n    }\n\n    // \u7B80\u5355\u7684\u9879\u76EE\u7ED3\u6784\u5206\u6790\n    const structure = this.analyzeProjectStructure(workspaceRoot);\n    const description = `\u6839\u636E\u4EE5\u4E0B\u9879\u76EE\u7ED3\u6784\u751F\u6210\u67B6\u6784\u56FE\uFF1A\\n${structure}`;\n    \n    await this.generateDiagram('architecture', description);\n  }\n\n  /**\n   * \u66F4\u65B0\u56FE\u8868\n   */\n  async updateDiagram(diagramId: string, code: string): Promise<void> {\n    const success = this.ctx.diagramGenerator.updateDiagram(diagramId, code);\n    if (success) {\n      const diagram = this.ctx.diagramGenerator.getDiagram(diagramId);\n      if (diagram) {\n        this.ctx.postMessage({ type: 'diagramUpdated', diagram });\n      }\n    } else {\n      this.ctx.postMessage({ type: 'error', message: '\u66F4\u65B0\u56FE\u8868\u5931\u8D25' });\n    }\n  }\n\n  /**\n   * \u5BFC\u51FA\u56FE\u8868\n   */\n  async exportDiagram(diagramId: string, format: string): Promise<void> {\n    try {\n      // \u5148\u83B7\u53D6\u56FE\u8868\u5BF9\u8C61\n      const diagram = this.ctx.diagramGenerator.getDiagram(diagramId);\n      if (!diagram) {\n        throw new Error('\u56FE\u8868\u4E0D\u5B58\u5728');\n      }\n      const result = await this.ctx.diagramGenerator.exportDiagram(diagram, format as any);\n      this.ctx.postMessage({ type: 'diagramExported', content: result, format });\n    } catch (error) {\n      this.ctx.postMessage({ type: 'error', message: error instanceof Error ? error.message : 'Export failed' });\n    }\n  }\n\n  /**\n   * \u53D1\u9001\u56FE\u8868\u5386\u53F2\n   */\n  sendDiagramHistory(): void {\n    const diagrams = this.ctx.diagramGenerator.getAllDiagrams();\n    this.ctx.postMessage({ type: 'diagramHistory', diagrams });\n  }\n\n  /**\n   * \u52A0\u8F7D\u56FE\u8868\n   */\n  loadDiagram(diagramId: string): void {\n    const diagram = this.ctx.diagramGenerator.getDiagram(diagramId);\n    if (diagram) {\n      this.ctx.postMessage({ type: 'diagramGenerated', diagram });\n    }\n  }\n\n  /**\n   * \u81EA\u52A8\u4FEE\u590D\u56FE\u8868\n   */\n  async autoFixDiagram(code: string, error: string): Promise<void> {\n    this.ctx.updateTaskStatus('diagram', 'running', '\u6B63\u5728\u4FEE\u590D\u56FE\u8868...');\n\n    const streamingMessageId = generateId();\n    let messageAdded = false;\n\n    try {\n      const errorMsg = error || '\u56FE\u8868\u6E32\u67D3\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5 Mermaid \u8BED\u6CD5';\n      \n      await this.ctx.autoFixService.fixDiagramStreaming(code, errorMsg, {\n        onChunk: (chunk, fullContent) => {\n          if (!messageAdded) {\n            messageAdded = true;\n            this.ctx.postMessage({\n              type: 'addMessage',\n              message: {\n                id: streamingMessageId,\n                role: 'assistant',\n                content: fullContent,\n                timestamp: Date.now(),\n              },\n              streaming: true,\n            });\n          } else {\n            this.ctx.postMessage({\n              type: 'updateMessage',\n              messageId: streamingMessageId,\n              content: fullContent,\n            });\n          }\n        },\n        onComplete: (result) => {\n          if (result.success && result.fixedCode) {\n            const finalContent = `\u2705 **\u56FE\u8868\u4FEE\u590D\u5B8C\u6210**\\n\\n${result.explanation || ''}\\n\\n\\`\\`\\`mermaid\\n${result.fixedCode}\\n\\`\\`\\``;\n            \n            if (messageAdded) {\n              this.ctx.postMessage({\n                type: 'completeMessage',\n                messageId: streamingMessageId,\n                content: finalContent,\n              });\n            }\n            \n            this.ctx.postMessage({ type: 'diagramAutoFixed', code: result.fixedCode });\n            this.ctx.updateTaskStatus('diagram', 'success', '\u56FE\u8868\u4FEE\u590D\u5B8C\u6210');\n          } else {\n            if (messageAdded) {\n              this.ctx.postMessage({\n                type: 'completeMessage',\n                messageId: streamingMessageId,\n                content: `\u274C **\u81EA\u52A8\u4FEE\u590D\u5931\u8D25**\\n\\n${result.error || '\u65E0\u6CD5\u89E3\u6790\u4FEE\u590D\u7ED3\u679C'}`,\n              });\n            }\n            this.ctx.updateTaskStatus('diagram', 'error', '\u4FEE\u590D\u5931\u8D25');\n          }\n        },\n        onError: (err) => {\n          const errorMessage = err instanceof Error ? err.message : '\u672A\u77E5\u9519\u8BEF';\n          if (messageAdded) {\n            this.ctx.postMessage({\n              type: 'completeMessage',\n              messageId: streamingMessageId,\n              content: `\u274C **\u81EA\u52A8\u4FEE\u590D\u5931\u8D25**\\n\\n${errorMessage}`,\n            });\n          }\n          this.ctx.updateTaskStatus('diagram', 'error', errorMessage);\n        },\n      });\n    } catch (e) {\n      const errorMsg = e instanceof Error ? e.message : '\u672A\u77E5\u9519\u8BEF';\n      this.ctx.updateTaskStatus('diagram', 'error', errorMsg);\n    }\n  }\n\n  /**\n   * \u91CD\u547D\u540D\u56FE\u8868\n   */\n  renameDiagram(diagramId: string, newTitle: string): void {\n    const success = this.ctx.diagramGenerator.renameDiagram(diagramId, newTitle);\n    if (success) {\n      vscode.window.showInformationMessage(`\u56FE\u8868\u5DF2\u91CD\u547D\u540D\u4E3A: ${newTitle}`);\n    } else {\n      vscode.window.showErrorMessage('\u91CD\u547D\u540D\u5931\u8D25');\n    }\n  }\n\n  /**\n   * \u4FDD\u5B58\u56FE\u8868\u5230\u5386\u53F2\u8BB0\u5F55\n   */\n  private async saveDiagramToHistory(diagram: Diagram): Promise<void> {\n    try {\n      const key = 'diagramHistory';\n      const existing = this.ctx.extensionContext.globalState.get<Diagram[]>(key, []);\n      const updated = [diagram, ...existing.filter(d => d.id !== diagram.id)].slice(0, 20);\n      await this.ctx.extensionContext.globalState.update(key, updated);\n    } catch (e) {\n      console.error('Failed to save diagram history:', e);\n    }\n  }\n\n  /**\n   * \u5206\u6790\u9879\u76EE\u7ED3\u6784\n   */\n  private analyzeProjectStructure(root: string, depth = 0, maxDepth = 2): string {\n    if (depth > maxDepth) return '';\n    \n    const items: string[] = [];\n    const prefix = '  '.repeat(depth);\n    \n    try {\n      const files = fs.readdirSync(root);\n      const filtered = files.filter(f => \n        !f.startsWith('.') && \n        f !== 'node_modules' && \n        f !== '__pycache__' && \n        f !== 'dist' && \n        f !== 'build'\n      ).slice(0, 15);\n      \n      for (const file of filtered) {\n        const fullPath = path.join(root, file);\n        try {\n          const stat = fs.statSync(fullPath);\n          if (stat.isDirectory()) {\n            items.push(`${prefix}\uD83D\uDCC1 ${file}/`);\n            if (depth < maxDepth) {\n              const subItems = this.analyzeProjectStructure(fullPath, depth + 1, maxDepth);\n              if (subItems) items.push(subItems);\n            }\n          } else {\n            items.push(`${prefix}\uD83D\uDCC4 ${file}`);\n          }\n        } catch {}\n      }\n    } catch {}\n    \n    return items.join('\\n');\n  }\n}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ChatViewContext, MessageHandler } from '../types';\nimport { Message, generateId } from '../../../types/shared';\nimport { i18n } from '../../i18n';\n\n/**\n * \u6D4B\u8BD5\u5904\u7406\u5668\n * \u5904\u7406\u6D4B\u8BD5\u751F\u6210\u3001\u4FDD\u5B58\u3001\u8FD0\u884C\u7B49\u529F\u80FD\n */\nexport class TestHandler implements MessageHandler {\n  constructor(private ctx: ChatViewContext) {}\n\n  async handle(data: any): Promise<boolean> {\n    switch (data.type) {\n      case 'generateTest':\n        await this.generateTest(data.filePath);\n        return true;\n      case 'saveTest':\n        await this.saveTest(data.code, data.path);\n        return true;\n      case 'runTest':\n        await this.runTest(data.path);\n        return true;\n      case 'getTestHistory':\n        this.sendTestHistory();\n        return true;\n      case 'loadTest':\n        this.loadTest(data.testIndex);\n        return true;\n      case 'autoFixTest':\n        await this.autoFixTest(data.code, data.errors, data.framework, data.path);\n        return true;\n      case 'renameTest':\n        this.renameTest(data.testIndex, data.newName);\n        return true;\n      case 'deleteTest':\n        this.deleteTest(data.testIndex);\n        return true;\n      case 'refineTest':\n        await this.refineTest(data.code, data.framework, data.path);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * \u751F\u6210\u6D4B\u8BD5\n   */\n  async generateTest(filePath?: string): Promise<void> {\n    const editor = vscode.window.activeTextEditor;\n    const targetPath = filePath || editor?.document.uri.fsPath;\n\n    if (!targetPath) {\n      this.ctx.postMessage({ type: 'error', message: '\u8BF7\u5148\u6253\u5F00\u6216\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6' });\n      return;\n    }\n\n    const taskId = `test-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    const chatService = await this.ctx.ensureChatService();\n    if (!chatService) {\n      this.ctx.postMessage({\n        type: 'error',\n        message: '\u8BF7\u5148\u914D\u7F6E API Key',\n      });\n      return;\n    }\n\n    const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath || '';\n    \n    const { language, framework } = this.ctx.testGenerator.detectLanguageAndFramework(targetPath, workspaceRoot);\n    \n    let sourceCode: string;\n    try {\n      sourceCode = fs.readFileSync(targetPath, 'utf-8');\n    } catch (err) {\n      this.ctx.postMessage({ type: 'error', message: `\u65E0\u6CD5\u8BFB\u53D6\u6587\u4EF6: ${targetPath}` });\n      return;\n    }\n    \n    const prompt = this.ctx.testGenerator.generatePrompt(sourceCode, targetPath, framework);\n    const fileName = path.basename(targetPath);\n\n    this.ctx.postMessage({\n      type: 'taskStatus',\n      taskType: 'test',\n      taskId,\n      status: 'running',\n      message: `\u6B63\u5728\u4E3A ${fileName} \u751F\u6210 ${framework} \u6D4B\u8BD5...`,\n      timestamp: Date.now(),\n    });\n\n    let response = '';\n\n    await chatService.sendMessage(\n      [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n      {\n        onToken: (token) => {\n          response += token;\n        },\n        onComplete: async () => {\n          const testCode = this.ctx.testGenerator.extractTestCode(response, language);\n          const testPath = this.ctx.testGenerator.generateTestFilePath(targetPath, framework);\n          \n          // \u4FDD\u5B58\u5230\u5386\u53F2\u8BB0\u5F55\n          await this.saveTestToHistory({\n            code: testCode,\n            path: testPath,\n            framework,\n            sourceFile: fileName,\n          });\n          \n          // \u4FDD\u5B58\u6D4B\u8BD5\u4E0A\u4E0B\u6587\n          this.ctx.lastGeneratedTest = {\n            code: testCode,\n            framework,\n            sourceFile: targetPath,\n            timestamp: Date.now(),\n          };\n          \n          this.ctx.postMessage({\n            type: 'testGenerated',\n            code: testCode,\n            suggestedPath: testPath,\n            framework,\n            taskId,\n          });\n          \n          this.ctx.postMessage({\n            type: 'taskStatus',\n            taskType: 'test',\n            taskId,\n            status: 'success',\n            message: `${fileName} \u6D4B\u8BD5\u751F\u6210\u5B8C\u6210`,\n            timestamp: Date.now(),\n          });\n        },\n        onError: (error) => {\n          this.ctx.postMessage({ type: 'error', message: error.message });\n          this.ctx.postMessage({\n            type: 'taskStatus',\n            taskType: 'test',\n            taskId,\n            status: 'error',\n            message: error.message,\n            timestamp: Date.now(),\n          });\n        },\n      },\n      { maxTokens: 8192, requestId: `test-${taskId}` }\n    );\n  }\n\n  /**\n   * \u4ECE\u5185\u8054\u4EE3\u7801\u751F\u6210\u6D4B\u8BD5\n   */\n  async generateFromCode(codeContent: string): Promise<void> {\n    const taskId = `test-inline-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    const chatService = await this.ctx.ensureChatService();\n    if (!chatService) {\n      this.ctx.postMessage({\n        type: 'error',\n        message: '\u8BF7\u5148\u914D\u7F6E API Key',\n      });\n      return;\n    }\n\n    // \u89E3\u6790\u4EE3\u7801\u5185\u5BB9\u548C\u8BED\u8A00\n    let sourceCode = codeContent;\n    let language = '';\n    \n    const codeBlockMatch = codeContent.match(/```(\\w+)?\\n([\\s\\S]*?)\\n```/);\n    if (codeBlockMatch) {\n      language = codeBlockMatch[1] || '';\n      sourceCode = codeBlockMatch[2];\n    } else if (codeContent.startsWith('code:')) {\n      sourceCode = codeContent.replace(/^code:\\s*/, '').trim();\n    }\n    \n    if (!language) {\n      language = this.detectLanguageFromCode(sourceCode);\n    }\n    \n    if (!language || language === 'unknown') {\n      const editor = vscode.window.activeTextEditor;\n      if (editor) {\n        language = this.normalizeLanguageId(editor.document.languageId);\n      }\n    }\n    \n    if (!language || language === 'unknown') {\n      language = 'javascript';\n    }\n    \n    const framework = this.detectFrameworkFromLanguage(language);\n    \n    const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath || '';\n    const prompt = this.ctx.testGenerator.generatePrompt(sourceCode, `inline.${language}`, framework);\n\n    this.ctx.postMessage({\n      type: 'taskStatus',\n      taskType: 'test',\n      taskId,\n      status: 'running',\n      message: `\u6B63\u5728\u4E3A\u9009\u4E2D\u4EE3\u7801 (${language}) \u751F\u6210 ${framework} \u6D4B\u8BD5...`,\n      timestamp: Date.now(),\n    });\n\n    let response = '';\n\n    await chatService.sendMessage(\n      [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n      {\n        onToken: (token) => {\n          response += token;\n        },\n        onComplete: async () => {\n          const testCode = this.ctx.testGenerator.extractTestCode(response, language);\n          const ext = this.getExtensionForLanguage(language);\n          const testPath = path.join(workspaceRoot, `test_inline${ext}`);\n          \n          await this.saveTestToHistory({\n            code: testCode,\n            path: testPath,\n            framework,\n            sourceFile: 'inline code',\n          });\n          \n          this.ctx.lastGeneratedTest = {\n            code: testCode,\n            framework,\n            sourceFile: 'inline code',\n            timestamp: Date.now(),\n          };\n          \n          this.ctx.postMessage({\n            type: 'testGenerated',\n            code: testCode,\n            suggestedPath: testPath,\n            framework,\n            taskId,\n          });\n          \n          this.ctx.postMessage({\n            type: 'taskStatus',\n            taskType: 'test',\n            taskId,\n            status: 'success',\n            message: `\u6D4B\u8BD5\u751F\u6210\u5B8C\u6210 (${framework})`,\n            timestamp: Date.now(),\n          });\n        },\n        onError: (error) => {\n          this.ctx.postMessage({ type: 'error', message: error.message });\n          this.ctx.postMessage({\n            type: 'taskStatus',\n            taskType: 'test',\n            taskId,\n            status: 'error',\n            message: error.message,\n            timestamp: Date.now(),\n          });\n        },\n      },\n      { maxTokens: 8192, requestId: `test-inline-${taskId}` }\n    );\n  }\n\n  /**\n   * \u4FDD\u5B58\u6D4B\u8BD5\u6587\u4EF6\n   */\n  async saveTest(code: string, testPath: string): Promise<void> {\n    try {\n      const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath || '';\n      const fullPath = path.isAbsolute(testPath) ? testPath : path.join(workspaceRoot, testPath);\n      \n      // \u786E\u4FDD\u76EE\u5F55\u5B58\u5728\n      const dir = path.dirname(fullPath);\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n      \n      fs.writeFileSync(fullPath, code, 'utf-8');\n      \n      // \u6253\u5F00\u6587\u4EF6\n      const document = await vscode.workspace.openTextDocument(fullPath);\n      await vscode.window.showTextDocument(document);\n      \n      vscode.window.showInformationMessage(`\u6D4B\u8BD5\u6587\u4EF6\u5DF2\u4FDD\u5B58: ${testPath}`);\n    } catch (error) {\n      vscode.window.showErrorMessage(`\u4FDD\u5B58\u5931\u8D25: ${error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF'}`);\n    }\n  }\n\n  /**\n   * \u8FD0\u884C\u6D4B\u8BD5\n   */\n  async runTest(testPath: string): Promise<void> {\n    const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n    if (!workspaceRoot) {\n      vscode.window.showErrorMessage('\u8BF7\u5148\u6253\u5F00\u5DE5\u4F5C\u533A');\n      return;\n    }\n\n    // \u68C0\u6D4B\u6D4B\u8BD5\u6846\u67B6\u5E76\u751F\u6210\u8FD0\u884C\u547D\u4EE4\n    const ext = path.extname(testPath);\n    let command = '';\n    \n    if (['.ts', '.tsx', '.js', '.jsx'].includes(ext)) {\n      // \u68C0\u6D4B\u662F\u5426\u6709jest\u6216vitest\n      const packageJsonPath = path.join(workspaceRoot, 'package.json');\n      if (fs.existsSync(packageJsonPath)) {\n        const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n        const deps = { ...pkg.dependencies, ...pkg.devDependencies };\n        \n        if (deps['vitest']) {\n          command = `npx vitest run ${testPath}`;\n        } else if (deps['jest']) {\n          command = `npx jest ${testPath}`;\n        } else if (deps['mocha']) {\n          command = `npx mocha ${testPath}`;\n        }\n      }\n    } else if (ext === '.py') {\n      command = `python -m pytest ${testPath}`;\n    } else if (ext === '.go') {\n      command = `go test -v ${testPath}`;\n    }\n\n    if (!command) {\n      command = `npm test -- ${testPath}`;\n    }\n\n    // \u5728\u7EC8\u7AEF\u4E2D\u8FD0\u884C\n    const terminal = vscode.window.createTerminal('AI Test Runner');\n    terminal.show();\n    terminal.sendText(`cd \"${workspaceRoot}\" && ${command}`);\n  }\n\n  /**\n   * \u53D1\u9001\u6D4B\u8BD5\u5386\u53F2\n   */\n  sendTestHistory(): void {\n    const tests = this.getTestHistory();\n    this.ctx.postMessage({ type: 'testHistory', tests });\n  }\n\n  /**\n   * \u52A0\u8F7D\u6D4B\u8BD5\n   */\n  loadTest(testIndex: number): void {\n    const tests = this.getTestHistory();\n    if (tests[testIndex]) {\n      const test = tests[testIndex];\n      this.ctx.postMessage({\n        type: 'testGenerated',\n        code: test.code,\n        suggestedPath: test.path,\n        framework: test.framework,\n      });\n    }\n  }\n\n  /**\n   * \u81EA\u52A8\u4FEE\u590D\u6D4B\u8BD5\n   */\n  async autoFixTest(code: string, errors: string[], framework: string, testPath: string): Promise<void> {\n    this.ctx.updateTaskStatus('test', 'running', '\u6B63\u5728\u4FEE\u590D\u6D4B\u8BD5\u4EE3\u7801...');\n\n    const streamingMessageId = generateId();\n    const language = this.getLanguageFromFramework(framework);\n    let messageAdded = false;\n\n    try {\n      // \u5C06\u9519\u8BEF\u6570\u7EC4\u8F6C\u6362\u4E3A\u5355\u4E2A\u5B57\u7B26\u4E32\n      const errorString = errors.join('\\n');\n      await this.ctx.autoFixService.fixTestStreaming(code, errorString, framework, language, {\n        onChunk: (chunk, fullContent) => {\n          if (!messageAdded) {\n            messageAdded = true;\n            this.ctx.postMessage({\n              type: 'addMessage',\n              message: {\n                id: streamingMessageId,\n                role: 'assistant',\n                content: fullContent,\n                timestamp: Date.now(),\n              },\n              streaming: true,\n            });\n          } else {\n            this.ctx.postMessage({\n              type: 'updateMessage',\n              messageId: streamingMessageId,\n              content: fullContent,\n            });\n          }\n        },\n        onComplete: (result) => {\n          if (result.success && result.fixedCode) {\n            const finalContent = `\u2705 **\u6D4B\u8BD5\u4EE3\u7801\u4FEE\u590D\u5B8C\u6210**\\n\\n${result.explanation || ''}\\n\\n\\`\\`\\`${language || 'typescript'}\\n${result.fixedCode}\\n\\`\\`\\``;\n            \n            if (messageAdded) {\n              this.ctx.postMessage({\n                type: 'completeMessage',\n                messageId: streamingMessageId,\n                content: finalContent,\n              });\n            }\n            \n            this.ctx.postMessage({ type: 'testAutoFixed', code: result.fixedCode });\n            this.ctx.updateTaskStatus('test', 'success', '\u6D4B\u8BD5\u4FEE\u590D\u5B8C\u6210');\n          } else {\n            if (messageAdded) {\n              this.ctx.postMessage({\n                type: 'completeMessage',\n                messageId: streamingMessageId,\n                content: `\u274C **\u81EA\u52A8\u4FEE\u590D\u5931\u8D25**\\n\\n${result.error || '\u65E0\u6CD5\u89E3\u6790\u4FEE\u590D\u7ED3\u679C'}`,\n              });\n            }\n            this.ctx.updateTaskStatus('test', 'error', '\u4FEE\u590D\u5931\u8D25');\n          }\n        },\n        onError: (err) => {\n          const errorMessage = err instanceof Error ? err.message : '\u672A\u77E5\u9519\u8BEF';\n          if (messageAdded) {\n            this.ctx.postMessage({\n              type: 'completeMessage',\n              messageId: streamingMessageId,\n              content: `\u274C **\u81EA\u52A8\u4FEE\u590D\u5931\u8D25**\\n\\n${errorMessage}`,\n            });\n          }\n          this.ctx.updateTaskStatus('test', 'error', errorMessage);\n        },\n      });\n    } catch (e) {\n      const errorMsg = e instanceof Error ? e.message : '\u672A\u77E5\u9519\u8BEF';\n      this.ctx.updateTaskStatus('test', 'error', errorMsg);\n    }\n  }\n\n  /**\n   * \u91CD\u547D\u540D\u6D4B\u8BD5\n   */\n  renameTest(testIndex: number, newName: string): void {\n    try {\n      const key = 'testHistory';\n      const tests = this.ctx.extensionContext.globalState.get<any[]>(key, []);\n      if (tests[testIndex]) {\n        tests[testIndex].customName = newName;\n        this.ctx.extensionContext.globalState.update(key, tests);\n        vscode.window.showInformationMessage(`\u6D4B\u8BD5\u5DF2\u91CD\u547D\u540D\u4E3A: ${newName}`);\n      }\n    } catch (e) {\n      vscode.window.showErrorMessage('\u91CD\u547D\u540D\u5931\u8D25');\n    }\n  }\n\n  /**\n   * \u5220\u9664\u6D4B\u8BD5\n   */\n  deleteTest(testIndex: number): void {\n    try {\n      const key = 'testHistory';\n      const tests = this.ctx.extensionContext.globalState.get<any[]>(key, []);\n      tests.splice(testIndex, 1);\n      this.ctx.extensionContext.globalState.update(key, tests);\n      vscode.window.showInformationMessage('\u6D4B\u8BD5\u5386\u53F2\u5DF2\u5220\u9664');\n    } catch (e) {\n      vscode.window.showErrorMessage('\u5220\u9664\u5931\u8D25');\n    }\n  }\n\n  /**\n   * \u4F18\u5316\u6D4B\u8BD5\u4EE3\u7801\n   */\n  async refineTest(code: string, framework: string, testPath: string): Promise<void> {\n    this.ctx.updateTaskStatus('test', 'running', '\u6B63\u5728\u4F18\u5316\u6D4B\u8BD5\u4EE3\u7801...');\n\n    const streamingMessageId = generateId();\n    const language = this.getLanguageFromFramework(framework);\n    let messageAdded = false;\n    let response = '';\n\n    const chatService = await this.ctx.ensureChatService();\n    if (!chatService) {\n      this.ctx.updateTaskStatus('test', 'error', 'API Key \u672A\u914D\u7F6E');\n      return;\n    }\n\n    const languageSuffix = i18n.isChinese() \n      ? '\\n\\n\u3010\u8BED\u8A00\u8981\u6C42\u3011\u8BF7\u4F7F\u7528\u4E2D\u6587\u56DE\u590D\u548C\u6CE8\u91CA\u3002'\n      : '\\n\\nPlease respond in English.';\n\n    const prompt = `\u4F60\u662F\u4E00\u4E2A\u6D4B\u8BD5\u4EE3\u7801\u4E13\u5BB6\u3002\u8BF7\u4F18\u5316\u548C\u5B8C\u5584\u4EE5\u4E0B\u6D4B\u8BD5\u4EE3\u7801\uFF1A\n\n**\u6D4B\u8BD5\u6846\u67B6:** ${framework}\n**\u5F53\u524D\u4EE3\u7801:**\n\\`\\`\\`\n${code}\n\\`\\`\\`\n\n**\u4F18\u5316\u8981\u6C42:**\n1. \u8865\u5168\u4E0D\u5B8C\u6574\u7684\u6D4B\u8BD5\u4EE3\u7801\n2. \u4FEE\u590D\u53EF\u80FD\u7684\u8BED\u6CD5\u9519\u8BEF\n3. \u6539\u8FDB\u6D4B\u8BD5\u8986\u76D6\u8303\u56F4\n4. \u4F18\u5316\u6D4B\u8BD5\u547D\u540D\u548C\u7ED3\u6784\n5. \u6DFB\u52A0\u5FC5\u8981\u7684 import \u8BED\u53E5\n6. \u786E\u4FDD\u4EE3\u7801\u53EF\u4EE5\u6B63\u5E38\u8FD0\u884C\n\n\u8BF7\u76F4\u63A5\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u5B8C\u6574\u4EE3\u7801\uFF0C\u4F7F\u7528\u4EE3\u7801\u5757\u683C\u5F0F\u3002${languageSuffix}`;\n\n    await chatService.sendMessage(\n      [{ id: '0', role: 'user', content: prompt, timestamp: Date.now() }],\n      {\n        onToken: (token) => {\n          response += token;\n          \n          if (!messageAdded && response.length > 30) {\n            messageAdded = true;\n            this.ctx.postMessage({\n              type: 'addMessage',\n              message: {\n                id: streamingMessageId,\n                role: 'assistant',\n                content: response,\n                timestamp: Date.now(),\n              },\n              streaming: true,\n            });\n          } else if (messageAdded) {\n            this.ctx.postMessage({\n              type: 'updateMessage',\n              messageId: streamingMessageId,\n              content: response,\n            });\n          }\n        },\n        onComplete: async () => {\n          const refinedCode = this.ctx.testGenerator.extractTestCode(response, language);\n          \n          if (refinedCode && refinedCode.length > 50) {\n            const finalContent = `\u2705 **\u6D4B\u8BD5\u4EE3\u7801\u4F18\u5316\u5B8C\u6210**\\n\\n\\`\\`\\`${language || 'typescript'}\\n${refinedCode}\\n\\`\\`\\`\\n\\n\u8BF7\u68C0\u67E5\u5E76\u8FD0\u884C\u6D4B\u8BD5\u9A8C\u8BC1\u3002`;\n            \n            if (messageAdded) {\n              this.ctx.postMessage({\n                type: 'completeMessage',\n                messageId: streamingMessageId,\n                content: finalContent,\n              });\n            }\n            this.ctx.postMessage({ type: 'testAutoFixed', code: refinedCode });\n            this.ctx.updateTaskStatus('test', 'success', '\u6D4B\u8BD5\u4EE3\u7801\u4F18\u5316\u5B8C\u6210');\n          } else {\n            if (messageAdded) {\n              this.ctx.postMessage({\n                type: 'completeMessage',\n                messageId: streamingMessageId,\n                content: response || '\u274C \u65E0\u6CD5\u4F18\u5316\u6D4B\u8BD5\u4EE3\u7801\uFF0C\u8BF7\u5C1D\u8BD5\u624B\u52A8\u7F16\u8F91\u3002',\n              });\n            }\n            this.ctx.updateTaskStatus('test', 'error', '\u4F18\u5316\u7ED3\u679C\u65E0\u6548');\n          }\n        },\n        onError: (error) => {\n          if (messageAdded) {\n            this.ctx.postMessage({\n              type: 'completeMessage',\n              messageId: streamingMessageId,\n              content: `\u274C **\u4F18\u5316\u5931\u8D25**\\n\\n${error.message}`,\n            });\n          }\n          this.ctx.updateTaskStatus('test', 'error', error.message);\n        },\n      },\n      { maxTokens: 8192, requestId: `test-refine-${streamingMessageId}` }\n    );\n  }\n\n  // \u8F85\u52A9\u65B9\u6CD5\n\n  private async saveTestToHistory(test: { code: string; path: string; framework: string; sourceFile: string }): Promise<void> {\n    try {\n      const key = 'testHistory';\n      const existing = this.ctx.extensionContext.globalState.get<typeof test[]>(key, []);\n      const updated = [{ ...test, timestamp: Date.now() }, ...existing].slice(0, 20);\n      await this.ctx.extensionContext.globalState.update(key, updated);\n    } catch (e) {\n      console.error('Failed to save test history:', e);\n    }\n  }\n\n  private getTestHistory(): any[] {\n    return this.ctx.extensionContext.globalState.get<any[]>('testHistory', []);\n  }\n\n  private getLanguageFromFramework(framework: string): string {\n    const frameworkLanguages: Record<string, string> = {\n      'jest': 'typescript',\n      'vitest': 'typescript',\n      'mocha': 'javascript',\n      'pytest': 'python',\n      'unittest': 'python',\n      'go': 'go',\n      'junit': 'java',\n    };\n    return frameworkLanguages[framework.toLowerCase()] || 'typescript';\n  }\n\n  private detectLanguageFromCode(code: string): string {\n    const indicators: Record<string, RegExp[]> = {\n      'typescript': [/:\\s*(?:string|number|boolean)/, /interface\\s+\\w+/, /type\\s+\\w+\\s*=/],\n      'javascript': [/function\\s+\\w+/, /const\\s+\\w+\\s*=/, /let\\s+\\w+\\s*=/],\n      'python': [/def\\s+\\w+/, /import\\s+\\w+/, /class\\s+\\w+:/],\n      'go': [/func\\s+\\w+/, /package\\s+\\w+/, /import\\s+\\(/],\n      'java': [/public\\s+class/, /private\\s+\\w+/, /void\\s+\\w+\\(/],\n    };\n    \n    for (const [lang, patterns] of Object.entries(indicators)) {\n      if (patterns.some(p => p.test(code))) {\n        return lang;\n      }\n    }\n    return 'unknown';\n  }\n\n  private normalizeLanguageId(langId: string): string {\n    const map: Record<string, string> = {\n      'typescriptreact': 'typescript',\n      'javascriptreact': 'javascript',\n    };\n    return map[langId] || langId;\n  }\n\n  private detectFrameworkFromLanguage(language: string): 'jest' | 'vitest' | 'mocha' | 'pytest' | 'junit' | 'go' {\n    const frameworks: Record<string, 'jest' | 'vitest' | 'mocha' | 'pytest' | 'junit' | 'go'> = {\n      'typescript': 'jest',\n      'javascript': 'jest',\n      'python': 'pytest',\n      'go': 'go',\n      'java': 'junit',\n    };\n    return frameworks[language] || 'jest';\n  }\n\n  private getExtensionForLanguage(language: string): string {\n    const extensions: Record<string, string> = {\n      'typescript': '.test.ts',\n      'javascript': '.test.js',\n      'python': '_test.py',\n      'go': '_test.go',\n      'java': 'Test.java',\n    };\n    return extensions[language] || '.test.ts';\n  }\n}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ChatViewContext, MessageHandler } from '../types';\nimport { Message, generateId } from '../../../types/shared';\nimport { ParsedCommand } from '../../commands/CommandParser';\nimport { MCPRegistry, MCPExecutor } from '../../mcp';\n\n/**\n * \u547D\u4EE4\u5904\u7406\u5668\n * \u5904\u7406\u659C\u6760\u547D\u4EE4\uFF08/clear, /init, /run \u7B49\uFF09\n * \u5927\u90E8\u5206\u547D\u4EE4\u5DF2\u8FC1\u79FB\u5230MCP\u5DE5\u5177\u7CFB\u7EDF\n */\nexport class CommandHandler implements MessageHandler {\n  private registry: MCPRegistry;\n  private executor: MCPExecutor;\n  \n  constructor(private ctx: ChatViewContext) {\n    // \u521D\u59CB\u5316MCP\u7EC4\u4EF6\n    this.registry = MCPRegistry.getInstance(ctx.extensionContext);\n    this.executor = MCPExecutor.getInstance(ctx.extensionContext, this.registry);\n  }\n\n  async handle(data: any): Promise<boolean> {\n    // \u8FD9\u4E2Ahandler\u4E3B\u8981\u901A\u8FC7executeCommand\u65B9\u6CD5\u88AB\u8C03\u7528\n    // \u6D88\u606F\u7C7B\u578B\u7684\u5904\u7406\u5728\u5176\u4ED6handler\u4E2D\n    return false;\n  }\n\n  /**\n   * \u6267\u884C\u547D\u4EE4 - \u5927\u90E8\u5206\u547D\u4EE4\u5DF2\u8FC1\u79FB\u5230MCP\n   */\n  async executeCommand(parsed: ParsedCommand, diagramHandler: any, testHandler: any, sessionHandler: any): Promise<void> {\n    const { command, args } = parsed;\n    \n    // \u4E0D\u5728chatbox\u4E2D\u663E\u793A\u7528\u6237\u6D88\u606F\u7684\u547D\u4EE4\u5217\u8868\n    const silentCommands = ['clear', 'diagram', 'gentest'];\n    \n    // \u5148\u5728\u5BF9\u8BDD\u6846\u4E2D\u663E\u793A\u7528\u6237\u8F93\u5165\u7684\u547D\u4EE4\n    let userMessageId: string | null = null;\n    if (!silentCommands.includes(command)) {\n      const commandText = `/${command}${args.length > 0 ? ' ' + args.join(' ') : ''}`;\n      const userMessage: Message = {\n        id: generateId(),\n        role: 'user',\n        content: commandText,\n        timestamp: Date.now(),\n      };\n      userMessageId = userMessage.id;\n      await this.ctx.sessionManager.addMessage(userMessage);\n      this.ctx.postMessage({ type: 'addMessage', message: userMessage });\n    }\n\n    // \u8F85\u52A9\u51FD\u6570\uFF1A\u79FB\u9664\u7528\u6237\u6D88\u606F\n    const removeUserMessage = async () => {\n      if (userMessageId) {\n        await this.ctx.sessionManager.removeLastMessage();\n        this.ctx.postMessage({ type: 'removeMessage', messageId: userMessageId });\n      }\n    };\n\n    try {\n      switch (command) {\n        // \u4FDD\u7559\u7684\u57FA\u7840\u547D\u4EE4\n        case 'clear':\n          await sessionHandler.clearChat();\n          break;\n        case 'compact':\n          await this.compactContext();\n          break;\n        case 'resume':\n          await sessionHandler.showSessionPicker();\n          break;\n          \n        // \u8FC1\u79FB\u5230MCP\u7684\u547D\u4EE4 - \u4F7F\u7528MCP\u6267\u884C\n        case 'init':\n          await this.executeMCPTool('builtin_init_project', {});\n          break;\n        case 'help':\n          await this.executeMCPTool('builtin_help', {});\n          break;\n        case 'file':\n          if (args[0]) {\n            await this.executeMCPTool('builtin_read_file', { filePath: args[0] });\n          } else {\n            await removeUserMessage();\n            this.ctx.postMessage({ type: 'error', message: '\u8BF7\u6307\u5B9A\u6587\u4EF6\u8DEF\u5F84' });\n          }\n          break;\n        case 'search':\n          if (args.length) {\n            await this.executeMCPTool('builtin_search_code', { query: args.join(' ') });\n          } else {\n            await removeUserMessage();\n            this.ctx.postMessage({ type: 'error', message: '\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD' });\n          }\n          break;\n        case 'run':\n          if (args.length) {\n            await this.executeMCPTool('builtin_run_command', { command: args.join(' ') });\n          } else {\n            await removeUserMessage();\n            this.ctx.postMessage({ type: 'error', message: '\u8BF7\u8F93\u5165\u8981\u6267\u884C\u7684\u547D\u4EE4' });\n          }\n          break;\n        case 'build':\n          await this.executeMCPTool('builtin_build', {});\n          break;\n        case 'test':\n          await this.executeMCPTool('builtin_run_test', {});\n          break;\n          \n        // Git \u547D\u4EE4\n        case 'git':\n          if (args.length) {\n            await this.executeMCPTool('builtin_run_command', { command: `git ${args.join(' ')}` });\n          } else {\n            await removeUserMessage();\n            this.ctx.postMessage({ type: 'error', message: '\u8BF7\u8F93\u5165git\u547D\u4EE4\u53C2\u6570' });\n          }\n          break;\n        case 'gst':\n          await this.executeMCPTool('builtin_git_status', {});\n          break;\n        case 'gpl':\n          await this.executeMCPTool('builtin_git_pull', {});\n          break;\n        case 'gps':\n          await this.executeMCPTool('builtin_git_push', {});\n          break;\n        case 'gco':\n          if (args[0]) {\n            await this.executeMCPTool('builtin_git_checkout', { branch: args[0] });\n          } else {\n            await removeUserMessage();\n            this.ctx.postMessage({ type: 'error', message: '\u8BF7\u6307\u5B9A\u5206\u652F\u540D' });\n          }\n          break;\n        case 'gcm':\n          if (args.length) {\n            await this.executeMCPTool('builtin_git_commit', { message: args.join(' ') });\n          } else {\n            await removeUserMessage();\n            this.ctx.postMessage({ type: 'error', message: '\u8BF7\u8F93\u5165\u63D0\u4EA4\u4FE1\u606F' });\n          }\n          break;\n        case 'gdf':\n          await this.executeMCPTool('builtin_git_diff', { file: args[0] || undefined });\n          break;\n        case 'glg':\n          await this.executeMCPTool('builtin_git_log', { count: 15 });\n          break;\n          \n        // \u56FE\u8868\u548C\u6D4B\u8BD5\u751F\u6210 - \u4FDD\u7559\u539F\u6709\u903B\u8F91\uFF0C\u56E0\u4E3A\u9700\u8981AI\u914D\u5408\n        case 'diagram':\n          this.ctx.postMessage({ type: 'clearInput' });\n          await this.handleDiagramCommand(args, diagramHandler);\n          break;\n        case 'gentest':\n          this.ctx.postMessage({ type: 'clearInput' });\n          const fullArgs = args.join(' ');\n          if (fullArgs.startsWith('code:') || fullArgs.includes('```')) {\n            await testHandler.generateFromCode(fullArgs);\n          } else {\n            await testHandler.generateTest(args[0]);\n          }\n          break;\n          \n        default:\n          await removeUserMessage();\n          this.ctx.postMessage({\n            type: 'addMessage',\n            message: {\n              id: generateId(),\n              role: 'assistant',\n              content: `\u274C \u672A\u77E5\u547D\u4EE4: \\`/${command}\\`\\n\\n\u8F93\u5165 \\`/help\\` \u67E5\u770B\u6240\u6709\u53EF\u7528\u547D\u4EE4\uFF0C\u6216\u4F7F\u7528 \\`@mcp:list\\` \u67E5\u770B\u53EF\u7528MCP\u5DE5\u5177\u3002`,\n              timestamp: Date.now(),\n            }\n          });\n          break;\n      }\n    } catch (error) {\n      await removeUserMessage();\n      this.ctx.postMessage({\n        type: 'error',\n        message: error instanceof Error ? error.message : '\u547D\u4EE4\u6267\u884C\u5931\u8D25',\n      });\n    }\n  }\n\n  /**\n   * \u6267\u884CMCP\u5DE5\u5177\n   */\n  private async executeMCPTool(toolId: string, params: Record<string, any>): Promise<void> {\n    const registration = this.registry.getTool(toolId);\n    \n    if (!registration) {\n      this.ctx.postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content: `\u26A0\uFE0F MCP\u5DE5\u5177 \\`${toolId}\\` \u672A\u627E\u5230`,\n          timestamp: Date.now(),\n        }\n      });\n      return;\n    }\n    \n    this.ctx.updateTaskStatus('command', 'running', `\u6267\u884C: ${registration.tool.name}`);\n    \n    try {\n      const result = await this.executor.execute({\n        toolId,\n        arguments: params,\n        caller: 'user',\n        context: {\n          workspaceRoot: vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n          activeFile: vscode.window.activeTextEditor?.document.fileName,\n        },\n      });\n      \n      // \u683C\u5F0F\u5316\u8F93\u51FA\u7ED3\u679C\n      let content: string;\n      if (result.success) {\n        const data = result.data;\n        \n        // \u7279\u6B8A\u5904\u7406\u4E0D\u540C\u7C7B\u578B\u7684\u7ED3\u679C\n        if (typeof data === 'string') {\n          content = data;\n        } else if (data?.content) {\n          // help\u547D\u4EE4\u7B49\u8FD4\u56DEcontent\u5B57\u6BB5\n          content = data.content;\n        } else if (data?.stdout !== undefined || data?.stderr !== undefined) {\n          // \u547D\u4EE4\u6267\u884C\u7ED3\u679C\n          const success = data.success !== false && data.exitCode !== 1;\n          const output = [data.stdout, data.stderr].filter(Boolean).join('\\n');\n          content = `${success ? '\u2705' : '\u274C'} **${registration.tool.name}**\\n\\n\\`\\`\\`\\n${output || '(\u65E0\u8F93\u51FA)'}\\n\\`\\`\\``;\n        } else if (data?.log !== undefined) {\n          // git log\u7ED3\u679C\n          content = `\uD83D\uDCDC **Git\u65E5\u5FD7**\\n\\n\\`\\`\\`\\n${data.log || '(\u65E0\u65E5\u5FD7)'}\\n\\`\\`\\``;\n        } else if (data?.diff !== undefined) {\n          // git diff\u7ED3\u679C\n          content = `\uD83D\uDCDD **Git\u5DEE\u5F02**\\n\\n\\`\\`\\`diff\\n${data.diff || '(\u65E0\u5DEE\u5F02)'}\\n\\`\\`\\``;\n        } else if (data?.type) {\n          // \u9879\u76EE\u5206\u6790\u7ED3\u679C\n          content = `\u2705 **\u9879\u76EE\u5206\u6790\u5B8C\u6210**\\n\\n`;\n          content += `**\u9879\u76EE\u7C7B\u578B:** ${data.type}\\n`;\n          if (data.framework) content += `**\u6846\u67B6:** ${data.framework}\\n`;\n          if (data.language) content += `**\u8BED\u8A00:** ${data.language}\\n`;\n          if (data.structure) {\n            const structureStr = JSON.stringify(data.structure, null, 2).slice(0, 2000);\n            content += `\\n**\u76EE\u5F55\u7ED3\u6784:**\\n\\`\\`\\`\\n${structureStr}\\n\\`\\`\\``;\n          }\n        } else {\n          // \u9ED8\u8BA4JSON\u683C\u5F0F\u5316\n          const dataStr = JSON.stringify(data, null, 2);\n          content = `\u2705 **${registration.tool.name}**\\n\\n\\`\\`\\`json\\n${dataStr.slice(0, 5000)}${dataStr.length > 5000 ? '\\n...(\u5DF2\u622A\u65AD)' : ''}\\n\\`\\`\\``;\n        }\n      } else {\n        content = `\u274C **${registration.tool.name}** \u6267\u884C\u5931\u8D25\\n\\n${result.error?.message || '\u672A\u77E5\u9519\u8BEF'}`;\n      }\n      \n      this.ctx.postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content,\n          timestamp: Date.now(),\n        }\n      });\n      \n      this.ctx.updateTaskStatus('command', result.success ? 'success' : 'error', \n        result.success ? '\u5B8C\u6210' : '\u5931\u8D25');\n      \n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content: `\u274C \u6267\u884C\u5931\u8D25: ${error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF'}`,\n          timestamp: Date.now(),\n        }\n      });\n      this.ctx.updateTaskStatus('command', 'error', '\u6267\u884C\u5931\u8D25');\n    }\n  }\n\n  /**\n   * \u5904\u7406\u56FE\u8868\u547D\u4EE4\n   */\n  private async handleDiagramCommand(args: string[], diagramHandler: any): Promise<void> {\n    if (args[0]) {\n      const diagramType = args[0].toLowerCase();\n      \n      if (diagramType === 'file') {\n        await diagramHandler.generateFromFile(args[1]);\n      } else if (diagramType === 'project') {\n        await diagramHandler.generateFromProject();\n      } else if (['flowchart', 'sequence', 'class', 'state', 'er', 'gantt', 'mindmap', 'architecture'].includes(diagramType)) {\n        const editor = vscode.window.activeTextEditor;\n        if (editor && !editor.selection.isEmpty) {\n          await diagramHandler.generateFromSelection(diagramType);\n        } else if (editor) {\n          await diagramHandler.generateFromFile(undefined, diagramType);\n        } else {\n          if (['architecture', 'mindmap'].includes(diagramType)) {\n            await diagramHandler.generateFromProject();\n          } else {\n            this.ctx.postMessage({ \n              type: 'addMessage', \n              message: {\n                id: generateId(),\n                role: 'assistant',\n                content: `\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6\u6216\u9009\u4E2D\u4E00\u4E9B\u4EE3\u7801\uFF0C\u7136\u540E\u91CD\u8BD5\u3002\\n\\n\u6216\u8005\u4F60\u53EF\u4EE5\u76F4\u63A5\u544A\u8BC9\u6211\u60F3\u8981\u7684\u56FE\u8868\u5185\u5BB9\uFF0C\u6BD4\u5982\uFF1A\"\u5E2E\u6211\u753B\u4E00\u4E2A\u7528\u6237\u767B\u5F55\u7684\u6D41\u7A0B\u56FE\"`,\n                timestamp: Date.now(),\n              }\n            });\n          }\n        }\n      } else {\n        const description = args.join(' ');\n        await diagramHandler.generateFromDescription(description);\n      }\n    } else {\n      const editor = vscode.window.activeTextEditor;\n      if (editor && !editor.selection.isEmpty) {\n        await diagramHandler.generateFromSelection('flowchart');\n      } else if (editor) {\n        await diagramHandler.generateFromFile();\n      } else {\n        await diagramHandler.generateFromProject();\n      }\n    }\n  }\n\n  /**\n   * \u538B\u7F29\u4E0A\u4E0B\u6587\n   */\n  private async compactContext(): Promise<void> {\n    const messages = this.ctx.sessionManager.getMessages();\n    \n    if (messages.length < 5) {\n      this.ctx.postMessage({\n        type: 'addMessage',\n        message: {\n          id: generateId(),\n          role: 'assistant',\n          content: '\u5F53\u524D\u4E0A\u4E0B\u6587\u8F83\u77ED\uFF0C\u65E0\u9700\u538B\u7F29\u3002',\n          timestamp: Date.now(),\n        },\n      });\n      return;\n    }\n\n    // \u4FDD\u7559\u6700\u8FD1\u7684\u51E0\u6761\u6D88\u606F\n    const keepCount = Math.min(4, Math.floor(messages.length / 2));\n    const removedCount = messages.length - keepCount;\n\n    // \u751F\u6210\u538B\u7F29\u6458\u8981\n    const summary = `[\u5DF2\u538B\u7F29 ${removedCount} \u6761\u5386\u53F2\u6D88\u606F]`;\n    \n    this.ctx.postMessage({\n      type: 'addMessage',\n      message: {\n        id: generateId(),\n        role: 'assistant',\n        content: `\u2705 \u4E0A\u4E0B\u6587\u5DF2\u538B\u7F29\\n\\n${summary}\\n\\n\u4FDD\u7559\u6700\u8FD1 ${keepCount} \u6761\u6D88\u606F\u3002`,\n        timestamp: Date.now(),\n      },\n    });\n  }\n}\n", "import * as vscode from 'vscode';\nimport { ChatViewContext, MessageHandler } from '../types';\nimport { i18n } from '../../i18n';\n\n/**\n * \u914D\u7F6E\u5904\u7406\u5668\n * \u5904\u7406\u914D\u7F6E\u3001\u6A21\u578B\u5207\u6362\u3001API Key\u7B49\n */\nexport class ConfigHandler implements MessageHandler {\n  constructor(private ctx: ChatViewContext) {}\n\n  async handle(data: any): Promise<boolean> {\n    switch (data.type) {\n      case 'getConfig':\n        this.sendConfig();\n        return true;\n      case 'updateModel':\n        await this.updateModel(data.provider, data.model);\n        return true;\n      case 'setApiKey':\n        await this.setApiKey(data.provider, data.apiKey);\n        return true;\n      case 'getApiKeyStatus':\n        await this.getApiKeyStatus();\n        return true;\n      case 'setLanguage':\n        await this.setLanguage(data.language);\n        return true;\n      case 'getLanguage':\n        this.sendLanguage();\n        return true;\n      case 'getHistory':\n        this.sendMessageHistory(data.direction);\n        return true;\n      case 'getSuggestions':\n        this.sendCommandSuggestions(data.input);\n        return true;\n      case 'searchMessages':\n        this.searchMessages(data.query);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * \u53D1\u9001\u914D\u7F6E\n   */\n  sendConfig(): void {\n    const modelConfig = this.ctx.configManager.getModelConfig();\n    const allModels = this.ctx.configManager.getAllModels();\n    this.ctx.postMessage({\n      type: 'config',\n      modelConfig,\n      allModels,\n    });\n  }\n\n  /**\n   * \u66F4\u65B0\u6A21\u578B\n   */\n  async updateModel(provider: string, model: string): Promise<void> {\n    await this.ctx.configManager.updateModelConfig({ provider: provider as any, model });\n    \n    // \u91CD\u65B0\u521B\u5EFAChatService\n    const config = await this.ctx.configManager.getFullModelConfig();\n    if (config.apiKey) {\n      const { ChatService } = await import('../../api/ChatService');\n      this.ctx.chatService = new ChatService(config);\n    }\n    \n    this.sendConfig();\n    vscode.window.showInformationMessage(`\u5DF2\u5207\u6362\u5230\u6A21\u578B: ${model}`);\n  }\n\n  /**\n   * \u8BBE\u7F6EAPI Key\n   */\n  async setApiKey(provider: string, apiKey: string): Promise<void> {\n    await this.ctx.configManager.setApiKey(provider as any, apiKey);\n    \n    // \u91CD\u65B0\u521D\u59CB\u5316ChatService\n    const config = await this.ctx.configManager.getFullModelConfig();\n    if (config.apiKey) {\n      const { ChatService } = await import('../../api/ChatService');\n      this.ctx.chatService = new ChatService(config);\n    }\n    \n    await this.getApiKeyStatus();\n    vscode.window.showInformationMessage(`${provider} API Key \u5DF2\u4FDD\u5B58`);\n  }\n\n  /**\n   * \u83B7\u53D6API Key\u72B6\u6001\n   */\n  async getApiKeyStatus(): Promise<void> {\n    const providers = ['deepseek', 'openai', 'anthropic', 'kimi', 'openrouter'];\n    const status: Record<string, boolean> = {};\n    \n    for (const provider of providers) {\n      const key = await this.ctx.configManager.getApiKey(provider as any);\n      status[provider] = !!key && key.length > 0;\n    }\n    \n    this.ctx.postMessage({ type: 'apiKeyStatus', status });\n  }\n\n  /**\n   * \u8BBE\u7F6E\u8BED\u8A00\n   */\n  async setLanguage(language: string): Promise<void> {\n    // \u5C06 'en' \u6620\u5C04\u4E3A 'en-US' \u4EE5\u517C\u5BB9\u65E7\u7684\u8C03\u7528\n    const langCode = language === 'en' ? 'en-US' : language;\n    i18n.setLanguage(langCode as 'zh-CN' | 'en-US');\n    await this.ctx.extensionContext.globalState.update('aiAssistant.language', langCode);\n    this.ctx.postMessage({ type: 'languageChanged', language: langCode });\n    vscode.window.showInformationMessage(\n      langCode === 'zh-CN' ? '\u8BED\u8A00\u5DF2\u5207\u6362\u4E3A\u4E2D\u6587' : 'Language switched to English'\n    );\n  }\n\n  /**\n   * \u53D1\u9001\u8BED\u8A00\u8BBE\u7F6E\n   */\n  sendLanguage(): void {\n    const language = i18n.getCurrentLanguage();\n    this.ctx.postMessage({ type: 'language', language });\n  }\n\n  /**\n   * \u53D1\u9001\u6D88\u606F\u5386\u53F2\uFF08\u7528\u4E8E\u4E0A\u4E0B\u952E\u6D4F\u89C8\uFF09\n   */\n  sendMessageHistory(direction: 'up' | 'down'): void {\n    const history = this.ctx.messageHistory;\n    \n    if (history.length === 0) {\n      this.ctx.postMessage({ type: 'historyItem', content: '' });\n      return;\n    }\n\n    if (direction === 'up') {\n      if (this.ctx.historyIndex < history.length - 1) {\n        this.ctx.historyIndex++;\n      }\n    } else {\n      if (this.ctx.historyIndex > -1) {\n        this.ctx.historyIndex--;\n      }\n    }\n\n    const content = this.ctx.historyIndex >= 0 \n      ? history[history.length - 1 - this.ctx.historyIndex] \n      : '';\n    \n    this.ctx.postMessage({ type: 'historyItem', content });\n  }\n\n  /**\n   * \u53D1\u9001\u547D\u4EE4\u5EFA\u8BAE\n   */\n  sendCommandSuggestions(input: string): void {\n    if (!input.startsWith('/')) {\n      this.ctx.postMessage({ type: 'suggestions', suggestions: [] });\n      return;\n    }\n\n    const query = input.slice(1).toLowerCase();\n    const commands = [\n      { command: '/clear', description: '\u6E05\u7A7A\u5F53\u524D\u5BF9\u8BDD' },\n      { command: '/init', description: '\u5206\u6790\u9879\u76EE\u7ED3\u6784' },\n      { command: '/diagram', description: '\u751F\u6210\u56FE\u8868' },\n      { command: '/gentest', description: '\u751F\u6210\u6D4B\u8BD5' },\n      { command: '/run', description: '\u6267\u884C\u547D\u4EE4' },\n      { command: '/search', description: '\u641C\u7D22\u4EE3\u7801' },\n      { command: '/file', description: '\u8BFB\u53D6\u6587\u4EF6' },\n      { command: '/help', description: '\u663E\u793A\u5E2E\u52A9' },\n      { command: '/gst', description: 'git status' },\n      { command: '/gpl', description: 'git pull' },\n      { command: '/gps', description: 'git push' },\n      { command: '/gcm', description: 'git commit -m' },\n    ];\n\n    const suggestions = commands\n      .filter(c => c.command.toLowerCase().includes(query))\n      .slice(0, 5);\n\n    this.ctx.postMessage({ type: 'suggestions', suggestions });\n  }\n\n  /**\n   * \u641C\u7D22\u6D88\u606F\n   */\n  searchMessages(query: string): void {\n    if (!query || query.trim().length === 0) {\n      this.ctx.postMessage({ type: 'searchResults', results: [], query: '' });\n      return;\n    }\n\n    const normalizedQuery = query.trim().toLowerCase();\n    const queryWords = normalizedQuery.split(/\\s+/).filter(w => w.length > 0);\n    \n    const session = this.ctx.sessionManager.currentSession;\n    let results: Array<{\n      id: string;\n      role: string;\n      preview: string;\n      timestamp: number;\n      sessionId?: string;\n      sessionTitle?: string;\n      score: number;\n    }> = [];\n\n    if (session) {\n      const sessionResults = this.searchInSession(session, queryWords, normalizedQuery);\n      results.push(...sessionResults);\n    }\n\n    // \u641C\u7D22\u5386\u53F2\u4F1A\u8BDD\n    const sessionList = this.ctx.sessionManager.getSessionList();\n    for (const sessionInfo of sessionList) {\n      if (sessionInfo.id === session?.id) continue;\n      \n      const historicalSession = this.ctx.sessionManager.getSessionById(sessionInfo.id);\n      if (historicalSession) {\n        const sessionResults = this.searchInSession(\n          historicalSession, \n          queryWords, \n          normalizedQuery, \n          sessionInfo.id, \n          sessionInfo.title\n        );\n        results.push(...sessionResults);\n      }\n    }\n\n    // \u6309\u76F8\u5173\u6027\u6392\u5E8F\n    results.sort((a, b) => b.score - a.score);\n    results = results.slice(0, 50);\n\n    const finalResults = results.map(({ score, ...rest }) => rest);\n    this.ctx.postMessage({ type: 'searchResults', results: finalResults, query });\n  }\n\n  /**\n   * \u5728\u5355\u4E2A\u4F1A\u8BDD\u4E2D\u641C\u7D22\u6D88\u606F\n   */\n  private searchInSession(\n    session: any,\n    queryWords: string[],\n    normalizedQuery: string,\n    sessionId?: string,\n    sessionTitle?: string\n  ): Array<{\n    id: string;\n    role: string;\n    preview: string;\n    timestamp: number;\n    sessionId?: string;\n    sessionTitle?: string;\n    score: number;\n  }> {\n    const results: Array<{\n      id: string;\n      role: string;\n      preview: string;\n      timestamp: number;\n      sessionId?: string;\n      sessionTitle?: string;\n      score: number;\n    }> = [];\n\n    for (const m of session.messages) {\n      const contentLower = m.content.toLowerCase();\n      \n      let score = 0;\n      let matchStart = -1;\n      \n      const exactMatchIndex = contentLower.indexOf(normalizedQuery);\n      if (exactMatchIndex !== -1) {\n        score += 10;\n        matchStart = exactMatchIndex;\n      }\n      \n      let wordMatches = 0;\n      for (const word of queryWords) {\n        if (contentLower.includes(word)) {\n          wordMatches++;\n          if (matchStart === -1) {\n            matchStart = contentLower.indexOf(word);\n          }\n        }\n      }\n      \n      if (wordMatches > 0) {\n        score += wordMatches * 2;\n        if (wordMatches === queryWords.length) {\n          score += 5;\n        }\n      }\n\n      if (score > 0) {\n        results.push({\n          id: m.id,\n          role: m.role,\n          preview: this.getSearchPreview(m.content, normalizedQuery, matchStart),\n          timestamp: m.timestamp,\n          sessionId,\n          sessionTitle,\n          score,\n        });\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * \u83B7\u53D6\u641C\u7D22\u9884\u89C8\n   */\n  private getSearchPreview(content: string, query: string, matchStart: number): string {\n    const maxLength = 120;\n    \n    if (matchStart >= 0) {\n      const start = Math.max(0, matchStart - 30);\n      const end = Math.min(content.length, start + maxLength);\n      let preview = content.slice(start, end);\n      if (start > 0) preview = '...' + preview;\n      if (end < content.length) preview += '...';\n      return preview;\n    }\n    \n    return content.slice(0, maxLength) + (content.length > maxLength ? '...' : '');\n  }\n}\n", "/**\n * MCP\u6D88\u606F\u5904\u7406\u5668 (\u4FEE\u6539\u7248)\n * \n * \u4FEE\u6539\u70B9\uFF1A\n * 1. \u5DE5\u5177\u6267\u884C\u7ED3\u679C\u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u8FD4\u56DE\uFF0C\u4E0D\u518D\u6DF7\u5165chat\u6D88\u606F\n * 2. Agent\u6267\u884C\u91C7\u7528\u6D41\u5F0F\u589E\u91CF\u8F93\u51FA\uFF0C\u800C\u975E\u6574\u4F53\u66FF\u6362\n * 3. \u6DFB\u52A0\u6267\u884C\u7ED3\u679C\u7684\u7ED3\u6784\u5316\u8FD4\u56DE\n */\n\nimport * as vscode from 'vscode';\nimport { ChatViewContext, MessageHandler } from '../types';\nimport { Message, generateId } from '../../../types/shared';\nimport {\n  MCPRegistry,\n  MCPExecutor,\n  MCPAgent,\n  AutonomousAgent,\n  MCPParser,\n  MCPToolDefinition,\n  MCPToolCallParams,\n  MCPAgentRequest,\n  AutonomousAgentRequest,\n  MCPConfig,\n  ExecutionHistory,\n  AgentStatus,\n  AgentStep,\n  IterationRecord,\n} from '../../mcp';\n\n/**\n * \u6267\u884C\u7ED3\u679C\u6D88\u606F\u7C7B\u578B\n */\nexport interface ExecutionResultMessage {\n  id: string;\n  type: 'mcp_execution' | 'skill_execution' | 'agent_execution';\n  toolId?: string;\n  skillId?: string;\n  success: boolean;\n  data?: any;\n  error?: string;\n  duration: number;\n  timestamp: number;\n}\n\n/**\n * Agent\u6D41\u5F0F\u66F4\u65B0\u7C7B\u578B\n */\nexport interface AgentStreamUpdate {\n  messageId: string;\n  phase: 'thinking' | 'executing' | 'observing' | 'complete';\n  iteration?: number;\n  chunk: string;\n  isAppend: boolean;  // true=\u8FFD\u52A0, false=\u66FF\u6362\u8BE5phase\u7684\u5185\u5BB9\n  toolExecution?: {\n    toolId: string;\n    toolName: string;\n    status: 'pending' | 'running' | 'success' | 'failed';\n    result?: any;\n  };\n}\n\n/**\n * MCP\u5904\u7406\u5668\n */\nexport class MCPHandler implements MessageHandler {\n  private registry: MCPRegistry;\n  private executor: MCPExecutor;\n  private agent: MCPAgent;\n  private autonomousAgent: AutonomousAgent;\n  \n  constructor(private ctx: ChatViewContext) {\n    // \u521D\u59CB\u5316MCP\u7EC4\u4EF6\n    this.registry = MCPRegistry.getInstance(ctx.extensionContext);\n    this.executor = MCPExecutor.getInstance(ctx.extensionContext, this.registry);\n    this.agent = MCPAgent.getInstance(\n      ctx.extensionContext,\n      this.registry,\n      this.executor,\n      ctx.configManager\n    );\n    \n    // \u521D\u59CB\u5316\u81EA\u4E3B\u5FAA\u73AFAgent\n    this.autonomousAgent = AutonomousAgent.getInstance(\n      ctx.extensionContext,\n      this.registry,\n      this.executor,\n      ctx.configManager\n    );\n    \n    // \u76D1\u542C\u6267\u884C\u5B8C\u6210\u4E8B\u4EF6\n    this.executor.onExecutionComplete((history: ExecutionHistory) => {\n      this.ctx.postMessage({\n        type: 'mcp:executionComplete',\n        history,\n      });\n    });\n    \n    // \u76D1\u542C\u4F20\u7EDFAgent\u72B6\u6001\u53D8\u5316\n    this.agent.onStatusChange((status: AgentStatus) => {\n      this.ctx.postMessage({\n        type: 'mcp:agentStatusChange',\n        status,\n      });\n    });\n    \n    this.agent.onStepUpdate((step: AgentStep) => {\n      this.ctx.postMessage({\n        type: 'mcp:agentStepUpdate',\n        step,\n      });\n    });\n    \n    this.agent.onProgress((progress: { message: string; progress?: number }) => {\n      this.ctx.postMessage({\n        type: 'mcp:agentProgress',\n        ...progress,\n      });\n    });\n    \n    // \u76D1\u542C\u81EA\u4E3BAgent\u4E8B\u4EF6\n    this.autonomousAgent.onStatusChange((status) => {\n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentStatusChange',\n        status,\n      });\n    });\n    \n    this.autonomousAgent.onIteration((iteration: IterationRecord) => {\n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentIteration',\n        iteration,\n      });\n    });\n    \n    this.autonomousAgent.onThought((thought) => {\n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentThought',\n        thought,\n      });\n    });\n    \n    this.autonomousAgent.onToolExecution(({ call, result }) => {\n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentToolExecution',\n        call,\n        result,\n      });\n    });\n    \n    this.autonomousAgent.onProgress((progress) => {\n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentProgress',\n        ...progress,\n      });\n    });\n  }\n  \n  async handle(data: any): Promise<boolean> {\n    // \u68C0\u67E5\u662F\u5426\u662FMCP\u6D88\u606F\n    if (!data.type?.startsWith('mcp:')) {\n      return false;\n    }\n    \n    switch (data.type) {\n      // \u5DE5\u5177\u7BA1\u7406\n      case 'mcp:getTools':\n        await this.handleGetTools();\n        return true;\n      \n      case 'mcp:getTool':\n        await this.handleGetTool(data.toolId);\n        return true;\n      \n      case 'mcp:registerTool':\n        await this.handleRegisterTool(data.tool);\n        return true;\n      \n      case 'mcp:updateTool':\n        await this.handleUpdateTool(data.tool);\n        return true;\n      \n      case 'mcp:deleteTool':\n        await this.handleDeleteTool(data.toolId);\n        return true;\n      \n      case 'mcp:toggleTool':\n        await this.handleToggleTool(data.toolId, data.enabled);\n        return true;\n      \n      // \u5DE5\u5177\u6267\u884C\n      case 'mcp:testTool':\n        await this.handleTestTool(data.toolId, data.testParams);\n        return true;\n      \n      case 'mcp:executeTool':\n        await this.handleExecuteTool(data.params);\n        return true;\n      \n      // Agent\n      case 'mcp:agentRequest':\n        await this.handleAgentRequest(data.request);\n        return true;\n      \n      case 'mcp:cancelAgent':\n        this.agent.cancelTask();\n        return true;\n      \n      // \u81EA\u4E3B\u5FAA\u73AFAgent\n      case 'mcp:autonomousAgentRequest':\n        await this.handleAutonomousAgentRequest(data.request);\n        return true;\n      \n      case 'mcp:cancelAutonomousAgent':\n        this.autonomousAgent.cancel();\n        return true;\n      \n      case 'mcp:getAutonomousAgentStatus':\n        this.ctx.postMessage({\n          type: 'mcp:autonomousAgentStatus',\n          status: this.autonomousAgent.getStatus(),\n          iterations: this.autonomousAgent.getIterations(),\n        });\n        return true;\n      \n      // \u914D\u7F6E\n      case 'mcp:getConfig':\n        this.handleGetConfig();\n        return true;\n      \n      case 'mcp:updateConfig':\n        await this.handleUpdateConfig(data.config);\n        return true;\n      \n      // \u5BFC\u5165\u5BFC\u51FA\n      case 'mcp:importTools':\n        await this.handleImportTools(data.data);\n        return true;\n      \n      case 'mcp:exportTools':\n        this.handleExportTools(data.toolIds);\n        return true;\n      \n      // \u5386\u53F2\n      case 'mcp:getExecutionHistory':\n        this.handleGetExecutionHistory(data.limit);\n        return true;\n      \n      default:\n        return false;\n    }\n  }\n  \n  /**\n   * \u5904\u7406\u804A\u5929\u6D88\u606F\u4E2D\u7684MCP\u6307\u4EE4\n   * \u4ECEChatMessageHandler\u8C03\u7528\n   */\n  async handleMCPCommand(input: string): Promise<boolean> {\n    const parseResult = MCPParser.parse(input);\n    \n    if (parseResult.type === 'none') {\n      return false;\n    }\n    \n    // \u6DFB\u52A0\u7528\u6237\u6D88\u606F\n    const userMessage: Message = {\n      id: generateId(),\n      role: 'user',\n      content: input,\n      timestamp: Date.now(),\n    };\n    await this.ctx.sessionManager.addMessage(userMessage);\n    this.ctx.postMessage({ type: 'addMessage', message: userMessage });\n    \n    // \u6839\u636E\u89E3\u6790\u7ED3\u679C\u5904\u7406\n    switch (parseResult.type) {\n      case 'help':\n        await this.sendAssistantMessage(MCPParser.getHelpText());\n        break;\n      \n      case 'list':\n        await this.sendToolList();\n        break;\n      \n      case 'search':\n        await this.sendSearchResults(parseResult.searchQuery || '');\n        break;\n      \n      case 'manage':\n        this.ctx.postMessage({ type: 'mcp:openManagePanel' });\n        await this.sendAssistantMessage('\u5DF2\u6253\u5F00MCP\u5DE5\u5177\u7BA1\u7406\u9762\u677F\u3002');\n        break;\n      \n      case 'history':\n        await this.sendExecutionHistory();\n        break;\n      \n      case 'call':\n        // \u5DE5\u5177\u6267\u884C\u7ED3\u679C\u901A\u8FC7chat\u6D88\u606F\u5B8C\u6574\u8FD4\u56DE\n        this.ctx.updateTaskStatus('mcp', 'running', `\u6267\u884C\u5DE5\u5177: ${parseResult.toolId}`);\n        await this.executeToolFromChat(parseResult);\n        break;\n      \n      case 'agent':\n        // [\u4FEE\u6539] Agent\u91C7\u7528\u6D41\u5F0F\u8F93\u51FA\n        await this.executeAgentFromChat(parseResult);\n        break;\n    }\n    \n    return true;\n  }\n  \n  // ============================================\n  // \u5DE5\u5177\u7BA1\u7406\u5904\u7406 (\u4FDD\u6301\u539F\u6709\u5B9E\u73B0)\n  // ============================================\n  \n  private async handleGetTools(): Promise<void> {\n    const tools = this.registry.getAllTools();\n    this.ctx.postMessage({\n      type: 'mcp:toolList',\n      tools,\n    });\n  }\n  \n  private async handleGetTool(toolId: string): Promise<void> {\n    const tool = this.registry.getTool(toolId);\n    this.ctx.postMessage({\n      type: 'mcp:toolDetail',\n      tool: tool || null,\n    });\n  }\n  \n  private async handleRegisterTool(tool: MCPToolDefinition): Promise<void> {\n    try {\n      await this.registry.registerTool(tool);\n      this.ctx.postMessage({ type: 'mcp:toolRegistered', toolId: tool.id });\n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'mcp:error',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n  \n  private async handleUpdateTool(tool: MCPToolDefinition): Promise<void> {\n    try {\n      await this.registry.updateTool(tool);\n      this.ctx.postMessage({ type: 'mcp:toolUpdated', toolId: tool.id });\n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'mcp:error',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n  \n  private async handleDeleteTool(toolId: string): Promise<void> {\n    try {\n      await this.registry.deleteTool(toolId);\n      this.ctx.postMessage({ type: 'mcp:toolDeleted', toolId });\n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'mcp:error',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n  \n  private async handleToggleTool(toolId: string, enabled: boolean): Promise<void> {\n    try {\n      await this.registry.toggleTool(toolId, enabled);\n      this.ctx.postMessage({ type: 'mcp:toolToggled', toolId, enabled });\n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'mcp:error',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n  \n  private async handleTestTool(toolId: string, testParams: Record<string, any>): Promise<void> {\n    const result = await this.executor.execute({\n      toolId,\n      arguments: testParams,\n      caller: 'test',\n      context: {\n        workspaceRoot: vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n      },\n    });\n    \n    this.ctx.postMessage({\n      type: 'mcp:testResult',\n      toolId,\n      result,\n    });\n  }\n  \n  private async handleExecuteTool(params: MCPToolCallParams): Promise<void> {\n    const result = await this.executor.execute(params);\n    \n    // [\u4FEE\u6539] \u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u8FD4\u56DE\u6267\u884C\u7ED3\u679C\n    this.ctx.postMessage({\n      type: 'mcp:executionResult',\n      result,\n    });\n  }\n  \n  private async handleAgentRequest(request: MCPAgentRequest): Promise<void> {\n    try {\n      const result = await this.agent.execute(request);\n      this.ctx.postMessage({\n        type: 'mcp:agentResult',\n        result,\n      });\n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'mcp:agentError',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n  \n  private handleGetConfig(): void {\n    // \u5B9E\u73B0\u83B7\u53D6\u914D\u7F6E\n    this.ctx.postMessage({\n      type: 'mcp:config',\n      config: {},\n    });\n  }\n  \n  private async handleUpdateConfig(config: Partial<MCPConfig>): Promise<void> {\n    // \u5B9E\u73B0\u66F4\u65B0\u914D\u7F6E\n    this.ctx.postMessage({ type: 'mcp:configUpdated' });\n  }\n  \n  private async handleImportTools(data: any): Promise<void> {\n    // \u5B9E\u73B0\u5BFC\u5165\u5DE5\u5177\n    this.ctx.postMessage({ type: 'mcp:importComplete' });\n  }\n  \n  private handleExportTools(toolIds: string[]): void {\n    // \u5B9E\u73B0\u5BFC\u51FA\u5DE5\u5177\n    const tools = toolIds.map(id => this.registry.getTool(id)).filter(Boolean);\n    this.ctx.postMessage({\n      type: 'mcp:exportData',\n      data: tools,\n    });\n  }\n  \n  private handleGetExecutionHistory(limit?: number): void {\n    const history = this.executor.getHistory(limit);\n    this.ctx.postMessage({\n      type: 'mcp:executionHistory',\n      history,\n    });\n  }\n  \n  /**\n   * \u53D1\u9001\u52A9\u624B\u6D88\u606F\n   */\n  private async sendAssistantMessage(content: string): Promise<void> {\n    const message: Message = {\n      id: generateId(),\n      role: 'assistant',\n      content,\n      timestamp: Date.now(),\n    };\n    await this.ctx.sessionManager.addMessage(message);\n    this.ctx.postMessage({ type: 'addMessage', message });\n  }\n  \n  /**\n   * \u53D1\u9001\u5DE5\u5177\u5217\u8868\n   */\n  private async sendToolList(): Promise<void> {\n    const allTools = this.registry.getAllTools();\n    \n    if (allTools.length === 0) {\n      await this.sendAssistantMessage('\u5F53\u524D\u6CA1\u6709\u53EF\u7528\u7684MCP\u5DE5\u5177\u3002\u4F7F\u7528 `@mcp:manage` \u6253\u5F00\u7BA1\u7406\u9762\u677F\u6DFB\u52A0\u5DE5\u5177\u3002');\n      return;\n    }\n    \n    // \u6309\u5206\u7C7B\u5206\u7EC4\n    const byCategory = new Map<string, typeof allTools>();\n    allTools.forEach(reg => {\n      const cat = reg.tool.category || 'custom';\n      if (!byCategory.has(cat)) {\n        byCategory.set(cat, []);\n      }\n      byCategory.get(cat)!.push(reg);\n    });\n    \n    let content = '# \uD83D\uDD27 \u53EF\u7528MCP\u5DE5\u5177\\n\\n';\n    \n    byCategory.forEach((tools, category) => {\n      content += `## ${this.getCategoryName(category)}\\n\\n`;\n      tools.forEach(reg => {\n        const status = reg.enabled ? '\u2705' : '\u23F8\uFE0F';\n        content += `${status} **${reg.tool.name}** (\\`@mcp:${reg.tool.id}\\`)\\n`;\n        content += `   ${reg.tool.description}\\n\\n`;\n      });\n    });\n    \n    content += '\\n\u4F7F\u7528 `@mcp:\u5DE5\u5177ID {\u53C2\u6570}` \u8C03\u7528\u5DE5\u5177';\n    \n    await this.sendAssistantMessage(content);\n  }\n  \n  /**\n   * \u53D1\u9001\u641C\u7D22\u7ED3\u679C\n   */\n  private async sendSearchResults(query: string): Promise<void> {\n    const results = this.registry.searchTools(query);\n    \n    if (results.length === 0) {\n      await this.sendAssistantMessage(`\u6CA1\u6709\u627E\u5230\u5339\u914D \"${query}\" \u7684\u5DE5\u5177\u3002`);\n      return;\n    }\n    \n    let content = `# \uD83D\uDD0D \u641C\u7D22\u7ED3\u679C: \"${query}\"\\n\\n`;\n    results.forEach(reg => {\n      const status = reg.enabled ? '\u2705' : '\u23F8\uFE0F';\n      content += `${status} **${reg.tool.name}** (\\`@mcp:${reg.tool.id}\\`)\\n`;\n      content += `   ${reg.tool.description}\\n\\n`;\n    });\n    \n    await this.sendAssistantMessage(content);\n  }\n  \n  /**\n   * \u53D1\u9001\u6267\u884C\u5386\u53F2\n   */\n  private async sendExecutionHistory(): Promise<void> {\n    const history = this.executor.getHistory(10);\n    \n    if (history.length === 0) {\n      await this.sendAssistantMessage('\u6682\u65E0\u6267\u884C\u5386\u53F2\u3002');\n      return;\n    }\n    \n    let content = '# \uD83D\uDCDC \u6700\u8FD1\u6267\u884C\u5386\u53F2\\n\\n';\n    \n    for (const h of history) {\n      const status = h.success ? '\u2705' : '\u274C';\n      const time = new Date(h.timestamp).toLocaleString();\n      const duration = h.duration;\n      \n      content += `${status} **${h.toolName}** - ${time} (${duration}ms)\\n`;\n      content += `\\`@mcp:${h.toolId}\\`\\n\\n`;\n    }\n    \n    await this.sendAssistantMessage(content);\n  }\n  \n  /**\n   * [\u4FEE\u6539] \u4ECE\u804A\u5929\u6267\u884C\u5DE5\u5177 - \u7ED3\u679C\u901A\u8FC7chat\u6D88\u606F\u5B8C\u6574\u8FD4\u56DE\n   */\n  private async executeToolFromChat(parseResult: any): Promise<void> {\n    const { toolId, params } = parseResult;\n    \n    // \u68C0\u67E5\u5DE5\u5177\u662F\u5426\u5B58\u5728\n    const registration = this.registry.getTool(toolId);\n    if (!registration) {\n      await this.sendAssistantMessage(`\u5DE5\u5177 \\`${toolId}\\` \u4E0D\u5B58\u5728\u3002\u4F7F\u7528 \\`@mcp:list\\` \u67E5\u770B\u53EF\u7528\u5DE5\u5177\u3002`);\n      return;\n    }\n    \n    if (!registration.enabled) {\n      await this.sendAssistantMessage(`\u5DE5\u5177 \\`${toolId}\\` \u5DF2\u7981\u7528\u3002`);\n      return;\n    }\n    \n    // \u901A\u77E5\u524D\u7AEF\u5DE5\u5177\u5F00\u59CB\u6267\u884C\n    this.ctx.updateTaskStatus('chat', 'running', `\u6B63\u5728\u6267\u884C ${registration.tool.name}...`);\n    this.ctx.postMessage({\n      type: 'mcp:toolExecutionStart',\n      toolId,\n      toolName: registration.tool.name,\n      params,\n    });\n    \n    // \u6267\u884C\u5DE5\u5177\n    const startTime = Date.now();\n    const result = await this.executor.execute({\n      toolId,\n      arguments: params,\n      caller: 'user',\n      context: {\n        workspaceRoot: vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n        activeFile: vscode.window.activeTextEditor?.document.fileName,\n      },\n    });\n    \n    const duration = Date.now() - startTime;\n    \n    // \u540C\u65F6\u901A\u8FC7\u72EC\u7ACB\u901A\u9053\u53D1\u9001\u539F\u59CB\u7ED3\u679C\uFF08\u4F9B\u9762\u677F\u4F7F\u7528\uFF09\n    const executionResult: ExecutionResultMessage = {\n      id: generateId(),\n      type: 'mcp_execution',\n      toolId,\n      success: result.success,\n      data: result.data,\n      error: result.error?.message,\n      duration,\n      timestamp: Date.now(),\n    };\n    \n    this.ctx.postMessage({\n      type: 'mcp:toolExecutionResult',\n      result: executionResult,\n      toolName: registration.tool.name,\n    });\n    \n    // [\u6838\u5FC3\u4FEE\u6539] \u5C06\u5B8C\u6574\u6267\u884C\u7ED3\u679C\u4F5C\u4E3Achat\u6D88\u606F\u8FD4\u56DE\n    let chatContent: string;\n    if (result.success) {\n      const dataStr = result.data != null\n        ? (typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2))\n        : '(\u65E0\u8FD4\u56DE\u6570\u636E)';\n      const truncated = dataStr.length > 3000 ? dataStr.slice(0, 3000) + '\\n...(\u7ED3\u679C\u5DF2\u622A\u65AD)' : dataStr;\n      \n      chatContent = `\u2705 **${registration.tool.name}** \u6267\u884C\u6210\u529F (${duration}ms)\\n\\n`;\n      chatContent += `\\`\\`\\`json\\n${truncated}\\n\\`\\`\\``;\n    } else {\n      chatContent = `\u274C **${registration.tool.name}** \u6267\u884C\u5931\u8D25 (${duration}ms)\\n\\n`;\n      chatContent += `**\u9519\u8BEF**: ${result.error?.message || '\u672A\u77E5\u9519\u8BEF'}`;\n    }\n    \n    await this.sendAssistantMessage(chatContent);\n    this.ctx.updateTaskStatus('chat', result.success ? 'success' : 'error', \n      result.success ? `${registration.tool.name} \u6267\u884C\u5B8C\u6210` : `${registration.tool.name} \u6267\u884C\u5931\u8D25`);\n  }\n  /**\n   * \u4ECE\u804A\u5929\u6267\u884CAgent\uFF08\u4F7F\u7528\u81EA\u4E3B\u5FAA\u73AFAgent\uFF09\n   */\n  private async executeAgentFromChat(parseResult: any): Promise<void> {\n    const task = parseResult.agentTask;\n    \n    // \u4F7F\u7528\u65B0\u7684\u6D41\u5F0F\u81EA\u4E3BAgent\n    await this.executeAutonomousAgentStreamingFromChat(task);\n  }\n  \n  /**\n   * \u83B7\u53D6\u5206\u7C7B\u540D\u79F0\n   */\n  private getCategoryName(category: string): string {\n    const names: Record<string, string> = {\n      file: '\uD83D\uDCC1 \u6587\u4EF6\u64CD\u4F5C',\n      code: '\uD83D\uDCBB \u4EE3\u7801\u76F8\u5173',\n      api: '\uD83C\uDF10 API\u8C03\u7528',\n      database: '\uD83D\uDDC4\uFE0F \u6570\u636E\u5E93',\n      shell: '\u2328\uFE0F Shell\u547D\u4EE4',\n      web: '\uD83D\uDD17 Web\u8BF7\u6C42',\n      ai: '\uD83E\uDD16 AI\u670D\u52A1',\n      utility: '\uD83D\uDD27 \u5DE5\u5177\u7C7B',\n      custom: '\uD83D\uDCE6 \u81EA\u5B9A\u4E49',\n    };\n    return names[category] || category;\n  }\n  \n  /**\n   * \u83B7\u53D6Registry\u5B9E\u4F8B\uFF08\u4F9B\u5916\u90E8\u4F7F\u7528\uFF09\n   */\n  getRegistry(): MCPRegistry {\n    return this.registry;\n  }\n  \n  /**\n   * \u83B7\u53D6Executor\u5B9E\u4F8B\uFF08\u4F9B\u5916\u90E8\u4F7F\u7528\uFF09\n   */\n  getExecutor(): MCPExecutor {\n    return this.executor;\n  }\n  \n  /**\n   * \u83B7\u53D6Agent\u5B9E\u4F8B\uFF08\u4F9B\u5916\u90E8\u4F7F\u7528\uFF09\n   */\n  getAgent(): MCPAgent {\n    return this.agent;\n  }\n  \n  /**\n   * \u83B7\u53D6\u81EA\u4E3BAgent\u5B9E\u4F8B\uFF08\u4F9B\u5916\u90E8\u4F7F\u7528\uFF09\n   */\n  getAutonomousAgent(): AutonomousAgent {\n    return this.autonomousAgent;\n  }\n  \n  // ============================================\n  // \u81EA\u4E3B\u5FAA\u73AFAgent\u5904\u7406\n  // ============================================\n  \n  /**\n   * \u5904\u7406\u81EA\u4E3BAgent\u8BF7\u6C42\n   */\n  private async handleAutonomousAgentRequest(request: AutonomousAgentRequest): Promise<void> {\n    try {\n      const result = await this.autonomousAgent.execute(request);\n      \n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentResult',\n        result,\n      });\n    } catch (error) {\n      this.ctx.postMessage({\n        type: 'mcp:autonomousAgentError',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  }\n  \n  /**\n   * [\u65B0\u589E] \u4ECE\u804A\u5929\u6267\u884C\u81EA\u4E3BAgent - \u6D41\u5F0F\u8F93\u51FA\u7248\u672C\n   * \u8F93\u51FA\u683C\u5F0F\uFF1A\u7ED3\u6784\u5316\u6B65\u9AA4 + \u6298\u53E0thinking + \u6E05\u6670\u7ED3\u679C\n   */\n  private async executeAutonomousAgentStreamingFromChat(task: string): Promise<void> {\n    if (!task) {\n      await this.sendAssistantMessage('\u8BF7\u63D0\u4F9B\u4EFB\u52A1\u63CF\u8FF0\uFF0C\u4F8B\u5982: `@mcp:agent \u5E2E\u6211\u67E5\u627E\u6240\u6709TODO\u6CE8\u91CA`');\n      return;\n    }\n    \n    // \u66F4\u65B0\u4EFB\u52A1\u72B6\u6001\n    this.ctx.updateTaskStatus('mcp', 'running', `Agent\u6267\u884C\u4E2D: ${task.slice(0, 30)}...`);\n    \n    // \u521B\u5EFA\u521D\u59CB\u6D88\u606F\n    const messageId = generateId();\n    const initialMessage: Message = {\n      id: messageId,\n      role: 'assistant',\n      content: '',\n      timestamp: Date.now(),\n      isStreaming: true,\n      metadata: {\n        type: 'agent_execution',\n        task,\n      },\n    };\n    \n    await this.ctx.sessionManager.addMessage(initialMessage);\n    this.ctx.postMessage({ type: 'addMessage', message: initialMessage, streaming: true });\n    \n    // \u5185\u5BB9\u7D2F\u79EF\u5668\n    let accumulatedContent = '';\n    let stepNumber = 0;\n    \n    // \u53D1\u9001\u6D41\u5F0F\u66F4\u65B0\u7684\u8F85\u52A9\u51FD\u6570\n    const sendStreamUpdate = (chunk: string, isAppend: boolean = true) => {\n      if (isAppend) {\n        accumulatedContent += chunk;\n      }\n      this.ctx.postMessage({\n        type: 'updateMessage',\n        messageId,\n        content: accumulatedContent,\n      });\n    };\n    \n    // \u8F93\u51FA\u4EFB\u52A1\u5934\u90E8\n    sendStreamUpdate(`\uD83E\uDD16 **Agent \u4EFB\u52A1**: ${task}\\n\\n`);\n    sendStreamUpdate(`---\\n\\n`);\n    \n    // \u8BBE\u7F6E\u6D41\u5F0F\u8FDB\u5EA6\u66F4\u65B0\n    const progressHandler = this.autonomousAgent.onProgress((progress) => {\n      this.ctx.postMessage({\n        type: 'mcp:agentStreamUpdate',\n        messageId,\n        phase: 'progress',\n        progress: progress.progress,\n        message: progress.message,\n      });\n    });\n    \n    // \u8BBE\u7F6E\u6D41\u5F0F\u601D\u8003\u66F4\u65B0 - \u6298\u53E0\u683C\u5F0F\n    const thoughtHandler = this.autonomousAgent.onThought((thought) => {\n      stepNumber++;\n      sendStreamUpdate(`**\u6B65\u9AA4 ${stepNumber}** \u2014 `);\n      \n      if (thought.decision === 'complete') {\n        sendStreamUpdate(`\u2705 \u4EFB\u52A1\u5B8C\u6210\\n\\n`);\n      } else if (thought.decision === 'clarify') {\n        sendStreamUpdate(`\u2753 \u9700\u8981\u6F84\u6E05\\n\\n`);\n      } else {\n        sendStreamUpdate(`\u6267\u884C\u4E2D\\n\\n`);\n      }\n      \n      // \u601D\u8003\u8FC7\u7A0B\u6298\u53E0\u5C55\u793A\n      sendStreamUpdate(`<details>\\n<summary>\uD83D\uDCAD \u601D\u8003\u8FC7\u7A0B</summary>\\n\\n`);\n      sendStreamUpdate(`${thought.analysis}\\n\\n`);\n      if (thought.toolCalls.length > 0) {\n        sendStreamUpdate(`**\u8BA1\u5212**:\\n`);\n        for (const call of thought.toolCalls) {\n          sendStreamUpdate(`- \uD83D\uDD27 ${call.toolName} \u2014 ${call.reason}\\n`);\n        }\n      }\n      sendStreamUpdate(`\\n</details>\\n\\n`);\n    });\n    \n    // \u8BBE\u7F6E\u6D41\u5F0F\u5DE5\u5177\u6267\u884C\u66F4\u65B0\n    const toolExecutionHandler = this.autonomousAgent.onToolExecution(({ call, result }) => {\n      if (!result) {\n        // \u5DE5\u5177\u5F00\u59CB\u6267\u884C\n        sendStreamUpdate(`> \u26A1 **${call.toolName}** \u2014 ${call.reason}\\n`);\n      } else {\n        // \u5DE5\u5177\u6267\u884C\u5B8C\u6210\n        const status = result.success ? '\u2705' : '\u274C';\n        const duration = result.duration ? ` (${result.duration}ms)` : '';\n        \n        if (result.success && result.data) {\n          const dataStr = typeof result.data === 'string' \n            ? result.data \n            : JSON.stringify(result.data, null, 2);\n          const truncated = dataStr.length > 300 \n            ? dataStr.slice(0, 300) + '\\n...' \n            : dataStr;\n          sendStreamUpdate(`> ${status} \u5B8C\u6210${duration}\\n>\\n> \\`\\`\\`\\n> ${truncated.split('\\n').join('\\n> ')}\\n> \\`\\`\\`\\n\\n`);\n        } else if (!result.success) {\n          sendStreamUpdate(`> ${status} \u5931\u8D25${duration}: ${result.error}\\n\\n`);\n        } else {\n          sendStreamUpdate(`> ${status} \u5B8C\u6210${duration}\\n\\n`);\n        }\n      }\n    });\n    \n    // \u8BBE\u7F6E\u6D41\u5F0F\u8FED\u4EE3\u66F4\u65B0 - \u7B80\u6D01\u7684\u89C2\u5BDF\u603B\u7ED3\n    const iterationHandler = this.autonomousAgent.onIteration((iteration) => {\n      // \u89C2\u5BDF\u7ED3\u679C\u6298\u53E0\n      sendStreamUpdate(`<details>\\n<summary>\uD83D\uDC41 \u7B2C${iteration.iteration}\u8F6E\u89C2\u5BDF</summary>\\n\\n`);\n      sendStreamUpdate(`${iteration.observation}\\n\\n`);\n      sendStreamUpdate(`</details>\\n\\n`);\n    });\n    \n    try {\n      // \u6267\u884C\u81EA\u4E3BAgent\u4EFB\u52A1\n      const result = await this.autonomousAgent.execute({\n        task,\n        context: {\n          workspaceRoot: vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n          activeFile: vscode.window.activeTextEditor?.document.fileName,\n          selectedCode: vscode.window.activeTextEditor?.document.getText(\n            vscode.window.activeTextEditor.selection\n          ),\n        },\n        config: {\n          maxIterations: 10,\n          maxParallelCalls: 5,\n          timeout: 120000,\n        },\n      });\n      \n      // \u8F93\u51FA\u7B80\u6D01\u7684\u6700\u7EC8\u7ED3\u679C\n      sendStreamUpdate(`---\\n\\n`);\n      sendStreamUpdate(`## \u2705 \u7ED3\u679C\\n\\n`);\n      sendStreamUpdate(`${result.finalAnswer}\\n\\n`);\n      \n      // \u7EDF\u8BA1\u4FE1\u606F\u6298\u53E0\n      sendStreamUpdate(`<details>\\n<summary>\uD83D\uDCCA \u6267\u884C\u7EDF\u8BA1</summary>\\n\\n`);\n      sendStreamUpdate(`- \u8FED\u4EE3: ${result.stats.totalIterations} \u8F6E\\n`);\n      sendStreamUpdate(`- \u5DE5\u5177\u8C03\u7528: ${result.stats.totalToolCalls} \u6B21 (\u6210\u529F ${result.stats.successfulCalls} / \u5931\u8D25 ${result.stats.failedCalls})\\n`);\n      sendStreamUpdate(`- \u8017\u65F6: ${(result.totalDuration / 1000).toFixed(1)}s\\n`);\n      if (result.toolsUsed.length > 0) {\n        sendStreamUpdate(`- \u4F7F\u7528\u5DE5\u5177: ${result.toolsUsed.join(', ')}\\n`);\n      }\n      sendStreamUpdate(`\\n</details>\\n`);\n      \n      // \u5B8C\u6210\u6D88\u606F\n      initialMessage.content = accumulatedContent;\n      initialMessage.isStreaming = false;\n      await this.ctx.sessionManager.updateLastMessage(accumulatedContent, true);\n      this.ctx.postMessage({\n        type: 'completeMessage',\n        messageId,\n        content: accumulatedContent,\n      });\n      \n      this.ctx.updateTaskStatus('mcp', 'success', 'Agent\u4EFB\u52A1\u5B8C\u6210');\n      \n    } catch (error) {\n      sendStreamUpdate(`\\n---\\n\\n`);\n      sendStreamUpdate(`## \u274C \u6267\u884C\u5931\u8D25\\n\\n`);\n      sendStreamUpdate(`${error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF'}\\n`);\n      \n      initialMessage.content = accumulatedContent;\n      initialMessage.isStreaming = false;\n      await this.ctx.sessionManager.updateLastMessage(accumulatedContent, true);\n      this.ctx.postMessage({\n        type: 'completeMessage',\n        messageId,\n        content: accumulatedContent,\n        error: true,\n      });\n      \n      this.ctx.updateTaskStatus('mcp', 'error', error instanceof Error ? error.message : '\u6267\u884C\u5931\u8D25');\n    } finally {\n      // \u6E05\u7406\u4E8B\u4EF6\u76D1\u542C\n      progressHandler.dispose();\n      thoughtHandler.dispose();\n      toolExecutionHandler.dispose();\n      iterationHandler.dispose();\n    }\n  }\n}\n", "/**\n * Skill\u5305\u7BA1\u7406\u5668 (v2)\n * \n * \u7BA1\u7406skill\u5305\u7684\u5B8C\u6574\u751F\u547D\u5468\u671F\uFF1A\n * - \u5185\u7F6Eskill\u5305\u81EA\u52A8\u52A0\u8F7D\n * - \u672C\u5730/Git/URL\u5B89\u88C5\n * - \u542F\u7528/\u7981\u7528/\u5378\u8F7D\n * - \u4E0EIntentClassifier\u8054\u52A8\u6CE8\u518C\u89E6\u53D1\u89C4\u5219\n */\n\nimport * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport {\n  SkillManifest,\n  InstalledSkill,\n  SkillStatus,\n  SkillInstallOptions,\n  SkillResult,\n  SkillMarkdown,\n} from './types';\nimport { SkillLoader } from './SkillLoader';\nimport { SkillExecutor } from './SkillExecutor';\nimport { SkillMCPBridgeFactory } from './SkillMCPBridge';\nimport { MCPRegistry, MCPExecutor } from '../../mcp';\n\nconst STORAGE_KEY = 'aiAssistant.skills';\nconst SKILLS_DIR = 'skills';\n\nexport class SkillManager {\n  private static instance: SkillManager | null = null;\n\n  private context: vscode.ExtensionContext;\n  private loader: SkillLoader;\n  private executor: SkillExecutor;\n  private bridgeFactory: SkillMCPBridgeFactory;\n  private skills: Map<string, InstalledSkill> = new Map();\n  private skillsDir: string;\n\n  // \u4E8B\u4EF6\n  private _onSkillInstalled = new vscode.EventEmitter<InstalledSkill>();\n  private _onSkillUninstalled = new vscode.EventEmitter<string>();\n  private _onSkillStatusChanged = new vscode.EventEmitter<{ id: string; status: SkillStatus }>();\n\n  readonly onSkillInstalled = this._onSkillInstalled.event;\n  readonly onSkillUninstalled = this._onSkillUninstalled.event;\n  readonly onSkillStatusChanged = this._onSkillStatusChanged.event;\n\n  private constructor(\n    context: vscode.ExtensionContext,\n    registry: MCPRegistry,\n    executor: MCPExecutor\n  ) {\n    this.context = context;\n    this.loader = SkillLoader.getInstance();\n    this.executor = SkillExecutor.getInstance(context);\n    this.bridgeFactory = SkillMCPBridgeFactory.getInstance();\n    this.bridgeFactory.initialize(registry, executor);\n\n    this.skillsDir = path.join(context.globalStorageUri.fsPath, SKILLS_DIR);\n    if (!fs.existsSync(this.skillsDir)) {\n      fs.mkdirSync(this.skillsDir, { recursive: true });\n    }\n  }\n\n  static getInstance(\n    context: vscode.ExtensionContext,\n    registry?: MCPRegistry,\n    executor?: MCPExecutor\n  ): SkillManager {\n    if (!SkillManager.instance) {\n      if (!registry || !executor) {\n        throw new Error('SkillManager\u9996\u6B21\u521D\u59CB\u5316\u9700\u8981\u63D0\u4F9BMCPRegistry\u548CMCPExecutor');\n      }\n      SkillManager.instance = new SkillManager(context, registry, executor);\n    }\n    return SkillManager.instance;\n  }\n\n  /**\n   * \u521D\u59CB\u5316\uFF1A\u52A0\u8F7D\u5185\u7F6Eskill\u5305 + \u5DF2\u5B89\u88C5\u7684skill\u5305\n   */\n  async initialize(): Promise<void> {\n    await this.loadBuiltinSkills();\n    await this.loadInstalledSkills();\n    console.log(`[SkillManager] \u521D\u59CB\u5316\u5B8C\u6210: ${this.skills.size} \u4E2Askill`);\n  }\n\n  /**\n   * \u52A0\u8F7D\u5185\u7F6Eskill\u5305\uFF08\u4ECE\u6269\u5C55dist/resources/builtin-packages\u76EE\u5F55\uFF09\n   */\n  private async loadBuiltinSkills(): Promise<void> {\n    // \u4F7F\u7528 extensionPath \u800C\u975E __dirname\uFF0C\u786E\u4FDD\u7F16\u8BD1\u540E\u8DEF\u5F84\u6B63\u786E\n    const builtinDir = path.join(this.context.extensionPath, 'dist', 'resources', 'builtin-packages');\n    \n    if (!fs.existsSync(builtinDir)) {\n      console.log('[SkillManager] \u5185\u7F6Eskill\u5305\u76EE\u5F55\u4E0D\u5B58\u5728:', builtinDir);\n      // \u517C\u5BB9\u5F00\u53D1\u6A21\u5F0F\uFF1A\u5C1D\u8BD5\u4ECE src \u76EE\u5F55\u52A0\u8F7D\n      const devDir = path.join(this.context.extensionPath, 'src', 'extension', 'skills', 'builtin-packages');\n      if (fs.existsSync(devDir)) {\n        console.log('[SkillManager] \u4F7F\u7528\u5F00\u53D1\u6A21\u5F0F\u8DEF\u5F84:', devDir);\n        return this._loadBuiltinFromDir(devDir);\n      }\n      return;\n    }\n\n    return this._loadBuiltinFromDir(builtinDir);\n  }\n\n  private async _loadBuiltinFromDir(builtinDir: string): Promise<void> {    const entries = fs.readdirSync(builtinDir, { withFileTypes: true });\n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n\n      const skillDir = path.join(builtinDir, entry.name);\n      const manifestPath = path.join(skillDir, 'manifest.json');\n\n      if (!fs.existsSync(manifestPath)) continue;\n\n      try {\n        const loadResult = await this.loader.loadFromDirectory(skillDir);\n        if (!loadResult.success || !loadResult.manifest) continue;\n\n        const manifest = loadResult.manifest;\n\n        // \u5185\u7F6Eskill\u4E0D\u8986\u76D6\u7528\u6237\u5DF2\u5B89\u88C5\u7684\u540CID skill\n        if (this.skills.has(manifest.id)) continue;\n\n        const skill: InstalledSkill = {\n          manifest,\n          installPath: skillDir,\n          installedAt: 0, // \u5185\u7F6E\u6807\u8BB0\n          status: 'active',\n          source: { type: 'local', localPath: skillDir },\n        };\n\n        this.skills.set(manifest.id, skill);\n      } catch (err) {\n        console.error(`[SkillManager] \u52A0\u8F7D\u5185\u7F6Eskill\u5931\u8D25 ${entry.name}:`, err);\n      }\n    }\n  }\n\n  /**\n   * \u52A0\u8F7D\u5DF2\u5B89\u88C5\u7684skills\uFF08\u4ECEglobalState\uFF09\n   */\n  private async loadInstalledSkills(): Promise<void> {\n    const saved = this.context.globalState.get<InstalledSkill[]>(STORAGE_KEY) || [];\n\n    for (const skill of saved) {\n      if (!fs.existsSync(skill.installPath)) continue;\n      \n      this.skills.set(skill.manifest.id, skill);\n\n      if (skill.status === 'active') {\n        try {\n          await this.initializeSkill(skill);\n        } catch (err) {\n          console.error(`\u521D\u59CB\u5316skill\u5931\u8D25 ${skill.manifest.id}:`, err);\n          this.updateStatus(skill.manifest.id, 'error', String(err));\n        }\n      }\n    }\n  }\n\n  private async saveSkills(): Promise<void> {\n    // \u53EA\u4FDD\u5B58\u7528\u6237\u5B89\u88C5\u7684skill\uFF08\u5185\u7F6E\u7684\u4E0D\u9700\u8981\u4FDD\u5B58\uFF09\n    const userSkills = Array.from(this.skills.values())\n      .filter(s => s.installedAt > 0);\n    await this.context.globalState.update(STORAGE_KEY, userSkills);\n  }\n\n  // ========== \u5B89\u88C5\u65B9\u6CD5 ==========\n\n  async installFromLocal(\n    localPath: string,\n    options: SkillInstallOptions = {}\n  ): Promise<{ success: boolean; skill?: InstalledSkill; error?: string }> {\n    try {\n      const loadResult = await this.loader.loadFromDirectory(localPath);\n      if (!loadResult.success || !loadResult.manifest) {\n        return { success: false, error: loadResult.error || '\u52A0\u8F7D\u5931\u8D25' };\n      }\n\n      const manifest = loadResult.manifest;\n\n      if (this.skills.has(manifest.id) && !options.overwrite) {\n        return { success: false, error: `Skill \"${manifest.id}\" \u5DF2\u5B89\u88C5` };\n      }\n\n      const targetDir = path.join(this.skillsDir, manifest.id);\n      await this.copyDirectory(localPath, targetDir);\n\n      const skill: InstalledSkill = {\n        manifest,\n        installPath: targetDir,\n        installedAt: Date.now(),\n        status: options.autoEnable !== false ? 'active' : 'installed',\n        userConfig: options.config || {},\n        source: { type: 'local', localPath },\n      };\n\n      this.skills.set(manifest.id, skill);\n      await this.saveSkills();\n\n      if (skill.status === 'active') {\n        await this.initializeSkill(skill);\n      }\n\n      this._onSkillInstalled.fire(skill);\n      return { success: true, skill };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  async installFromGit(\n    repoUrl: string,\n    options: SkillInstallOptions & { branch?: string } = {}\n  ): Promise<{ success: boolean; skill?: InstalledSkill; error?: string }> {\n    const tempDir = path.join(this.skillsDir, '.temp_' + Date.now());\n\n    try {\n      fs.mkdirSync(tempDir, { recursive: true });\n\n      const loadResult = await this.loader.loadFromGit(repoUrl, tempDir, options.branch);\n      if (!loadResult.success || !loadResult.manifest) {\n        return { success: false, error: loadResult.error || '\u514B\u9686\u5931\u8D25' };\n      }\n\n      const manifest = loadResult.manifest;\n\n      if (this.skills.has(manifest.id) && !options.overwrite) {\n        return { success: false, error: `Skill \"${manifest.id}\" \u5DF2\u5B89\u88C5` };\n      }\n\n      const targetDir = path.join(this.skillsDir, manifest.id);\n      if (fs.existsSync(targetDir)) {\n        fs.rmSync(targetDir, { recursive: true });\n      }\n      fs.renameSync(tempDir, targetDir);\n\n      const skill: InstalledSkill = {\n        manifest,\n        installPath: targetDir,\n        installedAt: Date.now(),\n        status: options.autoEnable !== false ? 'active' : 'installed',\n        userConfig: options.config || {},\n        source: { type: 'git', url: repoUrl, branch: options.branch },\n      };\n\n      this.skills.set(manifest.id, skill);\n      await this.saveSkills();\n\n      if (skill.status === 'active') {\n        await this.initializeSkill(skill);\n      }\n\n      this._onSkillInstalled.fire(skill);\n      return { success: true, skill };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    } finally {\n      if (fs.existsSync(tempDir)) {\n        fs.rmSync(tempDir, { recursive: true });\n      }\n    }\n  }\n\n  async installFromUrl(\n    url: string,\n    options: SkillInstallOptions = {}\n  ): Promise<{ success: boolean; skill?: InstalledSkill; error?: string }> {\n    const tempDir = path.join(this.skillsDir, '.temp_' + Date.now());\n\n    try {\n      fs.mkdirSync(tempDir, { recursive: true });\n\n      const loadResult = await this.loader.loadFromUrl(url, tempDir);\n      if (!loadResult.success || !loadResult.manifest) {\n        return { success: false, error: loadResult.error || '\u4E0B\u8F7D\u5931\u8D25' };\n      }\n\n      const manifest = loadResult.manifest;\n\n      if (this.skills.has(manifest.id) && !options.overwrite) {\n        return { success: false, error: `Skill \"${manifest.id}\" \u5DF2\u5B89\u88C5` };\n      }\n\n      const manifestPath = this.findFile(tempDir, 'manifest.json');\n      const skillSourceDir = manifestPath ? path.dirname(manifestPath) : tempDir;\n\n      const targetDir = path.join(this.skillsDir, manifest.id);\n      if (fs.existsSync(targetDir)) {\n        fs.rmSync(targetDir, { recursive: true });\n      }\n      await this.copyDirectory(skillSourceDir, targetDir);\n\n      const skill: InstalledSkill = {\n        manifest,\n        installPath: targetDir,\n        installedAt: Date.now(),\n        status: options.autoEnable !== false ? 'active' : 'installed',\n        userConfig: options.config || {},\n        source: { type: 'url', url },\n      };\n\n      this.skills.set(manifest.id, skill);\n      await this.saveSkills();\n\n      if (skill.status === 'active') {\n        await this.initializeSkill(skill);\n      }\n\n      this._onSkillInstalled.fire(skill);\n      return { success: true, skill };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    } finally {\n      if (fs.existsSync(tempDir)) {\n        fs.rmSync(tempDir, { recursive: true });\n      }\n    }\n  }\n\n  // ========== \u7BA1\u7406\u65B9\u6CD5 ==========\n\n  async uninstall(skillId: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      const skill = this.skills.get(skillId);\n      if (!skill) {\n        return { success: false, error: `Skill \"${skillId}\" \u672A\u627E\u5230` };\n      }\n\n      // \u5185\u7F6Eskill\u4E0D\u5141\u8BB8\u5378\u8F7D\n      if (skill.installedAt === 0) {\n        return { success: false, error: `\u5185\u7F6ESkill \"${skillId}\" \u4E0D\u80FD\u5378\u8F7D\uFF0C\u53EA\u80FD\u7981\u7528` };\n      }\n\n      await this.bridgeFactory.removeBridge(skillId);\n      this.executor.cancel(skillId);\n\n      if (fs.existsSync(skill.installPath)) {\n        fs.rmSync(skill.installPath, { recursive: true });\n      }\n\n      this.skills.delete(skillId);\n      await this.saveSkills();\n\n      this._onSkillUninstalled.fire(skillId);\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  async enable(skillId: string): Promise<{ success: boolean; error?: string }> {\n    const skill = this.skills.get(skillId);\n    if (!skill) return { success: false, error: `Skill \"${skillId}\" \u672A\u627E\u5230` };\n\n    try {\n      await this.initializeSkill(skill);\n      await this.updateStatus(skillId, 'active');\n      return { success: true };\n    } catch (error) {\n      await this.updateStatus(skillId, 'error', String(error));\n      return { success: false, error: String(error) };\n    }\n  }\n\n  async disable(skillId: string): Promise<{ success: boolean; error?: string }> {\n    const skill = this.skills.get(skillId);\n    if (!skill) return { success: false, error: `Skill \"${skillId}\" \u672A\u627E\u5230` };\n\n    try {\n      await this.bridgeFactory.removeBridge(skillId);\n      this.executor.cancel(skillId);\n      await this.updateStatus(skillId, 'disabled');\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  async execute(skillId: string, params?: Record<string, any>): Promise<SkillResult> {\n    const skill = this.skills.get(skillId);\n    if (!skill) return { success: false, error: `Skill \"${skillId}\" \u672A\u627E\u5230`, duration: 0 };\n    if (skill.status !== 'active') return { success: false, error: `Skill \"${skillId}\" \u672A\u6FC0\u6D3B`, duration: 0 };\n    return this.executor.execute(skill, params);\n  }\n\n  async update(skillId: string): Promise<{ success: boolean; error?: string }> {\n    const skill = this.skills.get(skillId);\n    if (!skill) return { success: false, error: `Skill \"${skillId}\" \u672A\u627E\u5230` };\n\n    const source = skill.source;\n    switch (source.type) {\n      case 'git':\n        return this.installFromGit(source.url!, { branch: source.branch, overwrite: true, config: skill.userConfig });\n      case 'url':\n        return this.installFromUrl(source.url!, { overwrite: true, config: skill.userConfig });\n      case 'local':\n        return this.installFromLocal(source.localPath!, { overwrite: true, config: skill.userConfig });\n      default:\n        return { success: false, error: '\u4E0D\u652F\u6301\u7684\u6765\u6E90\u7C7B\u578B' };\n    }\n  }\n\n  // ========== \u67E5\u8BE2\u65B9\u6CD5 ==========\n\n  getInstalledSkills(): InstalledSkill[] {\n    return Array.from(this.skills.values());\n  }\n\n  getActiveSkills(): InstalledSkill[] {\n    return Array.from(this.skills.values()).filter(s => s.status === 'active');\n  }\n\n  getSkill(skillId: string): InstalledSkill | undefined {\n    return this.skills.get(skillId);\n  }\n\n  async getSkillMarkdown(skillId: string): Promise<SkillMarkdown | null> {\n    const skill = this.skills.get(skillId);\n    if (!skill) return null;\n    const loadResult = await this.loader.loadFromDirectory(skill.installPath);\n    return loadResult.markdown || null;\n  }\n\n  async updateConfig(skillId: string, config: Record<string, any>): Promise<{ success: boolean }> {\n    const skill = this.skills.get(skillId);\n    if (!skill) return { success: false };\n    skill.userConfig = { ...skill.userConfig, ...config };\n    skill.updatedAt = Date.now();\n    await this.saveSkills();\n    return { success: true };\n  }\n\n  // ========== \u7BA1\u7406UI\u547D\u4EE4 ==========\n\n  /**\n   * \u6CE8\u518CVSCode\u547D\u4EE4\uFF08\u5728extension.ts\u4E2D\u8C03\u7528\uFF09\n   */\n  registerCommands(context: vscode.ExtensionContext): void {\n    context.subscriptions.push(\n      vscode.commands.registerCommand('aiAssistant.skill.install', () => this.showInstallDialog()),\n      vscode.commands.registerCommand('aiAssistant.skill.manage', () => this.showManageDialog()),\n      vscode.commands.registerCommand('aiAssistant.skill.create', () => this.showCreateDialog()),\n    );\n  }\n\n  /**\n   * Skill\u5B89\u88C5\u5BF9\u8BDD\u6846\n   */\n  private async showInstallDialog(): Promise<void> {\n    const source = await vscode.window.showQuickPick(\n      [\n        { label: '\uD83D\uDCC1 \u4ECE\u672C\u5730\u76EE\u5F55\u5B89\u88C5', description: '\u9009\u62E9\u5305\u542Bmanifest.json\u7684\u76EE\u5F55', value: 'local' },\n        { label: '\uD83D\uDD17 \u4ECEGit\u4ED3\u5E93\u5B89\u88C5', description: '\u8F93\u5165git clone\u5730\u5740', value: 'git' },\n        { label: '\uD83D\uDCE6 \u4ECEURL\u4E0B\u8F7D\u5B89\u88C5', description: '\u8F93\u5165skill\u5305zip\u4E0B\u8F7D\u94FE\u63A5', value: 'url' },\n      ],\n      { placeHolder: '\u9009\u62E9\u5B89\u88C5\u6765\u6E90' }\n    );\n\n    if (!source) return;\n\n    switch (source.value) {\n      case 'local': {\n        const uris = await vscode.window.showOpenDialog({\n          canSelectFolders: true, canSelectFiles: false,\n          openLabel: '\u9009\u62E9Skill\u76EE\u5F55',\n        });\n        if (uris?.[0]) {\n          const result = await this.installFromLocal(uris[0].fsPath);\n          this.showInstallResult(result);\n        }\n        break;\n      }\n      case 'git': {\n        const url = await vscode.window.showInputBox({\n          prompt: '\u8F93\u5165Git\u4ED3\u5E93\u5730\u5740',\n          placeHolder: 'https://github.com/user/skill-package.git',\n        });\n        if (url) {\n          const result = await this.installFromGit(url);\n          this.showInstallResult(result);\n        }\n        break;\n      }\n      case 'url': {\n        const url = await vscode.window.showInputBox({\n          prompt: '\u8F93\u5165Skill\u5305\u4E0B\u8F7D\u94FE\u63A5 (zip)',\n          placeHolder: 'https://example.com/skill-package.zip',\n        });\n        if (url) {\n          const result = await this.installFromUrl(url);\n          this.showInstallResult(result);\n        }\n        break;\n      }\n    }\n  }\n\n  /**\n   * Skill\u7BA1\u7406\u5BF9\u8BDD\u6846\n   */\n  private async showManageDialog(): Promise<void> {\n    const skills = this.getInstalledSkills();\n    if (skills.length === 0) {\n      vscode.window.showInformationMessage('\u6CA1\u6709\u5DF2\u5B89\u88C5\u7684skill');\n      return;\n    }\n\n    const items = skills.map(s => ({\n      label: `${s.status === 'active' ? '\u2705' : s.status === 'disabled' ? '\u23F8\uFE0F' : '\u274C'} ${s.manifest.name}`,\n      description: `v${s.manifest.version} - ${s.manifest.description}`,\n      detail: `ID: ${s.manifest.id} | \u6765\u6E90: ${s.source.type}${s.installedAt === 0 ? ' (\u5185\u7F6E)' : ''}`,\n      skill: s,\n    }));\n\n    const selected = await vscode.window.showQuickPick(items, {\n      placeHolder: '\u9009\u62E9\u8981\u7BA1\u7406\u7684skill',\n    });\n\n    if (!selected) return;\n\n    const actions = [\n      { label: selected.skill.status === 'active' ? '\u23F8\uFE0F \u7981\u7528' : '\u25B6\uFE0F \u542F\u7528', value: 'toggle' },\n      { label: '\uD83D\uDD04 \u66F4\u65B0', value: 'update' },\n      { label: '\u2139\uFE0F \u67E5\u770B\u8BE6\u60C5', value: 'info' },\n    ];\n\n    if (selected.skill.installedAt > 0) {\n      actions.push({ label: '\uD83D\uDDD1\uFE0F \u5378\u8F7D', value: 'uninstall' });\n    }\n\n    const action = await vscode.window.showQuickPick(actions, {\n      placeHolder: `\u7BA1\u7406 ${selected.skill.manifest.name}`,\n    });\n\n    if (!action) return;\n\n    switch (action.value) {\n      case 'toggle':\n        if (selected.skill.status === 'active') {\n          await this.disable(selected.skill.manifest.id);\n          vscode.window.showInformationMessage(`\u5DF2\u7981\u7528 ${selected.skill.manifest.name}`);\n        } else {\n          await this.enable(selected.skill.manifest.id);\n          vscode.window.showInformationMessage(`\u5DF2\u542F\u7528 ${selected.skill.manifest.name}`);\n        }\n        break;\n      case 'update':\n        const result = await this.update(selected.skill.manifest.id);\n        if (result.success) {\n          vscode.window.showInformationMessage(`\u5DF2\u66F4\u65B0 ${selected.skill.manifest.name}`);\n        } else {\n          vscode.window.showErrorMessage(`\u66F4\u65B0\u5931\u8D25: ${result.error}`);\n        }\n        break;\n      case 'info':\n        const md = await this.getSkillMarkdown(selected.skill.manifest.id);\n        if (md) {\n          const doc = await vscode.workspace.openTextDocument({ content: md.rawContent, language: 'markdown' });\n          await vscode.window.showTextDocument(doc, { preview: true });\n        }\n        break;\n      case 'uninstall':\n        const confirm = await vscode.window.showWarningMessage(\n          `\u786E\u5B9A\u8981\u5378\u8F7D ${selected.skill.manifest.name}?`, { modal: true }, '\u786E\u8BA4\u5378\u8F7D'\n        );\n        if (confirm === '\u786E\u8BA4\u5378\u8F7D') {\n          await this.uninstall(selected.skill.manifest.id);\n          vscode.window.showInformationMessage(`\u5DF2\u5378\u8F7D ${selected.skill.manifest.name}`);\n        }\n        break;\n    }\n  }\n\n  /**\n   * \u521B\u5EFA\u65B0skill\u5BF9\u8BDD\u6846\n   */\n  private async showCreateDialog(): Promise<void> {\n    const name = await vscode.window.showInputBox({\n      prompt: 'Skill\u540D\u79F0',\n      placeHolder: 'my-custom-skill',\n      validateInput: v => /^[a-zA-Z][a-zA-Z0-9_-]*$/.test(v) ? null : 'ID\u5FC5\u987B\u4EE5\u5B57\u6BCD\u5F00\u5934\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u6570\u5B57\u4E0B\u5212\u7EBF\u8FDE\u5B57\u7B26',\n    });\n\n    if (!name) return;\n\n    const uris = await vscode.window.showOpenDialog({\n      canSelectFolders: true, canSelectFiles: false,\n      openLabel: '\u9009\u62E9\u521B\u5EFA\u4F4D\u7F6E',\n    });\n\n    if (!uris?.[0]) return;\n\n    const targetDir = path.join(uris[0].fsPath, name);\n    // \u4F7F\u7528 extensionPath \u5B9A\u4F4D\u6A21\u677F\u76EE\u5F55\n    let templateDir = path.join(this.context.extensionPath, 'dist', 'resources', 'templates', 'example-skill');\n    if (!fs.existsSync(templateDir)) {\n      // \u517C\u5BB9\u5F00\u53D1\u6A21\u5F0F\n      templateDir = path.join(this.context.extensionPath, 'src', 'extension', 'skills', 'templates', 'example-skill');\n    }\n\n    try {\n      await this.copyDirectory(templateDir, targetDir);\n\n      // \u66F4\u65B0manifest\n      const manifestPath = path.join(targetDir, 'manifest.json');\n      const manifest = JSON.parse(fs.readFileSync(manifestPath, 'utf-8'));\n      manifest.id = name;\n      manifest.name = name;\n      manifest.description = `\u81EA\u5B9A\u4E49skill: ${name}`;\n      fs.writeFileSync(manifestPath, JSON.stringify(manifest, null, 2));\n\n      // \u6253\u5F00\u76EE\u5F55\n      const doc = await vscode.workspace.openTextDocument(manifestPath);\n      await vscode.window.showTextDocument(doc);\n\n      vscode.window.showInformationMessage(\n        `Skill \"${name}\" \u5DF2\u521B\u5EFA\u5728 ${targetDir}`,\n        '\u5B89\u88C5\u5230\u63D2\u4EF6'\n      ).then(async choice => {\n        if (choice === '\u5B89\u88C5\u5230\u63D2\u4EF6') {\n          const result = await this.installFromLocal(targetDir);\n          this.showInstallResult(result);\n        }\n      });\n    } catch (error) {\n      vscode.window.showErrorMessage(`\u521B\u5EFA\u5931\u8D25: ${error}`);\n    }\n  }\n\n  private showInstallResult(result: { success: boolean; skill?: InstalledSkill; error?: string }): void {\n    if (result.success) {\n      vscode.window.showInformationMessage(`\u2705 Skill \"${result.skill!.manifest.name}\" \u5B89\u88C5\u6210\u529F`);\n    } else {\n      vscode.window.showErrorMessage(`\u274C \u5B89\u88C5\u5931\u8D25: ${result.error}`);\n    }\n  }\n\n  // ========== \u5185\u90E8\u65B9\u6CD5 ==========\n\n  private async initializeSkill(skill: InstalledSkill): Promise<void> {\n    const bridge = this.bridgeFactory.createBridge(skill);\n    await bridge.registerProvidedTools();\n    console.log(`[SkillManager] \u521D\u59CB\u5316skill: ${skill.manifest.id}`);\n  }\n\n  private async updateStatus(skillId: string, status: SkillStatus, error?: string): Promise<void> {\n    const skill = this.skills.get(skillId);\n    if (skill) {\n      skill.status = status;\n      skill.error = error;\n      skill.updatedAt = Date.now();\n      await this.saveSkills();\n      this._onSkillStatusChanged.fire({ id: skillId, status });\n    }\n  }\n\n  private async copyDirectory(src: string, dest: string): Promise<void> {\n    if (!fs.existsSync(dest)) {\n      fs.mkdirSync(dest, { recursive: true });\n    }\n    const entries = fs.readdirSync(src, { withFileTypes: true });\n    for (const entry of entries) {\n      const srcPath = path.join(src, entry.name);\n      const destPath = path.join(dest, entry.name);\n      if (entry.isDirectory()) {\n        await this.copyDirectory(srcPath, destPath);\n      } else {\n        fs.copyFileSync(srcPath, destPath);\n      }\n    }\n  }\n\n  private findFile(dir: string, filename: string): string | null {\n    const entries = fs.readdirSync(dir, { withFileTypes: true });\n    for (const entry of entries) {\n      const fullPath = path.join(dir, entry.name);\n      if (entry.isFile() && entry.name === filename) return fullPath;\n      if (entry.isDirectory() && !entry.name.startsWith('.')) {\n        const found = this.findFile(fullPath, filename);\n        if (found) return found;\n      }\n    }\n    return null;\n  }\n}\n", "/**\n * Skill\u5305\u52A0\u8F7D\u5668\n * \n * \u8D1F\u8D23\u52A0\u8F7D\u3001\u89E3\u6790\u548C\u9A8C\u8BC1skill\u5305\n */\n\nimport * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { SkillManifest, SkillMarkdown, SkillSource } from './types';\n\nexport class SkillLoader {\n  private static instance: SkillLoader | null = null;\n\n  static getInstance(): SkillLoader {\n    if (!SkillLoader.instance) {\n      SkillLoader.instance = new SkillLoader();\n    }\n    return SkillLoader.instance;\n  }\n\n  /**\n   * \u4ECE\u76EE\u5F55\u52A0\u8F7Dskill\u5305\n   */\n  async loadFromDirectory(dirPath: string): Promise<{\n    success: boolean;\n    manifest?: SkillManifest;\n    markdown?: SkillMarkdown;\n    error?: string;\n  }> {\n    try {\n      if (!fs.existsSync(dirPath)) {\n        return { success: false, error: `\u76EE\u5F55\u4E0D\u5B58\u5728: ${dirPath}` };\n      }\n\n      // \u8BFB\u53D6 manifest.json\n      const manifestPath = path.join(dirPath, 'manifest.json');\n      if (!fs.existsSync(manifestPath)) {\n        return { success: false, error: 'manifest.json \u6587\u4EF6\u4E0D\u5B58\u5728' };\n      }\n\n      const manifestContent = fs.readFileSync(manifestPath, 'utf-8');\n      const manifest = JSON.parse(manifestContent) as SkillManifest;\n\n      // \u9A8C\u8BC1\u6E05\u5355\n      const validation = this.validateManifest(manifest);\n      if (!validation.valid) {\n        return { success: false, error: validation.error };\n      }\n\n      // \u8BFB\u53D6 SKILL.md\n      const skillFilePath = path.join(dirPath, manifest.skillFile || 'SKILL.md');\n      let markdown: SkillMarkdown | undefined;\n\n      if (fs.existsSync(skillFilePath)) {\n        const rawContent = fs.readFileSync(skillFilePath, 'utf-8');\n        markdown = this.parseSkillMarkdown(rawContent);\n      }\n\n      return { success: true, manifest, markdown };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '\u52A0\u8F7D\u5931\u8D25',\n      };\n    }\n  }\n\n  /**\n   * \u4ECEGit\u4ED3\u5E93\u514B\u9686skill\u5305\n   */\n  async loadFromGit(\n    repoUrl: string,\n    targetDir: string,\n    branch?: string\n  ): Promise<{\n    success: boolean;\n    manifest?: SkillManifest;\n    markdown?: SkillMarkdown;\n    error?: string;\n  }> {\n    try {\n      // \u786E\u4FDD\u76EE\u6807\u76EE\u5F55\u5B58\u5728\n      if (!fs.existsSync(targetDir)) {\n        fs.mkdirSync(targetDir, { recursive: true });\n      }\n\n      // \u4F7F\u7528git clone\n      const { execSync } = require('child_process');\n      const branchArg = branch ? `-b ${branch}` : '';\n\n      execSync(`git clone ${branchArg} --depth 1 \"${repoUrl}\" \"${targetDir}\"`, {\n        stdio: 'pipe',\n        timeout: 120000,\n      });\n\n      return this.loadFromDirectory(targetDir);\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '\u514B\u9686\u4ED3\u5E93\u5931\u8D25',\n      };\n    }\n  }\n\n  /**\n   * \u4ECEURL\u4E0B\u8F7Dskill\u5305\uFF08zip\u683C\u5F0F\uFF09\n   */\n  async loadFromUrl(\n    url: string,\n    targetDir: string\n  ): Promise<{\n    success: boolean;\n    manifest?: SkillManifest;\n    markdown?: SkillMarkdown;\n    error?: string;\n  }> {\n    try {\n      const https = require('https');\n      const http = require('http');\n\n      if (!fs.existsSync(targetDir)) {\n        fs.mkdirSync(targetDir, { recursive: true });\n      }\n\n      const tempZipPath = path.join(targetDir, '_temp_skill.zip');\n\n      // \u4E0B\u8F7D\u6587\u4EF6\n      await new Promise<void>((resolve, reject) => {\n        const protocol = url.startsWith('https') ? https : http;\n        const file = fs.createWriteStream(tempZipPath);\n\n        const request = protocol.get(url, (response: any) => {\n          // \u5904\u7406\u91CD\u5B9A\u5411\n          if (response.statusCode === 301 || response.statusCode === 302) {\n            file.close();\n            fs.unlinkSync(tempZipPath);\n            this.loadFromUrl(response.headers.location, targetDir)\n              .then(() => resolve())\n              .catch(reject);\n            return;\n          }\n\n          response.pipe(file);\n          file.on('finish', () => {\n            file.close();\n            resolve();\n          });\n        });\n\n        request.on('error', (err: Error) => {\n          file.close();\n          fs.unlinkSync(tempZipPath);\n          reject(err);\n        });\n\n        request.setTimeout(60000, () => {\n          request.destroy();\n          reject(new Error('\u4E0B\u8F7D\u8D85\u65F6'));\n        });\n      });\n\n      // \u89E3\u538B\n      const AdmZip = require('adm-zip');\n      const zip = new AdmZip(tempZipPath);\n      zip.extractAllTo(targetDir, true);\n\n      // \u5220\u9664\u4E34\u65F6\u6587\u4EF6\n      fs.unlinkSync(tempZipPath);\n\n      // \u67E5\u627Emanifest.json\uFF08\u53EF\u80FD\u5728\u5B50\u76EE\u5F55\u4E2D\uFF09\n      const manifestPath = this.findFile(targetDir, 'manifest.json');\n      if (!manifestPath) {\n        return { success: false, error: '\u538B\u7F29\u5305\u4E2D\u672A\u627E\u5230 manifest.json' };\n      }\n\n      return this.loadFromDirectory(path.dirname(manifestPath));\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '\u4E0B\u8F7D\u5931\u8D25',\n      };\n    }\n  }\n\n  /**\n   * \u9A8C\u8BC1\u6E05\u5355\u6587\u4EF6\n   */\n  validateManifest(manifest: SkillManifest): { valid: boolean; error?: string } {\n    if (!manifest.id) {\n      return { valid: false, error: '\u7F3A\u5C11\u5FC5\u586B\u5B57\u6BB5: id' };\n    }\n\n    if (!/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(manifest.id)) {\n      return { valid: false, error: 'id \u683C\u5F0F\u65E0\u6548\uFF0C\u5FC5\u987B\u4EE5\u5B57\u6BCD\u5F00\u5934\uFF0C\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u548C\u8FDE\u5B57\u7B26' };\n    }\n\n    if (!manifest.name) {\n      return { valid: false, error: '\u7F3A\u5C11\u5FC5\u586B\u5B57\u6BB5: name' };\n    }\n\n    if (!manifest.version) {\n      return { valid: false, error: '\u7F3A\u5C11\u5FC5\u586B\u5B57\u6BB5: version' };\n    }\n\n    if (!manifest.description) {\n      return { valid: false, error: '\u7F3A\u5C11\u5FC5\u586B\u5B57\u6BB5: description' };\n    }\n\n    // \u9A8C\u8BC1\u8FD0\u884C\u65F6\n    const validRuntimes = ['node', 'python', 'shell', 'builtin'];\n    if (manifest.runtime && !validRuntimes.includes(manifest.runtime)) {\n      return { valid: false, error: `\u65E0\u6548\u7684\u8FD0\u884C\u65F6: ${manifest.runtime}` };\n    }\n\n    return { valid: true };\n  }\n\n  /**\n   * \u89E3\u6790SKILL.md\u6587\u4EF6\n   */\n  parseSkillMarkdown(content: string): SkillMarkdown {\n    const sections: Record<string, string> = {};\n    const lines = content.split('\\n');\n\n    let currentSection = 'description';\n    let currentContent: string[] = [];\n    let title = '';\n\n    for (const line of lines) {\n      // \u68C0\u6D4B\u4E00\u7EA7\u6807\u9898\n      const h1Match = line.match(/^#\\s+(.+)$/);\n      if (h1Match && !title) {\n        title = h1Match[1].trim();\n        continue;\n      }\n\n      // \u68C0\u6D4B\u4E8C\u7EA7\u6807\u9898\n      const h2Match = line.match(/^##\\s+(.+)$/);\n      if (h2Match) {\n        if (currentContent.length > 0) {\n          sections[currentSection] = currentContent.join('\\n').trim();\n        }\n        currentSection = this.normalizeSectionName(h2Match[1].trim());\n        currentContent = [];\n        continue;\n      }\n\n      currentContent.push(line);\n    }\n\n    // \u4FDD\u5B58\u6700\u540E\u4E00\u4E2Asection\n    if (currentContent.length > 0) {\n      sections[currentSection] = currentContent.join('\\n').trim();\n    }\n\n    // \u63D0\u53D6\u793A\u4F8B\n    const examples: string[] = [];\n    const exampleContent = sections['examples'] || sections['usage'] || '';\n    const codeBlocks = exampleContent.match(/```[\\s\\S]*?```/g);\n    if (codeBlocks) {\n      examples.push(...codeBlocks.map(b => b.replace(/```\\w*\\n?/g, '').trim()));\n    }\n\n    return {\n      title: title || 'Untitled Skill',\n      description: sections['description']?.split('\\n\\n')[0] || '',\n      usage: sections['usage'] || sections['\u4F7F\u7528\u8BF4\u660E'],\n      examples,\n      aiPrompt: sections['ai-prompt'] || sections['prompt'] || sections['ai\u63D0\u793A\u8BCD'],\n      configuration: sections['configuration'] || sections['config'] || sections['\u914D\u7F6E'],\n      rawContent: content,\n      sections,\n    };\n  }\n\n  /**\n   * \u89C4\u8303\u5316section\u540D\u79F0\n   */\n  private normalizeSectionName(name: string): string {\n    const mapping: Record<string, string> = {\n      '\u63CF\u8FF0': 'description',\n      '\u4F7F\u7528\u8BF4\u660E': 'usage',\n      '\u7528\u6CD5': 'usage',\n      '\u793A\u4F8B': 'examples',\n      '\u4F8B\u5B50': 'examples',\n      '\u914D\u7F6E': 'configuration',\n      'ai\u63D0\u793A\u8BCD': 'ai-prompt',\n      '\u63D0\u793A\u8BCD': 'ai-prompt',\n    };\n\n    const lower = name.toLowerCase();\n    return mapping[lower] || lower.replace(/\\s+/g, '-');\n  }\n\n  /**\n   * \u5728\u76EE\u5F55\u4E2D\u67E5\u627E\u6587\u4EF6\n   */\n  private findFile(dir: string, filename: string, maxDepth = 2): string | null {\n    const search = (currentDir: string, depth: number): string | null => {\n      if (depth > maxDepth) return null;\n\n      const filePath = path.join(currentDir, filename);\n      if (fs.existsSync(filePath)) {\n        return filePath;\n      }\n\n      const entries = fs.readdirSync(currentDir, { withFileTypes: true });\n      for (const entry of entries) {\n        if (entry.isDirectory() && !entry.name.startsWith('.')) {\n          const found = search(path.join(currentDir, entry.name), depth + 1);\n          if (found) return found;\n        }\n      }\n\n      return null;\n    };\n\n    return search(dir, 0);\n  }\n\n  /**\n   * \u5217\u51FAskill\u76EE\u5F55\u4E2D\u7684\u811A\u672C\u6587\u4EF6\n   */\n  listScripts(skillDir: string): string[] {\n    const scriptsDir = path.join(skillDir, 'scripts');\n    if (!fs.existsSync(scriptsDir)) return [];\n\n    const scripts: string[] = [];\n    const entries = fs.readdirSync(scriptsDir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      if (entry.isFile()) {\n        const ext = path.extname(entry.name).toLowerCase();\n        if (['.js', '.ts', '.py', '.sh'].includes(ext)) {\n          scripts.push(path.join(scriptsDir, entry.name));\n        }\n      }\n    }\n\n    return scripts;\n  }\n\n  /**\n   * \u5217\u51FAskill\u76EE\u5F55\u4E2D\u7684\u8D44\u6E90\u6587\u4EF6\n   */\n  listResources(skillDir: string): string[] {\n    const srcDir = path.join(skillDir, 'src');\n    if (!fs.existsSync(srcDir)) return [];\n\n    const resources: string[] = [];\n\n    const scan = (dir: string) => {\n      const entries = fs.readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = path.join(dir, entry.name);\n        if (entry.isDirectory()) {\n          scan(fullPath);\n        } else {\n          resources.push(fullPath);\n        }\n      }\n    };\n\n    scan(srcDir);\n    return resources;\n  }\n}\n", "/**\n * Skill\u5305\u6267\u884C\u5668\n * \n * \u8D1F\u8D23\u6267\u884Cskill\u5305\u4E2D\u7684\u811A\u672C\uFF0C\u652F\u6301\u591A\u79CD\u8FD0\u884C\u65F6\n */\n\nimport * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { spawn, ChildProcess, execSync } from 'child_process';\nimport {\n  InstalledSkill,\n  SkillContext,\n  SkillResult,\n  SkillRuntime,\n} from './types';\nimport { SkillMCPBridgeImpl, SkillMCPBridgeFactory } from './SkillMCPBridge';\n\nexport class SkillExecutor {\n  private static instance: SkillExecutor | null = null;\n  private context: vscode.ExtensionContext;\n  private bridgeFactory: SkillMCPBridgeFactory;\n  private runningProcesses: Map<string, ChildProcess> = new Map();\n\n  private constructor(context: vscode.ExtensionContext) {\n    this.context = context;\n    this.bridgeFactory = SkillMCPBridgeFactory.getInstance();\n  }\n\n  static getInstance(context: vscode.ExtensionContext): SkillExecutor {\n    if (!SkillExecutor.instance) {\n      SkillExecutor.instance = new SkillExecutor(context);\n    }\n    return SkillExecutor.instance;\n  }\n\n  /**\n   * \u6267\u884Cskill\n   */\n  async execute(\n    skill: InstalledSkill,\n    params?: Record<string, any>,\n    workspaceContext?: {\n      workspaceRoot?: string;\n      activeFile?: string;\n      selectedCode?: string;\n    }\n  ): Promise<SkillResult> {\n    const startTime = Date.now();\n    const logs: SkillResult['logs'] = [];\n    const mcpCalls: SkillResult['mcpCalls'] = [];\n\n    const log = (message: string, level: 'info' | 'warn' | 'error' = 'info') => {\n      logs.push({ level, message, timestamp: Date.now() });\n      console.log(`[Skill:${skill.manifest.id}] [${level}] ${message}`);\n    };\n\n    try {\n      log(`\u5F00\u59CB\u6267\u884Cskill: ${skill.manifest.name}`);\n\n      // \u83B7\u53D6MCP\u6865\u63A5\n      const bridge = this.bridgeFactory.createBridge(skill);\n\n      // \u5305\u88C5MCP\u6865\u63A5\u4EE5\u8BB0\u5F55\u8C03\u7528\n      const wrappedBridge = {\n        call: async (toolId: string, toolParams: Record<string, any>) => {\n          const result = await bridge.call(toolId, toolParams);\n          mcpCalls.push({ toolId, params: toolParams, result });\n          return result;\n        },\n        listTools: () => bridge.listTools(),\n        registerTool: (tool: any) => bridge.registerTool(tool),\n        unregisterTool: (toolId: string) => bridge.unregisterTool(toolId),\n      };\n\n      // \u521B\u5EFA\u6267\u884C\u4E0A\u4E0B\u6587\n      const execContext: SkillContext = {\n        skill,\n        workspaceRoot: workspaceContext?.workspaceRoot || \n          vscode.workspace.workspaceFolders?.[0]?.uri.fsPath,\n        activeFile: workspaceContext?.activeFile || \n          vscode.window.activeTextEditor?.document.fileName,\n        selectedCode: workspaceContext?.selectedCode,\n        params,\n        mcp: wrappedBridge,\n        log,\n        progress: (percent, message) => {\n          log(`\u8FDB\u5EA6: ${percent}%${message ? ` - ${message}` : ''}`, 'info');\n        },\n      };\n\n      // \u6839\u636E\u8FD0\u884C\u65F6\u6267\u884C\n      const runtime = skill.manifest.runtime || 'node';\n      let output: any;\n\n      switch (runtime) {\n        case 'node':\n          output = await this.executeNode(skill, execContext);\n          break;\n        case 'python':\n          output = await this.executePython(skill, execContext);\n          break;\n        case 'shell':\n          output = await this.executeShell(skill, execContext);\n          break;\n        case 'builtin':\n          output = await this.executeBuiltin(skill, execContext);\n          break;\n        default:\n          throw new Error(`\u4E0D\u652F\u6301\u7684\u8FD0\u884C\u65F6: ${runtime}`);\n      }\n\n      log('\u6267\u884C\u5B8C\u6210');\n\n      return {\n        success: true,\n        output,\n        logs,\n        mcpCalls,\n        duration: Date.now() - startTime,\n      };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF';\n      log(`\u6267\u884C\u5931\u8D25: ${errorMessage}`, 'error');\n\n      return {\n        success: false,\n        error: errorMessage,\n        logs,\n        mcpCalls,\n        duration: Date.now() - startTime,\n      };\n    }\n  }\n\n  /**\n   * \u6267\u884CNode.js\u811A\u672C\n   */\n  private async executeNode(\n    skill: InstalledSkill,\n    context: SkillContext\n  ): Promise<any> {\n    const mainScript = skill.manifest.main || 'scripts/main.js';\n    const scriptPath = path.join(skill.installPath, mainScript);\n\n    if (!fs.existsSync(scriptPath)) {\n      throw new Error(`\u4E3B\u811A\u672C\u4E0D\u5B58\u5728: ${scriptPath}`);\n    }\n\n    // \u5904\u7406TypeScript\n    if (scriptPath.endsWith('.ts')) {\n      return this.executeTypeScript(skill, context, scriptPath);\n    }\n\n    // \u52A8\u6001\u52A0\u8F7D\u5E76\u6267\u884C\n    const vm = require('vm');\n    const scriptContent = fs.readFileSync(scriptPath, 'utf-8');\n\n    // \u521B\u5EFA\u5B89\u5168\u7684\u6267\u884C\u73AF\u5883\n    const sandbox = this.createSandbox(context);\n\n    const script = new vm.Script(`\n      (async function(context) {\n        ${scriptContent}\n        if (typeof execute === 'function') {\n          return await execute(context);\n        } else if (typeof main === 'function') {\n          return await main(context);\n        } else if (typeof module !== 'undefined' && module.exports) {\n          const exp = module.exports;\n          if (typeof exp === 'function') return await exp(context);\n          if (typeof exp.execute === 'function') return await exp.execute(context);\n          if (typeof exp.default === 'function') return await exp.default(context);\n        }\n        throw new Error('\u672A\u627E\u5230\u53EF\u6267\u884C\u7684\u51FD\u6570 (execute, main, \u6216 module.exports)');\n      })\n    `);\n\n    const execute = script.runInNewContext(sandbox);\n    return execute(context);\n  }\n\n  /**\n   * \u6267\u884CTypeScript\u811A\u672C\n   */\n  private async executeTypeScript(\n    skill: InstalledSkill,\n    context: SkillContext,\n    scriptPath: string\n  ): Promise<any> {\n    const jsPath = scriptPath.replace(/\\.ts$/, '.js');\n\n    // \u68C0\u67E5\u662F\u5426\u9700\u8981\u7F16\u8BD1\n    if (!fs.existsSync(jsPath) || \n        fs.statSync(scriptPath).mtime > fs.statSync(jsPath).mtime) {\n      try {\n        execSync(`npx tsc \"${scriptPath}\" --outDir \"${path.dirname(jsPath)}\"`, {\n          cwd: skill.installPath,\n          stdio: 'pipe',\n        });\n      } catch (error) {\n        throw new Error(`TypeScript\u7F16\u8BD1\u5931\u8D25: ${error}`);\n      }\n    }\n\n    // \u6267\u884C\u7F16\u8BD1\u540E\u7684JS\n    const updatedSkill = {\n      ...skill,\n      manifest: {\n        ...skill.manifest,\n        main: skill.manifest.main?.replace(/\\.ts$/, '.js'),\n      },\n    };\n\n    return this.executeNode(updatedSkill, context);\n  }\n\n  /**\n   * \u6267\u884CPython\u811A\u672C\n   */\n  private async executePython(\n    skill: InstalledSkill,\n    context: SkillContext\n  ): Promise<any> {\n    const mainScript = skill.manifest.main || 'scripts/main.py';\n    const scriptPath = path.join(skill.installPath, mainScript);\n\n    if (!fs.existsSync(scriptPath)) {\n      throw new Error(`\u4E3B\u811A\u672C\u4E0D\u5B58\u5728: ${scriptPath}`);\n    }\n\n    return new Promise((resolve, reject) => {\n      const contextJson = JSON.stringify({\n        workspaceRoot: context.workspaceRoot,\n        activeFile: context.activeFile,\n        selectedCode: context.selectedCode,\n        params: context.params,\n        skillId: skill.manifest.id,\n      });\n\n      const python = spawn('python', [scriptPath], {\n        cwd: skill.installPath,\n        env: {\n          ...process.env,\n          SKILL_CONTEXT: contextJson,\n          PYTHONPATH: skill.installPath,\n        },\n      });\n\n      this.runningProcesses.set(skill.manifest.id, python);\n\n      let stdout = '';\n      let stderr = '';\n\n      python.stdout.on('data', (data) => {\n        stdout += data.toString();\n        context.log(data.toString().trim(), 'info');\n      });\n\n      python.stderr.on('data', (data) => {\n        stderr += data.toString();\n        context.log(data.toString().trim(), 'error');\n      });\n\n      python.on('close', (code) => {\n        this.runningProcesses.delete(skill.manifest.id);\n\n        if (code === 0) {\n          try {\n            const lastLine = stdout.trim().split('\\n').pop() || '';\n            resolve(JSON.parse(lastLine));\n          } catch {\n            resolve(stdout);\n          }\n        } else {\n          reject(new Error(`Python\u811A\u672C\u9000\u51FA\u7801 ${code}: ${stderr}`));\n        }\n      });\n\n      python.on('error', (error) => {\n        this.runningProcesses.delete(skill.manifest.id);\n        reject(error);\n      });\n    });\n  }\n\n  /**\n   * \u6267\u884CShell\u811A\u672C\n   */\n  private async executeShell(\n    skill: InstalledSkill,\n    context: SkillContext\n  ): Promise<any> {\n    const mainScript = skill.manifest.main || 'scripts/main.sh';\n    const scriptPath = path.join(skill.installPath, mainScript);\n\n    if (!fs.existsSync(scriptPath)) {\n      throw new Error(`\u4E3B\u811A\u672C\u4E0D\u5B58\u5728: ${scriptPath}`);\n    }\n\n    return new Promise((resolve, reject) => {\n      const shell = process.platform === 'win32' ? 'powershell.exe' : 'bash';\n      const args = process.platform === 'win32' ? ['-File', scriptPath] : [scriptPath];\n\n      const proc = spawn(shell, args, {\n        cwd: skill.installPath,\n        env: {\n          ...process.env,\n          WORKSPACE_ROOT: context.workspaceRoot || '',\n          ACTIVE_FILE: context.activeFile || '',\n          SELECTED_CODE: context.selectedCode || '',\n          SKILL_ID: skill.manifest.id,\n          SKILL_PARAMS: JSON.stringify(context.params || {}),\n        },\n      });\n\n      this.runningProcesses.set(skill.manifest.id, proc);\n\n      let stdout = '';\n      let stderr = '';\n\n      proc.stdout.on('data', (data) => {\n        stdout += data.toString();\n        context.log(data.toString().trim(), 'info');\n      });\n\n      proc.stderr.on('data', (data) => {\n        stderr += data.toString();\n        context.log(data.toString().trim(), 'error');\n      });\n\n      proc.on('close', (code) => {\n        this.runningProcesses.delete(skill.manifest.id);\n\n        if (code === 0) {\n          resolve(stdout);\n        } else {\n          reject(new Error(`Shell\u811A\u672C\u9000\u51FA\u7801 ${code}: ${stderr}`));\n        }\n      });\n\n      proc.on('error', (error) => {\n        this.runningProcesses.delete(skill.manifest.id);\n        reject(error);\n      });\n    });\n  }\n\n  /**\n   * \u6267\u884C\u5185\u7F6Eskill\n   */\n  private async executeBuiltin(\n    skill: InstalledSkill,\n    context: SkillContext\n  ): Promise<any> {\n    const mainScript = skill.manifest.main || 'scripts/main.js';\n    const scriptPath = path.join(skill.installPath, mainScript);\n\n    if (!fs.existsSync(scriptPath)) {\n      throw new Error(`\u4E3B\u811A\u672C\u4E0D\u5B58\u5728: ${scriptPath}`);\n    }\n\n    // \u76F4\u63A5require\u6267\u884C\n    const module = require(scriptPath);\n\n    if (typeof module.execute === 'function') {\n      return module.execute(context);\n    } else if (typeof module.default === 'function') {\n      return module.default(context);\n    } else if (typeof module === 'function') {\n      return module(context);\n    }\n\n    throw new Error('\u672A\u627E\u5230\u53EF\u6267\u884C\u51FD\u6570');\n  }\n\n  /**\n   * \u521B\u5EFA\u6C99\u7BB1\u73AF\u5883\n   */\n  private createSandbox(context: SkillContext): Record<string, any> {\n    return {\n      console: {\n        log: (...args: any[]) => context.log(args.join(' '), 'info'),\n        warn: (...args: any[]) => context.log(args.join(' '), 'warn'),\n        error: (...args: any[]) => context.log(args.join(' '), 'error'),\n        info: (...args: any[]) => context.log(args.join(' '), 'info'),\n      },\n      setTimeout,\n      setInterval,\n      clearTimeout,\n      clearInterval,\n      Promise,\n      Buffer,\n      JSON,\n      Math,\n      Date,\n      RegExp,\n      Array,\n      Object,\n      String,\n      Number,\n      Boolean,\n      Map,\n      Set,\n      Error,\n      URL,\n      module: { exports: {} },\n      exports: {},\n      require: this.createSafeRequire(context.skill.installPath),\n    };\n  }\n\n  /**\n   * \u521B\u5EFA\u5B89\u5168\u7684require\u51FD\u6570\n   */\n  private createSafeRequire(skillPath: string): (module: string) => any {\n    const allowedModules = ['path', 'fs', 'url', 'util', 'crypto', 'zlib'];\n\n    return (moduleName: string) => {\n      if (allowedModules.includes(moduleName)) {\n        return require(moduleName);\n      }\n\n      // \u5141\u8BB8skill\u76EE\u5F55\u4E0B\u7684\u6A21\u5757\n      if (moduleName.startsWith('./') || moduleName.startsWith('../')) {\n        const resolvedPath = path.resolve(skillPath, moduleName);\n        if (resolvedPath.startsWith(skillPath)) {\n          return require(resolvedPath);\n        }\n      }\n\n      // \u5141\u8BB8skill\u7684node_modules\n      const nodeModulesPath = path.join(skillPath, 'node_modules', moduleName);\n      if (fs.existsSync(nodeModulesPath)) {\n        return require(nodeModulesPath);\n      }\n\n      throw new Error(`\u4E0D\u5141\u8BB8\u52A0\u8F7D\u6A21\u5757: ${moduleName}`);\n    };\n  }\n\n  /**\n   * \u53D6\u6D88skill\u6267\u884C\n   */\n  cancel(skillId: string): boolean {\n    const proc = this.runningProcesses.get(skillId);\n    if (proc) {\n      proc.kill('SIGTERM');\n      this.runningProcesses.delete(skillId);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * \u68C0\u67E5skill\u662F\u5426\u6B63\u5728\u6267\u884C\n   */\n  isRunning(skillId: string): boolean {\n    return this.runningProcesses.has(skillId);\n  }\n}\n", "/**\n * Skill MCP \u6865\u63A5\u5C42\n * \n * \u63D0\u4F9Bskill\u5305\u4E0EMCP\u7CFB\u7EDF\u4E4B\u95F4\u7684\u53CC\u5411\u901A\u4FE1\uFF1A\n * - \u8BA9skill\u53EF\u4EE5\u8C03\u7528MCP\u5DE5\u5177\n * - \u8BA9skill\u53EF\u4EE5\u6CE8\u518C\u81EA\u5DF1\u7684\u5DE5\u5177\u5230MCP\n */\n\nimport * as vscode from 'vscode';\nimport { SkillMCPBridge, SkillToolResult, InstalledSkill } from './types';\nimport { MCPRegistry, MCPExecutor, MCPToolDefinition } from '../../mcp';\n\n/**\n * Skill MCP \u6865\u63A5\u5668\u5B9E\u73B0\n */\nexport class SkillMCPBridgeImpl implements SkillMCPBridge {\n  private skill: InstalledSkill;\n  private registry: MCPRegistry;\n  private executor: MCPExecutor;\n  private registeredTools: Set<string> = new Set();\n\n  constructor(\n    skill: InstalledSkill,\n    registry: MCPRegistry,\n    executor: MCPExecutor\n  ) {\n    this.skill = skill;\n    this.registry = registry;\n    this.executor = executor;\n  }\n\n  /**\n   * \u8C03\u7528MCP\u5DE5\u5177\n   */\n  async call(toolId: string, params: Record<string, any>): Promise<SkillToolResult> {\n    const startTime = Date.now();\n\n    try {\n      // \u68C0\u67E5skill\u662F\u5426\u6709\u6743\u9650\u8C03\u7528\u6B64\u5DE5\u5177\n      const allowedTools = this.skill.manifest.mcpTools;\n      if (allowedTools && !allowedTools.includes(toolId) && !allowedTools.includes('*')) {\n        return {\n          success: false,\n          error: {\n            code: 'PERMISSION_DENIED',\n            message: `Skill \"${this.skill.manifest.name}\" \u65E0\u6743\u8C03\u7528\u5DE5\u5177 \"${toolId}\"`,\n          },\n          duration: Date.now() - startTime,\n        };\n      }\n\n      // \u68C0\u67E5\u5DE5\u5177\u662F\u5426\u5B58\u5728\n      const tool = this.registry.getTool(toolId);\n      if (!tool) {\n        return {\n          success: false,\n          error: {\n            code: 'TOOL_NOT_FOUND',\n            message: `\u5DE5\u5177 \"${toolId}\" \u4E0D\u5B58\u5728`,\n          },\n          duration: Date.now() - startTime,\n        };\n      }\n\n      // \u6267\u884C\u5DE5\u5177\n      const result = await this.executor.execute({\n        toolId,\n        arguments: params,\n        caller: 'agent', // skill\u4F5C\u4E3Aagent\u8EAB\u4EFD\u8C03\u7528\n        context: {\n          sessionId: `skill_${this.skill.manifest.id}`,\n        },\n      });\n\n      return {\n        success: result.success,\n        data: result.data,\n        error: result.error ? {\n          code: result.error.code,\n          message: result.error.message,\n        } : undefined,\n        duration: result.stats.duration,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: {\n          code: 'EXECUTION_ERROR',\n          message: error instanceof Error ? error.message : '\u672A\u77E5\u9519\u8BEF',\n        },\n        duration: Date.now() - startTime,\n      };\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u53EF\u7528\u5DE5\u5177\u5217\u8868\n   */\n  async listTools(): Promise<MCPToolDefinition[]> {\n    const allTools = this.registry.getAllTools();\n    const allowedTools = this.skill.manifest.mcpTools;\n\n    // \u5982\u679C\u6CA1\u6709\u9650\u5236\u6216\u5141\u8BB8\u6240\u6709\u5DE5\u5177\n    if (!allowedTools || allowedTools.includes('*')) {\n      return allTools.filter(t => t.enabled).map(t => t.tool);\n    }\n\n    // \u8FD4\u56DE\u5141\u8BB8\u7684\u5DE5\u5177\n    return allTools\n      .filter(t => t.enabled && allowedTools.includes(t.tool.id))\n      .map(t => t.tool);\n  }\n\n  /**\n   * \u6CE8\u518C\u5DE5\u5177\u5230MCP\n   */\n  async registerTool(tool: MCPToolDefinition): Promise<{ success: boolean; error?: string }> {\n    try {\n      // \u68C0\u67E5skill\u662F\u5426\u6709\u6743\u9650\u6CE8\u518C\u5DE5\u5177\n      const permissions = this.skill.manifest.permissions || [];\n      if (!permissions.includes('mcp:register')) {\n        return {\n          success: false,\n          error: `Skill \"${this.skill.manifest.name}\" \u6CA1\u6709\u6CE8\u518C\u5DE5\u5177\u7684\u6743\u9650`,\n        };\n      }\n\n      // \u6DFB\u52A0skill\u524D\u7F00\u907F\u514DID\u51B2\u7A81\n      const prefixedTool: MCPToolDefinition = {\n        ...tool,\n        id: `skill_${this.skill.manifest.id}_${tool.id}`,\n        description: `${tool.description} [\u6765\u81EA: ${this.skill.manifest.name}]`,\n        metadata: {\n          status: 'active',\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        },\n      };\n\n      const result = await this.registry.registerTool(prefixedTool, 'user');\n\n      if (result.success) {\n        this.registeredTools.add(prefixedTool.id);\n      }\n\n      return result;\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '\u6CE8\u518C\u5931\u8D25',\n      };\n    }\n  }\n\n  /**\n   * \u6CE8\u9500\u5DE5\u5177\n   */\n  async unregisterTool(toolId: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      const prefixedId = toolId.startsWith('skill_') \n        ? toolId \n        : `skill_${this.skill.manifest.id}_${toolId}`;\n\n      if (!this.registeredTools.has(prefixedId)) {\n        return {\n          success: false,\n          error: `\u5DE5\u5177 \"${toolId}\" \u4E0D\u662F\u7531\u6B64skill\u6CE8\u518C\u7684`,\n        };\n      }\n\n      const result = await this.registry.deleteTool(prefixedId);\n\n      if (result.success) {\n        this.registeredTools.delete(prefixedId);\n      }\n\n      return result;\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '\u6CE8\u9500\u5931\u8D25',\n      };\n    }\n  }\n\n  /**\n   * \u6CE8\u518Cskill\u6E05\u5355\u4E2D\u5B9A\u4E49\u7684\u6240\u6709\u5DE5\u5177\n   */\n  async registerProvidedTools(): Promise<{\n    success: boolean;\n    registered: string[];\n    errors: string[];\n  }> {\n    const registered: string[] = [];\n    const errors: string[] = [];\n\n    const providedTools = this.skill.manifest.providedTools;\n    if (!providedTools || providedTools.length === 0) {\n      return { success: true, registered, errors };\n    }\n\n    for (const tool of providedTools) {\n      const result = await this.registerTool(tool);\n      if (result.success) {\n        registered.push(tool.id);\n      } else {\n        errors.push(`${tool.id}: ${result.error}`);\n      }\n    }\n\n    return {\n      success: errors.length === 0,\n      registered,\n      errors,\n    };\n  }\n\n  /**\n   * \u6CE8\u9500\u6240\u6709\u7531\u6B64skill\u6CE8\u518C\u7684\u5DE5\u5177\n   */\n  async unregisterAllTools(): Promise<void> {\n    for (const toolId of this.registeredTools) {\n      await this.registry.deleteTool(toolId);\n    }\n    this.registeredTools.clear();\n  }\n\n  /**\n   * \u83B7\u53D6\u6B64skill\u6CE8\u518C\u7684\u5DE5\u5177\u5217\u8868\n   */\n  getRegisteredTools(): string[] {\n    return Array.from(this.registeredTools);\n  }\n}\n\n/**\n * Skill MCP \u6865\u63A5\u5DE5\u5382\n */\nexport class SkillMCPBridgeFactory {\n  private static instance: SkillMCPBridgeFactory | null = null;\n  private registry: MCPRegistry | null = null;\n  private executor: MCPExecutor | null = null;\n  private bridges: Map<string, SkillMCPBridgeImpl> = new Map();\n\n  static getInstance(): SkillMCPBridgeFactory {\n    if (!SkillMCPBridgeFactory.instance) {\n      SkillMCPBridgeFactory.instance = new SkillMCPBridgeFactory();\n    }\n    return SkillMCPBridgeFactory.instance;\n  }\n\n  /**\n   * \u521D\u59CB\u5316\u5DE5\u5382\n   */\n  initialize(registry: MCPRegistry, executor: MCPExecutor): void {\n    this.registry = registry;\n    this.executor = executor;\n  }\n\n  /**\n   * \u4E3Askill\u521B\u5EFA\u6865\u63A5\n   */\n  createBridge(skill: InstalledSkill): SkillMCPBridgeImpl {\n    if (!this.registry || !this.executor) {\n      throw new Error('SkillMCPBridgeFactory \u672A\u521D\u59CB\u5316');\n    }\n\n    const existing = this.bridges.get(skill.manifest.id);\n    if (existing) {\n      return existing;\n    }\n\n    const bridge = new SkillMCPBridgeImpl(skill, this.registry, this.executor);\n    this.bridges.set(skill.manifest.id, bridge);\n\n    return bridge;\n  }\n\n  /**\n   * \u83B7\u53D6skill\u7684\u6865\u63A5\n   */\n  getBridge(skillId: string): SkillMCPBridgeImpl | undefined {\n    return this.bridges.get(skillId);\n  }\n\n  /**\n   * \u79FB\u9664skill\u7684\u6865\u63A5\u5E76\u6CE8\u9500\u5176\u5DE5\u5177\n   */\n  async removeBridge(skillId: string): Promise<void> {\n    const bridge = this.bridges.get(skillId);\n    if (bridge) {\n      await bridge.unregisterAllTools();\n      this.bridges.delete(skillId);\n    }\n  }\n}\n", "import * as vscode from 'vscode';\nimport * as path from 'path';\n\n/**\n * \u4EE3\u7801\u7F16\u8F91\u64CD\u4F5C\u7C7B\u578B\n */\nexport type EditOperation = \n  | { type: 'replace'; oldText: string; newText: string }\n  | { type: 'insert'; position: 'before' | 'after'; anchor: string; content: string }\n  | { type: 'insertAtLine'; line: number; content: string }\n  | { type: 'delete'; target: string }\n  | { type: 'wrap'; target: string; before: string; after: string };\n\n/**\n * \u7F29\u8FDB\u4FE1\u606F\n */\ninterface IndentInfo {\n  char: string;      // \u7F29\u8FDB\u5B57\u7B26 (' ' \u6216 '\\t')\n  size: number;      // \u5355\u4F4D\u7F29\u8FDB\u5927\u5C0F\n  level: number;     // \u7F29\u8FDB\u7EA7\u522B\n  raw: string;       // \u539F\u59CB\u7F29\u8FDB\u5B57\u7B26\u4E32\n}\n\n/**\n * MCP\u5DE5\u5177\u63D0\u793A\u4FE1\u606F\n */\ninterface MCPToolSuggestion {\n  id: string;\n  name: string;\n  description: string;\n  category: string;\n  insertText: string;\n  documentation?: string;\n  parameters?: Array<{\n    name: string;\n    type: string;\n    description: string;\n    required: boolean;\n  }>;\n}\n\n/**\n * Skill\u6280\u80FD\u63D0\u793A\u4FE1\u606F\n */\ninterface SkillSuggestion {\n  id: string;\n  name: string;\n  description: string;\n  category: 'automator' | 'builder' | 'explainer';\n  icon: string;\n  insertText: string;\n  documentation?: string;\n  supportedLanguages?: string[];\n}\n\n/**\n * \u4EE3\u7801\u5206\u6790\u7ED3\u679C\n */\ninterface CodeAnalysis {\n  hasImports: boolean;\n  hasFunctions: boolean;\n  hasClasses: boolean;\n  language: string;\n  suggestedTools: string[];\n}\n\n/**\n * \u667A\u80FD\u4EE3\u7801\u7F16\u8F91\u5668\n * \n * Claude Code \u80FD\u591F\u6D41\u7545\u5904\u7406\u4EE3\u7801\u63D2\u5165\u7684\u6838\u5FC3\u539F\u56E0\uFF1A\n * 1. \u4F7F\u7528\u7CBE\u786E\u7684\u5B57\u7B26\u4E32\u5339\u914D\u66FF\u6362\uFF0C\u800C\u975E\u884C\u53F7\u5B9A\u4F4D\n * 2. \u81EA\u52A8\u5206\u6790\u76EE\u6807\u4F4D\u7F6E\u7684\u7F29\u8FDB\u7EA7\u522B\u5E76\u8C03\u6574\n * 3. \u4FDD\u6301\u4EE3\u7801\u98CE\u683C\u4E00\u81F4\u6027\n * 4. \u652F\u6301 @mcp \u667A\u80FD\u63D0\u793A\u548C\u81EA\u52A8\u8865\u5168\n */\nexport class SmartCodeEditor {\n\n  // ============================================\n  // MCP \u5DE5\u5177\u6CE8\u518C\u8868\uFF08\u7528\u4E8E\u667A\u80FD\u63D0\u793A\uFF09\n  // ============================================\n  \n  private static mcpTools: Map<string, MCPToolSuggestion> = new Map();\n  private static skillTools: Map<string, SkillSuggestion> = new Map();\n  private static completionProvider: vscode.Disposable | null = null;\n  private static hoverProvider: vscode.Disposable | null = null;\n\n  /**\n   * \u521D\u59CB\u5316MCP\u5DE5\u5177\u63D0\u793A\u7CFB\u7EDF\n   */\n  static initialize(context: vscode.ExtensionContext): void {\n    // \u6CE8\u518C\u81EA\u52A8\u8865\u5168\u63D0\u4F9B\u5668\n    this.completionProvider = vscode.languages.registerCompletionItemProvider(\n      ['typescript', 'javascript', 'typescriptreact', 'javascriptreact', 'markdown', 'plaintext'],\n      {\n        provideCompletionItems: (document, position) => {\n          return this.provideCompletions(document, position);\n        },\n        resolveCompletionItem: (item) => {\n          return this.resolveCompletion(item);\n        }\n      },\n      '@', ':', '.' // \u89E6\u53D1\u5B57\u7B26\n    );\n\n    // \u6CE8\u518C\u60AC\u505C\u63D0\u793A\u63D0\u4F9B\u5668\n    this.hoverProvider = vscode.languages.registerHoverProvider(\n      ['typescript', 'javascript', 'typescriptreact', 'javascriptreact', 'markdown', 'plaintext'],\n      {\n        provideHover: (document, position) => {\n          return this.provideHover(document, position);\n        }\n      }\n    );\n\n    context.subscriptions.push(this.completionProvider, this.hoverProvider);\n\n    // \u52A0\u8F7D\u5185\u7F6EMCP\u5DE5\u5177\n    this.loadBuiltinTools();\n    \n    // \u52A0\u8F7D\u5185\u7F6ESkill\u5DE5\u5177\n    this.loadBuiltinSkills();\n  }\n\n  /**\n   * \u52A0\u8F7D\u5185\u7F6EMCP\u5DE5\u5177\u5B9A\u4E49\n   */\n  private static loadBuiltinTools(): void {\n    const builtinTools: MCPToolSuggestion[] = [\n      {\n        id: 'file:read',\n        name: '\u8BFB\u53D6\u6587\u4EF6',\n        description: '\u8BFB\u53D6\u6307\u5B9A\u8DEF\u5F84\u7684\u6587\u4EF6\u5185\u5BB9',\n        category: 'file',\n        insertText: '@mcp:file:read \"${1:path}\"',\n        parameters: [\n          { name: 'path', type: 'string', description: '\u6587\u4EF6\u8DEF\u5F84', required: true }\n        ]\n      },\n      {\n        id: 'file:write',\n        name: '\u5199\u5165\u6587\u4EF6',\n        description: '\u5C06\u5185\u5BB9\u5199\u5165\u6307\u5B9A\u6587\u4EF6',\n        category: 'file',\n        insertText: '@mcp:file:write \"${1:path}\" \"${2:content}\"',\n        parameters: [\n          { name: 'path', type: 'string', description: '\u6587\u4EF6\u8DEF\u5F84', required: true },\n          { name: 'content', type: 'string', description: '\u6587\u4EF6\u5185\u5BB9', required: true }\n        ]\n      },\n      {\n        id: 'file:list',\n        name: '\u5217\u51FA\u6587\u4EF6',\n        description: '\u5217\u51FA\u76EE\u5F55\u4E0B\u7684\u6240\u6709\u6587\u4EF6',\n        category: 'file',\n        insertText: '@mcp:file:list \"${1:directory}\"',\n        parameters: [\n          { name: 'directory', type: 'string', description: '\u76EE\u5F55\u8DEF\u5F84', required: true }\n        ]\n      },\n      {\n        id: 'code:analyze',\n        name: '\u5206\u6790\u4EE3\u7801',\n        description: '\u5206\u6790\u4EE3\u7801\u7ED3\u6784\u548C\u4F9D\u8D56\u5173\u7CFB',\n        category: 'code',\n        insertText: '@mcp:code:analyze \"${1:file}\"',\n        parameters: [\n          { name: 'file', type: 'string', description: '\u8981\u5206\u6790\u7684\u6587\u4EF6', required: true }\n        ]\n      },\n      {\n        id: 'code:refactor',\n        name: '\u91CD\u6784\u4EE3\u7801',\n        description: '\u667A\u80FD\u91CD\u6784\u9009\u4E2D\u7684\u4EE3\u7801',\n        category: 'code',\n        insertText: '@mcp:code:refactor \"${1:target}\" \"${2:type}\"',\n        parameters: [\n          { name: 'target', type: 'string', description: '\u91CD\u6784\u76EE\u6807', required: true },\n          { name: 'type', type: 'string', description: '\u91CD\u6784\u7C7B\u578B: extract-function, rename, inline', required: true }\n        ]\n      },\n      {\n        id: 'shell:run',\n        name: '\u8FD0\u884C\u547D\u4EE4',\n        description: '\u5728\u7EC8\u7AEF\u8FD0\u884CShell\u547D\u4EE4',\n        category: 'shell',\n        insertText: '@mcp:shell:run \"${1:command}\"',\n        parameters: [\n          { name: 'command', type: 'string', description: 'Shell\u547D\u4EE4', required: true }\n        ]\n      },\n      {\n        id: 'git:status',\n        name: 'Git\u72B6\u6001',\n        description: '\u83B7\u53D6Git\u4ED3\u5E93\u72B6\u6001',\n        category: 'git',\n        insertText: '@mcp:git:status'\n      },\n      {\n        id: 'git:diff',\n        name: 'Git\u5DEE\u5F02',\n        description: '\u83B7\u53D6\u672A\u63D0\u4EA4\u7684\u66F4\u6539',\n        category: 'git',\n        insertText: '@mcp:git:diff \"${1:file}\"',\n        parameters: [\n          { name: 'file', type: 'string', description: '\u6587\u4EF6\u8DEF\u5F84\uFF08\u53EF\u9009\uFF09', required: false }\n        ]\n      },\n      {\n        id: 'git:commit',\n        name: 'Git\u63D0\u4EA4',\n        description: '\u63D0\u4EA4\u66F4\u6539\u5230\u672C\u5730\u4ED3\u5E93',\n        category: 'git',\n        insertText: '@mcp:git:commit \"${1:message}\"',\n        parameters: [\n          { name: 'message', type: 'string', description: '\u63D0\u4EA4\u4FE1\u606F', required: true }\n        ]\n      },\n      {\n        id: 'search:code',\n        name: '\u641C\u7D22\u4EE3\u7801',\n        description: '\u5728\u9879\u76EE\u4E2D\u641C\u7D22\u4EE3\u7801',\n        category: 'search',\n        insertText: '@mcp:search:code \"${1:query}\"',\n        parameters: [\n          { name: 'query', type: 'string', description: '\u641C\u7D22\u5173\u952E\u8BCD', required: true }\n        ]\n      },\n      {\n        id: 'search:files',\n        name: '\u641C\u7D22\u6587\u4EF6',\n        description: '\u6309\u540D\u79F0\u641C\u7D22\u6587\u4EF6',\n        category: 'search',\n        insertText: '@mcp:search:files \"${1:pattern}\"',\n        parameters: [\n          { name: 'pattern', type: 'string', description: '\u6587\u4EF6\u540D\u6A21\u5F0F', required: true }\n        ]\n      },\n      {\n        id: 'test:generate',\n        name: '\u751F\u6210\u6D4B\u8BD5',\n        description: '\u4E3A\u4EE3\u7801\u751F\u6210\u5355\u5143\u6D4B\u8BD5',\n        category: 'test',\n        insertText: '@mcp:test:generate \"${1:file}\"',\n        parameters: [\n          { name: 'file', type: 'string', description: '\u8981\u6D4B\u8BD5\u7684\u6587\u4EF6', required: true }\n        ]\n      },\n      {\n        id: 'test:run',\n        name: '\u8FD0\u884C\u6D4B\u8BD5',\n        description: '\u8FD0\u884C\u9879\u76EE\u6D4B\u8BD5',\n        category: 'test',\n        insertText: '@mcp:test:run \"${1:pattern}\"',\n        parameters: [\n          { name: 'pattern', type: 'string', description: '\u6D4B\u8BD5\u6587\u4EF6\u6A21\u5F0F\uFF08\u53EF\u9009\uFF09', required: false }\n        ]\n      },\n      {\n        id: 'diagram:generate',\n        name: '\u751F\u6210\u56FE\u8868',\n        description: '\u6839\u636E\u4EE3\u7801\u751F\u6210\u67B6\u6784\u56FE',\n        category: 'diagram',\n        insertText: '@mcp:diagram:generate \"${1:type}\" \"${2:description}\"',\n        parameters: [\n          { name: 'type', type: 'string', description: '\u56FE\u8868\u7C7B\u578B: flowchart, sequence, class, architecture', required: true },\n          { name: 'description', type: 'string', description: '\u56FE\u8868\u63CF\u8FF0', required: true }\n        ]\n      },\n      {\n        id: 'web:fetch',\n        name: '\u7F51\u9875\u8BF7\u6C42',\n        description: '\u83B7\u53D6\u7F51\u9875\u5185\u5BB9',\n        category: 'web',\n        insertText: '@mcp:web:fetch \"${1:url}\"',\n        parameters: [\n          { name: 'url', type: 'string', description: 'URL\u5730\u5740', required: true }\n        ]\n      },\n      {\n        id: 'agent:run',\n        name: '\u542F\u52A8Agent',\n        description: '\u542F\u52A8\u81EA\u4E3BAgent\u6267\u884C\u590D\u6742\u4EFB\u52A1',\n        category: 'agent',\n        insertText: '@mcp:agent:run \"${1:task}\"',\n        parameters: [\n          { name: 'task', type: 'string', description: '\u4EFB\u52A1\u63CF\u8FF0', required: true }\n        ]\n      }\n    ];\n\n    for (const tool of builtinTools) {\n      this.mcpTools.set(tool.id, tool);\n    }\n  }\n\n  /**\n   * \u6CE8\u518C\u81EA\u5B9A\u4E49MCP\u5DE5\u5177\n   */\n  static registerTool(tool: MCPToolSuggestion): void {\n    this.mcpTools.set(tool.id, tool);\n  }\n\n  /**\n   * \u6279\u91CF\u6CE8\u518CMCP\u5DE5\u5177\n   */\n  static registerTools(tools: MCPToolSuggestion[]): void {\n    for (const tool of tools) {\n      this.mcpTools.set(tool.id, tool);\n    }\n  }\n\n  /**\n   * \u52A0\u8F7D\u5185\u7F6ESkill\u6280\u80FD\u5B9A\u4E49\n   */\n  private static loadBuiltinSkills(): void {\n    const builtinSkills: SkillSuggestion[] = [\n      {\n        id: 'dependency-guardian',\n        name: '\u4F9D\u8D56\u5B89\u5168\u536B\u58EB',\n        description: '\u68C0\u67E5\u9879\u76EE\u4F9D\u8D56\u4E2D\u7684\u5B89\u5168\u6F0F\u6D1E',\n        category: 'automator',\n        icon: '\uD83D\uDEE1\uFE0F',\n        insertText: '@skill:dependency-guardian',\n        supportedLanguages: ['typescript', 'javascript', 'python', 'java', 'go']\n      },\n      {\n        id: 'test-architect',\n        name: '\u6D4B\u8BD5\u67B6\u6784\u5E08',\n        description: '\u4E3A\u6E90\u4EE3\u7801\u667A\u80FD\u751F\u6210\u5355\u5143\u6D4B\u8BD5',\n        category: 'builder',\n        icon: '\uD83E\uDDEA',\n        insertText: '@skill:test-architect \"${1:file}\"',\n        supportedLanguages: ['typescript', 'javascript', 'python', 'java', 'go']\n      },\n      {\n        id: 'code-reviewer',\n        name: '\u4EE3\u7801\u5BA1\u67E5\u5458',\n        description: '\u5BF9\u4EE3\u7801\u8FDB\u884C\u667A\u80FD\u5BA1\u67E5\uFF0C\u6307\u51FA\u6F5C\u5728\u95EE\u9898',\n        category: 'explainer',\n        icon: '\uD83D\uDD0D',\n        insertText: '@skill:code-reviewer \"${1:file}\"',\n        supportedLanguages: ['typescript', 'javascript', 'python', 'java', 'go']\n      },\n      {\n        id: 'tool-maker',\n        name: '\u5C0F\u5DE5\u5177\u5236\u4F5C\u5668',\n        description: '\u5236\u4F5C\u672C\u5730CLI\u811A\u672C\uFF08\u6279\u91CF\u91CD\u547D\u540D\u3001\u65E5\u5FD7\u5206\u6790\u3001\u56FE\u7247\u538B\u7F29\u7B49\uFF09',\n        category: 'builder',\n        icon: '\uD83D\uDD27',\n        insertText: '@skill:tool-maker \"${1:tool_type}\" \"${2:description}\"',\n        supportedLanguages: ['typescript', 'javascript', 'python', 'java', 'go']\n      },\n      {\n        id: 'excel-processor',\n        name: 'Excel\u5904\u7406\u5668',\n        description: '\u6E05\u6D17\u8868\u683C\u6570\u636E\u3001\u5408\u5E76\u591A\u8868\u3001\u505A\u7EDF\u8BA1\u5206\u6790\uFF0C\u8F93\u51FAExcel\u6587\u4EF6',\n        category: 'automator',\n        icon: '\uD83D\uDCCA',\n        insertText: '@skill:excel-processor \"${1:operation}\" \"${2:file}\"'\n      },\n      {\n        id: 'word-processor',\n        name: 'Word\u6587\u6863\u5904\u7406\u5668',\n        description: '\u751F\u6210\u89C4\u8303Word\u6587\u6863\uFF0C\u652F\u6301\u9700\u6C42\u6587\u6863\u3001\u4F1A\u8BAE\u7EAA\u8981\u3001\u8BF4\u660E\u4E66\u7B49',\n        category: 'builder',\n        icon: '\uD83D\uDCC4',\n        insertText: '@skill:word-processor \"${1:template}\" \"${2:content}\"'\n      },\n      {\n        id: 'ppt-processor',\n        name: 'PPT\u6F14\u793A\u6587\u7A3F\u751F\u6210\u5668',\n        description: '\u6839\u636E\u4E3B\u9898\u81EA\u52A8\u751F\u6210\u5927\u7EB2\u4E0E\u9010\u9875\u8981\u70B9\u6F14\u793A\u6587\u7A3F',\n        category: 'builder',\n        icon: '\uD83D\uDCFD\uFE0F',\n        insertText: '@skill:ppt-processor \"${1:topic}\" \"${2:outline}\"'\n      },\n      {\n        id: 'git-scribe',\n        name: 'Git\u4E66\u8BB0\u5458',\n        description: '\u81EA\u52A8\u751F\u6210Commit Message\u548CPR\u63CF\u8FF0',\n        category: 'automator',\n        icon: '\uD83D\uDCDD',\n        insertText: '@skill:git-scribe \"${1:type}\"'\n      },\n      {\n        id: 'scaffolder',\n        name: '\u811A\u624B\u67B6\u751F\u6210\u5668',\n        description: '\u5FEB\u901F\u751F\u6210\u9879\u76EE\u7ED3\u6784\u548C\u6837\u677F\u4EE3\u7801',\n        category: 'builder',\n        icon: '\uD83C\uDFD7\uFE0F',\n        insertText: '@skill:scaffolder \"${1:template}\" \"${2:name}\"'\n      },\n      {\n        id: 'live-docs',\n        name: '\u6587\u6863\u751F\u6210\u5668',\n        description: '\u81EA\u52A8\u751F\u6210\u4EE3\u7801\u6587\u6863\u548CAPI\u8BF4\u660E',\n        category: 'explainer',\n        icon: '\uD83D\uDCDA',\n        insertText: '@skill:live-docs \"${1:file}\"'\n      },\n      {\n        id: 'mcp-tools',\n        name: 'MCP\u5DE5\u5177\u8C03\u7528',\n        description: '\u901A\u8FC7MCP\u534F\u8BAE\u8C03\u7528\u5916\u90E8\u5DE5\u5177\uFF08\u6587\u4EF6\u7CFB\u7EDF\u3001\u6D4F\u89C8\u5668\u3001\u6570\u636E\u5E93\u7B49\uFF09',\n        category: 'automator',\n        icon: '\uD83D\uDD0C',\n        insertText: '@skill:mcp-tools \"${1:tool}\" \"${2:params}\"'\n      },\n      {\n        id: 'mcp-config',\n        name: 'MCP\u914D\u7F6E\u7BA1\u7406',\n        description: '\u914D\u7F6E\u548C\u7BA1\u7406MCP\u670D\u52A1\u5668\u8FDE\u63A5',\n        category: 'automator',\n        icon: '\u2699\uFE0F',\n        insertText: '@skill:mcp-config \"${1:action}\"'\n      }\n    ];\n\n    for (const skill of builtinSkills) {\n      this.skillTools.set(skill.id, skill);\n    }\n  }\n\n  /**\n   * \u6CE8\u518C\u81EA\u5B9A\u4E49Skill\u6280\u80FD\n   */\n  static registerSkill(skill: SkillSuggestion): void {\n    this.skillTools.set(skill.id, skill);\n  }\n\n  /**\n   * \u6279\u91CF\u6CE8\u518CSkill\u6280\u80FD\n   */\n  static registerSkills(skills: SkillSuggestion[]): void {\n    for (const skill of skills) {\n      this.skillTools.set(skill.id, skill);\n    }\n  }\n\n  /**\n   * \u63D0\u4F9B\u7EDF\u4E00\u7684\u81EA\u52A8\u8865\u5168\uFF08@mcp \u548C @skill\uFF09\n   */\n  private static provideCompletions(\n    document: vscode.TextDocument,\n    position: vscode.Position\n  ): vscode.CompletionList | null {\n    const linePrefix = document.lineAt(position).text.substring(0, position.character);\n    \n    // \u68C0\u6D4B @ \u5F00\u5934\u7684\u4EFB\u4F55\u5185\u5BB9\n    const atMatch = linePrefix.match(/@([a-zA-Z0-9:_-]*)$/);\n    if (!atMatch) {\n      return null;\n    }\n    \n    const prefix = atMatch[1] || '';\n    const items: vscode.CompletionItem[] = [];\n    \n    // \u5224\u65AD\u662F\u5426\u5E94\u8BE5\u663E\u793A\u524D\u7F00\u9009\u9879\n    const showMcpPrefix = prefix === '' || ('mcp:'.startsWith(prefix) && !prefix.startsWith('mcp:'));\n    const showSkillPrefix = prefix === '' || ('skill:'.startsWith(prefix) && !prefix.startsWith('skill:'));\n    const isMcpToolMode = prefix.startsWith('mcp:');\n    const isSkillMode = prefix.startsWith('skill:');\n    \n    // \u60C5\u51B51: \u7A7A\u524D\u7F00\u6216\u90E8\u5206\u524D\u7F00 - \u663E\u793A @mcp: \u548C @skill: \u524D\u7F00\u9009\u9879\n    if (showMcpPrefix) {\n      const mcpItem = new vscode.CompletionItem('@mcp:', vscode.CompletionItemKind.Module);\n      mcpItem.detail = 'MCP \u5DE5\u5177\u8C03\u7528';\n      mcpItem.documentation = new vscode.MarkdownString(\n        '**MCP \u5DE5\u5177\u7CFB\u7EDF**\\n\\n' +\n        '\u8F93\u5165 `@mcp:` \u540E\u8DDF\u5DE5\u5177ID\u6765\u8C03\u7528MCP\u5DE5\u5177\u3002\\n\\n' +\n        '**\u5206\u7C7B:** file, code, shell, git, search, test, diagram, web, agent'\n      );\n      mcpItem.insertText = new vscode.SnippetString('mcp:${1}');\n      mcpItem.filterText = '@mcp:';\n      mcpItem.command = { command: 'editor.action.triggerSuggest', title: '\u89E6\u53D1\u5EFA\u8BAE' };\n      mcpItem.sortText = '0-mcp';\n      items.push(mcpItem);\n    }\n    \n    if (showSkillPrefix) {\n      const skillItem = new vscode.CompletionItem('@skill:', vscode.CompletionItemKind.Module);\n      skillItem.detail = 'Skill \u6280\u80FD\u8C03\u7528';\n      skillItem.documentation = new vscode.MarkdownString(\n        '**Skill \u6280\u80FD\u7CFB\u7EDF**\\n\\n' +\n        '\u8F93\u5165 `@skill:` \u540E\u8DDF\u6280\u80FDID\u6765\u8C03\u7528Skill\u6280\u80FD\u3002\\n\\n' +\n        '**\u70ED\u95E8:** test-architect, code-reviewer, tool-maker'\n      );\n      skillItem.insertText = new vscode.SnippetString('skill:${1}');\n      skillItem.filterText = '@skill:';\n      skillItem.command = { command: 'editor.action.triggerSuggest', title: '\u89E6\u53D1\u5EFA\u8BAE' };\n      skillItem.sortText = '1-skill';\n      items.push(skillItem);\n    }\n    \n    // \u60C5\u51B52: \u524D\u7F00\u4EE5 mcp: \u5F00\u5934\uFF0C\u663E\u793A MCP \u5DE5\u5177\u5217\u8868\n    if (isMcpToolMode) {\n      const toolPrefix = prefix.slice(4); // \u53BB\u6389 'mcp:'\n      for (const [id, tool] of this.mcpTools) {\n        if (toolPrefix === '' || id.startsWith(toolPrefix) || id.includes(toolPrefix) || tool.name.includes(toolPrefix)) {\n          const item = new vscode.CompletionItem(`@mcp:${id}`, vscode.CompletionItemKind.Function);\n          item.detail = tool.name;\n          item.documentation = new vscode.MarkdownString(\n            `**${tool.name}**\\n\\n${tool.description}\\n\\n` +\n            (tool.parameters \n              ? `**\u53C2\u6570:**\\n${tool.parameters.map(p => \n                  `- \\`${p.name}\\` (${p.type}${p.required ? '' : ', \u53EF\u9009'}): ${p.description}`\n                ).join('\\n')}`\n              : '')\n          );\n          item.insertText = new vscode.SnippetString(tool.insertText.replace('@mcp:', ''));\n          item.filterText = `@mcp:${id}`;\n          item.sortText = `2-${tool.category}-${id}`;\n          items.push(item);\n        }\n      }\n    }\n    \n    // \u60C5\u51B53: \u524D\u7F00\u4EE5 skill: \u5F00\u5934\uFF0C\u663E\u793A Skill \u6280\u80FD\u5217\u8868\n    if (isSkillMode) {\n      const skillPrefix = prefix.slice(6); // \u53BB\u6389 'skill:'\n      for (const [id, skill] of this.skillTools) {\n        if (skillPrefix === '' || id.startsWith(skillPrefix) || id.includes(skillPrefix) || skill.name.includes(skillPrefix)) {\n          const item = new vscode.CompletionItem(`@skill:${id}`, vscode.CompletionItemKind.Module);\n          item.detail = `${skill.icon} ${skill.name}`;\n          item.documentation = new vscode.MarkdownString(\n            `## ${skill.icon} ${skill.name}\\n\\n` +\n            `${skill.description}\\n\\n` +\n            `**\u7C7B\u522B:** \\`${skill.category}\\`\\n\\n` +\n            (skill.supportedLanguages \n              ? `**\u652F\u6301\u8BED\u8A00:** ${skill.supportedLanguages.join(', ')}`\n              : '**\u652F\u6301\u8BED\u8A00:** \u6240\u6709\u8BED\u8A00')\n          );\n          item.insertText = new vscode.SnippetString(skill.insertText.replace('@skill:', ''));\n          item.filterText = `@skill:${id}`;\n          item.sortText = `3-${skill.category}-${id}`;\n          items.push(item);\n        }\n      }\n    }\n    \n    return items.length > 0 ? new vscode.CompletionList(items, false) : null;\n  }\n\n  /**\n   * \u63D0\u4F9BMCP\u81EA\u52A8\u8865\u5168 (\u4FDD\u7559\u7528\u4E8E\u5411\u540E\u517C\u5BB9)\n   */\n  private static provideMCPCompletions(\n    document: vscode.TextDocument,\n    position: vscode.Position,\n    prefix: string = ''\n  ): vscode.CompletionList {\n    const items: vscode.CompletionItem[] = [];\n    \n    // \u6839\u636E\u524D\u7F00\u8FC7\u6EE4\u5DE5\u5177\n    for (const [id, tool] of this.mcpTools) {\n      if (id.startsWith(prefix) || tool.name.includes(prefix)) {\n        const item = new vscode.CompletionItem(\n          `@mcp:${id}`,\n          vscode.CompletionItemKind.Function\n        );\n        item.detail = tool.name;\n        item.documentation = new vscode.MarkdownString(\n          `**${tool.name}**\\n\\n${tool.description}\\n\\n` +\n          (tool.parameters \n            ? `**\u53C2\u6570:**\\n${tool.parameters.map(p => \n                `- \\`${p.name}\\` (${p.type}${p.required ? '' : ', \u53EF\u9009'}): ${p.description}`\n              ).join('\\n')}`\n            : '')\n        );\n        item.insertText = new vscode.SnippetString(tool.insertText.replace('@mcp:', ''));\n        item.filterText = `@mcp:${id}`;\n        item.sortText = `0-${tool.category}-${id}`;\n        items.push(item);\n      }\n    }\n\n    return new vscode.CompletionList(items, false);\n  }\n\n  /**\n   * \u63D0\u4F9BSkill\u81EA\u52A8\u8865\u5168\n   */\n  private static provideSkillCompletions(\n    document: vscode.TextDocument,\n    position: vscode.Position,\n    prefix: string = ''\n  ): vscode.CompletionList {\n    const items: vscode.CompletionItem[] = [];\n    \n    // \u6839\u636E\u524D\u7F00\u8FC7\u6EE4\u6280\u80FD\n    for (const [id, skill] of this.skillTools) {\n      if (id.startsWith(prefix) || skill.name.includes(prefix)) {\n        const item = new vscode.CompletionItem(\n          `@skill:${id}`,\n          vscode.CompletionItemKind.Module\n        );\n        item.detail = `${skill.icon} ${skill.name}`;\n        item.documentation = new vscode.MarkdownString(\n          `## ${skill.icon} ${skill.name}\\n\\n` +\n          `${skill.description}\\n\\n` +\n          `**\u7C7B\u522B:** \\`${skill.category}\\`\\n\\n` +\n          (skill.supportedLanguages \n            ? `**\u652F\u6301\u8BED\u8A00:** ${skill.supportedLanguages.join(', ')}`\n            : '**\u652F\u6301\u8BED\u8A00:** \u6240\u6709\u8BED\u8A00')\n        );\n        item.insertText = new vscode.SnippetString(skill.insertText.replace('@skill:', ''));\n        item.filterText = `@skill:${id}`;\n        item.sortText = `1-${skill.category}-${id}`;\n        items.push(item);\n      }\n    }\n\n    return new vscode.CompletionList(items, false);\n  }\n\n  /**\n   * \u521B\u5EFA\u6240\u6709 @ \u524D\u7F00\u8865\u5168\uFF08\u5305\u62EC @mcp \u548C @skill\uFF09\n   */\n  private static createAllPrefixCompletions(): vscode.CompletionList {\n    const items: vscode.CompletionItem[] = [];\n    \n    // @mcp \u524D\u7F00\n    const mcpItem = new vscode.CompletionItem('mcp:', vscode.CompletionItemKind.Module);\n    mcpItem.detail = 'MCP \u5DE5\u5177\u8C03\u7528';\n    mcpItem.documentation = new vscode.MarkdownString(\n      '**MCP \u5DE5\u5177\u7CFB\u7EDF**\\n\\n' +\n      '\u8F93\u5165 `@mcp:` \u540E\u8DDF\u5DE5\u5177ID\u6765\u8C03\u7528MCP\u5DE5\u5177\u3002\\n\\n' +\n      '**\u5206\u7C7B:**\\n' +\n      '- `file:` - \u6587\u4EF6\u64CD\u4F5C\\n' +\n      '- `code:` - \u4EE3\u7801\u5206\u6790\\n' +\n      '- `shell:` - Shell\u547D\u4EE4\\n' +\n      '- `git:` - Git\u64CD\u4F5C\\n' +\n      '- `search:` - \u641C\u7D22\\n' +\n      '- `test:` - \u6D4B\u8BD5\\n' +\n      '- `diagram:` - \u56FE\u8868\\n' +\n      '- `web:` - \u7F51\u7EDC\u8BF7\u6C42\\n' +\n      '- `agent:` - \u81EA\u4E3BAgent'\n    );\n    mcpItem.insertText = new vscode.SnippetString('mcp:${1}');\n    mcpItem.command = {\n      command: 'editor.action.triggerSuggest',\n      title: '\u89E6\u53D1\u5EFA\u8BAE'\n    };\n    mcpItem.sortText = '0-mcp';\n    items.push(mcpItem);\n    \n    // @skill \u524D\u7F00\n    const skillItem = new vscode.CompletionItem('skill:', vscode.CompletionItemKind.Module);\n    skillItem.detail = 'Skill \u6280\u80FD\u8C03\u7528';\n    skillItem.documentation = new vscode.MarkdownString(\n      '**Skill \u6280\u80FD\u7CFB\u7EDF**\\n\\n' +\n      '\u8F93\u5165 `@skill:` \u540E\u8DDF\u6280\u80FDID\u6765\u8C03\u7528Skill\u6280\u80FD\u3002\\n\\n' +\n      '**\u5206\u7C7B:**\\n' +\n      '- `automator` - \uD83E\uDD16 \u81EA\u52A8\u5316\u6280\u80FD\uFF08\u5B89\u5168\u68C0\u67E5\u3001Git\u64CD\u4F5C\u7B49\uFF09\\n' +\n      '- `builder` - \uD83C\uDFD7\uFE0F \u6784\u5EFA\u5668\u6280\u80FD\uFF08\u751F\u6210\u6D4B\u8BD5\u3001\u6587\u6863\u3001\u811A\u624B\u67B6\u7B49\uFF09\\n' +\n      '- `explainer` - \uD83D\uDCD6 \u89E3\u91CA\u5668\u6280\u80FD\uFF08\u4EE3\u7801\u5BA1\u67E5\u3001\u6587\u6863\u751F\u6210\u7B49\uFF09\\n\\n' +\n      '**\u70ED\u95E8\u6280\u80FD:**\\n' +\n      '- `test-architect` - \u6D4B\u8BD5\u67B6\u6784\u5E08\\n' +\n      '- `code-reviewer` - \u4EE3\u7801\u5BA1\u67E5\u5458\\n' +\n      '- `tool-maker` - \u5C0F\u5DE5\u5177\u5236\u4F5C\u5668\\n' +\n      '- `dependency-guardian` - \u4F9D\u8D56\u5B89\u5168\u536B\u58EB'\n    );\n    skillItem.insertText = new vscode.SnippetString('skill:${1}');\n    skillItem.command = {\n      command: 'editor.action.triggerSuggest',\n      title: '\u89E6\u53D1\u5EFA\u8BAE'\n    };\n    skillItem.sortText = '1-skill';\n    items.push(skillItem);\n    \n    return new vscode.CompletionList(items, false);\n  }\n\n  /**\n   * \u89E3\u6790\u8865\u5168\u9879\uFF08\u6DFB\u52A0\u66F4\u591A\u7EC6\u8282\uFF09\n   */\n  private static resolveCompletion(item: vscode.CompletionItem): vscode.CompletionItem {\n    const label = item.label?.toString() || '';\n    \n    // \u5904\u7406 @mcp \u8865\u5168\n    if (label.startsWith('@mcp:')) {\n      const toolId = label.replace('@mcp:', '');\n      const tool = this.mcpTools.get(toolId);\n      if (tool && tool.documentation) {\n        item.documentation = new vscode.MarkdownString(tool.documentation);\n      }\n    }\n    \n    // \u5904\u7406 @skill \u8865\u5168\n    if (label.startsWith('@skill:')) {\n      const skillId = label.replace('@skill:', '');\n      const skill = this.skillTools.get(skillId);\n      if (skill && skill.documentation) {\n        item.documentation = new vscode.MarkdownString(skill.documentation);\n      }\n    }\n    \n    return item;\n  }\n\n  /**\n   * \u63D0\u4F9B\u60AC\u505C\u63D0\u793A\uFF08\u652F\u6301 @mcp \u548C @skill\uFF09\n   */\n  private static provideHover(\n    document: vscode.TextDocument,\n    position: vscode.Position\n  ): vscode.Hover | null {\n    // \u68C0\u6D4B @mcp \u60AC\u505C\n    const mcpRange = document.getWordRangeAtPosition(position, /@mcp:[a-zA-Z0-9:_-]+/);\n    if (mcpRange) {\n      const text = document.getText(mcpRange);\n      const toolId = text.replace('@mcp:', '');\n      const tool = this.mcpTools.get(toolId);\n\n      if (tool) {\n        const markdown = new vscode.MarkdownString();\n        markdown.isTrusted = true;\n        markdown.appendMarkdown(`## \uD83D\uDD27 ${tool.name}\\n\\n`);\n        markdown.appendMarkdown(`${tool.description}\\n\\n`);\n        markdown.appendMarkdown(`**\u5206\u7C7B:** \\`${tool.category}\\`\\n\\n`);\n        \n        if (tool.parameters && tool.parameters.length > 0) {\n          markdown.appendMarkdown(`**\u53C2\u6570:**\\n\\n`);\n          for (const param of tool.parameters) {\n            const required = param.required ? '(\u5FC5\u9700)' : '(\u53EF\u9009)';\n            markdown.appendMarkdown(`- \\`${param.name}\\` ${required}: ${param.description}\\n`);\n          }\n          markdown.appendMarkdown('\\n');\n        }\n\n        markdown.appendMarkdown(`**\u7528\u6CD5:** \\`${tool.insertText}\\``);\n\n        return new vscode.Hover(markdown, mcpRange);\n      }\n    }\n    \n    // \u68C0\u6D4B @skill \u60AC\u505C\n    const skillRange = document.getWordRangeAtPosition(position, /@skill:[a-zA-Z0-9:_-]+/);\n    if (skillRange) {\n      const text = document.getText(skillRange);\n      const skillId = text.replace('@skill:', '');\n      const skill = this.skillTools.get(skillId);\n\n      if (skill) {\n        const markdown = new vscode.MarkdownString();\n        markdown.isTrusted = true;\n        markdown.appendMarkdown(`## ${skill.icon} ${skill.name}\\n\\n`);\n        markdown.appendMarkdown(`${skill.description}\\n\\n`);\n        markdown.appendMarkdown(`**\u7C7B\u522B:** \\`${skill.category}\\`\\n\\n`);\n        \n        if (skill.supportedLanguages && skill.supportedLanguages.length > 0) {\n          markdown.appendMarkdown(`**\u652F\u6301\u8BED\u8A00:** ${skill.supportedLanguages.join(', ')}\\n\\n`);\n        } else {\n          markdown.appendMarkdown(`**\u652F\u6301\u8BED\u8A00:** \u6240\u6709\u8BED\u8A00\\n\\n`);\n        }\n\n        markdown.appendMarkdown(`**\u7528\u6CD5:** \\`${skill.insertText}\\``);\n\n        return new vscode.Hover(markdown, skillRange);\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * \u5206\u6790\u4EE3\u7801\u4E0A\u4E0B\u6587\uFF0C\u63A8\u8350\u76F8\u5173\u7684MCP\u5DE5\u5177\n   */\n  static analyzeCodeContext(document: vscode.TextDocument): CodeAnalysis {\n    const text = document.getText();\n    const language = document.languageId;\n    const suggestedTools: string[] = [];\n\n    // \u68C0\u6D4B\u4EE3\u7801\u7279\u5F81\n    const hasImports = /^(import|require|from)\\s/m.test(text);\n    const hasFunctions = /function\\s+\\w+|const\\s+\\w+\\s*=\\s*(async\\s+)?\\(|=>\\s*{/m.test(text);\n    const hasClasses = /class\\s+\\w+/m.test(text);\n\n    // \u57FA\u4E8E\u7279\u5F81\u63A8\u8350\u5DE5\u5177\n    if (hasFunctions || hasClasses) {\n      suggestedTools.push('code:analyze', 'test:generate');\n    }\n\n    if (hasImports) {\n      suggestedTools.push('code:refactor');\n    }\n\n    // \u68C0\u6D4B\u6D4B\u8BD5\u6587\u4EF6\n    if (document.fileName.includes('.test.') || document.fileName.includes('.spec.')) {\n      suggestedTools.push('test:run');\n    }\n\n    // \u68C0\u6D4B\u914D\u7F6E\u6587\u4EF6\n    if (document.fileName.endsWith('package.json') || document.fileName.endsWith('tsconfig.json')) {\n      suggestedTools.push('shell:run');\n    }\n\n    return {\n      hasImports,\n      hasFunctions,\n      hasClasses,\n      language,\n      suggestedTools\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u5F53\u524D\u4E0A\u4E0B\u6587\u63A8\u8350\u7684\u5DE5\u5177\n   */\n  static getContextualSuggestions(document: vscode.TextDocument): MCPToolSuggestion[] {\n    const analysis = this.analyzeCodeContext(document);\n    const suggestions: MCPToolSuggestion[] = [];\n\n    for (const toolId of analysis.suggestedTools) {\n      const tool = this.mcpTools.get(toolId);\n      if (tool) {\n        suggestions.push(tool);\n      }\n    }\n\n    return suggestions;\n  }\n\n  /**\n   * \u6E05\u7406\u8D44\u6E90\n   */\n  static dispose(): void {\n    if (this.completionProvider) {\n      this.completionProvider.dispose();\n      this.completionProvider = null;\n    }\n    if (this.hoverProvider) {\n      this.hoverProvider.dispose();\n      this.hoverProvider = null;\n    }\n    this.mcpTools.clear();\n    this.skillTools.clear();\n  }\n  \n  // ============================================\n  // \u539F\u6709\u7684\u4EE3\u7801\u7F16\u8F91\u529F\u80FD\n  // ============================================\n\n  /**\n   * \u5206\u6790\u6587\u672C\u7684\u7F29\u8FDB\u4FE1\u606F\n   */\n  static analyzeIndent(text: string): IndentInfo {\n    const lines = text.split('\\n').filter(l => l.trim().length > 0);\n    if (lines.length === 0) {\n      return { char: ' ', size: 2, level: 0, raw: '' };\n    }\n\n    // \u68C0\u6D4B\u7F29\u8FDB\u5B57\u7B26\uFF08\u7A7A\u683C\u6216\u5236\u8868\u7B26\uFF09\n    const indents = lines\n      .map(line => line.match(/^[\\t ]+/)?.[0] || '')\n      .filter(indent => indent.length > 0);\n\n    if (indents.length === 0) {\n      return { char: ' ', size: 2, level: 0, raw: '' };\n    }\n\n    // \u68C0\u6D4B\u662F\u5426\u4F7F\u7528 tab\n    const usesTabs = indents.some(i => i.includes('\\t'));\n    const char = usesTabs ? '\\t' : ' ';\n\n    // \u8BA1\u7B97\u7F29\u8FDB\u5927\u5C0F\n    let size = 2;\n    if (!usesTabs) {\n      const spaces = indents\n        .map(i => i.length)\n        .filter(len => len > 0);\n      \n      if (spaces.length > 1) {\n        // \u627E\u6700\u5C0F\u516C\u7EA6\u6570\u4F5C\u4E3A\u7F29\u8FDB\u5927\u5C0F\n        const diffs = [];\n        const sorted = [...new Set(spaces)].sort((a, b) => a - b);\n        for (let i = 1; i < sorted.length; i++) {\n          diffs.push(sorted[i] - sorted[i - 1]);\n        }\n        if (diffs.length > 0) {\n          size = Math.min(...diffs.filter(d => d > 0)) || 2;\n        }\n      } else if (spaces.length === 1) {\n        size = spaces[0] <= 4 ? spaces[0] : 2;\n      }\n    } else {\n      size = 1;\n    }\n\n    return { char, size, level: 0, raw: '' };\n  }\n\n  /**\n   * \u83B7\u53D6\u884C\u7684\u7F29\u8FDB\u4FE1\u606F\n   */\n  static getLineIndent(line: string, indentInfo: IndentInfo): IndentInfo {\n    const match = line.match(/^[\\t ]*/);\n    const raw = match ? match[0] : '';\n    \n    let level = 0;\n    if (indentInfo.char === '\\t') {\n      level = (raw.match(/\\t/g) || []).length;\n    } else {\n      level = Math.floor(raw.length / indentInfo.size);\n    }\n\n    return { ...indentInfo, level, raw };\n  }\n\n  /**\n   * \u8C03\u6574\u4EE3\u7801\u5757\u7684\u7F29\u8FDB\n   */\n  static adjustIndent(code: string, targetIndent: IndentInfo): string {\n    const lines = code.split('\\n');\n    if (lines.length === 0) return code;\n\n    // \u627E\u5230\u4EE3\u7801\u5757\u7684\u57FA\u7840\u7F29\u8FDB\n    const nonEmptyLines = lines.filter(l => l.trim().length > 0);\n    if (nonEmptyLines.length === 0) return code;\n\n    const baseIndent = nonEmptyLines[0].match(/^[\\t ]*/)?.[0] || '';\n    const baseLevel = this.getLineIndent(nonEmptyLines[0], targetIndent).level;\n\n    // \u8BA1\u7B97\u9700\u8981\u7684\u7F29\u8FDB\u8C03\u6574\n    const targetLevel = targetIndent.level;\n    const levelDiff = targetLevel - baseLevel;\n\n    return lines.map(line => {\n      if (line.trim().length === 0) {\n        return ''; // \u4FDD\u6301\u7A7A\u884C\u4E3A\u7A7A\n      }\n\n      const currentIndent = line.match(/^[\\t ]*/)?.[0] || '';\n      const currentLevel = this.getLineIndent(line, targetIndent).level;\n      const newLevel = Math.max(0, currentLevel + levelDiff);\n      const newIndent = targetIndent.char.repeat(newLevel * targetIndent.size);\n\n      return newIndent + line.trimStart();\n    }).join('\\n');\n  }\n\n  /**\n   * \u5728\u6587\u6863\u4E2D\u67E5\u627E\u6587\u672C\u4F4D\u7F6E\n   */\n  static findTextPosition(\n    document: vscode.TextDocument,\n    searchText: string,\n    startFrom: number = 0\n  ): { start: vscode.Position; end: vscode.Position } | null {\n    const fullText = document.getText();\n    const index = fullText.indexOf(searchText, startFrom);\n\n    if (index === -1) return null;\n\n    const start = document.positionAt(index);\n    const end = document.positionAt(index + searchText.length);\n\n    return { start, end };\n  }\n\n  /**\n   * \u6A21\u7CCA\u5339\u914D\u67E5\u627E\uFF08\u5FFD\u7565\u7F29\u8FDB\u5DEE\u5F02\uFF09\n   */\n  static findTextFuzzy(\n    document: vscode.TextDocument,\n    searchText: string\n  ): { start: vscode.Position; end: vscode.Position; matchedText: string } | null {\n    const fullText = document.getText();\n    const searchLines = searchText.split('\\n').map(l => l.trim()).filter(l => l.length > 0);\n    \n    if (searchLines.length === 0) return null;\n\n    const fullLines = fullText.split('\\n');\n    \n    // \u67E5\u627E\u7B2C\u4E00\u884C\u5339\u914D\n    for (let i = 0; i < fullLines.length; i++) {\n      if (fullLines[i].trim() === searchLines[0]) {\n        // \u68C0\u67E5\u540E\u7EED\u884C\u662F\u5426\u5339\u914D\n        let allMatch = true;\n        let endLine = i;\n\n        for (let j = 1; j < searchLines.length; j++) {\n          if (i + j >= fullLines.length || fullLines[i + j].trim() !== searchLines[j]) {\n            allMatch = false;\n            break;\n          }\n          endLine = i + j;\n        }\n\n        if (allMatch) {\n          const start = new vscode.Position(i, 0);\n          const end = new vscode.Position(endLine, fullLines[endLine].length);\n          const matchedText = fullLines.slice(i, endLine + 1).join('\\n');\n          return { start, end, matchedText };\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * \u6267\u884C\u5B57\u7B26\u4E32\u66FF\u6362\uFF08Claude Code \u6838\u5FC3\u529F\u80FD\uFF09\n   */\n  static async replaceText(\n    document: vscode.TextDocument,\n    oldText: string,\n    newText: string,\n    options: { fuzzy?: boolean; adjustIndent?: boolean } = {}\n  ): Promise<boolean> {\n    const editor = await vscode.window.showTextDocument(document);\n\n    // \u5148\u5C1D\u8BD5\u7CBE\u786E\u5339\u914D\n    let position = this.findTextPosition(document, oldText);\n\n    // \u5982\u679C\u7CBE\u786E\u5339\u914D\u5931\u8D25\u4E14\u542F\u7528\u6A21\u7CCA\u5339\u914D\uFF0C\u5C1D\u8BD5\u6A21\u7CCA\u5339\u914D\n    if (!position && options.fuzzy) {\n      const fuzzyResult = this.findTextFuzzy(document, oldText);\n      if (fuzzyResult) {\n        position = { start: fuzzyResult.start, end: fuzzyResult.end };\n        // \u8C03\u6574\u65B0\u6587\u672C\u7684\u7F29\u8FDB\u4EE5\u5339\u914D\u539F\u59CB\u6587\u672C\n        if (options.adjustIndent) {\n          const indentInfo = this.analyzeIndent(document.getText());\n          const targetIndent = this.getLineIndent(\n            document.lineAt(fuzzyResult.start.line).text,\n            indentInfo\n          );\n          newText = this.adjustIndent(newText, targetIndent);\n        }\n      }\n    }\n\n    if (!position) {\n      return false;\n    }\n\n    // \u5982\u679C\u9700\u8981\u8C03\u6574\u7F29\u8FDB\n    if (options.adjustIndent && !options.fuzzy) {\n      const indentInfo = this.analyzeIndent(document.getText());\n      const targetIndent = this.getLineIndent(\n        document.lineAt(position.start.line).text,\n        indentInfo\n      );\n      newText = this.adjustIndent(newText, targetIndent);\n    }\n\n    const range = new vscode.Range(position.start, position.end);\n    \n    const success = await editor.edit(editBuilder => {\n      editBuilder.replace(range, newText);\n    });\n\n    if (success) {\n      // \u4FDD\u5B58\u6587\u6863\n      await document.save();\n    }\n\n    return success;\n  }\n\n  /**\n   * \u5728\u951A\u70B9\u524D\u540E\u63D2\u5165\u4EE3\u7801\n   */\n  static async insertNearAnchor(\n    document: vscode.TextDocument,\n    anchor: string,\n    content: string,\n    position: 'before' | 'after',\n    options: { adjustIndent?: boolean } = {}\n  ): Promise<boolean> {\n    const editor = await vscode.window.showTextDocument(document);\n    \n    const anchorPosition = this.findTextPosition(document, anchor);\n    if (!anchorPosition) return false;\n\n    // \u83B7\u53D6\u951A\u70B9\u884C\u7684\u7F29\u8FDB\n    const indentInfo = this.analyzeIndent(document.getText());\n    const anchorLine = document.lineAt(anchorPosition.start.line);\n    const targetIndent = this.getLineIndent(anchorLine.text, indentInfo);\n\n    // \u8C03\u6574\u63D2\u5165\u5185\u5BB9\u7684\u7F29\u8FDB\n    if (options.adjustIndent) {\n      content = this.adjustIndent(content, targetIndent);\n    }\n\n    let insertPosition: vscode.Position;\n    let insertContent: string;\n\n    if (position === 'before') {\n      insertPosition = new vscode.Position(anchorPosition.start.line, 0);\n      insertContent = content + '\\n';\n    } else {\n      insertPosition = new vscode.Position(anchorPosition.end.line + 1, 0);\n      insertContent = content + '\\n';\n    }\n\n    const success = await editor.edit(editBuilder => {\n      editBuilder.insert(insertPosition, insertContent);\n    });\n\n    if (success) {\n      await document.save();\n    }\n\n    return success;\n  }\n\n  /**\n   * \u5728\u6307\u5B9A\u884C\u63D2\u5165\u4EE3\u7801\n   */\n  static async insertAtLine(\n    document: vscode.TextDocument,\n    lineNumber: number,\n    content: string,\n    options: { adjustIndent?: boolean; referenceLineOffset?: number } = {}\n  ): Promise<boolean> {\n    const editor = await vscode.window.showTextDocument(document);\n\n    // \u786E\u4FDD\u884C\u53F7\u6709\u6548\n    const targetLine = Math.max(0, Math.min(lineNumber, document.lineCount));\n\n    // \u83B7\u53D6\u53C2\u8003\u884C\u7684\u7F29\u8FDB\n    if (options.adjustIndent) {\n      const refLine = Math.max(0, targetLine + (options.referenceLineOffset || -1));\n      if (refLine < document.lineCount) {\n        const indentInfo = this.analyzeIndent(document.getText());\n        const targetIndent = this.getLineIndent(document.lineAt(refLine).text, indentInfo);\n        content = this.adjustIndent(content, targetIndent);\n      }\n    }\n\n    const insertPosition = new vscode.Position(targetLine, 0);\n    \n    const success = await editor.edit(editBuilder => {\n      editBuilder.insert(insertPosition, content + '\\n');\n    });\n\n    if (success) {\n      await document.save();\n    }\n\n    return success;\n  }\n\n  /**\n   * \u5220\u9664\u6307\u5B9A\u6587\u672C\n   */\n  static async deleteText(\n    document: vscode.TextDocument,\n    targetText: string,\n    options: { fuzzy?: boolean; deleteWholeLine?: boolean } = {}\n  ): Promise<boolean> {\n    const editor = await vscode.window.showTextDocument(document);\n\n    let position = this.findTextPosition(document, targetText);\n    \n    if (!position && options.fuzzy) {\n      const fuzzyResult = this.findTextFuzzy(document, targetText);\n      if (fuzzyResult) {\n        position = { start: fuzzyResult.start, end: fuzzyResult.end };\n      }\n    }\n\n    if (!position) return false;\n\n    let range: vscode.Range;\n    \n    if (options.deleteWholeLine) {\n      range = new vscode.Range(\n        new vscode.Position(position.start.line, 0),\n        new vscode.Position(position.end.line + 1, 0)\n      );\n    } else {\n      range = new vscode.Range(position.start, position.end);\n    }\n\n    const success = await editor.edit(editBuilder => {\n      editBuilder.delete(range);\n    });\n\n    if (success) {\n      await document.save();\n    }\n\n    return success;\n  }\n\n  /**\n   * \u6279\u91CF\u6267\u884C\u7F16\u8F91\u64CD\u4F5C\n   */\n  static async applyEdits(\n    document: vscode.TextDocument,\n    operations: EditOperation[]\n  ): Promise<{ success: boolean; failedOps: number[] }> {\n    const failedOps: number[] = [];\n\n    for (let i = 0; i < operations.length; i++) {\n      const op = operations[i];\n      let success = false;\n\n      switch (op.type) {\n        case 'replace':\n          success = await this.replaceText(document, op.oldText, op.newText, {\n            fuzzy: true,\n            adjustIndent: true,\n          });\n          break;\n        case 'insert':\n          success = await this.insertNearAnchor(document, op.anchor, op.content, op.position, {\n            adjustIndent: true,\n          });\n          break;\n        case 'insertAtLine':\n          success = await this.insertAtLine(document, op.line, op.content, {\n            adjustIndent: true,\n          });\n          break;\n        case 'delete':\n          success = await this.deleteText(document, op.target, {\n            fuzzy: true,\n            deleteWholeLine: true,\n          });\n          break;\n        case 'wrap':\n          // \u5148\u627E\u5230\u76EE\u6807\uFF0C\u7136\u540E\u66FF\u6362\n          success = await this.replaceText(\n            document,\n            op.target,\n            op.before + op.target + op.after,\n            { fuzzy: true }\n          );\n          break;\n      }\n\n      if (!success) {\n        failedOps.push(i);\n      }\n\n      // \u91CD\u65B0\u83B7\u53D6\u6587\u6863\uFF08\u56E0\u4E3A\u5185\u5BB9\u5DF2\u6539\u53D8\uFF09\n      // document \u4F1A\u81EA\u52A8\u66F4\u65B0\n    }\n\n    return {\n      success: failedOps.length === 0,\n      failedOps,\n    };\n  }\n\n  /**\n   * \u4ECE AI \u54CD\u5E94\u4E2D\u63D0\u53D6\u4EE3\u7801\u5E76\u5E94\u7528\n   */\n  static async applyCodeFromAI(\n    targetDocument: vscode.TextDocument,\n    aiResponse: string\n  ): Promise<{ success: boolean; message: string }> {\n    // \u89E3\u6790 AI \u54CD\u5E94\u4E2D\u7684\u4EE3\u7801\u5757\u548C\u64CD\u4F5C\u6307\u4EE4\n    const operations = this.parseAIResponse(aiResponse);\n\n    if (operations.length === 0) {\n      return { success: false, message: 'No code changes found in AI response' };\n    }\n\n    const result = await this.applyEdits(targetDocument, operations);\n\n    if (result.success) {\n      return { success: true, message: `Applied ${operations.length} changes successfully` };\n    } else {\n      return {\n        success: false,\n        message: `Failed to apply ${result.failedOps.length} of ${operations.length} changes`,\n      };\n    }\n  }\n\n  /**\n   * \u89E3\u6790 AI \u54CD\u5E94\u4E2D\u7684\u4EE3\u7801\u64CD\u4F5C\n   */\n  private static parseAIResponse(response: string): EditOperation[] {\n    const operations: EditOperation[] = [];\n\n    // \u5339\u914D ```diff \u6216 ```patch \u683C\u5F0F\n    const diffMatch = response.match(/```(?:diff|patch)\\n([\\s\\S]*?)```/g);\n    if (diffMatch) {\n      for (const diff of diffMatch) {\n        const parsed = this.parseDiff(diff);\n        operations.push(...parsed);\n      }\n    }\n\n    // \u5339\u914D SEARCH/REPLACE \u683C\u5F0F\uFF08Claude Code \u98CE\u683C\uFF09\n    const searchReplaceMatch = response.match(\n      /<<<<<<< SEARCH\\n([\\s\\S]*?)\\n=======\\n([\\s\\S]*?)\\n>>>>>>> REPLACE/g\n    );\n    if (searchReplaceMatch) {\n      for (const block of searchReplaceMatch) {\n        const match = block.match(\n          /<<<<<<< SEARCH\\n([\\s\\S]*?)\\n=======\\n([\\s\\S]*?)\\n>>>>>>> REPLACE/\n        );\n        if (match) {\n          operations.push({\n            type: 'replace',\n            oldText: match[1],\n            newText: match[2],\n          });\n        }\n      }\n    }\n\n    return operations;\n  }\n\n  /**\n   * \u89E3\u6790 diff \u683C\u5F0F\n   */\n  private static parseDiff(diff: string): EditOperation[] {\n    const operations: EditOperation[] = [];\n    const lines = diff.split('\\n');\n    \n    let oldLines: string[] = [];\n    let newLines: string[] = [];\n    let inHunk = false;\n\n    for (const line of lines) {\n      if (line.startsWith('@@')) {\n        // \u5F00\u59CB\u65B0\u7684 hunk\n        if (oldLines.length > 0 || newLines.length > 0) {\n          operations.push({\n            type: 'replace',\n            oldText: oldLines.join('\\n'),\n            newText: newLines.join('\\n'),\n          });\n        }\n        oldLines = [];\n        newLines = [];\n        inHunk = true;\n      } else if (inHunk) {\n        if (line.startsWith('-')) {\n          oldLines.push(line.slice(1));\n        } else if (line.startsWith('+')) {\n          newLines.push(line.slice(1));\n        } else if (line.startsWith(' ')) {\n          oldLines.push(line.slice(1));\n          newLines.push(line.slice(1));\n        }\n      }\n    }\n\n    // \u5904\u7406\u6700\u540E\u4E00\u4E2A hunk\n    if (oldLines.length > 0 || newLines.length > 0) {\n      operations.push({\n        type: 'replace',\n        oldText: oldLines.join('\\n'),\n        newText: newLines.join('\\n'),\n      });\n    }\n\n    return operations;\n  }\n}\n", "import * as vscode from 'vscode';\nimport { SmartCodeEditor, EditOperation } from './SmartCodeEditor';\n\n/**\n * \u4EE3\u7801\u53D8\u66F4\u9884\u89C8\n */\ninterface CodeChange {\n  filePath: string;\n  original: string;\n  modified: string;\n  operations: EditOperation[];\n}\n\n/**\n * \u4EE3\u7801\u5E94\u7528\u5668\n * \u5904\u7406 AI \u751F\u6210\u7684\u4EE3\u7801\u5E76\u5E94\u7528\u5230\u7F16\u8F91\u5668\n */\nexport class CodeApplier {\n  private pendingChanges: Map<string, CodeChange> = new Map();\n\n  /**\n   * \u4ECE AI \u54CD\u5E94\u89E3\u6790\u4EE3\u7801\u53D8\u66F4\n   */\n  parseCodeChanges(response: string, targetFile?: string): CodeChange[] {\n    const changes: CodeChange[] = [];\n\n    // \u89E3\u6790\u5E26\u6587\u4EF6\u8DEF\u5F84\u7684\u4EE3\u7801\u5757\n    // \u683C\u5F0F: ```typescript:path/to/file.ts\n    const fileCodeBlocks = response.matchAll(\n      /```(\\w+):([^\\n]+)\\n([\\s\\S]*?)```/g\n    );\n\n    for (const match of fileCodeBlocks) {\n      const [, language, filePath, code] = match;\n      changes.push({\n        filePath: filePath.trim(),\n        original: '',\n        modified: code.trim(),\n        operations: [{ type: 'replace', oldText: '', newText: code.trim() }],\n      });\n    }\n\n    // \u89E3\u6790 SEARCH/REPLACE \u683C\u5F0F\n    const searchReplaceBlocks = response.matchAll(\n      /(?:File:\\s*([^\\n]+)\\n)?<<<<<<< SEARCH\\n([\\s\\S]*?)\\n=======\\n([\\s\\S]*?)\\n>>>>>>> REPLACE/g\n    );\n\n    for (const match of searchReplaceBlocks) {\n      const [, filePath, oldCode, newCode] = match;\n      const path = filePath?.trim() || targetFile || '';\n      \n      const existing = changes.find(c => c.filePath === path);\n      if (existing) {\n        existing.operations.push({\n          type: 'replace',\n          oldText: oldCode,\n          newText: newCode,\n        });\n      } else {\n        changes.push({\n          filePath: path,\n          original: oldCode,\n          modified: newCode,\n          operations: [{ type: 'replace', oldText: oldCode, newText: newCode }],\n        });\n      }\n    }\n\n    // \u5982\u679C\u53EA\u6709\u666E\u901A\u4EE3\u7801\u5757\u4E14\u6709\u76EE\u6807\u6587\u4EF6\n    if (changes.length === 0 && targetFile) {\n      const codeBlock = response.match(/```[\\w]*\\n([\\s\\S]*?)```/);\n      if (codeBlock) {\n        changes.push({\n          filePath: targetFile,\n          original: '',\n          modified: codeBlock[1].trim(),\n          operations: [],\n        });\n      }\n    }\n\n    return changes;\n  }\n\n  /**\n   * \u663E\u793A\u5DEE\u5F02\u9884\u89C8\n   */\n  async showDiffPreview(change: CodeChange): Promise<void> {\n    const uri = vscode.Uri.parse(`ai-diff:${change.filePath}`);\n    \n    // \u521B\u5EFA\u865A\u62DF\u6587\u6863\u7528\u4E8E\u663E\u793A\u539F\u59CB\u5185\u5BB9\n    const originalUri = vscode.Uri.parse(`ai-original:${change.filePath}`);\n    const modifiedUri = vscode.Uri.parse(`ai-modified:${change.filePath}`);\n\n    // \u4F7F\u7528 VS Code \u7684 diff \u7F16\u8F91\u5668\n    await vscode.commands.executeCommand('vscode.diff', \n      originalUri, \n      modifiedUri,\n      `AI Changes: ${change.filePath}`\n    );\n  }\n\n  /**\n   * \u5E94\u7528\u4EE3\u7801\u53D8\u66F4\u5230\u6587\u4EF6\n   */\n  async applyChanges(\n    changes: CodeChange[],\n    options: { preview?: boolean; autoSave?: boolean } = {}\n  ): Promise<{ success: boolean; applied: number; failed: number; messages: string[] }> {\n    const messages: string[] = [];\n    let applied = 0;\n    let failed = 0;\n\n    for (const change of changes) {\n      try {\n        // \u83B7\u53D6\u6216\u521B\u5EFA\u6587\u6863\n        let document: vscode.TextDocument;\n        \n        const workspaceRoot = vscode.workspace.workspaceFolders?.[0]?.uri.fsPath;\n        const fullPath = change.filePath.startsWith('/')\n          ? change.filePath\n          : `${workspaceRoot}/${change.filePath}`;\n        \n        const uri = vscode.Uri.file(fullPath);\n\n        try {\n          document = await vscode.workspace.openTextDocument(uri);\n        } catch {\n          // \u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u521B\u5EFA\u65B0\u6587\u4EF6\n          if (change.modified) {\n            await vscode.workspace.fs.writeFile(\n              uri,\n              Buffer.from(change.modified, 'utf-8')\n            );\n            messages.push(`Created: ${change.filePath}`);\n            applied++;\n            continue;\n          } else {\n            throw new Error(`File not found: ${change.filePath}`);\n          }\n        }\n\n        // \u5982\u679C\u6709\u64CD\u4F5C\uFF0C\u6267\u884C\u64CD\u4F5C\n        if (change.operations.length > 0) {\n          const result = await SmartCodeEditor.applyEdits(document, change.operations);\n          \n          if (result.success) {\n            messages.push(`Applied ${change.operations.length} changes to ${change.filePath}`);\n            applied++;\n          } else {\n            messages.push(`Failed to apply some changes to ${change.filePath}`);\n            failed++;\n          }\n        } else if (change.modified) {\n          // \u5982\u679C\u6CA1\u6709\u64CD\u4F5C\u4F46\u6709\u4FEE\u6539\u540E\u7684\u5185\u5BB9\uFF0C\u667A\u80FD\u66FF\u6362\u6574\u4E2A\u6587\u4EF6\u6216\u63D2\u5165\n          const editor = await vscode.window.showTextDocument(document);\n          const fullRange = new vscode.Range(\n            document.positionAt(0),\n            document.positionAt(document.getText().length)\n          );\n\n          await editor.edit(editBuilder => {\n            editBuilder.replace(fullRange, change.modified);\n          });\n\n          if (options.autoSave) {\n            await document.save();\n          }\n\n          messages.push(`Updated: ${change.filePath}`);\n          applied++;\n        }\n      } catch (error) {\n        messages.push(`Error: ${change.filePath} - ${error instanceof Error ? error.message : 'Unknown error'}`);\n        failed++;\n      }\n    }\n\n    return { success: failed === 0, applied, failed, messages };\n  }\n\n  /**\n   * \u667A\u80FD\u63D2\u5165\u4EE3\u7801\u7247\u6BB5\n   * \u81EA\u52A8\u68C0\u6D4B\u6700\u4F73\u63D2\u5165\u4F4D\u7F6E\u5E76\u8C03\u6574\u7F29\u8FDB\n   */\n  async smartInsert(\n    document: vscode.TextDocument,\n    code: string,\n    hint?: string\n  ): Promise<{ success: boolean; message: string }> {\n    const editor = await vscode.window.showTextDocument(document);\n    const selection = editor.selection;\n\n    // \u5982\u679C\u6709\u9009\u4E2D\u5185\u5BB9\uFF0C\u66FF\u6362\u9009\u4E2D\u90E8\u5206\n    if (!selection.isEmpty) {\n      const indentInfo = SmartCodeEditor.analyzeIndent(document.getText());\n      const targetIndent = SmartCodeEditor.getLineIndent(\n        document.lineAt(selection.start.line).text,\n        indentInfo\n      );\n      \n      const adjustedCode = SmartCodeEditor.adjustIndent(code, targetIndent);\n      \n      const success = await editor.edit(editBuilder => {\n        editBuilder.replace(selection, adjustedCode);\n      });\n\n      return {\n        success,\n        message: success ? 'Code inserted at selection' : 'Failed to insert code',\n      };\n    }\n\n    // \u5982\u679C\u6709\u63D0\u793A\uFF0C\u5C1D\u8BD5\u627E\u5230\u76F8\u5173\u4F4D\u7F6E\n    if (hint) {\n      const position = SmartCodeEditor.findTextPosition(document, hint);\n      if (position) {\n        const indentInfo = SmartCodeEditor.analyzeIndent(document.getText());\n        const targetIndent = SmartCodeEditor.getLineIndent(\n          document.lineAt(position.start.line).text,\n          indentInfo\n        );\n        \n        const adjustedCode = SmartCodeEditor.adjustIndent(code, targetIndent);\n        const insertPosition = new vscode.Position(position.end.line + 1, 0);\n\n        const success = await editor.edit(editBuilder => {\n          editBuilder.insert(insertPosition, adjustedCode + '\\n');\n        });\n\n        return {\n          success,\n          message: success ? `Code inserted after \"${hint.slice(0, 30)}...\"` : 'Failed to insert code',\n        };\n      }\n    }\n\n    // \u9ED8\u8BA4\u63D2\u5165\u5230\u5149\u6807\u4F4D\u7F6E\n    const cursorPosition = selection.active;\n    const indentInfo = SmartCodeEditor.analyzeIndent(document.getText());\n    const targetIndent = SmartCodeEditor.getLineIndent(\n      document.lineAt(cursorPosition.line).text,\n      indentInfo\n    );\n    \n    const adjustedCode = SmartCodeEditor.adjustIndent(code, targetIndent);\n\n    const success = await editor.edit(editBuilder => {\n      editBuilder.insert(cursorPosition, adjustedCode);\n    });\n\n    return {\n      success,\n      message: success ? 'Code inserted at cursor' : 'Failed to insert code',\n    };\n  }\n\n  /**\n   * \u683C\u5F0F\u5316\u5E76\u5E94\u7528\u4EE3\u7801\n   */\n  async formatAndApply(\n    document: vscode.TextDocument,\n    code: string\n  ): Promise<boolean> {\n    const result = await this.smartInsert(document, code);\n    \n    if (result.success) {\n      // \u5C1D\u8BD5\u683C\u5F0F\u5316\u6587\u6863\n      try {\n        await vscode.commands.executeCommand('editor.action.formatDocument');\n      } catch {\n        // \u683C\u5F0F\u5316\u5931\u8D25\u4E0D\u5F71\u54CD\u7ED3\u679C\n      }\n      \n      await document.save();\n    }\n\n    return result.success;\n  }\n\n  /**\n   * \u4EA4\u4E92\u5F0F\u4EE3\u7801\u5E94\u7528\n   * \u663E\u793A\u9884\u89C8\u5E76\u8BA9\u7528\u6237\u786E\u8BA4\n   */\n  async interactiveApply(\n    response: string,\n    targetFile?: string\n  ): Promise<{ success: boolean; message: string }> {\n    const changes = this.parseCodeChanges(response, targetFile);\n\n    if (changes.length === 0) {\n      return { success: false, message: 'No code changes found' };\n    }\n\n    // \u663E\u793A\u5FEB\u901F\u9009\u62E9\u8BA9\u7528\u6237\u9009\u62E9\u8981\u5E94\u7528\u7684\u53D8\u66F4\n    const items = changes.map((change, index) => ({\n      label: change.filePath || `Change ${index + 1}`,\n      description: `${change.operations.length} operations`,\n      detail: change.modified.slice(0, 100) + '...',\n      change,\n      picked: true,\n    }));\n\n    const selected = await vscode.window.showQuickPick(items, {\n      canPickMany: true,\n      placeHolder: 'Select changes to apply',\n    });\n\n    if (!selected || selected.length === 0) {\n      return { success: false, message: 'No changes selected' };\n    }\n\n    const result = await this.applyChanges(\n      selected.map(s => s.change),\n      { autoSave: true }\n    );\n\n    return {\n      success: result.success,\n      message: `Applied ${result.applied} changes, ${result.failed} failed`,\n    };\n  }\n}\n\n/**\n * \u7528\u4E8E\u5DEE\u5F02\u9884\u89C8\u7684\u865A\u62DF\u6587\u6863\u63D0\u4F9B\u5668\n */\nexport class DiffContentProvider implements vscode.TextDocumentContentProvider {\n  private contents = new Map<string, string>();\n\n  setContent(uri: string, content: string): void {\n    this.contents.set(uri, content);\n  }\n\n  provideTextDocumentContent(uri: vscode.Uri): string {\n    return this.contents.get(uri.toString()) || '';\n  }\n}\n", "/**\n * \u65B0\u529F\u80FD\u670D\u52A1\n * \u6574\u5408\u8BED\u8A00\u5207\u6362\u7B49\u4FBF\u6377\u5165\u53E3\n * \n * \u6CE8\uFF1A\u5DF2\u79FB\u9664\u6279\u5904\u7406\u529F\u80FD\uFF08\u4E1A\u52A1\u4E0D\u9700\u8981\uFF09\n */\n\nimport * as vscode from 'vscode';\nimport { \n  I18nManager, \n  i18n, \n  t, \n  tf,\n  SupportedLanguage, \n  SUPPORTED_LANGUAGES \n} from '../i18n';\n\n/**\n * \u65B0\u529F\u80FD\u670D\u52A1\u7C7B\n * \u63D0\u4F9B\u7EDF\u4E00\u7684API\u6765\u8BBF\u95EE\u65B0\u529F\u80FD\n */\nexport class NewFeaturesService {\n  private static instance: NewFeaturesService | null = null;\n  \n  private context: vscode.ExtensionContext;\n  \n  private constructor(context: vscode.ExtensionContext) {\n    this.context = context;\n    \n    // \u521D\u59CB\u5316i18n\n    i18n.initialize(context);\n  }\n\n  static getInstance(context: vscode.ExtensionContext): NewFeaturesService {\n    if (!NewFeaturesService.instance) {\n      NewFeaturesService.instance = new NewFeaturesService(context);\n    }\n    return NewFeaturesService.instance;\n  }\n\n  // ============ \u8BED\u8A00\u914D\u7F6E\u529F\u80FD ============\n\n  /**\n   * \u83B7\u53D6\u5F53\u524D\u8BED\u8A00\n   */\n  getCurrentLanguage(): SupportedLanguage {\n    return i18n.getCurrentLanguage();\n  }\n\n  /**\n   * \u8BBE\u7F6E\u8BED\u8A00\n   */\n  async setLanguage(language: SupportedLanguage): Promise<void> {\n    await i18n.setLanguage(language);\n    vscode.window.showInformationMessage(\n      language === 'zh-CN' \n        ? '\u2705 \u8BED\u8A00\u5DF2\u5207\u6362\u4E3A\u4E2D\u6587' \n        : '\u2705 Language switched to English'\n    );\n  }\n\n  /**\n   * \u663E\u793A\u8BED\u8A00\u9009\u62E9\u5668\n   */\n  async showLanguageSelector(): Promise<void> {\n    const languages = SUPPORTED_LANGUAGES;\n    const currentLanguage = i18n.getCurrentLanguage();\n    \n    const items = languages.map(lang => ({\n      label: `${lang.code === currentLanguage ? '$(check) ' : ''}${lang.nativeName}`,\n      description: lang.name,\n      code: lang.code,\n    }));\n\n    const selected = await vscode.window.showQuickPick(items, {\n      placeHolder: t('chat', 'selectProvider'),\n    });\n\n    if (selected) {\n      await this.setLanguage(selected.code);\n    }\n  }\n\n  /**\n   * \u83B7\u53D6 AI \u7CFB\u7EDF\u63D0\u793A\uFF08\u542B\u8BED\u8A00\u6307\u793A\uFF09\n   */\n  getAISystemPrompt(type: 'general' | 'code' | 'diagram' | 'test' = 'general'): string {\n    return i18n.getFullAIPrompt(type);\n  }\n\n  /**\n   * \u83B7\u53D6\u7FFB\u8BD1\u6587\u672C\n   */\n  translate<K extends keyof import('../i18n/I18nManager').Translations>(\n    category: K,\n    key: keyof import('../i18n/I18nManager').Translations[K]\n  ): string {\n    return t(category, key);\n  }\n}\n\n/**\n * \u6CE8\u518C\u65B0\u529F\u80FD\u547D\u4EE4\n */\nexport function registerNewFeaturesCommands(\n  context: vscode.ExtensionContext,\n  service: NewFeaturesService\n): void {\n  // \u8BED\u8A00\u5207\u6362\u547D\u4EE4\n  context.subscriptions.push(\n    vscode.commands.registerCommand('aiAssistant.setLanguage', () => {\n      service.showLanguageSelector();\n    })\n  );\n}\n\n// \u5BFC\u51FA\u5355\u4F8B\u83B7\u53D6\u51FD\u6570\nexport function getNewFeaturesService(context: vscode.ExtensionContext): NewFeaturesService {\n  return NewFeaturesService.getInstance(context);\n}\n"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAwgBhI,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAqpBtB;AAAA,IACF;AA/lDE,IADW,kBACY,WAAW;AAElC,IAHW,kBAGI,WAAoC;AAH9C,IAAM,mBAAN;AAAA;AAAA;;;ACfP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AACA;AAAA;AAAA;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAAC,WAAwB;;;ACAxB,IAAAC,WAAwB;AACxB;AACA;;;ACFA,aAAwB;AACxB;AAEO,IAAM,iBAAN,MAAM,eAAc;AAAA,EAIzB,YAAY,SAAkC;AAC5C,SAAK,UAAU;AAAA,EACjB;AAAA,EAEA,MAAM,UAAU,UAAiD;AAC/D,WAAO,KAAK,QAAQ,QAAQ,IAAI,eAAc,iBAAiB,QAAQ;AAAA,EACzE;AAAA,EAEA,MAAM,UAAU,UAAoB,QAA+B;AACjE,QAAI,QAAQ;AACV,YAAM,KAAK,QAAQ,QAAQ,MAAM,eAAc,iBAAiB,UAAU,MAAM;AAAA,IAClF,OAAO;AACL,YAAM,KAAK,QAAQ,QAAQ,OAAO,eAAc,iBAAiB,QAAQ;AAAA,IAC3E;AAAA,EACF;AAAA,EAEA,MAAM,eAAiC;AACrC,UAAM,YAAwB,CAAC,YAAY,UAAU,aAAa,QAAQ,YAAY;AACtF,eAAW,YAAY,WAAW;AAChC,YAAM,MAAM,MAAM,KAAK,UAAU,QAAQ;AACzC,UAAI;AAAK,eAAO;AAAA,IAClB;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,qBAAmF;AACvF,UAAM,YAAwB,CAAC,YAAY,UAAU,aAAa,QAAQ,YAAY;AACtF,UAAM,SAA8D,CAAC;AAErE,eAAW,YAAY,WAAW;AAChC,YAAM,MAAM,MAAM,KAAK,UAAU,QAAQ;AACzC,UAAI,KAAK;AAEP,eAAO,QAAQ,IAAI;AAAA,UACjB,OAAO;AAAA,UACP,SAAS,IAAI,MAAM,GAAG,EAAE;AAAA,QAC1B;AAAA,MACF,OAAO;AACL,eAAO,QAAQ,IAAI;AAAA,UACjB,OAAO;AAAA,UACP,SAAS;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,iBAA8B;AAC5B,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,UAAU,OAAO,IAAc,mBAAmB,UAAU;AAAA,MAC5D,OAAO,OAAO,IAAY,gBAAgB,eAAe;AAAA,MACzD,aAAa,OAAO,IAAY,eAAe,GAAG;AAAA,MAClD,WAAW,OAAO,IAAY,aAAa,IAAI;AAAA;AAAA,IACjD;AAAA,EACF;AAAA,EAEA,MAAM,qBAA2C;AAC/C,UAAM,SAAS,KAAK,eAAe;AACnC,WAAO,SAAS,MAAM,KAAK,UAAU,OAAO,QAAQ;AACpD,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,kBAAkB,SAA8C;AACpE,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,QAAI,QAAQ,aAAa,QAAW;AAClC,YAAM,OAAO,OAAO,mBAAmB,QAAQ,UAAiB,2BAAoB,MAAM;AAAA,IAC5F;AACA,QAAI,QAAQ,UAAU,QAAW;AAC/B,YAAM,OAAO,OAAO,gBAAgB,QAAQ,OAAc,2BAAoB,MAAM;AAAA,IACtF;AACA,QAAI,QAAQ,gBAAgB,QAAW;AACrC,YAAM,OAAO,OAAO,eAAe,QAAQ,aAAoB,2BAAoB,MAAM;AAAA,IAC3F;AACA,QAAI,QAAQ,cAAc,QAAW;AACnC,YAAM,OAAO,OAAO,aAAa,QAAQ,WAAkB,2BAAoB,MAAM;AAAA,IACvF;AAAA,EACF;AAAA,EAEA,mBAAmB,UAAoB;AACrC,WAAO,iBAAiB,QAAQ,KAAK,CAAC;AAAA,EACxC;AAAA,EAEA,eAAe;AACb,WAAO;AAAA,EACT;AAAA,EAEA,eAAe,UAAoB,OAAwB;AACzD,UAAM,SAAS,KAAK,mBAAmB,QAAQ;AAC/C,UAAM,YAAY,OAAO,KAAK,CAAC,MAAM,EAAE,OAAO,KAAK;AACnD,YAAO,uCAAW,kBAAiB;AAAA,EACrC;AAAA,EAEA,mBAAmB;AACjB,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,aAAa,OAAO,IAAY,8BAA8B,EAAE;AAAA,MAChE,UAAU,OAAO,IAAa,2BAA2B,IAAI;AAAA,IAC/D;AAAA,EACF;AAAA,EAEA,uBAAuB;AACrB,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,SAAS,OAAO,IAAa,8BAA8B,IAAI;AAAA,MAC/D,aAAa,OAAO,IAAY,kCAAkC,EAAE;AAAA,IACtE;AAAA,EACF;AAAA,EAEA,mBAAmB;AACjB,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,eAAe,OAAO,IAAmC,yBAAyB,SAAS;AAAA,IAC7F;AAAA,EACF;AAAA,EAEA,iBAAiB;AACf,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,UAAU,OAAO,IAAY,kBAAkB,OAAO;AAAA,IACxD;AAAA,EACF;AAAA,EAEA,gBAAgB;AACd,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,WAAW,OAAO,IAAY,2BAA2B,MAAM;AAAA,IACjE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,oBAAoB;AAClB,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,UAAU,OAAO,IAAuB,YAAY,OAAO;AAAA,MAC3D,YAAY,OAAO,IAAa,uBAAuB,IAAI;AAAA,IAC7D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,UAA4C;AAC5D,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,UAAM,OAAO,OAAO,YAAY,UAAiB,2BAAoB,MAAM;AAAA,EAC7E;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB;AAClB,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,WAAO;AAAA,MACL,gBAAgB,OAAO,IAAY,2BAA2B,CAAC;AAAA,MAC/D,aAAa,OAAO,IAAa,wBAAwB,KAAK;AAAA,IAChE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAkB,SAA4E;AAClG,UAAM,SAAgB,iBAAU,iBAAiB,aAAa;AAC9D,QAAI,QAAQ,mBAAmB,QAAW;AACxC,YAAM,OAAO,OAAO,2BAA2B,QAAQ,gBAAuB,2BAAoB,MAAM;AAAA,IAC1G;AACA,QAAI,QAAQ,gBAAgB,QAAW;AACrC,YAAM,OAAO,OAAO,wBAAwB,QAAQ,aAAoB,2BAAoB,MAAM;AAAA,IACpG;AAAA,EACF;AACF;AAtLa,eAEa,iBAAiB;AAFpC,IAAM,gBAAN;;;ACHP,IAAAC,UAAwB;AACxB;AASA,IAAM,eAAe;AACrB,IAAM,sBAAsB;AAMrB,IAAM,iBAAN,MAAqB;AAAA;AAAA,EAK1B,YAAY,SAAkC;AAH9C,SAAQ,kBAAkC;AAC1C,SAAQ,kBAA4B,CAAC;AAGnC,SAAK,WAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,iBAAiC;AACnC,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,iBAA2B;AAC7B,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,cAAc,OAAyB;AACrC,UAAM,UAAmB;AAAA,MACvB,IAAI,WAAW;AAAA,MACf,OAAO,SAAS,iBAAM,oBAAI,KAAK,GAAE,eAAe,OAAO,CAAC;AAAA,MACxD,UAAU,CAAC;AAAA,MACX,WAAW,KAAK,IAAI;AAAA,MACpB,WAAW,KAAK,IAAI;AAAA,MACpB,UAAU,CAAC;AAAA,IACb;AACA,SAAK,kBAAkB;AACvB,SAAK,kBAAkB,CAAC;AAExB,SAAK,SAAS,YAAY,OAAO,qBAAqB,QAAQ,EAAE;AAChE,YAAQ,IAAI,yCAAyC,QAAQ,EAAE;AAC/D,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAY,WAA4C;AAC5D,YAAQ,IAAI,qCAAqC,SAAS;AAC1D,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,UAAU,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS;AACrD,QAAI,SAAS;AACX,WAAK,kBAAkB;AACvB,WAAK,kBAAkB,QAAQ,SAC5B,OAAO,OAAK,EAAE,SAAS,MAAM,EAC7B,IAAI,OAAK,EAAE,OAAO;AACrB,YAAM,KAAK,sBAAsB,QAAQ,EAAE;AAC3C,cAAQ,IAAI,iDAAiD,QAAQ,IAAI,aAAa,QAAQ,SAAS,MAAM;AAC7G,aAAO;AAAA,IACT;AACA,YAAQ,IAAI,uCAAuC,SAAS;AAC5D,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,sBAA+C;AACnD,QAAI;AACF,YAAM,gBAAgB,KAAK,SAAS,YAAY,IAAY,mBAAmB;AAC/E,cAAQ,IAAI,6DAA6D,aAAa;AAEtF,UAAI,eAAe;AACjB,cAAM,UAAU,MAAM,KAAK,YAAY,aAAa;AACpD,YAAI,SAAS;AACX,kBAAQ,IAAI,iDAAiD,QAAQ,IAAI,QAAQ,QAAQ,SAAS,QAAQ,UAAU;AACpH,iBAAO;AAAA,QACT;AACA,gBAAQ,IAAI,yEAAyE;AAAA,MACvF;AAGA,YAAM,WAAW,KAAK,gBAAgB;AACtC,cAAQ,IAAI,+CAA+C,SAAS,MAAM;AAE1E,UAAI,SAAS,SAAS,GAAG;AACvB,cAAM,SAAS,SAAS,KAAK,CAAC,GAAG,MAAM,EAAE,YAAY,EAAE,SAAS;AAChE,gBAAQ,IAAI,iDAAiD,OAAO,CAAC,EAAE,EAAE;AACzE,eAAO,KAAK,YAAY,OAAO,CAAC,EAAE,EAAE;AAAA,MACtC;AAEA,cAAQ,IAAI,+CAA+C;AAC3D,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,MAAM,kDAAkD,KAAK;AACrE,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,qBAAoC;AACxC,QAAI,CAAC,KAAK,iBAAiB;AACzB,cAAQ,IAAI,6CAA6C;AACzD;AAAA,IACF;AAEA,SAAK,gBAAgB,YAAY,KAAK,IAAI;AAG1C,QAAI,KAAK,gBAAgB,SAAS,SAAS,KACvC,KAAK,gBAAgB,MAAM,WAAW,eAAK,GAAG;AAChD,YAAM,eAAe,KAAK,gBAAgB,SAAS,KAAK,OAAK,EAAE,SAAS,MAAM;AAC9E,UAAI,cAAc;AAChB,aAAK,gBAAgB,QAAQ,aAAa,aAAa,SAAS,EAAE;AAAA,MACpE;AAAA,IACF;AAEA,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,gBAAgB,SAAS,UAAU,OAAK,EAAE,OAAO,KAAK,gBAAiB,EAAE;AAE/E,QAAI,iBAAiB,GAAG;AACtB,eAAS,aAAa,IAAI,KAAK;AAAA,IACjC,OAAO;AACL,eAAS,KAAK,KAAK,eAAe;AAAA,IACpC;AAGA,UAAM,cAAqB,kBAAU,iBAAiB,aAAa,EAChE,IAAY,8BAA8B,EAAE;AAE/C,QAAI,SAAS,SAAS,aAAa;AACjC,eAAS,KAAK,CAAC,GAAG,MAAM,EAAE,YAAY,EAAE,SAAS;AACjD,eAAS,OAAO,WAAW;AAAA,IAC7B;AAGA,UAAM,KAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AAC7D,UAAM,KAAK,sBAAsB,KAAK,gBAAgB,EAAE;AAExD,YAAQ,IAAI,mCAAmC,KAAK,gBAAgB,IAAI,aAAa,KAAK,gBAAgB,SAAS,MAAM;AAAA,EAC3H;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,WAAW,SAAiC;AAChD,QAAI,CAAC,KAAK,iBAAiB;AACzB,WAAK,cAAc;AAAA,IACrB;AAEA,SAAK,gBAAiB,SAAS,KAAK,OAAO;AAG3C,QAAI,QAAQ,SAAS,QAAQ;AAC3B,WAAK,gBAAgB,KAAK,QAAQ,OAAO;AAAA,IAC3C;AAGA,UAAM,qBAA4B,kBAAU,iBAAiB,aAAa,EACvE,IAAa,8BAA8B,IAAI;AAClD,UAAM,cAAqB,kBAAU,iBAAiB,aAAa,EAChE,IAAY,kCAAkC,EAAE;AAEnD,QAAI,sBAAsB,KAAK,gBAAiB,SAAS,SAAS,aAAa;AAE7E,MAAO,iBAAS,eAAe,4BAA4B;AAAA,IAC7D;AAEA,UAAM,KAAK,mBAAmB;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,kBAAkB,SAAiB,aAAsB,OAAO,YAAqB,OAAsB;AAC/G,QAAI,CAAC,KAAK,mBAAmB,KAAK,gBAAgB,SAAS,WAAW;AAAG;AAEzE,UAAM,UAAU,KAAK,gBAAgB,SAAS,KAAK,gBAAgB,SAAS,SAAS,CAAC;AACtF,YAAQ,UAAU;AAClB,YAAQ,cAAc,CAAC;AAGvB,QAAI,cAAc,WAAW;AAC3B,YAAM,KAAK,mBAAmB;AAAA,IAChC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,eAAe,iBAIlB;AACD,QAAI,CAAC,KAAK,iBAAiB;AACzB,aAAO,EAAE,eAAe,GAAG,iBAAiB,GAAG,aAAa,EAAE;AAAA,IAChE;AAEA,UAAM,aAAoB,kBAAU,iBAAiB,aAAa,EAC/D,IAAY,iCAAiC,CAAC;AAEjD,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,gBAAgB,SAAS;AAE/B,QAAI,iBAAiB,YAAY;AAC/B,aAAO,EAAE,eAAe,iBAAiB,eAAe,aAAa,EAAE;AAAA,IACzE;AAGA,UAAM,iBAAiB,SAAS,OAAO,CAAC,KAAK,MAAM,MAAM,eAAe,EAAE,OAAO,GAAG,CAAC;AAGrF,UAAM,aAAa,SAAS,MAAM,GAAG,CAAC,UAAU;AAChD,UAAM,SAAS,SAAS,MAAM,CAAC,UAAU;AAGzC,UAAM,UAAU,MAAM,gBAAgB,UAAU;AAGhD,UAAM,iBAA0B;AAAA,MAC9B,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN,SAAS;AAAA,EAAW,OAAO;AAAA;AAAA;AAAA;AAAA,MAC3B,WAAW,KAAK,IAAI;AAAA,IACtB;AAGA,SAAK,gBAAgB,WAAW,CAAC,gBAAgB,GAAG,MAAM;AAC1D,SAAK,gBAAgB,WAAW;AAAA,MAC9B,GAAG,KAAK,gBAAgB;AAAA,MACxB;AAAA,IACF;AAGA,UAAM,mBAAmB,KAAK,gBAAgB,SAC3C,OAAO,CAAC,KAAK,MAAM,MAAM,eAAe,EAAE,OAAO,GAAG,CAAC;AAExD,SAAK,mBAAmB;AAExB,WAAO;AAAA,MACL;AAAA,MACA,iBAAiB,KAAK,gBAAgB,SAAS;AAAA,MAC/C,aAAa,iBAAiB;AAAA,IAChC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,sBAA4B;AAC1B,QAAI,KAAK,iBAAiB;AACxB,WAAK,gBAAgB,WAAW,CAAC;AACjC,WAAK,gBAAgB,YAAY,KAAK,IAAI;AAC1C,WAAK,mBAAmB;AAAA,IAC1B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAyB;AA/RzC;AAgSI,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,WAAW,SAAS,OAAO,OAAK,EAAE,OAAO,SAAS;AACxD,SAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AAEvD,UAAI,UAAK,oBAAL,mBAAsB,QAAO,WAAW;AAC1C,WAAK,kBAAkB;AAAA,IACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAmB,UAA2B;AA5S9D;AA6SI,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,UAAU,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS;AAErD,QAAI,SAAS;AACX,cAAQ,QAAQ;AAChB,cAAQ,YAAY,KAAK,IAAI;AAC7B,WAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AAGvD,YAAI,UAAK,oBAAL,mBAAsB,QAAO,WAAW;AAC1C,aAAK,gBAAgB,QAAQ;AAAA,MAC/B;AACA,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAmC;AACjC,UAAM,WAAW,KAAK,gBAAgB;AACtC,WAAO,SACJ,KAAK,CAAC,GAAG,MAAM,EAAE,YAAY,EAAE,SAAS,EACxC,IAAI,QAAM;AAAA,MACT,IAAI,EAAE;AAAA,MACN,OAAO,EAAE;AAAA,MACT,SAAS,KAAK,mBAAmB,CAAC;AAAA,MAClC,cAAc,EAAE,SAAS;AAAA,MACzB,WAAW,EAAE;AAAA,MACb,WAAW,EAAE;AAAA,IACf,EAAE;AAAA,EACN;AAAA;AAAA;AAAA;AAAA,EAKA,oBAA8B;AAC5B,WAAO,CAAC,GAAG,KAAK,eAAe;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAyB;AAzV3B;AA0VI,aAAO,UAAK,oBAAL,mBAAsB,aAAY,CAAC;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoC;AAClC,QAAI,CAAC,KAAK,mBAAmB,KAAK,gBAAgB,SAAS,WAAW,GAAG;AACvE,aAAO;AAAA,IACT;AAEA,UAAM,iBAAiB,KAAK,gBAAgB,SAAS,IAAI,KAAK;AAC9D,SAAK,mBAAmB;AACxB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,WAAmC;AACnD,QAAI,CAAC,KAAK,iBAAiB;AACzB,aAAO;AAAA,IACT;AAEA,UAAM,QAAQ,KAAK,gBAAgB,SAAS,UAAU,OAAK,EAAE,OAAO,SAAS;AAC7E,QAAI,UAAU,IAAI;AAChB,aAAO;AAAA,IACT;AAEA,UAAM,CAAC,cAAc,IAAI,KAAK,gBAAgB,SAAS,OAAO,OAAO,CAAC;AAGtE,QAAI,eAAe,SAAS,QAAQ;AAClC,YAAM,eAAe,KAAK,gBAAgB,UAAU,OAAK,MAAM,eAAe,OAAO;AACrF,UAAI,iBAAiB,IAAI;AACvB,aAAK,gBAAgB,OAAO,cAAc,CAAC;AAAA,MAC7C;AAAA,IACF;AAEA,SAAK,mBAAmB;AACxB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,iBAA4B;AAC1B,WAAO,KAAK,gBAAgB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,WAAmC;AAChD,UAAM,WAAW,KAAK,gBAAgB;AACtC,WAAO,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS,KAAK;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,SAAiB,KAAK,KAAK,KAAK,KAAK,KAAc;AACpE,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,SAAS,KAAK,IAAI,IAAI;AAC5B,UAAM,WAAW,SAAS,OAAO,OAAK,EAAE,YAAY,MAAM;AAC1D,UAAM,UAAU,SAAS,SAAS,SAAS;AAE3C,QAAI,UAAU,GAAG;AACf,WAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AAAA,IACzD;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMQ,kBAA6B;AACnC,WAAO,KAAK,SAAS,YAAY,IAAe,cAAc,CAAC,CAAC;AAAA,EAClE;AAAA,EAEA,MAAc,sBAAsB,WAAkC;AACpE,UAAM,KAAK,SAAS,YAAY,OAAO,qBAAqB,SAAS;AAAA,EACvE;AAAA,EAEQ,mBAAmB,SAA0B;AACnD,UAAM,cAAc,CAAC,GAAG,QAAQ,QAAQ,EACrC,QAAQ,EACR,KAAK,OAAK,EAAE,SAAS,MAAM;AAE9B,QAAI,aAAa;AACf,aAAO,aAAa,YAAY,SAAS,EAAE;AAAA,IAC7C;AACA,WAAO;AAAA,EACT;AACF;;;AC1bA,IAAAC,UAAwB;AACxB,WAAsB;AACtB;AAiBO,IAAM,gBAAN,MAAoB;AAAA;AAAA;AAAA;AAAA,EAIzB,MAAM,OAAqC;AACzC,UAAM,UAAU,MAAM,KAAK;AAG3B,QAAI,CAAC,QAAQ,WAAW,GAAG,KAAK,CAAC,QAAQ,WAAW,GAAG,GAAG;AACxD,aAAO;AAAA,IACT;AAGA,QAAI,QAAQ,WAAW,GAAG,GAAG;AAC3B,YAAM,UAAU,QAAQ,UAAU,CAAC,EAAE,KAAK;AAC1C,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM,CAAC,OAAO;AAAA,QACd,KAAK;AAAA,QACL,SAAS,QAAQ,SAAS;AAAA,QAC1B,OAAO,QAAQ,WAAW,IAAI,2DAAc;AAAA,MAC9C;AAAA,IACF;AAGA,UAAM,QAAQ,QAAQ,UAAU,CAAC,EAAE,MAAM,KAAK;AAC9C,UAAM,cAAc,MAAM,CAAC,EAAE,YAAY;AACzC,UAAM,OAAO,MAAM,MAAM,CAAC;AAG1B,UAAM,aAAa,KAAK,aAAa,WAAW;AAEhD,QAAI,CAAC,YAAY;AACf,aAAO;AAAA,QACL,SAAS;AAAA,QACT;AAAA,QACA,KAAK;AAAA,QACL,SAAS;AAAA,QACT,OAAO,8BAAU,WAAW;AAAA,MAC9B;AAAA,IACF;AAGA,UAAM,aAAa,KAAK,cAAc,YAAY,IAAI;AAEtD,WAAO;AAAA,MACL,SAAS,WAAW;AAAA,MACpB;AAAA,MACA,KAAK;AAAA,MACL,SAAS,WAAW;AAAA,MACpB,OAAO,WAAW;AAAA,IACpB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,OAA+B;AAC5C,QAAI,CAAC,MAAM,WAAW,GAAG,GAAG;AAC1B,aAAO;AAAA,IACT;AAEA,UAAM,UAAU,MAAM,UAAU,CAAC,EAAE,YAAY;AAE/C,WAAO,eAAe,OAAO,SAAO;AAnFxC;AAoFM,aAAO,IAAI,KAAK,WAAW,OAAO,OAChC,SAAI,YAAJ,mBAAa,KAAK,OAAK,EAAE,WAAW,OAAO;AAAA,IAC/C,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,aAA8B;AACpC,QAAI,aAAa;AACf,YAAM,MAAM,KAAK,aAAa,WAAW;AACzC,UAAI,KAAK;AACP,eAAO,KAAK,mBAAmB,GAAG;AAAA,MACpC;AACA,aAAO,6BAAS,WAAW;AAAA,IAC7B;AAGA,QAAI,OAAO;AAEX,UAAM,aAAa;AAAA,MACjB,SAAS,CAAC,SAAS,WAAW,QAAQ;AAAA,MACtC,SAAS,CAAC,QAAQ,QAAQ,UAAU,OAAO,SAAS,QAAQ,KAAK;AAAA,MACjE,UAAU,CAAC,WAAW,SAAS;AAAA,MAC/B,OAAO,CAAC,MAAM;AAAA,IAChB;AAEA,YAAQ;AACR,eAAW,QAAQ,QAAQ,UAAQ;AACjC,YAAM,MAAM,eAAe,KAAK,OAAK,EAAE,SAAS,IAAI;AACpD,UAAI;AAAK,gBAAQ,OAAO,IAAI,KAAK,QAAQ,IAAI,WAAW;AAAA;AAAA,IAC1D,CAAC;AAED,YAAQ;AACR,eAAW,QAAQ,QAAQ,UAAQ;AACjC,YAAM,MAAM,eAAe,KAAK,OAAK,EAAE,SAAS,IAAI;AACpD,UAAI;AAAK,gBAAQ,OAAO,IAAI,KAAK,QAAQ,IAAI,WAAW;AAAA;AAAA,IAC1D,CAAC;AAED,YAAQ;AACR,eAAW,SAAS,QAAQ,UAAQ;AAClC,YAAM,MAAM,eAAe,KAAK,OAAK,EAAE,SAAS,IAAI;AACpD,UAAI;AAAK,gBAAQ,OAAO,IAAI,KAAK,QAAQ,IAAI,WAAW;AAAA;AAAA,IAC1D,CAAC;AAED,YAAQ;AACR,YAAQ;AACR,YAAQ;AACR,YAAQ;AACR,YAAQ;AACR,YAAQ;AAER,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAmB,SAAoC;AA9I/D;AA+II,UAAM,mBAAkB,KAAO,kBAAU,qBAAjB,mBAAoC;AAC5D,QAAI,CAAC;AAAiB,aAAO,CAAC;AAE9B,QAAI;AACF,YAAM,WAAgB,aAAQ,OAAO,KAAK;AAC1C,YAAM,SAAc,cAAS,OAAO;AAEpC,YAAM,eAAoB,gBAAW,QAAQ,IACzC,WACK,UAAK,gBAAgB,IAAI,QAAQ,QAAQ;AAElD,YAAM,UAAU,MAAa,kBAAU,GAAG;AAAA,QACjC,YAAI,KAAK,YAAY;AAAA,MAC9B;AAEA,aAAO,QACJ,OAAO,CAAC,CAAC,IAAI,MAAM,KAAK,WAAW,MAAM,CAAC,EAC1C,IAAI,CAAC,CAAC,MAAM,IAAI,MAAM;AACrB,cAAM,WAAgB,UAAK,UAAU,IAAI;AACzC,eAAO,SAAgB,iBAAS,YAAY,WAAW,MAAM;AAAA,MAC/D,CAAC,EACA,MAAM,GAAG,EAAE;AAAA,IAChB,QAAQ;AACN,aAAO,CAAC;AAAA,IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,aAAa,aAA+C;AAClE,WAAO,eAAe;AAAA,MAAK,SAAI;AA/KnC;AAgLM,mBAAI,SAAS,iBACb,SAAI,YAAJ,mBAAa,SAAS;AAAA;AAAA,IACxB;AAAA,EACF;AAAA,EAEQ,cACN,KACA,MACoC;AACpC,QAAI,CAAC,IAAI,MAAM;AACb,aAAO,EAAE,OAAO,KAAK;AAAA,IACvB;AAEA,UAAM,eAAe,IAAI,KAAK,OAAO,OAAK,EAAE,QAAQ;AAEpD,QAAI,KAAK,SAAS,aAAa,QAAQ;AACrC,YAAM,UAAU,aAAa,KAAK,MAAM;AACxC,aAAO;AAAA,QACL,OAAO;AAAA,QACP,OAAO,6BAAS,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAAA,MACvD;AAAA,IACF;AAEA,WAAO,EAAE,OAAO,KAAK;AAAA,EACvB;AAAA,EAEQ,mBAAmB,KAA2B;AA1MxD;AA2MI,QAAI,OAAO,MAAM,IAAI,IAAI,QAAQ,IAAI,WAAW;AAAA;AAAA;AAChD,YAAQ,mBAAS,IAAI,KAAK;AAAA;AAE1B,SAAI,SAAI,YAAJ,mBAAa,QAAQ;AACvB,cAAQ,iBAAO,IAAI,QAAQ,IAAI,OAAK,MAAM,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA,IAC7D;AAEA,SAAI,SAAI,SAAJ,mBAAU,QAAQ;AACpB,cAAQ;AACR,UAAI,KAAK,QAAQ,SAAO;AACtB,cAAM,WAAW,IAAI,WAAW,mBAAS;AACzC,gBAAQ,SAAS,IAAI,IAAI,MAAM,QAAQ,KAAK,IAAI,WAAW;AAAA;AAAA,MAC7D,CAAC;AAAA,IACH;AAEA,WAAO;AAAA,EACT;AACF;;;AC5NA,IAAAC,UAAwB;AACxB;AAQA,IAAM,eAAe;AAMd,IAAM,mBAAN,MAAuB;AAAA,EAG5B,YAAY,SAAkC;AAC5C,SAAK,WAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,MAAmB,aAAsB,MAAuB;AAC7E,UAAM,SAAS,KAAK,kBAAkB;AAEtC,QAAI,SAAS,kCAAS,KAAK,oBAAoB,IAAI,CAAC,KAAK,MAAM;AAAA;AAAA;AAE/D,QAAI,aAAa;AACf,gBAAU,iCAAQ,WAAW;AAAA;AAAA;AAAA,IAC/B;AAEA,QAAI,MAAM;AACR,gBAAU;AAAA;AAAA,EAAoB,IAAI;AAAA;AAAA;AAAA;AAAA,IACpC;AAGA,UAAM,cAAc,KAAK,gBAAgB,IAAI;AAE7C,cAAU;AAAA,wBACL,MAAM;AAAA,0CACE,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,EAKrB,WAAW;AAAA;AAAA;AAAA,QAGL,MAAM;AAAA,EACZ,kBAAkB,IAAI,CAAC;AAAA;AAAA;AAAA,oFAGiB,KAAK,kBAAkB,IAAI,CAAC;AAElE,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,MAA2B;AACjD,UAAM,SAAsC;AAAA,MAC1C,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMX,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOV,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAKP,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAKP,IAAI;AAAA;AAAA;AAAA;AAAA,MAIJ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAKP,KAAK;AAAA;AAAA;AAAA;AAAA,MAIL,SAAS;AAAA;AAAA;AAAA;AAAA,MAIT,cAAc;AAAA;AAAA;AAAA;AAAA,IAIhB;AACA,WAAO,OAAO,IAAI,KAAK;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,MAA2B;AACnD,UAAM,QAAqC;AAAA,MACzC,WAAW;AAAA,MACX,UAAU;AAAA,MACV,OAAO;AAAA,MACP,OAAO;AAAA,MACP,IAAI;AAAA,MACJ,OAAO;AAAA,MACP,KAAK;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,IAChB;AACA,WAAO,MAAM,IAAI,KAAK;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,UAAiC;AAClD,UAAM,SAAS,KAAK,kBAAkB;AAGtC,UAAM,WAAW;AAAA,MACf,IAAI,OAAO,SAAS,MAAM,0BAA0B,GAAG;AAAA,MACvD,IAAI,OAAO,uCAAuC,GAAG;AAAA,MACrD,IAAI,OAAO,gCAAgC,GAAG;AAAA,IAChD;AAEA,eAAW,WAAW,UAAU;AAC9B,YAAM,QAAQ,SAAS,MAAM,OAAO;AACpC,UAAI,SAAS,MAAM,CAAC,GAAG;AACrB,eAAO,MAAM,CAAC,EAAE,KAAK;AAAA,MACvB;AAAA,IACF;AAGA,QAAI,KAAK,sBAAsB,QAAQ,GAAG;AACxC,aAAO,SAAS,KAAK;AAAA,IACvB;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,cACE,MACA,MACA,OACA,WACS;AACT,UAAM,UAAmB;AAAA,MACvB,IAAI,WAAW;AAAA,MACf,OAAO,SAAS,GAAG,KAAK,oBAAoB,IAAI,CAAC,OAAM,oBAAI,KAAK,GAAE,eAAe,OAAO,CAAC;AAAA,MACzF;AAAA,MACA,QAAQ,KAAK,kBAAkB;AAAA,MAC/B;AAAA,MACA,WAAW,KAAK,IAAI;AAAA,MACpB,WAAW,KAAK,IAAI;AAAA,MACpB;AAAA,IACF;AAEA,SAAK,aAAa,OAAO;AACzB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAmB,MAA8B;AAC7D,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,QAAQ,SAAS,UAAU,OAAK,EAAE,OAAO,SAAS;AAExD,QAAI,UAAU;AAAI,aAAO;AAEzB,aAAS,KAAK,EAAE,OAAO;AACvB,aAAS,KAAK,EAAE,YAAY,KAAK,IAAI;AAErC,SAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AACvD,WAAO,SAAS,KAAK;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,WAAmC;AAC5C,UAAM,WAAW,KAAK,gBAAgB;AACtC,WAAO,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS,KAAK;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,iBAA4B;AAC1B,WAAO,KAAK,gBAAgB,EACzB,KAAK,CAAC,GAAG,MAAM,EAAE,YAAY,EAAE,SAAS;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAA4B;AACxC,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,WAAW,SAAS,OAAO,OAAK,EAAE,OAAO,SAAS;AAExD,QAAI,SAAS,WAAW,SAAS;AAAQ,aAAO;AAEhD,SAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AACvD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAmB,UAA2B;AAC1D,UAAM,WAAW,KAAK,gBAAgB;AACtC,UAAM,QAAQ,SAAS,UAAU,OAAK,EAAE,OAAO,SAAS;AAExD,QAAI,UAAU;AAAI,aAAO;AAEzB,aAAS,KAAK,EAAE,QAAQ;AACxB,aAAS,KAAK,EAAE,YAAY,KAAK,IAAI;AAErC,SAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AACvD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cACJ,SACA,QACiB;AACjB,YAAQ,QAAQ;AAAA,MACd,KAAK;AACH,eAAO,KAAK,kBAAkB,OAAO;AAAA,MACvC,KAAK;AACH,eAAO,KAAK,cAAc,OAAO;AAAA,MACnC,KAAK;AAAA,MACL,KAAK;AAEH,cAAM,IAAI,MAAM,GAAG,OAAO,YAAY,CAAC,yDAAY;AAAA,MACrD;AACE,cAAM,IAAI,MAAM,qDAAa,MAAM,EAAE;AAAA,IACzC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,MAAkD;AAC7D,QAAI,CAAC,QAAQ,KAAK,KAAK,EAAE,WAAW,GAAG;AACrC,aAAO,EAAE,OAAO,OAAO,OAAO,uCAAS;AAAA,IACzC;AAGA,UAAM,UAAU,KAAK,KAAK;AAG1B,UAAM,cAAc;AAAA,MAClB;AAAA,MAAa;AAAA,MAAS;AAAA,MAAmB;AAAA,MACzC;AAAA,MAAgB;AAAA,MAAa;AAAA,MAAS;AAAA,MAAO;AAAA,MAC7C;AAAA,MAAW;AAAA,MAAY;AAAA,MAAa;AAAA,IACtC;AAEA,UAAM,YAAY,QAAQ,MAAM,KAAK,EAAE,CAAC,EAAE,YAAY;AACtD,QAAI,CAAC,YAAY,KAAK,OAAK,UAAU,WAAW,EAAE,YAAY,CAAC,CAAC,GAAG;AACjE,aAAO;AAAA,QACL,OAAO;AAAA,QACP,OAAO,mFAAkB,YAAY,KAAK,IAAI,CAAC;AAAA,MACjD;AAAA,IACF;AAGA,UAAM,WAAW,EAAE,KAAK,GAAG,KAAK,GAAG,KAAK,EAAE;AAC1C,eAAW,QAAQ,SAAS;AAC1B,UAAI,SAAS;AAAK,iBAAS,GAAG;AAC9B,UAAI,SAAS;AAAK,iBAAS,GAAG;AAC9B,UAAI,SAAS;AAAK,iBAAS,GAAG;AAC9B,UAAI,SAAS;AAAK,iBAAS,GAAG;AAC9B,UAAI,SAAS;AAAK,iBAAS,GAAG;AAC9B,UAAI,SAAS;AAAK,iBAAS,GAAG;AAAA,IAChC;AAEA,QAAI,SAAS,GAAG,MAAM,KAAK,SAAS,GAAG,MAAM,KAAK,SAAS,GAAG,MAAM,GAAG;AACrE,aAAO,EAAE,OAAO,OAAO,OAAO,iCAAQ;AAAA,IACxC;AAEA,WAAO,EAAE,OAAO,KAAK;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,MAA2B;AACrC,WAAO,kBAAkB,IAAI,KAAK,kBAAkB;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,2BAA2B,aAKhB;AApUb;AAqUI,QAAI,SAAS;AAAA;AAAA,gCAEV,YAAY,IAAI;AAAA,gCAChB,YAAY,IAAI;AAAA;AAAA;AAAA;AAAA,EAIrB,YAAY,SAAS;AAAA;AAAA;AAInB,SAAI,iBAAY,iBAAZ,mBAA0B,QAAQ;AACpC,gBAAU;AAAA,gCAAU,YAAY,aAAa,KAAK,IAAI,CAAC;AAAA;AAAA,IACzD;AAEA,cAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUV,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,gCAAgC,MAAc,UAA0B;AACtE,WAAO,kCAAS,QAAQ;AAAA;AAAA,QAEpB,QAAQ;AAAA,EACd,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQJ;AAAA;AAAA;AAAA;AAAA,EAMQ,oBAAmC;AACzC,WAAc,kBAAU,iBAAiB,aAAa,EACnD,IAAmB,yBAAyB,SAAS;AAAA,EAC1D;AAAA,EAEQ,oBAAoB,MAA2B;AACrD,UAAM,QAAqC;AAAA,MACzC,WAAW;AAAA,MACX,UAAU;AAAA,MACV,OAAO;AAAA,MACP,OAAO;AAAA,MACP,IAAI;AAAA,MACJ,OAAO;AAAA,MACP,KAAK;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,IAChB;AACA,WAAO,MAAM,IAAI,KAAK;AAAA,EACxB;AAAA,EAEQ,kBAA6B;AACnC,WAAO,KAAK,SAAS,YAAY,IAAe,cAAc,CAAC,CAAC;AAAA,EAClE;AAAA,EAEQ,aAAa,SAAwB;AAC3C,UAAM,WAAW,KAAK,gBAAgB;AACtC,aAAS,KAAK,OAAO;AAGrB,QAAI,SAAS,SAAS,KAAK;AACzB,eAAS,KAAK,CAAC,GAAG,MAAM,EAAE,YAAY,EAAE,SAAS;AACjD,eAAS,OAAO,GAAG;AAAA,IACrB;AAEA,SAAK,SAAS,YAAY,OAAO,cAAc,QAAQ;AAAA,EACzD;AAAA,EAEQ,sBAAsB,MAAuB;AACnD,UAAM,aAAa;AAAA,MACjB;AAAA,MAAa;AAAA,MAAS;AAAA,MAAmB;AAAA,MACzC;AAAA,MAAgB;AAAA,MAAa;AAAA,MAAS;AAAA,MAAO;AAAA,MAC7C;AAAA,MAAO;AAAA,MAAO;AAAA,IAChB;AAEA,WAAO,WAAW,KAAK,SAAO,KAAK,SAAS,GAAG,CAAC;AAAA,EAClD;AAAA,EAEQ,kBAAkB,SAA0B;AAClD,WAAO,KAAK,QAAQ,KAAK;AAAA;AAAA;AAAA,EAG3B,QAAQ,IAAI;AAAA;AAAA;AAAA;AAAA,6BAIL,IAAI,KAAK,QAAQ,SAAS,EAAE,eAAe,OAAO,CAAC;AAAA;AAAA,EAE1D;AAAA,EAEQ,cAAc,SAA0B;AAC9C,WAAO;AAAA;AAAA;AAAA;AAAA,WAIA,QAAQ,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAkBhB,QAAQ,KAAK;AAAA;AAAA,EAEnB,QAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,EAKZ;AACF;;;AJzcA;;;AKNA;AAyDO,IAAM,iBAAN,MAAqB;AAAA,EAM1B,YAAY,SAAkC;AAH9C,SAAQ,cAA4B,CAAC;AACrC,SAAQ,cAAc;AAGpB,SAAK,iBAAiB,IAAI,cAAc,OAAO;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAuC;AACnD,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,SAAS,MAAM,KAAK,eAAe,mBAAmB;AAC5D,UAAI,CAAC,OAAO,QAAQ;AAClB,eAAO;AAAA,MACT;AACA,WAAK,eAAe,IAAI,YAAY,MAAM;AAAA,IAC5C;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,MAAc,OAAmC;AAChE,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,aAAO,EAAE,SAAS,OAAO,OAAO,mCAAe;AAAA,IACjD;AAEA,UAAM,SAAS,KAAK,uBAAuB,MAAM,KAAK;AACtD,WAAO,MAAM,KAAK,qBAAqB,QAAQ,WAAW,IAAI;AAAA,EAChE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBACJ,MACA,OACA,WACe;AACf,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,gBAAU,QAAQ,IAAI,MAAM,kCAAc,CAAC;AAC3C;AAAA,IACF;AAEA,UAAM,SAAS,KAAK,uBAAuB,MAAM,KAAK;AACtD,UAAM,KAAK,qBAAqB,QAAQ,WAAW,SAAS;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBACJ,MACA,OACA,WACA,UACA,WACe;AACf,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,gBAAU,QAAQ,IAAI,MAAM,kCAAc,CAAC;AAC3C;AAAA,IACF;AAEA,UAAM,SAAS,KAAK,oBAAoB,MAAM,OAAO,WAAW,QAAQ;AACxE,UAAM,KAAK,qBAAqB,QAAQ,QAAQ,SAAS;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBACJ,MACA,OACA,UACA,SACA,WACe;AACf,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,gBAAU,QAAQ,IAAI,MAAM,kCAAc,CAAC;AAC3C;AAAA,IACF;AAEA,UAAM,SAAS,KAAK,oBAAoB,MAAM,OAAO,UAAU,OAAO;AACtE,UAAM,KAAK,qBAAqB,QAAQ,QAAQ,SAAS;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBACZ,QACA,MACA,WACe;AACf,QAAI,eAAe;AACnB,QAAI,gBAAgB;AAEpB,QAAI;AACF,YAAM,KAAK,aAAc;AAAA,QACvB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,QAClE;AAAA,UACE,SAAS,CAAC,UAAU;AAClB,4BAAgB;AAGhB,kBAAM,YAAY,KAAK,uBAAuB,YAAY;AAC1D,gBAAI,YAAY,gBAAgB,IAAI;AAClC,wBAAU,QAAQ,aAAa,MAAM,eAAe,SAAS,GAAG,YAAY;AAC5E,8BAAgB;AAAA,YAClB;AAAA,UACF;AAAA,UACA,YAAY,MAAM;AAEhB,gBAAI,gBAAgB,aAAa,QAAQ;AACvC,wBAAU,QAAQ,aAAa,MAAM,aAAa,GAAG,YAAY;AAAA,YACnE;AAGA,kBAAM,YAAY,KAAK,kBAAkB,cAAc,IAAI;AAC3D,kBAAM,cAAc,KAAK,oBAAoB,YAAY;AAEzD,gBAAI,WAAW;AACb,wBAAU,WAAW;AAAA,gBACnB,SAAS;AAAA,gBACT;AAAA,gBACA;AAAA,cACF,CAAC;AAAA,YACH,OAAO;AACL,wBAAU,WAAW;AAAA,gBACnB,SAAS;AAAA,gBACT,OAAO;AAAA,cACT,CAAC;AAAA,YACH;AAAA,UACF;AAAA,UACA,SAAS,CAAC,UAAU;AAElB,gBAAI,aAAa,SAAS,GAAG;AAC3B,oBAAM,YAAY,KAAK,kBAAkB,cAAc,IAAI;AAC3D,kBAAI,WAAW;AACb,0BAAU,WAAW;AAAA,kBACnB,SAAS;AAAA,kBACT;AAAA,kBACA,aAAa;AAAA,gBACf,CAAC;AACD;AAAA,cACF;AAAA,YACF;AACA,sBAAU,QAAQ,KAAK;AAAA,UACzB;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,gBAAU,QAAQ,iBAAiB,QAAQ,QAAQ,IAAI,MAAM,OAAO,KAAK,CAAC,CAAC;AAAA,IAC7E;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,SAAyB;AAEtD,UAAM,mBAAmB,QAAQ,MAAM,MAAM,KAAK,CAAC,GAAG;AACtD,UAAM,gBAAgB,kBAAkB,MAAM;AAE9C,QAAI,eAAe;AAEjB,YAAMC,eAAc,QAAQ,YAAY,IAAI;AAC5C,aAAOA,eAAc,IAAIA,eAAc;AAAA,IACzC;AAGA,UAAM,mBAAmB,QAAQ,YAAY,OAAO;AACpD,QAAI,mBAAmB,GAAG;AACxB,YAAM,aAAa,QAAQ,QAAQ,MAAM,mBAAmB,CAAC;AAC7D,UAAI,aAAa;AAAkB,eAAO;AAC1C,aAAO,mBAAmB;AAAA,IAC5B;AAGA,UAAM,gBAAgB,QAAQ,YAAY,MAAM;AAChD,QAAI,gBAAgB;AAAG,aAAO,gBAAgB;AAG9C,UAAM,cAAc,QAAQ,YAAY,IAAI;AAC5C,QAAI,cAAc;AAAG,aAAO,cAAc;AAE1C,WAAO,QAAQ;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QACJ,MACA,OACA,WACA,UACoB;AACpB,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,aAAO,EAAE,SAAS,OAAO,OAAO,mCAAe;AAAA,IACjD;AAEA,UAAM,SAAS,KAAK,oBAAoB,MAAM,OAAO,WAAW,QAAQ;AACxE,WAAO,MAAM,KAAK,qBAAqB,QAAQ,QAAQ,IAAI;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QACJ,MACA,OACA,UACA,SACoB;AACpB,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,aAAO,EAAE,SAAS,OAAO,OAAO,mCAAe;AAAA,IACjD;AAEA,UAAM,SAAS,KAAK,oBAAoB,MAAM,OAAO,UAAU,OAAO;AACtE,WAAO,MAAM,KAAK,qBAAqB,QAAQ,QAAQ,IAAI;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,OAAe,aAIhC;AACD,QAAI,CAAC,MAAM,KAAK,mBAAmB,GAAG;AACpC,aAAO;AAAA,QACL,WAAW;AAAA,QACX,gBAAgB,CAAC,kCAAc;AAAA,QAC/B,gBAAgB,CAAC;AAAA,MACnB;AAAA,IACF;AAEA,UAAM,SAAS;AAAA;AAAA;AAAA;AAAA,EAIjB,KAAK;AAAA;AAAA;AAAA,EAGL,cAAc;AAAA;AAAA,EAAyB,WAAW;AAAA;AAAA,IAAe,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBjE,QAAI;AACF,UAAI,WAAW;AACf,YAAM,KAAK,aAAc;AAAA,QACvB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,QAClE;AAAA,UACE,SAAS,CAAC,UAAU;AAAE,wBAAY;AAAA,UAAO;AAAA,UACzC,YAAY,MAAM;AAAA,UAAC;AAAA,UACnB,SAAS,MAAM;AAAA,UAAC;AAAA,QAClB;AAAA,MACF;AAGA,YAAM,YAAY,SAAS,MAAM,4BAA4B;AAC7D,UAAI,WAAW;AACb,eAAO,KAAK,MAAM,UAAU,CAAC,CAAC;AAAA,MAChC;AAEA,aAAO;AAAA,QACL,WAAW;AAAA,QACX,gBAAgB,CAAC;AAAA,QACjB,gBAAgB,CAAC;AAAA,MACnB;AAAA,IACF,QAAQ;AACN,aAAO;AAAA,QACL,WAAW;AAAA,QACX,gBAAgB,CAAC;AAAA,QACjB,gBAAgB,CAAC;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAA8B;AAC5B,WAAO,KAAK,YAAY,MAAM,GAAG;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAwB;AACtB,SAAK,cAAc,CAAC;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,uBAAuB,MAAc,OAAuB;AAElE,UAAM,cAAc,KAAK,mBAAmB,IAAI;AAChD,UAAM,YAAY,KAAK,qBAAqB,WAAW;AAEvD,WAAO;AAAA;AAAA;AAAA;AAAA,EAIT,IAAI;AAAA;AAAA;AAAA;AAAA,EAIJ,KAAK;AAAA;AAAA,sCAEW,WAAW;AAAA,EAC3B,SAAS;AAAA;AAAA,+EAEiC,KAAK,sBAAsB,WAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBjF;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,MAAsB;AAC/C,UAAM,UAAU,KAAK,KAAK,EAAE,YAAY;AACxC,QAAI,QAAQ,WAAW,WAAW,KAAK,QAAQ,WAAW,OAAO;AAAG,aAAO;AAC3E,QAAI,QAAQ,WAAW,iBAAiB;AAAG,aAAO;AAClD,QAAI,QAAQ,WAAW,cAAc;AAAG,aAAO;AAC/C,QAAI,QAAQ,WAAW,cAAc;AAAG,aAAO;AAC/C,QAAI,QAAQ,WAAW,WAAW;AAAG,aAAO;AAC5C,QAAI,QAAQ,WAAW,OAAO;AAAG,aAAO;AACxC,QAAI,QAAQ,WAAW,KAAK;AAAG,aAAO;AACtC,QAAI,QAAQ,WAAW,SAAS;AAAG,aAAO;AAC1C,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAAsB,MAAsB;AAClD,UAAM,QAAgC;AAAA,MACpC,WAAW;AAAA,MACX,UAAU;AAAA,MACV,OAAO;AAAA,MACP,OAAO;AAAA,MACP,IAAI;AAAA,MACJ,OAAO;AAAA,MACP,KAAK;AAAA,MACL,SAAS;AAAA,IACX;AACA,WAAO,MAAM,IAAI,KAAK;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,MAAsB;AACjD,UAAM,OAA+B;AAAA,MACnC,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMX,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMV,OAAO;AAAA;AAAA;AAAA;AAAA,MAIP,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAKP,IAAI;AAAA;AAAA;AAAA;AAAA,MAIJ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAKP,KAAK;AAAA;AAAA;AAAA,MAGL,SAAS;AAAA;AAAA;AAAA;AAAA,IAIX;AACA,WAAO,KAAK,IAAI,KAAK,KAAK;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKQ,oBACN,MACA,OACA,WACA,UACQ;AACR,UAAM,OAAO,YAAY,KAAK,gBAAgB,IAAI;AAClD,UAAM,KAAK,aAAa,KAAK,qBAAqB,IAAI;AAEtD,WAAO,kFAAiB,MAAM,0BAAM;AAAA;AAAA,qCAE5B,MAAM,cAAI;AAAA,qCACV,QAAQ,cAAI;AAAA;AAAA;AAAA,QAGhB,QAAQ,EAAE;AAAA,EAChB,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,EAKJ,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAgBC,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAShB;AAAA;AAAA;AAAA;AAAA,EAKQ,oBACN,MACA,OACA,UACA,SACQ;AACR,UAAM,OAAO,YAAY,KAAK,gBAAgB,IAAI;AAElD,WAAO;AAAA;AAAA,qCAEC,QAAQ,cAAI;AAAA;AAAA;AAAA,QAGhB,QAAQ,EAAE;AAAA,EAChB,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,EAKJ,KAAK;AAAA;AAAA;AAAA,EAGL,UAAU;AAAA,EAAe,OAAO;AAAA,IAAO,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAcnC,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMhB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBACZ,QACA,MACA,cACoB;AACpB,QAAI,YAAY;AAEhB,aAAS,UAAU,GAAG,UAAU,KAAK,aAAa,WAAW;AAC3D,UAAI;AACF,cAAM,SAAS,MAAM,KAAK,YAAY,QAAQ,IAAI;AAElD,YAAI,OAAO,WAAW,OAAO,WAAW;AAEtC,gBAAM,UAAU,MAAM,KAAK,aAAa,MAAM,OAAO,SAAS;AAE9D,cAAI,SAAS;AAEX,iBAAK,YAAY,KAAK;AAAA,cACpB,WAAW,KAAK,IAAI;AAAA,cACpB;AAAA,cACA;AAAA,cACA,WAAW,OAAO;AAAA,cAClB,OAAO;AAAA,YACT,CAAC;AACD,mBAAO;AAAA,UACT,OAAO;AACL,wBAAY;AAEZ,sBAAU;AAAA;AAAA;AAAA,UACZ;AAAA,QACF,OAAO;AACL,sBAAY,OAAO,SAAS;AAAA,QAC9B;AAAA,MACF,SAAS,GAAG;AACV,oBAAY,aAAa,QAAQ,EAAE,UAAU;AAAA,MAC/C;AAAA,IACF;AAEA,WAAO;AAAA,MACL,SAAS;AAAA,MACT,OAAO,8CAAW,KAAK,WAAW,wBAAS,SAAS;AAAA,MACpD,aAAa;AAAA,QACX;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YAAY,QAAgB,MAAmC;AAC3E,WAAO,IAAI,QAAQ,CAACC,aAAY;AAC9B,UAAI,WAAW;AAEf,WAAK,aAAc;AAAA,QACjB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,QAClE;AAAA,UACE,SAAS,CAAC,UAAU;AAClB,wBAAY;AAAA,UACd;AAAA,UACA,YAAY,MAAM;AAEhB,kBAAM,YAAY,KAAK,kBAAkB,UAAU,IAAI;AACvD,kBAAM,cAAc,KAAK,oBAAoB,QAAQ;AAErD,gBAAI,WAAW;AACb,cAAAA,SAAQ;AAAA,gBACN,SAAS;AAAA,gBACT;AAAA,gBACA;AAAA,cACF,CAAC;AAAA,YACH,OAAO;AACL,cAAAA,SAAQ;AAAA,gBACN,SAAS;AAAA,gBACT,OAAO;AAAA,cACT,CAAC;AAAA,YACH;AAAA,UACF;AAAA,UACA,SAAS,CAAC,UAAU;AAClB,YAAAA,SAAQ;AAAA,cACN,SAAS;AAAA,cACT,OAAO,MAAM;AAAA,YACf,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,UAAkB,MAA8B;AAExE,QAAI;AAEJ,QAAI,SAAS,WAAW;AAEtB,kBAAY,SAAS,MAAM,+BAA+B;AAAA,IAC5D,OAAO;AAEL,kBAAY,SAAS,MAAM,gCAAgC;AAAA,IAC7D;AAEA,QAAI,aAAa,UAAU,CAAC,GAAG;AAC7B,aAAO,UAAU,CAAC,EAAE,KAAK;AAAA,IAC3B;AAGA,UAAM,QAAQ,SAAS,MAAM,IAAI;AACjC,UAAM,YAAsB,CAAC;AAC7B,QAAI,SAAS;AAEb,eAAW,QAAQ,OAAO;AACxB,UAAI,KAAK,WAAW,MAAM,KAAK,KAAK,WAAW,GAAI,GAAG;AACpD,iBAAS;AACT,kBAAU,KAAK,IAAI;AAAA,MACrB,WAAW,UAAU,KAAK,KAAK,MAAM,IAAI;AACvC,kBAAU,KAAK,IAAI;AAAA,MACrB,OAAO;AACL,iBAAS;AAAA,MACX;AAAA,IACF;AAEA,QAAI,UAAU,SAAS,GAAG;AACxB,aAAO,UAAU,KAAK,IAAI,EAAE,KAAK;AAAA,IACnC;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,UAAsC;AAChE,UAAM,WAAW;AAAA,MACf;AAAA,MACA;AAAA,IACF;AAEA,UAAM,eAAyB,CAAC;AAEhC,eAAW,WAAW,UAAU;AAC9B,YAAM,QAAQ,SAAS,MAAM,OAAO;AACpC,UAAI,SAAS,MAAM,CAAC,GAAG;AACrB,YAAI,UAAU,MAAM,CAAC,EAAE,KAAK;AAE5B,kBAAU,QACP,MAAM,IAAI,EACV,OAAO,UAAQ;AACd,gBAAM,UAAU,KAAK,KAAK;AAE1B,cAAI,CAAC;AAAS,mBAAO;AACrB,cAAI,oBAAoB,KAAK,OAAO;AAAG,mBAAO;AAE9C,cAAI,WAAW,KAAK,OAAO,KAAK,QAAQ,SAAS;AAAI,mBAAO;AAC5D,iBAAO;AAAA,QACT,CAAC,EACA,KAAK,IAAI;AAEZ,YAAI,WAAW,QAAQ,SAAS,GAAG;AACjC,uBAAa,KAAK,OAAO;AAAA,QAC3B;AAAA,MACF;AAAA,IACF;AAGA,QAAI,aAAa,WAAW,GAAG;AAC7B,aAAO;AAAA,IACT;AAEA,WAAO,aAAa,KAAK,MAAM;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAAa,MAAe,MAAgC;AACxE,QAAI,SAAS,WAAW;AACtB,aAAO,KAAK,iBAAiB,IAAI;AAAA,IACnC;AAEA,WAAO,KAAK,KAAK,EAAE,SAAS;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,MAAuB;AAE9C,UAAM,qBAAqB;AAAA,MACzB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAEA,WAAO,mBAAmB,KAAK,aAAW,QAAQ,KAAK,KAAK,KAAK,CAAC,CAAC;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,MAAsB;AAC5C,QAAI,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,cAAgB,GAAG;AACpE,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,MAAM,KAAK,KAAK,SAAS,SAAS,GAAG;AACrD,UAAI,KAAK,SAAS,WAAW,KAAK,KAAK,SAAS,QAAQ,GAAG;AACzD,eAAO;AAAA,MACT;AAAA,IACF;AACA,QAAI,KAAK,SAAS,OAAO,KAAK,KAAK,SAAS,UAAU,GAAG;AACvD,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,KAAK,KAAK,KAAK,SAAS,MAAM,GAAG;AACjD,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,UAAU,GAAG;AAC9D,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,MAAM,KAAK,KAAK,SAAS,WAAW,GAAG;AAClF,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,MAAsB;AACjD,QAAI,KAAK,SAAS,WAAW,KAAK,KAAK,SAAS,KAAK,GAAG;AACtD,UAAI,KAAK,SAAS,QAAQ;AAAG,eAAO;AACpC,UAAI,KAAK,SAAS,OAAO;AAAG,eAAO;AACnC,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,WAAW,GAAG;AACzD,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,OAAO,KAAK,KAAK,SAAS,OAAO,GAAG;AACpD,aAAO;AAAA,IACT;AACA,QAAI,KAAK,SAAS,WAAW,GAAG;AAC9B,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AACF;;;ACl1BA,IAAAC,QAAsB;AACtB,IAAAC,MAAoB;AAmMb,IAAM,0BAAN,MAA8B;AAAA,EAA9B;AACL,SAAQ,cAAc;AAAA,MACpB;AAAA,MAAgB;AAAA,MAAQ;AAAA,MAAQ;AAAA,MAAS;AAAA,MACzC;AAAA,MAAQ;AAAA,MAAS;AAAA,MAAU;AAAA,MAAY;AAAA,MAAS;AAAA,MAChD;AAAA,MAAU;AAAA,MAAO;AAAA,MAAO;AAAA,MAAS;AAAA,IACnC;AAEA,SAAQ,eAAe;AAAA,MACrB;AAAA,MAAa;AAAA,MAAa;AAAA,MAAc;AAAA,MACxC;AAAA,MAAqB;AAAA,MAAa;AAAA,IACpC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,eAAiD;AACpE,UAAM,OAAY,eAAS,aAAa;AAGxC,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,IAAI,MAAM,QAAQ,IAAI;AAAA,MACpB,KAAK,mBAAmB,aAAa;AAAA,MACrC,KAAK,gBAAgB,eAAe,CAAC;AAAA,MACrC,KAAK,kBAAkB,aAAa;AAAA,MACpC,KAAK,gBAAgB,aAAa;AAAA,MAClC,KAAK,gBAAgB,aAAa;AAAA,IACpC,CAAC;AAED,UAAM,eAAe,MAAM,KAAK,qBAAqB,eAAe,YAAY,IAAI;AACpF,UAAM,eAAe,KAAK,mBAAmB,WAAW,WAAW;AACnE,UAAM,cAAc,KAAK,iBAAiB,eAAe,WAAW;AACpE,UAAM,cAAc,KAAK,iBAAiB,aAAa;AACvD,UAAM,UAAU,KAAK,gBAAgB,eAAe,YAAY,IAAI;AAGpE,UAAM,iBAAiB,MAAM,KAAK,uBAAuB,eAAe,aAAa,YAAY;AAGjG,UAAM,gBAAgB,MAAM,KAAK,sBAAsB,eAAe,aAAa,aAAa,OAAO;AAGvG,UAAM,eAAe,MAAM,KAAK,kBAAkB,aAAa;AAG/D,UAAM,iBAAiB,KAAK,wBAAwB;AAAA,MAClD;AAAA,MACA,MAAM,YAAY;AAAA,MAClB,WAAW,YAAY;AAAA,MACvB,UAAU,YAAY;AAAA,MACtB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AAED,WAAO;AAAA,MACL;AAAA,MACA,MAAM;AAAA,MACN,MAAM,YAAY;AAAA,MAClB,WAAW,YAAY;AAAA,MACvB,UAAU,YAAY;AAAA,MACtB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,eAAe,UAAmC;AA7RpD;AA8RI,UAAM,WAAqB,CAAC;AAG5B,aAAS,KAAK,0CAAe,SAAS,IAAI;AAAA,CAAI;AAG9C,QAAI,SAAS,gBAAgB;AAC3B,YAAM,OAAO,SAAS,eAAe;AACrC,YAAM,WAAW,KAAK,kBAAkB,SAAS,eAAe,QAAQ;AAExE,UAAI,QAAQ,SAAS,oDAAY;AAC/B,iBAAS,KAAK,KAAK,IAAI;AAAA,CAAI;AAAA,MAC7B;AAGA,YAAM,YAAY,SAAS,eAAe,UAAU,MAAM,GAAG,CAAC,EAAE,KAAK,IAAI;AACzE,eAAS,KAAK,KAAK,QAAQ,QAAQ,SAAS,QAAQ,GAAG,YAAY,MAAM,SAAS,KAAK,EAAE;AAAA,CAAI;AAAA,IAC/F,OAAO;AACL,eAAS,KAAK,KAAK,SAAS,IAAI,QAAQ,SAAS,QAAQ;AAAA,CAAI;AAAA,IAC/D;AAGA,SAAI,cAAS,kBAAT,mBAAwB,WAAW;AACrC,eAAS,KAAK,iCAAgB,SAAS,cAAc,UAAU,IAAI,IAAI;AACvE,UAAI,SAAS,cAAc,cAAc;AACvC,iBAAS,KAAK,oCAAgB,SAAS,cAAc,YAAY,IAAI;AAAA,MACvE;AACA,eAAS,KAAK,EAAE;AAAA,IAClB;AAGA,UAAM,aAAa,SAAS,UAAU;AACtC,UAAM,aAAa,SAAS,UAAU;AACtC,UAAM,WAAW,aAAa,MAAQ,iBAAO,aAAa,MAAO,iBAAO;AACxE,aAAS,KAAK,+BAAc,QAAQ,iBAAO,UAAU,kBAAQ,WAAW,eAAe,CAAC;AAAA,CAAO;AAG/F,QAAI,SAAS,QAAQ,SAAS,GAAG;AAC/B,YAAM,cAAc,SAAS,QAC1B,OAAO,OAAK,EAAE,eAAe,CAAC,OAAO,OAAO,OAAO,MAAM,EAAE,SAAS,EAAE,KAAK,YAAY,CAAC,CAAC,EACzF,MAAM,GAAG,CAAC;AAEb,UAAI,YAAY,SAAS,GAAG;AAC1B,iBAAS,KAAK,wCAAa;AAC3B,mBAAW,OAAO,aAAa;AAC7B,mBAAS,KAAK,OAAO,IAAI,IAAI,OAAO,IAAI,eAAe,EAAE,EAAE;AAAA,QAC7D;AACA,iBAAS,KAAK,EAAE;AAAA,MAClB;AAAA,IACF;AAGA,QAAI,SAAS,aAAa,QAAQ,SAAS,GAAG;AAC5C,YAAM,UAAU,SAAS,aAAa,QAAQ,MAAM,GAAG,CAAC;AACxD,eAAS,KAAK,2CAAgB,QAAQ,KAAK,IAAI,CAAC,GAAG,SAAS,aAAa,QAAQ,SAAS,IAAI,QAAQ,EAAE;AAAA,CAAI;AAAA,IAC9G;AAGA,QAAI,SAAS,QAAQ,SAAS,GAAG;AAC/B,YAAM,mBAAmB,SAAS,QAC/B,OAAO,OAAK,CAAC,OAAO,SAAS,SAAS,MAAM,EAAE,SAAS,EAAE,KAAK,YAAY,CAAC,CAAC,EAC5E,MAAM,GAAG,CAAC;AAEb,UAAI,iBAAiB,SAAS,GAAG;AAC/B,cAAM,YAAY,iBAAiB,IAAI,OAAK,KAAK,EAAE,IAAI,IAAI,EAAE,KAAK,KAAK;AACvE,iBAAS,KAAK,+BAAc,SAAS;AAAA,CAAI;AAAA,MAC3C;AAAA,IACF;AAGA,aAAS,KAAK,KAAK;AACnB,aAAS,KAAK,0DAAgB;AAC9B,aAAS,KAAK,0GAAqB;AACnC,aAAS,KAAK,uFAAsB;AACpC,aAAS,KAAK,iGAAsB;AAEpC,WAAO,SAAS,KAAK,IAAI;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,UAAmC;AAC3D,UAAM,SAA0C;AAAA,MAC9C,gBAAgB;AAAA,MAChB,eAAe;AAAA,MACf,aAAa;AAAA,MACb,YAAY;AAAA,MACZ,WAAW;AAAA,MACX,oBAAoB;AAAA,MACpB,cAAc;AAAA,MACd,eAAe;AAAA,MACf,eAAe;AAAA,MACf,mBAAmB;AAAA,MACnB,SAAS;AAAA,MACT,WAAW;AAAA,IACb;AACA,WAAO,OAAO,QAAQ,KAAK;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,SAA6C;AACpE,UAAM,SAAqD;AAAA,MACzD,UAAU;AAAA,MACV,aAAa;AAAA,MACb,gBAAgB;AAAA,MAChB,OAAO;AAAA,MACP,SAAS;AAAA,MACT,gBAAgB;AAAA,MAChB,SAAS;AAAA,IACX;AACA,WAAO,OAAO,OAAO,KAAK;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,MAAqB,SAAiB,IAAI,SAAkB,MAAc;AACrG,QAAI,SAAS;AACb,UAAM,aAAa,UAAU,SAAS,wBAAS;AAC/C,UAAM,cAAc,UAAU,SAAS,SAAS;AAGhD,QAAI,WAAW,IAAI;AACjB,eAAS,GAAG,KAAK,IAAI;AAAA;AAAA,IACvB,OAAO;AACL,YAAM,OAAO,KAAK,SAAS,cAAc,cAAO;AAChD,YAAM,OAAO,KAAK,SAAS,cAAc,GAAG,KAAK,IAAI,MAAM,KAAK;AAChE,eAAS,GAAG,UAAU,GAAG,IAAI,IAAI,IAAI;AAAA;AAAA,IACvC;AAGA,QAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAE7C,YAAM,iBAAiB,CAAC,GAAG,KAAK,QAAQ,EAAE,KAAK,CAAC,GAAG,MAAM;AACvD,YAAI,EAAE,SAAS,EAAE;AAAM,iBAAO,EAAE,KAAK,cAAc,EAAE,IAAI;AACzD,eAAO,EAAE,SAAS,cAAc,KAAK;AAAA,MACvC,CAAC;AAGD,YAAM,eAAe;AACrB,YAAM,iBAAiB,eAAe,MAAM,GAAG,YAAY;AAC3D,YAAM,UAAU,eAAe,SAAS;AAExC,qBAAe,QAAQ,CAAC,OAAO,UAAU;AACvC,cAAM,cAAc,UAAU,eAAe,SAAS,KAAK,CAAC;AAC5D,kBAAU,KAAK,qBAAqB,OAAO,WAAW,KAAK,KAAK,aAAa,WAAW;AAAA,MAC1F,CAAC;AAED,UAAI,SAAS;AACX,kBAAU,GAAG,WAAW,wCAAe,eAAe,SAAS,YAAY;AAAA;AAAA,MAC7E;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,qBAAqB,UAAmC;AAjc1D;AAkcI,UAAM,WAAqB,CAAC;AAG5B,aAAS,KAAK,mCAAU;AACxB,aAAS,KAAK,qBAAW,SAAS,IAAI,EAAE;AACxC,aAAS,KAAK,qBAAW,SAAS,IAAI,GAAG,SAAS,YAAY,KAAK,SAAS,SAAS,MAAM,EAAE,EAAE;AAC/F,aAAS,KAAK,qBAAW,SAAS,QAAQ,EAAE;AAC5C,aAAS,KAAK,qBAAW,SAAS,UAAU,UAAU,kBAAQ,SAAS,UAAU,WAAW,eAAe,CAAC,SAAI;AAGhH,SAAI,cAAS,mBAAT,mBAAyB,aAAa;AACxC,eAAS,KAAK;AAAA,gCAAe,SAAS,eAAe,WAAW,EAAE;AAAA,IACpE;AAGA,UAAI,oBAAS,mBAAT,mBAAyB,cAAzB,mBAAoC,UAAS,GAAG;AAClD,eAAS,KAAK,2BAAY,SAAS,eAAe,UAAU,KAAK,IAAI,CAAC,EAAE;AAAA,IAC1E;AAGA,SAAI,cAAS,kBAAT,mBAAwB,WAAW;AACrC,eAAS,KAAK;AAAA,0BAAc,SAAS,cAAc,UAAU,IAAI,EAAE;AAAA,IACrE;AACA,SAAI,cAAS,kBAAT,mBAAwB,cAAc;AACxC,eAAS,KAAK,iCAAa,SAAS,cAAc,YAAY,EAAE;AAAA,IAClE;AAGA,QAAI,SAAS,QAAQ,SAAS,GAAG;AAC/B,eAAS,KAAK;AAAA,8BAAa;AAC3B,iBAAW,KAAK,SAAS,QAAQ,MAAM,GAAG,EAAE,GAAG;AAC7C,iBAAS,KAAK,KAAK,EAAE,IAAI,MAAM,EAAE,eAAe,EAAE,IAAI,EAAE;AAAA,MAC1D;AAAA,IACF;AAGA,QAAI,SAAS,aAAa,SAAS;AACjC,eAAS,KAAK;AAAA,gCAAe,SAAS,aAAa,OAAO,EAAE;AAAA,IAC9D;AACA,QAAI,SAAS,aAAa,cAAc,SAAS,GAAG;AAClD,eAAS,KAAK,iCAAa,SAAS,aAAa,cAAc,KAAK,IAAI,CAAC,EAAE;AAAA,IAC7E;AAGA,QAAI,SAAS,aAAa,QAAQ,SAAS,GAAG;AAC5C,eAAS,KAAK;AAAA,gCAAe,SAAS,aAAa,QAAQ,MAAM,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,EAAE;AAAA,IACtF;AAGA,UAAI,cAAS,iBAAT,mBAAuB,UAAS,GAAG;AACrC,YAAM,SAAS,SAAS,aAAa,KAAK,OAAK,EAAE,YAAY,QAAQ;AACrE,UAAI,iCAAQ,SAAS;AACnB,iBAAS,KAAK;AAAA,yBAAkB;AAChC,iBAAS,KAAK,OAAO,QAAQ,MAAM,GAAG,GAAG,CAAC;AAAA,MAC5C;AAAA,IACF;AAEA,aAAS,KAAK;AAAA,IAAO;AACrB,aAAS,KAAK,oHAAqB;AAEnC,WAAO,SAAS,KAAK,IAAI;AAAA,EAC3B;AAAA;AAAA,EAIA,MAAc,mBAAmB,MAI9B;AACD,UAAM,QAAW,gBAAY,IAAI;AACjC,QAAI,OAAO;AACX,QAAI;AACJ,QAAI,WAAW;AAGf,UAAM,oBAAyC,oBAAI,IAAI;AAGvD,QAAI,MAAM,SAAS,cAAc,GAAG;AAClC,aAAO;AACP,iBAAW;AAEX,UAAI;AACF,cAAM,MAAM,KAAK,MAAS,iBAAkB,WAAK,MAAM,cAAc,GAAG,OAAO,CAAC;AAChF,cAAM,OAAO,EAAE,GAAG,IAAI,cAAc,GAAG,IAAI,gBAAgB;AAG3D,YAAI,KAAK,OAAO,KAAK,KAAK,MAAM;AAAG,sBAAY;AAAA,iBACtC,KAAK,OAAO;AAAG,sBAAY;AAAA,iBAC3B,KAAK,KAAK,KAAK,KAAK,MAAM;AAAG,sBAAY;AAAA,iBACzC,KAAK,KAAK;AAAG,sBAAY;AAAA,iBACzB,KAAK,eAAe;AAAG,sBAAY;AAAA,iBACnC,KAAK,QAAQ;AAAG,sBAAY;AAAA,iBAC5B,KAAK,SAAS;AAAG,sBAAY;AAAA,iBAC7B,KAAK,SAAS;AAAG,sBAAY;AAAA,iBAC7B,KAAK,QAAQ,KAAK,KAAK,cAAc;AAAG,sBAAY;AAAA,iBACpD,KAAK,KAAK;AAAG,sBAAY;AAAA,iBACzB,KAAK,QAAQ;AAAG,sBAAY;AAAA,iBAC5B,KAAK,UAAU;AAAG,sBAAY;AAGvC,YAAI,KAAK,YAAY,KAAK,MAAM,SAAS,eAAe,GAAG;AACzD,qBAAW;AAAA,QACb;AAAA,MACF,QAAQ;AAAA,MAAC;AAAA,IACX,WAES,MAAM,SAAS,kBAAkB,KAAK,MAAM,SAAS,UAAU,KAAK,MAAM,SAAS,gBAAgB,GAAG;AAC7G,aAAO;AACP,iBAAW;AAEX,UAAI,MAAM,SAAS,WAAW;AAAG,oBAAY;AAAA,WACxC;AAEH,cAAM,aAAa,CAAC,UAAU,WAAW,QAAQ;AACjD,mBAAW,KAAK,YAAY;AAC1B,cAAI,MAAM,SAAS,CAAC,GAAG;AACrB,gBAAI;AACF,oBAAM,UAAa,iBAAkB,WAAK,MAAM,CAAC,GAAG,OAAO;AAC3D,kBAAI,QAAQ,SAAS,OAAO;AAAG,4BAAY;AAAA,uBAClC,QAAQ,SAAS,SAAS;AAAG,4BAAY;AAAA,uBACzC,QAAQ,SAAS,QAAQ;AAAG,4BAAY;AAAA,YACnD,QAAQ;AAAA,YAAC;AAAA,UACX;AAAA,QACF;AAAA,MACF;AAAA,IACF,WAES,MAAM,SAAS,QAAQ,GAAG;AACjC,aAAO;AACP,iBAAW;AAEX,UAAI;AACF,cAAM,aAAgB,iBAAkB,WAAK,MAAM,QAAQ,GAAG,OAAO;AACrE,YAAI,WAAW,SAAS,WAAW;AAAG,sBAAY;AAAA,iBACzC,WAAW,SAAS,MAAM;AAAG,sBAAY;AAAA,iBACzC,WAAW,SAAS,OAAO;AAAG,sBAAY;AAAA,MACrD,QAAQ;AAAA,MAAC;AAAA,IACX,WAES,MAAM,SAAS,YAAY,GAAG;AACrC,aAAO;AACP,iBAAW;AAAA,IACb,WAES,MAAM,SAAS,SAAS,GAAG;AAClC,aAAO;AACP,iBAAW;AACX,kBAAY;AAAA,IACd,WACS,MAAM,SAAS,cAAc,KAAK,MAAM,SAAS,kBAAkB,GAAG;AAC7E,aAAO;AACP,iBAAW;AACX,kBAAY;AAAA,IACd;AAGA,QAAI,CAAC,QAAQ,CAAC,UAAU;AACtB,YAAM,iBAAiB,MAAM,KAAK,sBAAsB,IAAI;AAG5D,UAAI,WAAW;AACf,UAAI,cAAc;AAClB,iBAAW,CAAC,MAAM,KAAK,KAAK,OAAO,QAAQ,cAAc,GAAG;AAC1D,YAAI,QAAQ,UAAU;AACpB,qBAAW;AACX,wBAAc;AAAA,QAChB;AAAA,MACF;AAEA,UAAI,aAAa;AACf,mBAAW;AAEX,cAAM,aAAqC;AAAA,UACzC,cAAc;AAAA,UACd,cAAc;AAAA,UACd,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,QAAQ;AAAA,UACR,KAAK;AAAA,UACL,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,UACP,SAAS;AAAA,UACT,UAAU;AAAA,UACV,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QACT;AACA,eAAO,WAAW,WAAW,KAAK,GAAG,WAAW;AAAA,MAClD;AAAA,IACF;AAGA,QAAI,CAAC;AAAM,aAAO;AAClB,QAAI,CAAC;AAAU,iBAAW;AAE1B,WAAO,EAAE,MAAM,WAAW,SAAS;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAsB,MAA+C;AACjF,UAAM,SAAiC,CAAC;AAExC,UAAM,OAAO,CAAC,KAAa,QAAgB,MAAM;AAC/C,UAAI,QAAQ;AAAG;AAEf,UAAI;AACF,cAAM,UAAa,gBAAY,KAAK,EAAE,eAAe,KAAK,CAAC;AAE3D,mBAAW,SAAS,SAAS;AAC3B,cAAI,MAAM,KAAK,WAAW,GAAG,KAAK,KAAK,YAAY,SAAS,MAAM,IAAI,GAAG;AACvE;AAAA,UACF;AAEA,gBAAM,WAAgB,WAAK,KAAK,MAAM,IAAI;AAE1C,cAAI,MAAM,YAAY,GAAG;AACvB,iBAAK,UAAU,QAAQ,CAAC;AAAA,UAC1B,OAAO;AACL,kBAAM,OAAO,KAAK,aAAa,MAAM,IAAI;AACzC,gBAAI,SAAS,WAAW;AACtB,qBAAO,IAAI,KAAK,OAAO,IAAI,KAAK,KAAK;AAAA,YACvC;AAAA,UACF;AAAA,QACF;AAAA,MACF,QAAQ;AAAA,MAAC;AAAA,IACX;AAEA,SAAK,IAAI;AACT,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,gBAAgB,KAAa,UAAkB,eAAe,GAA2B;AA/qBzG;AAgrBI,UAAM,OAAY,eAAS,GAAG;AAC9B,UAAM,OAAsB;AAAA,MAC1B;AAAA,MACA,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU,CAAC;AAAA,IACb;AAEA,QAAI,gBAAgB,UAAU;AAC5B,aAAO;AAAA,IACT;AAEA,QAAI;AACF,YAAM,UAAa,gBAAY,KAAK,EAAE,eAAe,KAAK,CAAC;AAE3D,iBAAW,SAAS,SAAS;AAC3B,YAAI,MAAM,KAAK,WAAW,GAAG,KACzB,KAAK,YAAY,SAAS,MAAM,IAAI,KACpC,KAAK,aAAa,SAAS,MAAM,IAAI,GAAG;AAC1C;AAAA,QACF;AAEA,cAAM,WAAgB,WAAK,KAAK,MAAM,IAAI;AAE1C,YAAI,MAAM,YAAY,GAAG;AACvB,gBAAM,YAAY,MAAM,KAAK,gBAAgB,UAAU,UAAU,eAAe,CAAC;AACjF,qBAAK,aAAL,mBAAe,KAAK;AAAA,QACtB,OAAO;AACL,qBAAK,aAAL,mBAAe,KAAK;AAAA,YAClB,MAAM,MAAM;AAAA,YACZ,MAAM;AAAA,YACN,MAAM;AAAA,YACN,UAAU,KAAK,aAAa,MAAM,IAAI;AAAA,UACxC;AAAA,QACF;AAAA,MACF;AAAA,IACF,QAAQ;AAAA,IAAC;AAET,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,kBAAkB,MAAkC;AAChE,UAAM,QAAmB;AAAA,MACvB,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,YAAY,CAAC;AAAA,MACb,aAAa,CAAC;AAAA,IAChB;AAEA,UAAM,OAAO,CAAC,KAAa,SAAiB,OAAO;AACjD,UAAI;AACF,cAAM,UAAa,gBAAY,KAAK,EAAE,eAAe,KAAK,CAAC;AAE3D,mBAAW,SAAS,SAAS;AAC3B,cAAI,MAAM,KAAK,WAAW,GAAG,KAAK,KAAK,YAAY,SAAS,MAAM,IAAI,GAAG;AACvE;AAAA,UACF;AAEA,gBAAM,WAAgB,WAAK,KAAK,MAAM,IAAI;AAC1C,gBAAM,UAAe,WAAK,QAAQ,MAAM,IAAI;AAE5C,cAAI,MAAM,YAAY,GAAG;AACvB,iBAAK,UAAU,OAAO;AAAA,UACxB,OAAO;AACL,kBAAM,MAAW,cAAQ,MAAM,IAAI,EAAE,YAAY;AACjD,kBAAM,OAAO,KAAK,aAAa,MAAM,IAAI;AAEzC,gBAAI,SAAS,WAAW;AACtB,oBAAM,QAAQ,KAAK,YAAY,QAAQ;AAEvC,oBAAM;AACN,oBAAM,cAAc;AAEpB,kBAAI,CAAC,MAAM,WAAW,IAAI,GAAG;AAC3B,sBAAM,WAAW,IAAI,IAAI,EAAE,OAAO,GAAG,OAAO,EAAE;AAAA,cAChD;AACA,oBAAM,WAAW,IAAI,EAAE;AACvB,oBAAM,WAAW,IAAI,EAAE,SAAS;AAEhC,oBAAM,SAAS,OAAO,MAAW,SAAG,EAAE,CAAC,KAAK;AAC5C,kBAAI,CAAC,MAAM,YAAY,MAAM,GAAG;AAC9B,sBAAM,YAAY,MAAM,IAAI,EAAE,OAAO,GAAG,OAAO,EAAE;AAAA,cACnD;AACA,oBAAM,YAAY,MAAM,EAAE;AAC1B,oBAAM,YAAY,MAAM,EAAE,SAAS;AAAA,YACrC;AAAA,UACF;AAAA,QACF;AAAA,MACF,QAAQ;AAAA,MAAC;AAAA,IACX;AAEA,SAAK,IAAI;AACT,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,gBAAgB,MAAqC;AACjE,UAAM,UAAwB,CAAC;AAC/B,UAAM,UAAU;AAAA,MAAC;AAAA,MAAO;AAAA,MAAO;AAAA,MAAO;AAAA,MAAc;AAAA,MAAS;AAAA,MAAO;AAAA,MACnD;AAAA,MAAS;AAAA,MAAS;AAAA,MAAS;AAAA,MAAU;AAAA,MAAe;AAAA,MACpD;AAAA,MAAU;AAAA,MAAc;AAAA,MAAU;AAAA,MAAS;AAAA,IAAY;AAExE,eAAW,OAAO,SAAS;AACzB,YAAM,UAAe,WAAK,MAAM,GAAG;AACnC,UAAO,eAAW,OAAO,KAAQ,aAAS,OAAO,EAAE,YAAY,GAAG;AAChE,cAAM,MAAkB;AAAA,UACtB,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM,KAAK,iBAAiB,GAAG;AAAA,UAC/B,aAAa,KAAK,sBAAsB,GAAG;AAAA,QAC7C;AAGA,YAAI;AACF,gBAAM,UAAa,gBAAY,SAAS,EAAE,eAAe,KAAK,CAAC,EAC5D,OAAO,OAAK,EAAE,YAAY,KAAK,CAAC,EAAE,KAAK,WAAW,GAAG,CAAC,EACtD,IAAI,OAAK,EAAE,IAAI;AAElB,cAAI,QAAQ,SAAS,GAAG;AACtB,gBAAI,UAAU,QAAQ,MAAM,GAAG,EAAE;AAAA,UACnC;AAAA,QACF,QAAQ;AAAA,QAAC;AAET,gBAAQ,KAAK,GAAG;AAAA,MAClB;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,qBAAqB,MAAc,aAA8C;AAC7F,UAAM,OAAuB;AAAA,MAC3B,SAAS,CAAC;AAAA,MACV,aAAa,CAAC;AAAA,MACd,OAAO;AAAA,IACT;AAEA,QAAI,YAAY,SAAS,MAAM,GAAG;AAChC,UAAI;AACF,cAAM,MAAM,KAAK,MAAS,iBAAkB,WAAK,MAAM,cAAc,GAAG,OAAO,CAAC;AAChF,aAAK,UAAU,OAAO,KAAK,IAAI,gBAAgB,CAAC,CAAC;AACjD,aAAK,cAAc,OAAO,KAAK,IAAI,mBAAmB,CAAC,CAAC;AACxD,aAAK,QAAQ,KAAK,QAAQ,SAAS,KAAK,YAAY;AAAA,MACtD,QAAQ;AAAA,MAAC;AAAA,IACX,WAAW,gBAAgB,UAAU;AACnC,UAAI;AACF,YAAO,eAAgB,WAAK,MAAM,kBAAkB,CAAC,GAAG;AACtD,gBAAM,UAAa,iBAAkB,WAAK,MAAM,kBAAkB,GAAG,OAAO;AAC5E,eAAK,UAAU,QAAQ,MAAM,IAAI,EAC9B,OAAO,OAAK,EAAE,KAAK,KAAK,CAAC,EAAE,WAAW,GAAG,CAAC,EAC1C,IAAI,OAAK,EAAE,MAAM,IAAI,EAAE,CAAC,EAAE,MAAM,IAAI,EAAE,CAAC,EAAE,KAAK,CAAC;AAClD,eAAK,QAAQ,KAAK,QAAQ;AAAA,QAC5B;AAAA,MACF,QAAQ;AAAA,MAAC;AAAA,IACX;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,gBAAgB,MAA0C;AACtE,UAAM,QAAW,gBAAY,IAAI;AAEjC,WAAO;AAAA,MACL,UAAU,MAAM,KAAK,OAAK,CAAC,QAAQ,SAAS,aAAa,MAAM,EAAE,SAAS,CAAC,CAAC,KAClE,MAAM,KAAK,OAAK,EAAE,SAAS,QAAQ,KAAK,EAAE,SAAS,QAAQ,CAAC;AAAA,MACtE,YAAY,MAAM,SAAS,cAAc,KAAK,MAAM,SAAS,gBAAgB,KACjE,MAAM,SAAS,aAAa,KAAK,MAAM,SAAS,YAAY;AAAA,MACxE,eAAe,MAAM,SAAS,eAAe;AAAA,MAC7C,OAAO,MAAM,SAAS,SAAS,KAAK,MAAM,SAAS,gBAAgB,KAC5D,MAAM,SAAS,aAAa,KAAK,MAAM,SAAS,WAAW;AAAA,MAClE,kBAAkB,MAAM,SAAS,WAAW,KAAK,MAAM,SAAS,MAAM,KACpD,MAAM,SAAS,cAAc;AAAA,IACjD;AAAA,EACF;AAAA,EAEQ,mBAAmB,WAA0B,aAAqE;AA91B5H;AA+1BI,UAAM,SAAO,eAAU,aAAV,mBAAoB,IAAI,OAAK,EAAE,UAAS,CAAC;AACtD,UAAM,SAAmB,CAAC;AAC1B,UAAM,gBAA0B,CAAC;AACjC,QAAI;AAGJ,QAAI,KAAK,SAAS,aAAa,KAAK,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,OAAO,GAAG;AACrF,gBAAU;AACV,aAAO,KAAK,SAAS,eAAe,QAAQ;AAAA,IAC9C,WAAW,KAAK,SAAS,YAAY,KAAK,KAAK,SAAS,OAAO,GAAG;AAChE,gBAAU;AACV,aAAO,KAAK,cAAc,WAAW,OAAO;AAAA,IAC9C,WAAW,KAAK,SAAS,OAAO,KAAK,KAAK,SAAS,YAAY,GAAG;AAChE,gBAAU;AACV,aAAO,KAAK,SAAS,cAAc,OAAO;AAAA,IAC5C,WAAW,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,gBAAgB,GAAG;AACrE,gBAAU;AACV,aAAO,KAAK,gBAAgB,UAAU,gBAAgB;AAAA,IACxD,WAAW,KAAK,SAAS,UAAU,KAAK,KAAK,SAAS,KAAK,GAAG;AAC5D,gBAAU;AACV,aAAO,KAAK,OAAO,YAAY,MAAM;AAAA,IACvC;AAGA,UAAM,gBAAgB,CAAC,OAAO,OAAO,OAAO,QAAQ,OAAO,UAAU;AACrE,eAAW,OAAO,eAAe;AAC/B,UAAI,KAAK,SAAS,GAAG,GAAG;AACtB,sBAAc,KAAK,GAAG;AAAA,MACxB;AAAA,IACF;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,uBACZ,MACA,aACA,cACyB;AACzB,QAAI,cAAc;AAClB,QAAI,WAA4B;AAChC,UAAM,WAAqB,CAAC;AAC5B,UAAM,YAAsB,CAAC;AAC7B,QAAI;AAGJ,QAAI;AACF,YAAM,UAAe,WAAK,MAAM,cAAc;AAC9C,UAAO,eAAW,OAAO,GAAG;AAC1B,cAAM,MAAM,KAAK,MAAS,iBAAa,SAAS,OAAO,CAAC;AACxD,YAAI,IAAI,aAAa;AACnB,wBAAc,IAAI;AAAA,QACpB;AAEA,YAAI,IAAI,YAAY,MAAM,QAAQ,IAAI,QAAQ,GAAG;AAC/C,mBAAS,KAAK,GAAG,IAAI,SAAS,MAAM,GAAG,CAAC,CAAC;AAAA,QAC3C;AAAA,MACF;AAAA,IACF,QAAQ;AAAA,IAAC;AAGT,QAAI;AACF,YAAM,aAAkB,WAAK,MAAM,WAAW;AAC9C,UAAO,eAAW,UAAU,GAAG;AAC7B,cAAM,SAAY,iBAAa,YAAY,OAAO;AAGlD,YAAI,CAAC,aAAa;AAChB,gBAAM,iBAAiB,OAAO,MAAM,6BAA6B;AACjE,cAAI,gBAAgB;AAClB,0BAAc,eAAe,CAAC,EAAE,KAAK,EAAE,MAAM,GAAG,GAAG;AAAA,UACrD;AAAA,QACF;AAGA,cAAM,gBAAgB,OAAO,MAAM,oDAAoD;AACvF,YAAI,eAAe;AACjB,gBAAM,cAAc,cAAc,CAAC,EAAE,MAAM,cAAc;AACzD,cAAI,aAAa;AACf,qBAAS,KAAK,GAAG,YAAY,MAAM,GAAG,CAAC,EAAE,IAAI,OAAK,EAAE,QAAQ,YAAY,EAAE,EAAE,KAAK,CAAC,CAAC;AAAA,UACrF;AAAA,QACF;AAAA,MACF;AAAA,IACF,QAAQ;AAAA,IAAC;AAGT,eAAW,KAAK,uBAAuB,aAAa,cAAc,IAAI;AAGtE,QAAI,YAAY,WAAW;AACzB,gBAAU,KAAK,YAAY,SAAS;AAAA,IACtC;AACA,cAAU,KAAK,YAAY,QAAQ;AAGnC,UAAM,WAAW,KAAK,0BAA0B,aAAa,OAAO;AACpE,cAAU,KAAK,GAAG,QAAQ;AAG1B,qBAAiB,KAAK,qBAAqB,UAAU,QAAQ;AAE7D,WAAO;AAAA,MACL,aAAa,eAAe,GAAG,YAAY,IAAI;AAAA,MAC/C;AAAA,MACA,UAAU,CAAC,GAAG,IAAI,IAAI,QAAQ,CAAC,EAAE,MAAM,GAAG,EAAE;AAAA,MAC5C;AAAA,MACA,WAAW,CAAC,GAAG,IAAI,IAAI,SAAS,CAAC,EAAE,MAAM,GAAG,CAAC;AAAA,IAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,uBACN,aACA,cACA,MACiB;AA39BrB;AA49BI,UAAM,OAAO,aAAa,QAAQ,KAAK,GAAG,EAAE,YAAY;AACxD,UAAM,UAAU,aAAa,YAAY,KAAK,GAAG,EAAE,YAAY;AAC/D,UAAM,cAAY,iBAAY,cAAZ,mBAAuB,kBAAiB;AAC1D,UAAM,QAAW,gBAAY,IAAI;AAGjC,QAAI,KAAK,SAAS,QAAQ,KAAK,MAAM,SAAS,eAAe,GAAG;AAC9D,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,WAAW,KAAK,KAAK,SAAS,OAAO,KAAK,KAAK,SAAS,UAAU,KAChF,KAAK,SAAS,OAAO,KAAK,KAAK,SAAS,KAAK,KAAK,KAAK,SAAS,UAAU,GAAG;AAC/E,aAAO;AAAA,IACT;AAGA,QAAI,UAAU,SAAS,OAAO,KAAK,UAAU,SAAS,KAAK,KAAK,UAAU,SAAS,SAAS,KACxF,UAAU,SAAS,QAAQ,KAAK,UAAU,SAAS,MAAM,KAAK,UAAU,SAAS,MAAM,GAAG;AAC5F,UAAI,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,KAAK,GAAG;AAChF,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,KAAK,KAC3E,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,MAAM,KAAK,KAAK,SAAS,OAAO,KACzE,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,SAAS,GAAG;AACvD,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,MAAM,KAC3E,MAAM,SAAS,cAAc,KAAK,MAAM,SAAS,cAAc,GAAG;AACpE,aAAO;AAAA,IACT;AAGA,QAAI,MAAM,SAAS,kBAAkB,KAAK,MAAM,SAAS,gBAAgB,KACrE,QAAQ,SAAS,QAAQ,KAAK,QAAQ,SAAS,MAAM,KACrD,YAAY,KAAK,YAAY,EAAE,SAAS,SAAS,GAAG;AACtD,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,MAAM,KACrD,MAAM,SAAS,SAAS,KAAK,MAAM,SAAS,KAAK,GAAG;AACtD,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,UAAU,KAAK,KAAK,SAAS,OAAO,GAAG;AACvD,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,QAAQ,KAAK,KAAK,SAAS,OAAO,KAAK,KAAK,SAAS,MAAM,KACzE,KAAK,SAAS,cAAc,GAAG;AACjC,aAAO;AAAA,IACT;AAGA,QAAI,KAAK,SAAS,YAAY,KAAK,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,OAAO,KAChF,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,WAAW,KAAK,KAAK,SAAS,QAAQ,GAAG;AAC1F,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAA0B,MAA0B;AAC1D,UAAM,YAAsB,CAAC;AAC7B,UAAM,UAAkC;AAAA,MACtC,SAAS;AAAA,MACT,OAAO;AAAA,MACP,WAAW;AAAA,MACX,UAAU;AAAA,MACV,WAAW;AAAA,MACX,WAAW;AAAA,MACX,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,WAAW;AAAA,MACX,aAAa;AAAA,MACb,eAAe;AAAA,MACf,YAAY;AAAA,MACZ,UAAU;AAAA,IACZ;AAEA,eAAW,OAAO,MAAM;AACtB,YAAM,WAAW,IAAI,YAAY;AACjC,iBAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,OAAO,GAAG;AAClD,YAAI,SAAS,SAAS,GAAG,GAAG;AAC1B,oBAAU,KAAK,KAAK;AAAA,QACtB;AAAA,MACF;AAAA,IACF;AAEA,WAAO,CAAC,GAAG,IAAI,IAAI,SAAS,CAAC;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,UAA2B,UAAwC;AAC9F,UAAM,cAA+C;AAAA,MACnD,gBAAgB;AAAA,MAChB,eAAe;AAAA,MACf,aAAa;AAAA,MACb,YAAY;AAAA,MACZ,WAAW;AAAA,MACX,oBAAoB;AAAA,MACpB,cAAc;AAAA,MACd,eAAe;AAAA,MACf,eAAe;AAAA,MACf,mBAAmB;AAAA,MACnB,SAAS;AAAA,MACT,WAAW;AAAA,IACb;AACA,WAAO,YAAY,QAAQ,KAAK;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBACZ,MACA,aACA,aACA,SACwB;AACxB,QAAI,YAA+B;AACnC,QAAI,eAA8B;AAClC,UAAM,YAAwB,CAAC;AAC/B,UAAM,qBAAyC,CAAC;AAGhD,gBAAY,MAAM,KAAK,eAAe,MAAM,aAAa,WAAW;AAGpE,mBAAe,KAAK,kBAAkB,MAAM,WAAW;AAGvD,QAAI,WAAW;AACb,YAAM,QAAQ,MAAM,KAAK,kBAAkB,MAAM,WAAW,WAAW;AACvE,gBAAU,KAAK,GAAG,KAAK;AAAA,IACzB;AAGA,UAAM,OAAO,MAAM,KAAK,2BAA2B,MAAM,uCAAW,IAAI;AACxE,uBAAmB,KAAK,GAAG,IAAI;AAG/B,UAAM,WAAW,KAAK,6BAA6B,aAAa,SAAS;AAEzE,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eACZ,MACA,aACA,aAC4B;AA/oChC;AAipCI,QAAI;AACF,YAAM,UAAe,WAAK,MAAM,cAAc;AAC9C,UAAO,eAAW,OAAO,GAAG;AAC1B,cAAM,MAAM,KAAK,MAAS,iBAAa,SAAS,OAAO,CAAC;AAGxD,YAAI,IAAI,UAAQ,SAAI,YAAJ,mBAAa,SAAQ;AACnC,iBAAO;AAAA,YACL,MAAM,IAAI;AAAA,YACV,MAAM;AAAA,YACN,aAAa;AAAA,YACb,SAAS,CAAC,YAAY,YAAY;AAAA,UACpC;AAAA,QACF;AAGA,YAAI,IAAI,MAAM;AACZ,iBAAO;AAAA,YACL,MAAM,IAAI;AAAA,YACV,MAAM;AAAA,YACN,aAAa;AAAA,UACf;AAAA,QACF;AAAA,MACF;AAAA,IACF,QAAQ;AAAA,IAAC;AAGT,UAAM,cAAY,iBAAY,cAAZ,mBAAuB,kBAAiB;AAE1D,QAAI,UAAU,SAAS,MAAM,GAAG;AAC9B,aAAO;AAAA,QACL,MAAM;AAAA,QACN,MAAM;AAAA,QACN,aAAa;AAAA,MACf;AAAA,IACF;AAEA,QAAI,UAAU,SAAS,OAAO,GAAG;AAC/B,iBAAW,SAAS,CAAC,iBAAiB,gBAAgB,gBAAgB,aAAa,GAAG;AACpF,YAAO,eAAgB,WAAK,MAAM,KAAK,CAAC,GAAG;AACzC,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,MAAM;AAAA,YACN,aAAa;AAAA,UACf;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,QAAI,UAAU,SAAS,KAAK,GAAG;AAC7B,iBAAW,SAAS,CAAC,eAAe,aAAa,GAAG;AAClD,YAAO,eAAgB,WAAK,MAAM,KAAK,CAAC,GAAG;AACzC,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,MAAM;AAAA,YACN,aAAa;AAAA,UACf;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA,eAAW,SAAS,CAAC,gBAAgB,cAAc,iBAAiB,aAAa,GAAG;AAClF,UAAO,eAAgB,WAAK,MAAM,KAAK,CAAC,GAAG;AACzC,eAAO;AAAA,UACL,MAAM;AAAA,UACN,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,IACF;AAGA,QAAI,YAAY,SAAS,GAAG;AAC1B,aAAO;AAAA,QACL,MAAM,YAAY,CAAC;AAAA,QACnB,MAAM;AAAA,QACN,aAAa;AAAA,MACf;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,MAAc,aAA8C;AAxuCxF;AAyuCI,QAAI;AACF,YAAM,UAAe,WAAK,MAAM,cAAc;AAC9C,UAAO,eAAW,OAAO,GAAG;AAC1B,cAAM,MAAM,KAAK,MAAS,iBAAa,SAAS,OAAO,CAAC;AAGxD,aAAI,SAAI,YAAJ,mBAAa,QAAQ;AACvB,iBAAO;AAAA,QACT;AAGA,aAAI,SAAI,YAAJ,mBAAa;AAAK,iBAAO;AAC7B,aAAI,SAAI,YAAJ,mBAAa;AAAO,iBAAO;AAC/B,aAAI,SAAI,YAAJ,mBAAa;AAAO,iBAAO;AAAA,MACjC;AAAA,IACF,QAAQ;AAAA,IAAC;AAGT,QAAI,YAAY,SAAS,UAAU;AACjC,UAAO,eAAgB,WAAK,MAAM,SAAS,CAAC;AAAG,eAAO;AACtD,UAAO,eAAgB,WAAK,MAAM,QAAQ,CAAC;AAAG,eAAO;AAAA,IACvD;AAGA,QAAI,YAAY,SAAS,MAAM;AAC7B,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBACZ,MACA,WACA,aACqB;AA/wCzB;AAgxCI,UAAM,QAAoB,CAAC;AAC3B,UAAM,cAAY,iBAAY,cAAZ,mBAAuB,kBAAiB;AAG1D,QAAI,UAAU,SAAS,aAAa;AAElC,YAAM;AAAA,QACJ,EAAE,OAAO,GAAG,aAAa,+EAAkC,MAAM,OAAO;AAAA,QACxE,EAAE,OAAO,GAAG,aAAa,kFAA2B,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,QACvF,EAAE,OAAO,GAAG,aAAa,mEAAsB,MAAM,SAAS;AAAA,QAC9D,EAAE,OAAO,GAAG,aAAa,0DAAa,MAAM,UAAU;AAAA,QACtD,EAAE,OAAO,GAAG,aAAa,oFAA6B,MAAM,UAAU;AAAA,MACxE;AAAA,IACF,WAAW,UAAU,SAAS,MAAM,GAAG;AAErC,YAAM;AAAA,QACJ,EAAE,OAAO,GAAG,aAAa,4CAAwB,MAAM,SAAS;AAAA,QAChE,EAAE,OAAO,GAAG,aAAa,wDAAqB,MAAM,OAAO;AAAA,QAC3D,EAAE,OAAO,GAAG,aAAa,6EAAgC,MAAM,QAAQ;AAAA,QACvE,EAAE,OAAO,GAAG,aAAa,2EAA6C,MAAM,UAAU;AAAA,QACtF,EAAE,OAAO,GAAG,aAAa,+DAAkB,MAAM,SAAS;AAAA,MAC5D;AAAA,IACF,WAAW,UAAU,SAAS,OAAO,GAAG;AAEtC,YAAM;AAAA,QACJ,EAAE,OAAO,GAAG,aAAa,gEAAc,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,QAC1E,EAAE,OAAO,GAAG,aAAa,4CAA6B,MAAM,OAAO;AAAA,QACnE,EAAE,OAAO,GAAG,aAAa,kFAAiB,MAAM,QAAQ;AAAA,QACxD,EAAE,OAAO,GAAG,aAAa,kFAAiB,MAAM,UAAU;AAAA,QAC1D,EAAE,OAAO,GAAG,aAAa,mEAAsB,MAAM,SAAS;AAAA,MAChE;AAAA,IACF,WAAW,UAAU,SAAS,SAAS,KAAK,UAAU,SAAS,SAAS,KAAK,UAAU,SAAS,KAAK,GAAG;AAEtG,YAAM;AAAA,QACJ,EAAE,OAAO,GAAG,aAAa,0DAAa,MAAM,SAAS;AAAA,QACrD,EAAE,OAAO,GAAG,aAAa,oDAAY,MAAM,OAAO;AAAA,QAClD,EAAE,OAAO,GAAG,aAAa,4FAAsB,MAAM,aAAa;AAAA,QAClE,EAAE,OAAO,GAAG,aAAa,oDAAY,MAAM,QAAQ;AAAA,QACnD,EAAE,OAAO,GAAG,aAAa,gEAAmB,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,QAC/E,EAAE,OAAO,GAAG,aAAa,kIAA8B,MAAM,UAAU;AAAA,MACzE;AAAA,IACF,OAAO;AAEL,YAAM;AAAA,QACJ,EAAE,OAAO,GAAG,aAAa,sEAAe,MAAM,UAAU,MAAM,MAAM,OAAO;AAAA,QAC3E,EAAE,OAAO,GAAG,aAAa,oDAAY,MAAM,SAAS;AAAA,QACpD,EAAE,OAAO,GAAG,aAAa,oDAAY,MAAM,UAAU;AAAA,MACvD;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,2BACZ,MACA,eAC6B;AAC7B,UAAM,eAAmC,CAAC;AAE1C,QAAI,CAAC;AAAe,aAAO;AAE3B,QAAI;AACF,YAAM,YAAiB,WAAK,MAAM,aAAa;AAC/C,UAAI,CAAI,eAAW,SAAS;AAAG,eAAO;AAEtC,YAAM,UAAa,iBAAa,WAAW,OAAO;AAGlD,YAAM,gBAAgB,QAAQ,SAAS,8DAA8D;AACrG,iBAAW,SAAS,eAAe;AACjC,qBAAa,KAAK;AAAA,UAChB,MAAM;AAAA,UACN,IAAI,MAAM,CAAC;AAAA,UACX,MAAM;AAAA,QACR,CAAC;AAAA,MACH;AAGA,YAAM,iBAAiB,QAAQ,SAAS,+CAA+C;AACvF,iBAAW,SAAS,gBAAgB;AAClC,qBAAa,KAAK;AAAA,UAChB,MAAM;AAAA,UACN,IAAI,MAAM,CAAC;AAAA,UACX,MAAM;AAAA,QACR,CAAC;AAAA,MACH;AAAA,IACF,QAAQ;AAAA,IAAC;AAET,WAAO,aAAa,MAAM,GAAG,EAAE;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,6BACN,aACA,WACQ;AAp3CZ;AAq3CI,UAAM,cAAY,iBAAY,cAAZ,mBAAuB,kBAAiB;AAE1D,QAAI,UAAU,SAAS,OAAO,KAAK,UAAU,SAAS,KAAK,GAAG;AAC5D,aAAO;AAAA,IACT;AAEA,QAAI,UAAU,SAAS,MAAM,KAAK,UAAU,SAAS,MAAM,GAAG;AAC5D,aAAO;AAAA,IACT;AAEA,QAAI,UAAU,SAAS,SAAS,KAAK,UAAU,SAAS,SAAS,GAAG;AAClE,aAAO;AAAA,IACT;AAEA,QAAI,YAAY,KAAK,SAAS,WAAW,GAAG;AAC1C,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,MAAc,aAA6D;AAClG,UAAM,cAAwB,CAAC;AAC/B,UAAM,QAAW,gBAAY,IAAI;AAGjC,UAAM,gBAAgB;AAAA,MAAC;AAAA,MAAY;AAAA,MAAY;AAAA,MAAW;AAAA,MAAW;AAAA,MAAU;AAAA,MACzD;AAAA,MAAW;AAAA,MAAU;AAAA,MAAU;AAAA,MAAW;AAAA,IAAa;AAE7E,eAAW,SAAS,eAAe;AACjC,UAAO,eAAgB,WAAK,MAAM,KAAK,CAAC,GAAG;AACzC,oBAAY,KAAK,KAAK;AAAA,MACxB;AAAA,IACF;AAGA,QAAO,eAAgB,WAAK,MAAM,KAAK,CAAC,GAAG;AACzC,iBAAW,SAAS,eAAe;AACjC,YAAO,eAAgB,WAAK,MAAM,OAAO,KAAK,CAAC,GAAG;AAChD,sBAAY,KAAK,OAAO,KAAK,EAAE;AAAA,QACjC;AAAA,MACF;AAAA,IACF;AAEA,WAAO,YAAY,MAAM,GAAG,CAAC;AAAA,EAC/B;AAAA,EAEQ,iBAAiB,MAAwB;AAC/C,UAAM,iBAAiB;AAAA,MACrB;AAAA,MAAgB;AAAA,MAAiB;AAAA,MAAgB;AAAA,MACjD;AAAA,MAAkB;AAAA,MAAqB;AAAA,MACvC;AAAA,MAAoB;AAAA,MAAkB;AAAA,MACtC;AAAA,MAAU;AAAA,MAAc;AAAA,MAAW;AAAA,MACnC;AAAA,MAAsB;AAAA,MAAc;AAAA,IACtC;AAEA,UAAM,QAAW,gBAAY,IAAI;AACjC,WAAO,MAAM,OAAO,OAAK,eAAe,SAAS,CAAC,CAAC;AAAA,EACrD;AAAA,EAEQ,gBAAgB,MAAc,aAAmC;AACvE,UAAM,UAAwB,CAAC;AAE/B,QAAI,YAAY,SAAS,MAAM,GAAG;AAChC,UAAI;AACF,cAAM,MAAM,KAAK,MAAS,iBAAkB,WAAK,MAAM,cAAc,GAAG,OAAO,CAAC;AAChF,YAAI,IAAI,SAAS;AACf,qBAAW,CAAC,MAAM,GAAG,KAAK,OAAO,QAAQ,IAAI,OAAO,GAAG;AACrD,oBAAQ,KAAK;AAAA,cACX,MAAM,WAAW,IAAI;AAAA,cACrB,SAAS,OAAO,GAAG;AAAA,cACnB,aAAa,KAAK,sBAAsB,IAAI;AAAA,YAC9C,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF,QAAQ;AAAA,MAAC;AAAA,IACX;AAEA,WAAO,QAAQ,MAAM,GAAG,EAAE;AAAA,EAC5B;AAAA,EAEQ,wBAAwB,MAAmB;AAz8CrD;AA08CI,UAAM,QAAkB,CAAC;AAGzB,UAAM,KAAK,GAAG,KAAK,IAAI,uBAAQ,KAAK,IAAI,gBAAM,KAAK,YAAY,SAAI,KAAK,SAAS,WAAM,EAAE,kCAAS,KAAK,QAAQ,qBAAM;AAGrH,SAAI,UAAK,mBAAL,mBAAqB,aAAa;AACpC,YAAM,KAAK,6BAAS,KAAK,eAAe,WAAW,EAAE;AAAA,IACvD;AAGA,UAAM,KAAK,4BAAQ,KAAK,UAAU,UAAU,+CAAY,KAAK,UAAU,WAAW,eAAe,CAAC,2BAAO;AAGzG,SAAI,UAAK,kBAAL,mBAAoB,WAAW;AACjC,YAAM,KAAK,mCAAU,KAAK,cAAc,UAAU,IAAI,QAAG;AAAA,IAC3D;AACA,SAAI,UAAK,kBAAL,mBAAoB,cAAc;AACpC,YAAM,KAAK,6BAAS,KAAK,cAAc,YAAY,QAAG;AAAA,IACxD;AAGA,UAAI,UAAK,YAAL,mBAAc,UAAS,GAAG;AAC5B,YAAM,KAAK,yCAAW,KAAK,QAAQ,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAW,EAAE,IAAI,EAAE,KAAK,IAAI,CAAC,QAAG;AAAA,IACtF;AAGA,UAAI,gBAAK,mBAAL,mBAAqB,cAArB,mBAAgC,UAAS,GAAG;AAC9C,YAAM,KAAK,uBAAQ,KAAK,eAAe,UAAU,KAAK,IAAI,CAAC,QAAG;AAAA,IAChE;AAEA,WAAO,MAAM,KAAK,GAAG;AAAA,EACvB;AAAA,EAEQ,iBAAiB,MAAqB,QAAgB,UAA0B;AACtF,QAAI,UAAU;AAAU,aAAO;AAE/B,UAAM,SAAS,KAAK,OAAO,MAAM;AACjC,QAAI,SAAS;AAEb,QAAI,KAAK,SAAS,aAAa;AAC7B,gBAAU,GAAG,MAAM,aAAM,KAAK,IAAI;AAAA;AAClC,UAAI,KAAK,UAAU;AACjB,mBAAW,SAAS,KAAK,SAAS,MAAM,GAAG,EAAE,GAAG;AAC9C,oBAAU,KAAK,iBAAiB,OAAO,SAAS,GAAG,QAAQ;AAAA,QAC7D;AACA,YAAI,KAAK,SAAS,SAAS,IAAI;AAC7B,oBAAU,GAAG,MAAM,UAAU,KAAK,SAAS,SAAS,EAAE;AAAA;AAAA,QACxD;AAAA,MACF;AAAA,IACF,OAAO;AACL,gBAAU,GAAG,MAAM,aAAM,KAAK,IAAI;AAAA;AAAA,IACpC;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,aAAa,UAA0B;AAC7C,UAAM,MAAW,cAAQ,QAAQ,EAAE,YAAY;AAC/C,UAAM,UAAkC;AAAA,MACtC,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,OAAO;AAAA,MACP,SAAS;AAAA,MACT,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,SAAS;AAAA,MACT,SAAS;AAAA,MACT,SAAS;AAAA,MACT,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,SAAS;AAAA,IACX;AACA,WAAO,QAAQ,GAAG,KAAK;AAAA,EACzB;AAAA,EAEQ,YAAY,UAA0B;AAC5C,QAAI;AACF,YAAM,UAAa,iBAAa,UAAU,OAAO;AACjD,aAAO,QAAQ,MAAM,IAAI,EAAE;AAAA,IAC7B,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEQ,iBAAiB,SAAyB;AAChD,UAAM,UAAkC;AAAA,MACtC,OAAO;AAAA,MACP,OAAO;AAAA,MACP,OAAO;AAAA,MACP,cAAc;AAAA,MACd,SAAS;AAAA,MACT,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,SAAS;AAAA,MACT,SAAS;AAAA,MACT,UAAU;AAAA,MACV,eAAe;AAAA,MACf,SAAS;AAAA,MACT,UAAU;AAAA,MACV,cAAc;AAAA,MACd,UAAU;AAAA,MACV,SAAS;AAAA,MACT,cAAc;AAAA,IAChB;AACA,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC7B;AAAA,EAEQ,sBAAsB,SAAyB;AACrD,UAAM,UAAkC;AAAA,MACtC,OAAO;AAAA,MACP,OAAO;AAAA,MACP,OAAO;AAAA,MACP,cAAc;AAAA,MACd,SAAS;AAAA,MACT,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,SAAS;AAAA,MACT,SAAS;AAAA,MACT,SAAS;AAAA,MACT,UAAU;AAAA,MACV,eAAe;AAAA,MACf,SAAS;AAAA,MACT,UAAU;AAAA,MACV,cAAc;AAAA,MACd,UAAU;AAAA,MACV,SAAS;AAAA,IACX;AACA,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC7B;AAAA,EAEQ,sBAAsB,MAAsB;AAClD,UAAM,UAAkC;AAAA,MACtC,OAAO;AAAA,MACP,SAAS;AAAA,MACT,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,UAAU;AAAA,MACV,SAAS;AAAA,IACX;AACA,WAAO,QAAQ,IAAI,KAAK;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAkB,MAA0C;AACxE,UAAM,OAA0B,CAAC;AACjC,UAAM,UAAU;AAChB,UAAM,WAAW;AAEjB,UAAM,UAAU,CAAC,KAAa,UAAwB;AACpD,UAAI,QAAQ,YAAY,KAAK,UAAU;AAAS;AAEhD,UAAI;AACF,cAAM,QAAW,gBAAY,GAAG;AAEhC,mBAAW,QAAQ,OAAO;AACxB,cAAI,KAAK,UAAU;AAAS;AAG5B,cAAI,KAAK,YAAY,SAAS,IAAI;AAAG;AAErC,gBAAM,WAAgB,WAAK,KAAK,IAAI;AAEpC,cAAI;AACF,kBAAM,OAAU,aAAS,QAAQ;AAEjC,gBAAI,KAAK,YAAY,GAAG;AACtB,sBAAQ,UAAU,QAAQ,CAAC;AAAA,YAC7B,WAAW,KAAK,YAAY,EAAE,SAAS,KAAK,GAAG;AAC7C,oBAAM,UAAU,KAAK,kBAAkB,UAAU,IAAI;AACrD,kBAAI,SAAS;AACX,qBAAK,KAAK,OAAO;AAAA,cACnB;AAAA,YACF;AAAA,UACF,QAAQ;AAAA,UAER;AAAA,QACF;AAAA,MACF,QAAQ;AAAA,MAER;AAAA,IACF;AAEA,YAAQ,MAAM,CAAC;AAGf,SAAK,KAAK,CAAC,GAAG,MAAM;AAClB,UAAI,EAAE,YAAY,YAAY,EAAE,YAAY;AAAU,eAAO;AAC7D,UAAI,EAAE,YAAY,YAAY,EAAE,YAAY;AAAU,eAAO;AAC7D,aAAO,EAAE,OAAO,EAAE;AAAA,IACpB,CAAC;AAED,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,UAAkB,MAAsC;AAChF,QAAI;AACF,YAAM,OAAU,aAAS,QAAQ;AACjC,YAAM,UAAa,iBAAa,UAAU,OAAO;AACjD,YAAM,WAAgB,eAAS,QAAQ;AACvC,YAAM,eAAoB,eAAS,MAAM,QAAQ;AAGjD,YAAM,aAAa,QAAQ,MAAM,aAAa;AAC9C,YAAM,QAAQ,aAAa,WAAW,CAAC,EAAE,KAAK,IAAI,SAAS,QAAQ,OAAO,EAAE;AAG5E,YAAM,UAAU,KAAK,eAAe,UAAU,YAAY;AAG1D,YAAM,iBAAiB,QAAQ,SAAS,eAAe;AACvD,YAAM,WAAqB,CAAC;AAC5B,iBAAW,SAAS,gBAAgB;AAClC,iBAAS,KAAK,MAAM,CAAC,EAAE,KAAK,CAAC;AAC7B,YAAI,SAAS,UAAU;AAAI;AAAA,MAC7B;AAGA,YAAM,UAAU,KAAK,oBAAoB,OAAO;AAEhD,aAAO;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAM,KAAK;AAAA,MACb;AAAA,IACF,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,UAAkB,cAAkD;AACzF,UAAM,YAAY,SAAS,YAAY;AACvC,UAAM,YAAY,aAAa,YAAY;AAE3C,QAAI,cAAc;AAAa,aAAO;AACtC,QAAI,UAAU,SAAS,WAAW;AAAG,aAAO;AAC5C,QAAI,UAAU,SAAS,cAAc;AAAG,aAAO;AAC/C,QAAI,UAAU,SAAS,KAAK,KAAK,UAAU,SAAS,KAAK;AAAG,aAAO;AACnE,QAAI,UAAU,SAAS,OAAO,KAAK,UAAU,SAAS,UAAU;AAAG,aAAO;AAC1E,QAAI,UAAU,SAAS,cAAc,KAAK,UAAU,SAAS,QAAQ;AAAG,aAAO;AAE/E,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,SAAyB;AACnD,QAAI,UAAU;AAGd,cAAU,QAAQ,QAAQ,mBAAmB,EAAE;AAG/C,cAAU,QAAQ,QAAQ,YAAY,EAAE;AAGxC,cAAU,QAAQ,QAAQ,0BAA0B,IAAI;AAGxD,cAAU,QAAQ,QAAQ,oBAAoB,EAAE;AAGhD,cAAU,QAAQ,QAAQ,YAAY,EAAE;AAGxC,cAAU,QAAQ,QAAQ,oBAAoB,IAAI;AAClD,cAAU,QAAQ,QAAQ,gBAAgB,IAAI;AAC9C,cAAU,QAAQ,QAAQ,gBAAgB,IAAI;AAC9C,cAAU,QAAQ,QAAQ,cAAc,IAAI;AAG5C,cAAU,QAAQ,QAAQ,oBAAoB,EAAE;AAChD,cAAU,QAAQ,QAAQ,oBAAoB,EAAE;AAGhD,cAAU,QAAQ,QAAQ,WAAW,MAAM;AAC3C,cAAU,QAAQ,KAAK;AAGvB,QAAI,QAAQ,SAAS,KAAM;AACzB,gBAAU,QAAQ,MAAM,GAAG,GAAI,IAAI;AAAA,IACrC;AAEA,WAAO;AAAA,EACT;AACF;AAGO,IAAM,kBAAkB,IAAI,wBAAwB;;;ACxuD3D,IAAM,oBAAoB;AAAA;AAAA,EAExB;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAEA;AAAA,EACA;AACF;AAEA,IAAM,mBAAmB;AAAA;AAAA,EAEvB;AAAA,EACA;AAAA;AAAA,EAEA;AACF;AAEA,IAAM,gBAAgB;AAAA;AAAA,EAEpB;AAAA,EACA;AAAA;AAAA,EAEA;AAAA;AAAA,EAEA;AACF;AAIA,IAAM,yBAA+E;AAAA;AAAA,EAEnF,4BAAQ,EAAE,SAAS,4BAA4B,SAAS,QAAQ;AAAA,EAChE,4BAAQ,EAAE,SAAS,4BAA4B,SAAS,QAAQ;AAAA;AAAA,EAGhE,4BAAQ,EAAE,SAAS,oCAAoC,SAAS,QAAQ;AAAA,EACxE,4BAAQ,EAAE,SAAS,wCAAwC,SAAS,UAAU;AAAA;AAAA,EAG9E,4BAAQ,EAAE,SAAS,kBAAkB,SAAS,cAAc;AAAA,EAC5D,4BAAQ,EAAE,SAAS,+BAA+B,SAAS,cAAc;AAAA,EACzE,4BAAQ,EAAE,SAAS,2BAA2B,SAAS,YAAY;AAAA,EACnE,4BAAQ,EAAE,SAAS,2BAA2B,SAAS,YAAY;AAAA;AAAA,EAGnE,kCAAS,EAAE,SAAS,yBAAyB,SAAS,qBAAqB;AAAA,EAC3E,kCAAS,EAAE,SAAS,yBAAyB,SAAS,oBAAoB;AAAA,EAC1E,4BAAQ,EAAE,SAAS,wBAAwB,SAAS,iBAAiB;AAAA,EACrE,kCAAS,EAAE,SAAS,yBAAyB,SAAS,wBAAwB;AAAA;AAAA,EAG9E,4BAAQ,EAAE,SAAS,0BAA0B,SAAS,WAAW;AAAA,EACjE,4BAAQ,EAAE,SAAS,mBAAmB,SAAS,QAAQ;AAAA;AAAA,EAGvD,4BAAQ,EAAE,SAAS,mBAAmB,SAAS,SAAS;AAAA;AAAA,EAGxD,gBAAM,EAAE,SAAS,mCAAmC,SAAS,QAAQ;AACvE;AAKO,IAAM,mBAAN,MAAuB;AAAA;AAAA;AAAA;AAAA,EAI5B,MAAM,OAA4B;AAChC,UAAM,UAAU,MAAM,KAAK;AAG3B,QAAI,CAAC,SAAS;AACZ,aAAO;AAAA,QACL,MAAM;AAAA,QACN,eAAe;AAAA,QACf,YAAY;AAAA,QACZ,YAAY;AAAA,MACd;AAAA,IACF;AAGA,QAAI,QAAQ,WAAW,GAAG,GAAG;AAC3B,aAAO,KAAK,cAAc,OAAO;AAAA,IACnC;AAGA,QAAI,QAAQ,WAAW,GAAG,GAAG;AAC3B,aAAO,KAAK,mBAAmB,OAAO;AAAA,IACxC;AAGA,WAAO,KAAK,sBAAsB,OAAO;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAc,OAA4B;AAChD,WAAO;AAAA,MACL,MAAM;AAAA,MACN,eAAe;AAAA,MACf,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,gBAAgB;AAAA,IAClB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,OAA4B;AACrD,UAAM,UAAU,MAAM,UAAU,CAAC,EAAE,KAAK;AACxC,WAAO;AAAA,MACL,MAAM;AAAA,MACN,eAAe;AAAA,MACf,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,gBAAgB;AAAA,MAChB,iBAAiB,QAAQ,OAAO;AAAA,IAClC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAAsB,OAA4B;AACxD,UAAM,aAAa,MAAM,YAAY;AACrC,QAAI,aAAa;AACjB,QAAI,OAAO;AACX,QAAI;AACJ,QAAI;AACJ,QAAI;AAGJ,eAAW,CAAC,MAAM,IAAI,KAAK,OAAO,QAAQ,sBAAsB,GAAG;AACjE,UAAI,KAAK,QAAQ,KAAK,KAAK,GAAG;AAC5B,0BAAkB,KAAK;AACvB,qBAAa,+DAAgB,KAAK,OAAO;AACzC,qBAAa;AACb,eAAO;AACP,yBAAiB;AACjB;AAAA,MACF;AAAA,IACF;AAGA,UAAM,aAAa,kBAAkB,KAAK,OAAK,EAAE,KAAK,KAAK,CAAC;AAC5D,QAAI,YAAY;AACd,aAAO;AACP,mBAAa,KAAK,IAAI,YAAY,GAAG;AACrC,uBAAiB;AAAA,IACnB;AAGA,UAAM,YAAY,iBAAiB,KAAK,OAAK,EAAE,KAAK,KAAK,CAAC;AAC1D,QAAI,WAAW;AACb,aAAO;AACP,mBAAa,KAAK,IAAI,YAAY,GAAG;AACrC,uBAAiB;AAAA,IACnB;AAGA,UAAM,gBAAgB,cAAc,KAAK,OAAK,EAAE,KAAK,KAAK,CAAC;AAC3D,QAAI,eAAe;AACjB,aAAO;AACP,mBAAa,KAAK,IAAI,YAAY,IAAI;AACtC,uBAAiB;AAAA,IACnB;AAGA,UAAM,sBAAsB;AAAA,MAC1B;AAAA,IACF;AAEA,eAAW,WAAW,qBAAqB;AACzC,YAAM,QAAQ,MAAM,MAAM,OAAO;AACjC,UAAI,OAAO;AACT,0BAAkB,IAAI,MAAM,CAAC,EAAE,YAAY,CAAC,GAAG,MAAM,UAAU,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,IAAI,MAAM,MAAM,UAAU,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,IAAI,EAAE;AAC3I,qBAAa,6FAAqB,eAAe;AACjD;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,MACL;AAAA,MACA,eAAe;AAAA,MACf,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,OAAyB;AACrC,UAAM,QAAkB,CAAC;AACzB,UAAM,SAAS,KAAK,MAAM,KAAK;AAE/B,QAAI,OAAO,YAAY;AACrB,YAAM,KAAK,OAAO,UAAU;AAAA,IAC9B;AAGA,QAAI,OAAO,SAAS,mCAA4B;AAC9C,YAAM,KAAK,yGAAuB;AAAA,IACpC,WAAW,OAAO,SAAS,iCAA2B;AACpD,YAAM,KAAK,qHAAyB;AAAA,IACtC,WAAW,OAAO,SAAS,2BAAwB;AACjD,YAAM,KAAK,2HAA0B;AAAA,IACvC;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,OAA8B;AAC3C,UAAM,SAAS,KAAK,MAAM,KAAK;AAC/B,WAAO,OAAO,mBAAmB;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAuB,OAAwB;AAC7C,WAAO,MAAM,WAAW,GAAG,KAAK,MAAM,WAAW,GAAG;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,OAIZ;AACA,UAAM,SAAS,KAAK,MAAM,KAAK;AAC/B,UAAM,UAAoB,CAAC;AAC3B,UAAM,UAAoD,CAAC;AAG3D,QAAI,gBAAgB;AAEpB,QAAI,OAAO,SAAS,yBAAmB;AACrC,sBAAgB;AAAA,IAClB,WAAW,OAAO,SAAS,6BAAyB;AAClD,sBAAgB;AAAA,IAClB,WAAW,OAAO,SAAS,2BAAwB;AACjD,sBAAgB;AAChB,cAAQ,KAAK,oDAAY,oDAAY,kDAAU;AAC/C,cAAQ;AAAA,QACN,EAAE,OAAO,4BAAQ,QAAQ,WAAW;AAAA,QACpC,EAAE,OAAO,4BAAQ,QAAQ,WAAW;AAAA,MACtC;AAAA,IACF,WAAW,OAAO,SAAS,iCAA2B;AACpD,sBAAgB;AAChB,UAAI,OAAO,iBAAiB;AAC1B,gBAAQ,KAAK,EAAE,OAAO,iBAAO,OAAO,eAAe,IAAI,QAAQ,OAAO,gBAAgB,CAAC;AAAA,MACzF;AAAA,IACF;AAEA,WAAO;AAAA,MACL;AAAA,MACA,kBAAkB;AAAA,MAClB,kBAAkB;AAAA,IACpB;AAAA,EACF;AACF;AAGO,IAAM,mBAAmB,IAAI,iBAAiB;;;ACzS9C,IAAM,mBAAN,MAAuB;AAAA,EAI5B,YAAY,aAAqC;AAC/C,SAAK,cAAc;AACnB,SAAK,aAAa;AAAA,MAChB,MAAM,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,MACrC,SAAS,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,MACxC,MAAM,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,MACrC,SAAS,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,MACxC,OAAO,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,MACtC,KAAK,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,IACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAA6C;AAC3C,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,UAA+B;AAC1C,WAAO,KAAK,WAAW,QAAQ;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,UAA6B;AACrC,WAAO,KAAK,WAAW,QAAQ,EAAE,WAAW;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,eAAwB;AAC1B,WAAO,KAAK,WAAW,KAAK,WAAW;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,UAAoB,QAAoB,SAAwB;AAC3E,UAAM,MAAM,KAAK,IAAI;AACrB,SAAK,WAAW,QAAQ,IAAI;AAAA,MAC1B,GAAG,KAAK,WAAW,QAAQ;AAAA,MAC3B;AAAA,MACA;AAAA,MACA,WAAW;AAAA,IACb;AAIA,QAAI,aAAa,QAAQ;AACvB,WAAK,YAAY;AAAA,QACf,MAAM;AAAA,QACN;AAAA,QACA;AAAA,QACA;AAAA,QACA,WAAW;AAAA,MACb,CAAC;AAAA,IACH;AAGA,QAAI,WAAW,WAAW;AACxB,iBAAW,MAAM;AACf,YAAI,KAAK,WAAW,QAAQ,EAAE,WAAW,aACrC,KAAK,WAAW,QAAQ,EAAE,cAAc,KAAK;AAC/C,eAAK,aAAa,UAAU,MAAM;AAAA,QACpC;AAAA,MACF,GAAG,GAAI;AAAA,IACT;AAGA,QAAI,WAAW,SAAS;AACtB,iBAAW,MAAM;AACf,YAAI,KAAK,WAAW,QAAQ,EAAE,WAAW,WACrC,KAAK,WAAW,QAAQ,EAAE,cAAc,KAAK;AAC/C,eAAK,aAAa,UAAU,MAAM;AAAA,QACpC;AAAA,MACF,GAAG,GAAI;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,UAA0B;AACnC,UAAM,YAAY,KAAK,WAAW,QAAQ;AAC1C,QAAI,UAAU,iBAAiB;AAC7B,gBAAU,gBAAgB,MAAM;AAAA,IAClC;AACA,SAAK,aAAa,UAAU,QAAQ,oBAAK;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,UAAoB,YAAmC;AACxE,SAAK,WAAW,QAAQ,EAAE,kBAAkB;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,WAAiB;AACf,eAAW,YAAY,OAAO,KAAK,KAAK,UAAU,GAAiB;AACjE,WAAK,WAAW,QAAQ,IAAI,EAAE,QAAQ,QAAQ,WAAW,EAAE;AAAA,IAC7D;AAAA,EACF;AACF;;;ACzHA,IAAAC,UAAwB;AAQjB,IAAM,iBAAN,MAA+C;AAAA,EACpD,YAAoB,KAAsB;AAAtB;AAAA,EAAuB;AAAA,EAE3C,MAAM,OAAO,MAA6B;AACxC,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,cAAM,KAAK,cAAc;AACzB,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,UAAU;AACrB,eAAO;AAAA,MACT,KAAK;AACH,aAAK,cAAc,KAAK,WAAW,KAAK,QAAQ;AAChD,eAAO;AAAA,MACT,KAAK;AACH,aAAK,cAAc,KAAK,SAAS;AACjC,eAAO;AAAA,MACT,KAAK;AACH,aAAK,gBAAgB;AACrB,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,YAAY,KAAK,SAAS;AACrC,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,mBAAmB,KAAK,SAAS;AAC5C,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAA+B;AACnC,UAAM,aAAa,KAAK,IAAI,eAAe,cAAc;AACzD,YAAQ,IAAI,8CAA8C,WAAW,EAAE;AACvE,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,WAAW,WAAW;AAAA,IACxB,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAA2B;AAC/B,UAAM,KAAK,cAAc;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAmB,UAAwB;AACvD,UAAM,UAAU,KAAK,IAAI,eAAe,cAAc,WAAW,QAAQ;AACzE,QAAI,SAAS;AACX,WAAK,gBAAgB;AACrB,MAAO,eAAO,uBAAuB,+CAAY,QAAQ,EAAE;AAAA,IAC7D,OAAO;AACL,MAAO,eAAO,iBAAiB,gCAAO;AAAA,IACxC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAyB;AACrC,SAAK,IAAI,eAAe,cAAc,SAAS;AAC/C,SAAK,gBAAgB;AACrB,IAAO,eAAO,uBAAuB,gCAAO;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAwB;AACtB,UAAM,WAAW,KAAK,IAAI,eAAe,eAAe;AACxD,SAAK,IAAI,YAAY,EAAE,MAAM,eAAe,SAAS,CAAC;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,WAAkC;AAClD,UAAM,UAAU,MAAM,KAAK,IAAI,eAAe,YAAY,SAAS;AACnE,QAAI,SAAS;AACX,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,UAAU,QAAQ,YAAY,CAAC;AAAA,QAC/B,WAAW,QAAQ;AAAA,QACnB,cAAc,QAAQ;AAAA,MACxB,CAAC;AACD,MAAO,eAAO,uBAAuB,yCAAW,QAAQ,KAAK,EAAE;AAAA,IACjE,OAAO;AACL,MAAO,eAAO,iBAAiB,sCAAQ;AAAA,IACzC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,mBAAmB,oBAA4C;AACnE,YAAQ,IAAI,kEAAkE,kBAAkB;AAGhG,QAAI,oBAAoB;AACtB,YAAM,iBAAiB,KAAK,IAAI,eAAe;AAG/C,UAAI,kBAAkB,eAAe,OAAO,oBAAoB;AAC9D,gBAAQ,IAAI,4DAA4D;AACxE;AAAA,MACF;AAGA,cAAQ,IAAI,4DAA4D,kBAAkB;AAC1F,YAAM,SAAS,MAAM,KAAK,IAAI,eAAe,YAAY,kBAAkB;AAC3E,UAAI,QAAQ;AACV,gBAAQ,IAAI,mDAAmD,OAAO,IAAI,aAAa,OAAO,SAAS,MAAM;AAC7G,aAAK,IAAI,YAAY;AAAA,UACnB,MAAM;AAAA,UACN,UAAU,OAAO,YAAY,CAAC;AAAA,UAC9B,WAAW,OAAO;AAAA,UAClB,cAAc,OAAO;AAAA,QACvB,CAAC;AACD;AAAA,MACF;AAGA,cAAQ,IAAI,sEAAsE;AAAA,IACpF;AAGA,QAAI,CAAC,KAAK,IAAI,eAAe,gBAAgB;AAC3C,cAAQ,IAAI,gEAAgE;AAC5E,YAAM,WAAW,MAAM,KAAK,IAAI,eAAe,oBAAoB;AACnE,UAAI,UAAU;AACZ,gBAAQ,IAAI,2CAA2C,SAAS,EAAE;AAClE,aAAK,IAAI,YAAY;AAAA,UACnB,MAAM;AAAA,UACN,UAAU,SAAS,YAAY,CAAC;AAAA,UAChC,WAAW,SAAS;AAAA,UACpB,cAAc,SAAS;AAAA,QACzB,CAAC;AACD;AAAA,MACF;AAGA,cAAQ,IAAI,8DAA8D;AAC1E,YAAM,aAAa,KAAK,IAAI,eAAe,cAAc;AACzD,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,WAAW,WAAW;AAAA,MACxB,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAmC;AACvC,UAAM,WAAW,KAAK,IAAI,eAAe,eAAe;AAExD,QAAI,SAAS,WAAW,GAAG;AACzB,MAAO,eAAO,uBAAuB,sCAAQ;AAC7C;AAAA,IACF;AAEA,UAAM,QAAgC,SAAS,IAAI,QAAM;AAAA,MACvD,OAAO,EAAE;AAAA,MACT,aAAa,GAAG,EAAE,YAAY;AAAA,MAC9B,QAAQ,IAAI,KAAK,EAAE,SAAS,EAAE,eAAe;AAAA,MAC7C,IAAI,EAAE;AAAA,IACR,EAAE;AAEF,UAAM,WAAW,MAAa,eAAO,cAAc,OAAO;AAAA,MACxD,aAAa;AAAA,MACb,oBAAoB;AAAA,IACtB,CAAC;AAED,QAAI,UAAU;AACZ,YAAM,KAAK,YAAa,SAAiB,EAAE;AAAA,IAC7C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,sBAAqC;AACzC,UAAM,KAAK,IAAI,eAAe,oBAAoB;AAClD,SAAK,iBAAiB;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAyB;AACvB,UAAM,UAAU,KAAK,IAAI,eAAe;AACxC,UAAM,cAAc,KAAK,IAAI,cAAc,eAAe;AAE1D,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,WAAU,mCAAS,aAAY,CAAC;AAAA,MAChC;AAAA,MACA,WAAW,KAAK,IAAI,cAAc,aAAa;AAAA,MAC/C,YAAW,mCAAS,OAAM;AAAA,IAC5B,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,gCAAsC;AACpC,UAAM,UAAU,KAAK,IAAI,eAAe;AACxC,UAAM,cAAc,KAAK,IAAI,cAAc,eAAe;AAE1D,QAAI,WAAW,CAAC,IAAI,mCAAS,aAAY,CAAC,CAAE;AAG5C,QAAI,KAAK,IAAI,yBAAyB;AACpC,YAAM,iBAAiB,KAAK,IAAI,wBAAwB;AACxD,YAAM,gBAAgB,SAAS,UAAU,OAAK,EAAE,OAAO,cAAc;AAErE,UAAI,kBAAkB,IAAI;AACxB,iBAAS,aAAa,IAAI,EAAE,GAAG,KAAK,IAAI,wBAAwB;AAChE,gBAAQ,IAAI,4DAA4D,cAAc;AAAA,MACxF;AAAA,IACF;AAEA,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA,WAAW,KAAK,IAAI,cAAc,aAAa;AAAA,MAC/C,YAAW,mCAAS,OAAM;AAAA,MAC1B,aAAa,KAAK,IAAI,cAAc,MAAM,KAAK,CAAC,CAAC,KAAK,IAAI;AAAA,IAC5D,CAAC;AAGD,QAAI,KAAK,IAAI,cAAc,MAAM,KAAK,KAAK,IAAI,yBAAyB;AACtE,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,WAAW,KAAK,IAAI,wBAAwB;AAAA,QAC5C,SAAS,KAAK,IAAI,wBAAwB;AAAA,MAC5C,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,uBAA6B;AAC3B,UAAM,aAAa,KAAK,IAAI,eAAe,cAAc;AACzD,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,WAAW,WAAW;AAAA,IACxB,CAAC;AACD,YAAQ,IAAI,2DAA2D,WAAW,EAAE;AAAA,EACtF;AACF;;;AC5QA,IAAAC,UAAwB;AAExB;;;ACGA,IAAAC,UAAwB;AAcjB,IAAM,sBAAsC;AAAA,EACjD;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,YAAY;AAAA,IACZ,gBAAgB;AAAA,EAClB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,YAAY;AAAA,IACZ,gBAAgB;AAAA,EAClB;AACF;AA2KA,IAAM,QAAsB;AAAA,EAC1B,QAAQ;AAAA,IACN,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,MAAM;AAAA,IACN,OAAO;AAAA,IACP,SAAS;AAAA,IACT,OAAO;AAAA,IACP,SAAS;AAAA,IACT,SAAS;AAAA,IACT,MAAM;AAAA,IACN,KAAK;AAAA,IACL,IAAI;AAAA,IACJ,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,EACT;AAAA,EAEA,MAAM;AAAA,IACJ,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,kBAAkB;AAAA,IAClB,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,OAAO;AAAA,IACP,UAAU;AAAA,IACV,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,aAAa;AAAA,IACb,WAAW;AAAA,EACb;AAAA,EAEA,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,SAAS;AAAA,IAET,mBAAmB;AAAA,IACnB,kBAAkB;AAAA,IAClB,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,kBAAkB;AAAA,IAClB,gBAAgB;AAAA,IAChB,gBAAgB;AAAA,IAEhB,sBAAsB;AAAA,IACtB,wBAAwB;AAAA,IACxB,cAAc;AAAA,EAChB;AAAA,EAEA,SAAS;AAAA,IACP,OAAO;AAAA,IACP,WAAW;AAAA,IACX,UAAU;AAAA,IACV,OAAO;AAAA,IACP,OAAO;AAAA,IACP,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,SAAS;AAAA,IACT,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,EACf;AAAA,EAEA,MAAM;AAAA,IACJ,OAAO;AAAA,IACP,UAAU;AAAA,IACV,KAAK;AAAA,IACL,MAAM;AAAA,IACN,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,EACX;AAAA,EAEA,KAAK;AAAA,IACH,OAAO;AAAA,IACP,kBAAkB;AAAA,IAClB,WAAW;AAAA,IACX,cAAc;AAAA,IACd,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,cAAc;AAAA,IACd,WAAW;AAAA,IACX,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,OAAO;AAAA,IACP,WAAW;AAAA,IACX,SAAS;AAAA,IACT,aAAa;AAAA,IACb,cAAc;AAAA,IACd,cAAc;AAAA,EAChB;AAAA,EAEA,OAAO;AAAA,IACL,OAAO;AAAA,IACP,iBAAiB;AAAA,IACjB,eAAe;AAAA,IACf,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,cAAc;AAAA,IACd,WAAW;AAAA,IACX,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,EACV;AAAA,EAEA,QAAQ;AAAA,IACN,cAAc;AAAA,IACd,eAAe;AAAA,IACf,eAAe;AAAA,IACf,eAAe;AAAA,IACf,aAAa;AAAA,IACb,aAAa;AAAA,IACb,SAAS;AAAA,IACT,SAAS;AAAA,IACT,aAAa;AAAA,IACb,cAAc;AAAA,IACd,kBAAkB;AAAA,EACpB;AAAA,EAEA,IAAI;AAAA,IACF,cAAc;AAAA,IACd,qBAAqB;AAAA,IACrB,wBAAwB;AAAA,IACxB,qBAAqB;AAAA,EACvB;AACF;AAGA,IAAM,QAAsB;AAAA,EAC1B,QAAQ;AAAA,IACN,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,MAAM;AAAA,IACN,OAAO;AAAA,IACP,SAAS;AAAA,IACT,OAAO;AAAA,IACP,SAAS;AAAA,IACT,SAAS;AAAA,IACT,MAAM;AAAA,IACN,KAAK;AAAA,IACL,IAAI;AAAA,IACJ,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,EACT;AAAA,EAEA,MAAM;AAAA,IACJ,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,kBAAkB;AAAA,IAClB,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,OAAO;AAAA,IACP,UAAU;AAAA,IACV,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,aAAa;AAAA,IACb,WAAW;AAAA,EACb;AAAA,EAEA,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,SAAS;AAAA,IAET,mBAAmB;AAAA,IACnB,kBAAkB;AAAA,IAClB,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,kBAAkB;AAAA,IAClB,gBAAgB;AAAA,IAChB,gBAAgB;AAAA,IAEhB,sBAAsB;AAAA,IACtB,wBAAwB;AAAA,IACxB,cAAc;AAAA,EAChB;AAAA,EAEA,SAAS;AAAA,IACP,OAAO;AAAA,IACP,WAAW;AAAA,IACX,UAAU;AAAA,IACV,OAAO;AAAA,IACP,OAAO;AAAA,IACP,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,SAAS;AAAA,IACT,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,EACf;AAAA,EAEA,MAAM;AAAA,IACJ,OAAO;AAAA,IACP,UAAU;AAAA,IACV,KAAK;AAAA,IACL,MAAM;AAAA,IACN,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,EACX;AAAA,EAEA,KAAK;AAAA,IACH,OAAO;AAAA,IACP,kBAAkB;AAAA,IAClB,WAAW;AAAA,IACX,cAAc;AAAA,IACd,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,cAAc;AAAA,IACd,WAAW;AAAA,IACX,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,OAAO;AAAA,IACP,WAAW;AAAA,IACX,SAAS;AAAA,IACT,aAAa;AAAA,IACb,cAAc;AAAA,IACd,cAAc;AAAA,EAChB;AAAA,EAEA,OAAO;AAAA,IACL,OAAO;AAAA,IACP,iBAAiB;AAAA,IACjB,eAAe;AAAA,IACf,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,cAAc;AAAA,IACd,WAAW;AAAA,IACX,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,EACV;AAAA,EAEA,QAAQ;AAAA,IACN,cAAc;AAAA,IACd,eAAe;AAAA,IACf,eAAe;AAAA,IACf,eAAe;AAAA,IACf,aAAa;AAAA,IACb,aAAa;AAAA,IACb,SAAS;AAAA,IACT,SAAS;AAAA,IACT,aAAa;AAAA,IACb,cAAc;AAAA,IACd,kBAAkB;AAAA,EACpB;AAAA,EAEA,IAAI;AAAA,IACF,cAAc;AAAA,IACd,qBAAqB;AAAA,IACrB,wBAAwB;AAAA,IACxB,qBAAqB;AAAA,EACvB;AACF;AAGA,IAAM,eAAwD;AAAA,EAC5D,SAAS;AAAA,EACT,SAAS;AACX;AAKO,IAAM,eAAN,MAAM,aAAY;AAAA,EAKf,cAAc;AAHtB,SAAQ,kBAAqC;AAC7C,SAAQ,UAA0C;AAAA,EAE3B;AAAA,EAEvB,OAAO,cAA2B;AAChC,QAAI,CAAC,aAAY,UAAU;AACzB,mBAAY,WAAW,IAAI,aAAY;AAAA,IACzC;AACA,WAAO,aAAY;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,SAAwC;AACjD,SAAK,UAAU;AAGf,UAAM,SAAgB,kBAAU,iBAAiB,aAAa;AAC9D,UAAM,gBAAgB,OAAO,IAAuB,UAAU;AAE9D,QAAI,iBAAiB,aAAa,aAAa,GAAG;AAChD,WAAK,kBAAkB;AAAA,IACzB,OAAO;AAEL,YAAM,iBAAwB,YAAI;AAClC,UAAI,eAAe,WAAW,IAAI,GAAG;AACnC,aAAK,kBAAkB;AAAA,MACzB,OAAO;AACL,aAAK,kBAAkB;AAAA,MACzB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAwC;AACtC,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAgC;AAC9B,WAAO,oBAAoB,KAAK,OAAK,EAAE,SAAS,KAAK,eAAe;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,UAA4C;AAC5D,QAAI,CAAC,aAAa,QAAQ,GAAG;AAC3B,YAAM,IAAI,MAAM,yBAAyB,QAAQ,EAAE;AAAA,IACrD;AAEA,SAAK,kBAAkB;AAGvB,UAAM,SAAgB,kBAAU,iBAAiB,aAAa;AAC9D,UAAM,OAAO,OAAO,YAAY,UAAiB,4BAAoB,MAAM;AAAA,EAC7E;AAAA;AAAA;AAAA;AAAA,EAKA,EACE,UACA,KACQ;AACR,UAAM,eAAe,aAAa,KAAK,eAAe;AACtD,UAAM,uBAAuB,aAAa,QAAQ;AAClD,WAAO,qBAAqB,GAAa,KAAK,IAAI,OAAO,QAAQ,CAAC,IAAI,OAAO,GAAG,CAAC;AAAA,EACnF;AAAA;AAAA;AAAA;AAAA,EAKA,GACE,UACA,KACA,QACQ;AACR,QAAI,OAAO,KAAK,EAAE,UAAU,GAAG;AAE/B,eAAW,CAAC,OAAO,KAAK,KAAK,OAAO,QAAQ,MAAM,GAAG;AACnD,aAAO,KAAK,QAAQ,IAAI,KAAK,KAAK,OAAO,KAAK,CAAC;AAAA,IACjD;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,OAAgD,WAAmB;AACnF,UAAM,eAAe,aAAa,KAAK,eAAe;AAEtD,YAAQ,MAAM;AAAA,MACZ,KAAK;AACH,eAAO,aAAa,GAAG;AAAA,MACzB,KAAK;AACH,eAAO,aAAa,GAAG;AAAA,MACzB,KAAK;AACH,eAAO,aAAa,GAAG;AAAA,MACzB;AACE,eAAO,aAAa,GAAG;AAAA,IAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,sBAA8B;AAC5B,WAAO,KAAK,gBAAgB,EAAE;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,OAAgD,WAAmB;AACjF,WAAO,GAAG,KAAK,kBAAkB,IAAI,CAAC;AAAA;AAAA,EAAO,KAAK,oBAAoB,CAAC;AAAA,EACzE;AAAA;AAAA;AAAA;AAAA,EAKA,wBAAwC;AACtC,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,YAAqB;AACnB,WAAO,KAAK,oBAAoB;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAqB;AACnB,WAAO,KAAK,oBAAoB;AAAA,EAClC;AACF;AAnJa,aACI,WAA+B;AADzC,IAAM,cAAN;AAsJA,IAAM,OAAO,YAAY,YAAY;AAErC,SAAS,EACd,UACA,KACQ;AACR,SAAO,KAAK,EAAE,UAAU,GAAG;AAC7B;;;AC3pBA;AAkCA,IAAM,cAAc;AACpB,IAAM,iBAAiB,IAAI,KAAK,KAAK;AACrC,IAAM,iBAAiB;AACvB,IAAM,gBAAgB;AACtB,IAAM,iBAAiB;AACvB,IAAM,qBAAqB;AAC3B,IAAM,oBAAoB,KAAK,KAAK;AACpC,IAAM,mBAAmB,KAAK,KAAK;AACnC,IAAM,gBAAgB;AAGtB,IAAM,aAAa,oBAAI,IAAI;AAAA,EACzB;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EACvD;AAAA,EAAM;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EAAK;AAAA,EACnD;AAAA,EAAO;AAAA,EAAK;AAAA,EAAM;AAAA,EAAM;AAAA,EAAO;AAAA,EAAO;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAC9D;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAM;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAQ;AAAA,EAAM;AAAA,EAAM;AAAA,EAAO;AAAA,EAC7D;AAAA,EAAQ;AAAA,EAAK;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAQ;AAAA,EAAO;AAAA,EAAO;AAAA,EAAQ;AAAA,EAC7D;AAAA,EAAO;AAAA,EAAQ;AAAA,EAAS;AAAA,EAAU;AAAA,EAAS;AAC7C,CAAC;AAMM,IAAM,iBAAN,MAAM,eAAc;AAAA,EAejB,YAAY,SAAkC;AAXtD,SAAQ,YAA2B,CAAC;AACpC,SAAQ,WAA0B,CAAC;AAInC,SAAQ,QAAQ;AAGhB;AAAA,SAAQ,eAAe,oBAAI,IAAsB;AACjD,SAAiB,YAAY;AAG3B,SAAK,UAAU;AACf,SAAK,KAAK;AACV,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,OAAO,YAAY,SAAiD;AAClE,QAAI,CAAC,eAAc,UAAU;AAC3B,qBAAc,WAAW,IAAI,eAAc,OAAO;AAAA,IACpD;AACA,WAAO,eAAc;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAMA,aAAa,OAAgF;AAC3F,UAAM,WAAW,KAAK,UAAU;AAAA,MAAK,OACnC,EAAE,SAAS,MAAM,QAAQ,KAAK,WAAW,EAAE,SAAS,MAAM,OAAO,IAAI;AAAA,IACvE;AACA,QAAI,UAAU;AACZ,eAAS,eAAe,KAAK,IAAI;AACjC,eAAS;AACT,eAAS,aAAa,KAAK,IAAI,SAAS,YAAY,MAAM,UAAU;AACpE,WAAK,UAAU;AACf;AAAA,IACF;AAEA,SAAK,UAAU,KAAK;AAAA,MAClB,IAAI,MAAM,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,MAC/D,GAAG;AAAA,MACH,aAAa;AAAA,MACb,cAAc,KAAK,IAAI;AAAA,MACvB,WAAW,KAAK,IAAI;AAAA,MACpB,WAAW,KAAK,IAAI,IAAI;AAAA,IAC1B,CAAC;AAED,QAAI,KAAK,UAAU,SAAS,gBAAgB;AAC1C,WAAK,eAAe;AAAA,IACtB;AACA,SAAK,UAAU;AAAA,EACjB;AAAA,EAEA,YAAY,OAAgF;AAC1F,UAAM,WAAW,KAAK,SAAS;AAAA,MAAK,OAClC,EAAE,SAAS,MAAM,QAAQ,KAAK,WAAW,EAAE,SAAS,MAAM,OAAO,IAAI;AAAA,IACvE;AACA,QAAI,UAAU;AACZ,eAAS,eAAe,KAAK,IAAI;AACjC,eAAS;AACT,eAAS,aAAa,KAAK,IAAI,SAAS,YAAY,MAAM,UAAU;AACpE,WAAK,UAAU;AACf;AAAA,IACF;AAEA,SAAK,SAAS,KAAK;AAAA,MACjB,IAAI,MAAM,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,MAC/D,GAAG;AAAA,MACH,aAAa;AAAA,MACb,cAAc,KAAK,IAAI;AAAA,MACvB,WAAW,KAAK,IAAI;AAAA,IACtB,CAAC;AAED,QAAI,KAAK,SAAS,SAAS,eAAe;AACxC,WAAK,iBAAiB;AAAA,IACxB;AACA,SAAK,UAAU;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAMA,mBAAmB,SAAwB;AACzC,QAAI,QAAQ,SAAS;AAAQ;AAC7B,UAAM,OAAO,QAAQ;AACrB,QAAI,CAAC,QAAQ,KAAK,SAAS;AAAG;AAG9B,UAAM,eAAe;AAAA,MACnB;AAAA,MACA;AAAA,IACF;AACA,eAAW,KAAK,cAAc;AAC5B,UAAIC;AACJ,cAAQA,KAAI,EAAE,KAAK,IAAI,OAAO,MAAM;AAClC,aAAK,aAAa;AAAA,UAChB,MAAM;AAAA,UACN,SAASA,GAAE,CAAC,EAAE,KAAK;AAAA,UACnB,UAAU,KAAK,gBAAgBA,GAAE,CAAC,CAAC;AAAA,UACnC,YAAY;AAAA,QACd,CAAC;AAAA,MACH;AAAA,IACF;AAGA,UAAM,cAAc;AACpB,QAAI;AACJ,YAAQ,IAAI,YAAY,KAAK,IAAI,OAAO,MAAM;AAC5C,WAAK,aAAa;AAAA,QAChB,MAAM;AAAA,QACN,SAAS,6BAAS,EAAE,CAAC,EAAE,KAAK,CAAC;AAAA,QAC7B,UAAU,KAAK,gBAAgB,EAAE,CAAC,CAAC;AAAA,QACnC,YAAY;AAAA,MACd,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,gBAAgB,WAAmB,UAA2B;AAC5D,QAAI,SAAS,SAAS;AAAG;AAEzB,UAAM,SAAS,oBAAI,IAAY;AAC/B,aACG,OAAO,OAAK,EAAE,SAAS,MAAM,EAC7B,QAAQ,OAAK,KAAK,gBAAgB,EAAE,OAAO,EAAE,MAAM,GAAG,CAAC,EAAE,QAAQ,OAAK,OAAO,IAAI,CAAC,CAAC,CAAC;AAEvF,UAAM,WAAW,CAAC,GAAG,MAAM,EAAE,MAAM,GAAG,CAAC,EAAE,KAAK,IAAI;AAClD,SAAK,YAAY;AAAA,MACf,MAAM;AAAA,MACN,SAAS,gBAAM,SAAS,MAAM,8BAAU,QAAQ;AAAA,MAChD,UAAU,CAAC,GAAG,MAAM,EAAE,MAAM,GAAG,EAAE;AAAA,MACjC,YAAY;AAAA,IACd,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAMA,SAAS,OAAe,QAAgB,GAA0B;AAChE,UAAM,YAAY,KAAK,gBAAgB,KAAK;AAC5C,QAAI,UAAU,WAAW,GAAG;AAC1B,aAAO,EAAE,UAAU,CAAC,GAAG,gBAAgB,GAAG,YAAY,EAAE;AAAA,IAC1D;AAEA,UAAM,SAAiD,CAAC;AACxD,UAAM,aAAa,CAAC,GAAG,KAAK,WAAW,GAAG,KAAK,QAAQ;AAEvD,eAAW,SAAS,YAAY;AAC9B,YAAM,QAAQ,KAAK,eAAe,WAAW,KAAK;AAClD,UAAI,QAAQ,KAAK;AACf,eAAO,KAAK,EAAE,GAAG,OAAO,MAAM,CAAC;AAAA,MACjC;AAAA,IACF;AAEA,WAAO,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AACvC,UAAM,MAAM,OAAO,MAAM,GAAG,KAAK;AAGjC,eAAW,QAAQ,KAAK;AACtB,YAAM,WAAW,WAAW,KAAK,OAAK,EAAE,OAAO,KAAK,EAAE;AACtD,UAAI,UAAU;AACZ,iBAAS;AACT,iBAAS,eAAe,KAAK,IAAI;AAAA,MACnC;AAAA,IACF;AAEA,QAAI,IAAI,SAAS;AAAG,WAAK,UAAU;AAEnC,WAAO;AAAA,MACL,UAAU;AAAA,MACV,gBAAgB,IAAI,SAAS,IAAI,IAAI,CAAC,EAAE,QAAQ;AAAA,MAChD,YAAY,IAAI,OAAO,CAAC,GAAG,MAAM,IAAI,eAAe,EAAE,OAAO,GAAG,CAAC;AAAA,IACnE;AAAA,EACF;AAAA,EAEA,mBAAmB,OAAe,YAAoB,KAAa;AACjE,UAAM,SAAS,KAAK,SAAS,OAAO,CAAC;AACrC,QAAI,OAAO,SAAS,WAAW;AAAG,aAAO;AAEzC,UAAM,aAAqC;AAAA,MACzC,YAAY;AAAA,MAAM,SAAS;AAAA,MAAM,SAAS;AAAA,MAAM,MAAM;AAAA,IACxD;AAEA,QAAI,UAAU;AACd,QAAI,SAAS;AAEb,eAAW,OAAO,OAAO,UAAU;AACjC,YAAM,cAAc,eAAe,IAAI,OAAO;AAC9C,UAAI,SAAS,cAAc;AAAW;AACtC,iBAAW,MAAM,WAAW,IAAI,IAAI,KAAK,cAAI,KAAK,IAAI,OAAO;AAAA;AAC7D,gBAAU;AAAA,IACZ;AAEA,eAAW;AACX,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMA,UAAgB;AACd,UAAM,MAAM,KAAK,IAAI;AACrB,UAAM,YAA2B,CAAC;AAClC,UAAM,OAAsB,CAAC;AAE7B,eAAW,SAAS,KAAK,WAAW;AAClC,YAAM,UAAU,MAAM,aAAa,MAAM,YAAY;AAErD,UAAI,MAAM,eAAe,kBAAkB,MAAM,cAAc,oBAAoB;AACjF,kBAAU,KAAK,KAAK;AACpB;AAAA,MACF;AAEA,UAAI,CAAC,SAAS;AACZ,aAAK,KAAK,KAAK;AAAA,MACjB;AAAA,IACF;AAEA,UAAM,UAAU,KAAK,WAAW,KAAK,UAAU,UAAU,UAAU,SAAS;AAC5E,SAAK,YAAY;AAEjB,eAAW,SAAS,WAAW;AAC7B,WAAK,YAAY;AAAA,QACf,MAAM,MAAM;AAAA,QACZ,SAAS,MAAM;AAAA,QACf,UAAU,MAAM;AAAA,QAChB,YAAY,KAAK,IAAI,MAAM,aAAa,KAAK,CAAC;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,QAAI;AAAS,WAAK,UAAU;AAAA,EAC9B;AAAA,EAEA,mBAAyB;AACvB,QAAI,KAAK,SAAS,UAAU,gBAAgB;AAAK;AAEjD,UAAM,SAAwB,CAAC;AAC/B,UAAM,OAAO,oBAAI,IAAY;AAE7B,aAAS,IAAI,GAAG,IAAI,KAAK,SAAS,QAAQ,KAAK;AAC7C,UAAI,KAAK,IAAI,KAAK,SAAS,CAAC,EAAE,EAAE;AAAG;AAEnC,YAAM,UAAU,EAAE,GAAG,KAAK,SAAS,CAAC,EAAE;AAEtC,eAAS,IAAI,IAAI,GAAG,IAAI,KAAK,SAAS,QAAQ,KAAK;AACjD,YAAI,KAAK,IAAI,KAAK,SAAS,CAAC,EAAE,EAAE;AAAG;AAEnC,YAAI,KAAK,WAAW,QAAQ,SAAS,KAAK,SAAS,CAAC,EAAE,OAAO,IAAI,KAAK;AACpE,eAAK,IAAI,KAAK,SAAS,CAAC,EAAE,EAAE;AAC5B,kBAAQ,eAAe,KAAK,SAAS,CAAC,EAAE;AACxC,kBAAQ,aAAa,KAAK,IAAI,QAAQ,YAAY,KAAK,SAAS,CAAC,EAAE,UAAU;AAC7E,kBAAQ,eAAe,KAAK,IAAI,QAAQ,cAAc,KAAK,SAAS,CAAC,EAAE,YAAY;AACnF,gBAAM,KAAK,oBAAI,IAAI,CAAC,GAAG,QAAQ,UAAU,GAAG,KAAK,SAAS,CAAC,EAAE,QAAQ,CAAC;AACtE,kBAAQ,WAAW,CAAC,GAAG,EAAE,EAAE,MAAM,GAAG,EAAE;AAAA,QACxC;AAAA,MACF;AAEA,aAAO,KAAK,OAAO;AAAA,IACrB;AAEA,QAAI,OAAO,SAAS,eAAe;AACjC,aAAO,KAAK,CAAC,GAAG,MAAM;AACpB,cAAM,SAAS,EAAE,aAAa,MAAM,KAAK,IAAI,EAAE,cAAc,KAAK,GAAG,KAAK,EAAE,SAAS,eAAe,MAAM;AAC1G,cAAM,SAAS,EAAE,aAAa,MAAM,KAAK,IAAI,EAAE,cAAc,KAAK,GAAG,KAAK,EAAE,SAAS,eAAe,MAAM;AAC1G,eAAO,SAAS;AAAA,MAClB,CAAC;AACD,WAAK,WAAW,OAAO,MAAM,GAAG,aAAa;AAAA,IAC/C,OAAO;AACL,WAAK,WAAW;AAAA,IAClB;AAEA,SAAK,UAAU;AAAA,EACjB;AAAA,EAEQ,iBAAuB;AAC7B,SAAK,UAAU,KAAK,CAAC,GAAG,MAAM;AAC5B,YAAM,MAAM,KAAK,IAAI;AACrB,YAAM,SAAS,EAAE,aAAa,MAAM,KAAK,IAAI,EAAE,cAAc,KAAK,GAAG,KAAK,EAAE,YAAY,KAAK,IAAI,IAAI,EAAE,YAAY,OAAO,iBAAiB,GAAG,IAAI;AAClJ,YAAM,SAAS,EAAE,aAAa,MAAM,KAAK,IAAI,EAAE,cAAc,KAAK,GAAG,KAAK,EAAE,YAAY,KAAK,IAAI,IAAI,EAAE,YAAY,OAAO,iBAAiB,GAAG,IAAI;AAClJ,aAAO,SAAS;AAAA,IAClB,CAAC;AACD,SAAK,YAAY,KAAK,UAAU,MAAM,GAAG,cAAc;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAMA,WAAwB;AACtB,UAAM,aAAa,CAAC,GAAG,KAAK,WAAW,GAAG,KAAK,QAAQ;AACvD,WAAO;AAAA,MACL,gBAAgB,KAAK,UAAU;AAAA,MAC/B,eAAe,KAAK,SAAS;AAAA,MAC7B,aAAa,WAAW,OAAO,CAAC,GAAG,MAAM,IAAI,eAAe,EAAE,OAAO,GAAG,CAAC;AAAA,IAC3E;AAAA,EACF;AAAA,EAEA,WAAiB;AACf,SAAK,YAAY,CAAC;AAClB,SAAK,WAAW,CAAC;AACjB,SAAK,aAAa,MAAM;AACxB,SAAK,KAAK;AAAA,EACZ;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAkB;AACxB,SAAK,QAAQ;AAEb,QAAI,KAAK;AAAW,mBAAa,KAAK,SAAS;AAC/C,SAAK,YAAY,WAAW,MAAM;AAChC,UAAI,KAAK;AAAO,aAAK,KAAK;AAAA,IAC5B,GAAG,aAAa;AAAA,EAClB;AAAA,EAEQ,OAAa;AACnB,SAAK,QAAQ,YAAY,OAAO,aAAa;AAAA,MAC3C,WAAW,KAAK;AAAA,MAChB,UAAU,KAAK;AAAA,MACf,SAAS,KAAK,IAAI;AAAA,IACpB,CAAC;AACD,SAAK,QAAQ;AAAA,EACf;AAAA,EAEQ,OAAa;AACnB,UAAM,OAAO,KAAK,QAAQ,YAAY,IAAS,WAAW;AAC1D,QAAI,MAAM;AACR,WAAK,YAAY,KAAK,aAAa,CAAC;AACpC,WAAK,WAAW,KAAK,YAAY,CAAC;AAAA,IACpC;AACA,SAAK,QAAQ;AAAA,EACf;AAAA,EAEQ,cAAoB;AAC1B,SAAK,eAAe,YAAY,MAAM;AACpC,WAAK,QAAQ;AAAA,IACf,GAAG,gBAAgB;AAEnB,SAAK,gBAAgB,YAAY,MAAM;AACrC,WAAK,iBAAiB;AAAA,IACxB,GAAG,iBAAiB;AAAA,EACtB;AAAA,EAEA,UAAgB;AACd,QAAI,KAAK;AAAc,oBAAc,KAAK,YAAY;AACtD,QAAI,KAAK;AAAe,oBAAc,KAAK,aAAa;AACxD,QAAI,KAAK;AAAW,mBAAa,KAAK,SAAS;AAC/C,QAAI,KAAK;AAAO,WAAK,KAAK;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAMA,gBAAgB,MAAwB;AAEtC,UAAM,WAAW,KAAK,UAAU,GAAG,GAAG;AACtC,UAAM,SAAS,KAAK,aAAa,IAAI,QAAQ;AAC7C,QAAI;AAAQ,aAAO;AAEnB,UAAM,QAAQ,KAAK,YAAY,EAC5B,QAAQ,yBAAyB,GAAG,EACpC,MAAM,KAAK,EACX,OAAO,OAAK,EAAE,SAAS,KAAK,CAAC,WAAW,IAAI,CAAC,CAAC;AAEjD,UAAM,SAAS,CAAC,GAAG,IAAI,IAAI,KAAK,CAAC,EAAE,MAAM,GAAG,EAAE;AAG9C,QAAI,KAAK,aAAa,OAAO,KAAK,WAAW;AAC3C,YAAM,WAAW,KAAK,aAAa,KAAK,EAAE,KAAK,EAAE;AACjD,UAAI,aAAa;AAAW,aAAK,aAAa,OAAO,QAAQ;AAAA,IAC/D;AACA,SAAK,aAAa,IAAI,UAAU,MAAM;AAEtC,WAAO;AAAA,EACT;AAAA,EAEQ,eAAe,eAAyB,OAA4B;AAC1E,QAAI,cAAc,WAAW,KAAK,MAAM,SAAS,WAAW;AAAG,aAAO;AAEtE,QAAI,UAAU;AACd,UAAM,eAAe,MAAM,QAAQ,YAAY;AAE/C,eAAW,MAAM,eAAe;AAC9B,UAAI,MAAM,SAAS,SAAS,EAAE,KAAK,aAAa,SAAS,EAAE,GAAG;AAC5D;AAAA,MACF;AAAA,IACF;AAEA,UAAM,eAAe,UAAU,cAAc;AAC7C,UAAM,kBAAkB,MAAM,aAAa;AAC3C,UAAM,cAAc,KAAK,IAAI,MAAM,cAAc,MAAM,IAAI;AAC3D,UAAM,eAAe,MAAM,eAAe,KAAK,IAAI,IAAI,OAAU,MAAM;AAEvE,WAAO,eAAe,kBAAkB,cAAc;AAAA,EACxD;AAAA,EAEQ,WAAW,GAAW,GAAmB;AAC/C,UAAM,SAAS,IAAI,IAAI,KAAK,gBAAgB,CAAC,CAAC;AAC9C,UAAM,SAAS,IAAI,IAAI,KAAK,gBAAgB,CAAC,CAAC;AAC9C,QAAI,OAAO,SAAS,KAAK,OAAO,SAAS;AAAG,aAAO;AACnD,QAAI,OAAO,SAAS,KAAK,OAAO,SAAS;AAAG,aAAO;AAEnD,QAAI,eAAe;AACnB,eAAW,KAAK,QAAQ;AACtB,UAAI,OAAO,IAAI,CAAC;AAAG;AAAA,IACrB;AACA,WAAO,gBAAgB,OAAO,OAAO,OAAO,OAAO;AAAA,EACrD;AACF;AAnaa,eACI,WAAiC;AAD3C,IAAM,gBAAN;;;AChBA,IAAM,mBAAN,MAAuB;AAAA,EAAvB;AAEL;AAAA,SAAQ,uBAA2C,CAAC;AAGpD;AAAA,SAAiB,uBAA2C;AAAA,MAC1D;AAAA,QACE,SAAS;AAAA,QACT,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,MACA;AAAA,QACE,SAAS;AAAA,QACT,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA;AAAA,SAAiB,cAAc;AAAA,MAC7B;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,UAAU;AAAA,UACR;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA;AAAA,SAAiB,qBAAyE;AAAA,MACxF,EAAE,SAAS,oEAAoE,QAAQ,UAAU;AAAA,MACjG,EAAE,SAAS,oCAAoC,QAAQ,MAAM;AAAA,MAC7D,EAAE,SAAS,uCAAuC,QAAQ,WAAW;AAAA,MACrE,EAAE,SAAS,kCAAkC,QAAQ,UAAU;AAAA,MAC/D,EAAE,SAAS,wCAAwC,QAAQ,SAAS;AAAA,MACpE,EAAE,SAAS,mBAAmB,QAAQ,WAAW;AAAA,IACnD;AAGA;AAAA,SAAiB,gBAAgB,oBAAI,IAAI;AAAA,MACvC;AAAA,MAAQ;AAAA,MAAS;AAAA,MAAQ;AAAA,MAAU;AAAA,MAAO;AAAA,MAC1C;AAAA,MAAO;AAAA,MAAO;AAAA,MAAO;AAAA,MAAO;AAAA,MAAO;AAAA,MAAO;AAAA,MAC1C;AAAA,MAAW;AAAA,MAAQ;AAAA,MAAU;AAAA,MAAS;AAAA,MAAQ;AAAA,IAChD,CAAC;AAGD;AAAA,SAAiB,kBAA0C;AAAA,MACzD,SAAS;AAAA,MACT,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,QAAQ;AAAA,IACV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,sBAAsB,OAAiC;AACrD,eAAW,QAAQ,OAAO;AACxB,YAAM,MAAM,KAAK,qBAAqB,UAAU,OAAK,EAAE,YAAY,KAAK,OAAO;AAC/E,UAAI,OAAO,GAAG;AACZ,aAAK,qBAAqB,GAAG,IAAI;AAAA,MACnC,OAAO;AACL,aAAK,qBAAqB,KAAK,IAAI;AAAA,MACrC;AAAA,IACF;AACA,SAAK,qBAAqB,KAAK,CAAC,GAAG,MAAM,EAAE,WAAW,EAAE,QAAQ;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,SAAuB;AACxC,SAAK,uBAAuB,KAAK,qBAAqB,OAAO,OAAK,EAAE,YAAY,OAAO;AAAA,EACzF;AAAA;AAAA;AAAA;AAAA,EAKA,wBAA4C;AAC1C,WAAO,CAAC,GAAG,KAAK,sBAAsB,GAAG,KAAK,oBAAoB;AAAA,EACpE;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,OAAe,SAIP;AA/LnB;AAgMI,UAAM,UAAU,MAAM,KAAK;AAG3B,QAAI,QAAQ,WAAW,GAAG,GAAG;AAC3B,aAAO,KAAK,kBAAkB,OAAO;AAAA,IACvC;AAGA,UAAM,WAAW,QAAQ,MAAM,6BAA6B;AAC5D,QAAI,UAAU;AACZ,aAAO;AAAA,QACL,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,aAAa,SAAS,CAAC;AAAA,QACvB,UAAU;AAAA,QACV,iBAAiB,SAAS,CAAC,KAAK;AAAA,MAClC;AAAA,IACF;AAGA,UAAM,aAAa,QAAQ,MAAM,+BAA+B;AAChE,QAAI,YAAY;AACd,UAAI;AACJ,YAAM,aAAY,gBAAW,CAAC,MAAZ,mBAAe;AACjC,UAAI,WAAW;AACb,YAAI;AAAE,wBAAc,KAAK,MAAM,SAAS;AAAA,QAAG,QAAQ;AAAE,wBAAc,EAAE,WAAW,UAAU;AAAA,QAAG;AAAA,MAC/F;AACA,aAAO;AAAA,QACL,MAAM;AAAA,QAAS,YAAY;AAAA,QAC3B,SAAS,WAAW,CAAC;AAAA,QAAG;AAAA,QACxB,UAAU;AAAA,MACZ;AAAA,IACF;AAGA,QAAI,mCAAS,iBAAiB;AAC5B,YAAM,SAAS,KAAK,iBAAiB,OAAO;AAC5C,UAAI,UAAU,OAAO,cAAc;AAAK,eAAO;AAAA,IACjD;AAGA,UAAM,cAAc,KAAK,kBAAkB,OAAO;AAClD,QAAI;AAAa,aAAO;AAGxB,UAAM,YAAY,KAAK,oBAAoB,OAAO;AAClD,QAAI;AAAW,aAAO;AAGtB,UAAM,aAAa,KAAK,iBAAiB,OAAO;AAChD,QAAI,cAAc,WAAW,cAAc;AAAK,aAAO;AAGvD,WAAO,EAAE,MAAM,QAAQ,YAAY,GAAK,UAAU,SAAS,iBAAiB,QAAQ;AAAA,EACtF;AAAA;AAAA,EAIQ,oBAAoB,OAAoC;AAC9D,eAAW,WAAW,KAAK,aAAa;AACtC,iBAAW,WAAW,QAAQ,UAAU;AACtC,YAAI,QAAQ,KAAK,KAAK,GAAG;AACvB,iBAAO;AAAA,YACL,MAAM;AAAA,YAAY,YAAY;AAAA,YAC9B,aAAa,QAAQ;AAAA,YACrB,UAAU;AAAA,YAAO,iBAAiB;AAAA,UACpC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEQ,kBAAkB,OAAoC;AAC5D,UAAM,cAAc,CAAC,GAAG,KAAK,sBAAsB,GAAG,KAAK,oBAAoB,EAC5E,KAAK,CAAC,GAAG,MAAM,EAAE,WAAW,EAAE,QAAQ;AAEzC,eAAW,WAAW,aAAa;AACjC,iBAAW,WAAW,QAAQ,UAAU;AACtC,YAAI,QAAQ,KAAK,KAAK,GAAG;AACvB,iBAAO;AAAA,YACL,MAAM;AAAA,YAAS,YAAY;AAAA,YAC3B,SAAS,QAAQ;AAAA,YACjB,aAAa,EAAE,WAAW,MAAM;AAAA,YAChC,UAAU;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEQ,kBAAkB,OAA6B;AACrD,UAAM,QAAQ,MAAM,MAAM,uBAAuB;AACjD,QAAI,CAAC,OAAO;AACV,aAAO,EAAE,MAAM,QAAQ,YAAY,KAAK,UAAU,MAAM;AAAA,IAC1D;AAEA,UAAM,CAAC,EAAE,SAAS,IAAI,IAAI;AAC1B,UAAM,MAAM,QAAQ,YAAY;AAEhC,QAAI,KAAK,cAAc,IAAI,GAAG,GAAG;AAC/B,aAAO;AAAA,QACL,MAAM;AAAA,QAAW,YAAY;AAAA,QAC7B,UAAU;AAAA,QAAO,SAAS,EAAE,MAAM,SAAS,MAAM,QAAQ,GAAG;AAAA,MAC9D;AAAA,IACF;AAEA,QAAI,KAAK,gBAAgB,GAAG,GAAG;AAC7B,aAAO;AAAA,QACL,MAAM;AAAA,QAAS,YAAY;AAAA,QAC3B,SAAS,KAAK,gBAAgB,GAAG;AAAA,QACjC,UAAU;AAAA,QACV,SAAS,EAAE,MAAM,SAAS,MAAM,QAAQ,GAAG;AAAA,QAC3C,aAAa,OAAO,EAAE,WAAW,KAAK,IAAI;AAAA,MAC5C;AAAA,IACF;AAEA,WAAO,EAAE,MAAM,QAAQ,YAAY,KAAK,UAAU,OAAO,iBAAiB,MAAM;AAAA,EAClF;AAAA,EAEQ,iBAAiB,OAAoC;AAC3D,eAAW,EAAE,SAAS,OAAO,KAAK,KAAK,oBAAoB;AACzD,UAAI,QAAQ,KAAK,KAAK,GAAG;AACvB,eAAO;AAAA,UACL,MAAM;AAAA,UAAe,YAAY;AAAA,UACjC,YAAY;AAAA,UAAQ,UAAU;AAAA,UAC9B,iBAAiB,KAAK,sBAAsB,QAAQ,KAAK;AAAA,QAC3D;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEQ,sBAAsB,QAAwB,OAAuB;AAC3E,UAAM,MAAsC;AAAA,MAC1C,SAAS;AAAA;AAAA,EAAyB,KAAK;AAAA,MACvC,KAAK;AAAA;AAAA,EAA2C,KAAK;AAAA,MACrD,UAAU;AAAA;AAAA,EAAoC,KAAK;AAAA,MACnD,SAAS;AAAA;AAAA,EAAyC,KAAK;AAAA,MACvD,QAAQ;AAAA;AAAA,EAA4B,KAAK;AAAA,MACzC,UAAU;AAAA;AAAA,EAAoC,KAAK;AAAA,MACnD,MAAM;AAAA;AAAA,EAAoB,KAAK;AAAA,IACjC;AACA,WAAO,IAAI,MAAM,KAAK;AAAA,EACxB;AACF;AAGO,IAAM,mBAAmB,IAAI,iBAAiB;;;AHrU9C,IAAM,qBAAN,MAAmD;AAAA,EAIxD,YAAoB,KAAsB;AAAtB;AAClB,SAAK,gBAAgB,cAAc,YAAY,IAAI,gBAAgB;AACnE,SAAK,mBAAmB,IAAI,iBAAiB;AAAA,EAC/C;AAAA,EAEA,MAAM,OAAO,MAA6B;AACxC,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,cAAM,KAAK,kBAAkB,KAAK,SAAS,KAAK,WAAW;AAC3D,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,gBAAgB;AAC3B,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,iBAAiB;AAC5B,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAkB,SAAiB,aAA2C;AAClF,QAAI,EAAC,mCAAS,YAAW,CAAC,eAAe,YAAY,WAAW,IAAI;AAClE;AAAA,IACF;AAGA,QAAI,mCAAS,QAAQ;AACnB,WAAK,IAAI,eAAe,KAAK,OAAO;AACpC,UAAI,KAAK,IAAI,eAAe,SAAS,KAAK;AACxC,aAAK,IAAI,eAAe,MAAM;AAAA,MAChC;AACA,WAAK,IAAI,eAAe;AAAA,IAC1B;AAGA,QAAI,KAAK,IAAI,cAAc,MAAM,GAAG;AAClC,YAAM,KAAK,aAAa;AACxB,YAAM,IAAI,QAAQ,CAAAC,aAAW,WAAWA,UAAS,EAAE,CAAC;AAAA,IACtD;AAGA,UAAM,SAAS,KAAK,IAAI,YAAY,MAAM,OAAO;AAEjD,QAAI,OAAO,SAAS,WAAW;AAC7B,YAAM,gBAAgB,KAAK,IAAI,cAAc,MAAM,OAAO;AAC1D,UAAI,eAAe;AACjB;AAAA,MACF;AAAA,IACF;AAGA,UAAM,SAAgB,eAAO;AAC7B,UAAM,eAAe,KAAK,iBAAiB,SAAS,SAAS;AAAA,MAC3D,iBAAiB,SAAS,CAAC,OAAO,UAAU,UAAU;AAAA,MACtD,aAAa,iCAAQ,SAAS;AAAA,IAChC,CAAC;AAKD,QAAI,aAAa,SAAS,WAAW,aAAa,SAAS;AAEzD,YAAM,OAAO,yFAA2B,aAAa,OAAO;AAC5D,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS;AAAA,UACT,WAAW,KAAK,IAAI;AAAA,UACpB,UAAU,EAAE,MAAM,cAAc;AAAA,QAClC;AAAA,MACF,CAAC;AAAA,IAGH;AAGA,UAAM,KAAK,cAAc,SAAS,WAAW;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cACJ,SACA,aACA,SACe;AACf,UAAM,cAAc,MAAM,KAAK,IAAI,kBAAkB;AACrD,QAAI,CAAC,aAAa;AAChB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAEA,SAAK,IAAI,iBAAiB,QAAQ,WAAW,6BAAS;AACtD,SAAK,IAAI,qBAAqB,IAAI;AAGlC,QAAI,EAAC,mCAAS,kBAAiB;AAC7B,YAAM,cAAuB;AAAA,QAC3B,IAAI,WAAW;AAAA,QACf,MAAM;AAAA,QACN,UAAS,mCAAS,mBAAkB;AAAA,QACpC,WAAW,KAAK,IAAI;AAAA,QACpB;AAAA,MACF;AACA,YAAM,KAAK,IAAI,eAAe,WAAW,WAAW;AACpD,WAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,YAAY,CAAC;AAGjE,WAAK,cAAc,mBAAmB,WAAW;AAAA,IACnD;AAEA,UAAM,mBAA4B;AAAA,MAChC,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,KAAK,IAAI;AAAA,MACpB,aAAa;AAAA,IACf;AAEA,SAAK,IAAI,0BAA0B;AACnC,UAAM,KAAK,IAAI,eAAe,WAAW,gBAAgB;AAEzD,QAAI,eAAe,KAAK,IAAI;AAC5B,UAAM,gBAAgB;AAEtB,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,kBAAkB,WAAW,KAAK,CAAC;AAGvF,UAAM,WAAW,KAAK,IAAI,eAAe,YAAY;AACrD,UAAM,gBAAgB,SAAS,IAAI,CAAC,KAAK,UAAU;AACjD,UAAI,UAAU,SAAS,SAAS,KAAK,IAAI,SAAS,WAAU,mCAAS,iBAAgB;AACnF,eAAO,EAAE,GAAG,KAAK,QAAQ;AAAA,MAC3B;AACA,aAAO;AAAA,IACT,CAAC;AAGD,UAAM,mBAAmB,KAAK,kBAAkB,SAAS;AACzD,UAAM,sBAAsB,KAAK,UAAU,IACvC,ohBACA;AAGJ,UAAM,gBAAgB,KAAK,cAAc,mBAAmB,OAAO;AAEnE,UAAM,gBAAyB;AAAA,MAC7B,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,SAAS,mBAAmB,gBAAgB;AAAA,MAC5C,WAAW,KAAK,IAAI;AAAA,IACtB;AACA,UAAM,qBAAqB,CAAC,eAAe,GAAG,aAAa;AAE3D,QAAI;AACF,YAAM,YAAY,YAAY,oBAAoB;AAAA,QAChD,SAAS,OAAO,UAAU;AACxB,2BAAiB,WAAW;AAC5B,cAAI,KAAK,IAAI,yBAAyB;AACpC,iBAAK,IAAI,wBAAwB,UAAU,iBAAiB;AAAA,UAC9D;AACA,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,WAAW,iBAAiB;AAAA,YAC5B,SAAS,iBAAiB;AAAA,UAC5B,CAAC;AAED,gBAAM,MAAM,KAAK,IAAI;AACrB,cAAI,MAAM,eAAe,iBAAiB,iBAAiB,QAAQ,SAAS,GAAG;AAC7E,2BAAe;AACf,kBAAM,KAAK,IAAI,eAAe,kBAAkB,iBAAiB,SAAS,OAAO,IAAI;AAAA,UACvF;AAAA,QACF;AAAA,QACA,YAAY,OAAO,iBAAiB;AAClC,2BAAiB,UAAU;AAC3B,2BAAiB,cAAc;AAC/B,eAAK,IAAI,0BAA0B;AAEnC,gBAAM,KAAK,IAAI,eAAe,kBAAkB,cAAc,IAAI;AAElE,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,WAAW,iBAAiB;AAAA,YAC5B,SAAS;AAAA,UACX,CAAC;AACD,eAAK,IAAI,qBAAqB,KAAK;AACnC,eAAK,IAAI,iBAAiB,QAAQ,WAAW,0BAAM;AAAA,QACrD;AAAA,QACA,SAAS,CAAC,UAAU;AAClB,eAAK,IAAI,0BAA0B;AACnC,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,SAAS,MAAM;AAAA,YACf,WAAW,iBAAiB;AAAA,UAC9B,CAAC;AACD,eAAK,IAAI,qBAAqB,KAAK;AACnC,eAAK,IAAI,iBAAiB,QAAQ,SAAS,MAAM,OAAO;AAAA,QAC1D;AAAA,MACF,GAAG,EAAE,WAAW,OAAO,CAAC;AAAA,IAC1B,SAAS,OAAO;AACd,WAAK,IAAI,0BAA0B;AACnC,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MACpD,CAAC;AACD,WAAK,IAAI,qBAAqB,KAAK;AACnC,WAAK,IAAI,iBAAiB,QAAQ,SAAS,iBAAiB,QAAQ,MAAM,UAAU,0BAAM;AAAA,IAC5F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAkC;AACtC,UAAM,WAAW,KAAK,IAAI,eAAe,YAAY;AAErD,QAAI,uBAAuB;AAC3B,aAAS,IAAI,SAAS,SAAS,GAAG,KAAK,GAAG,KAAK;AAC7C,UAAI,SAAS,CAAC,EAAE,SAAS,QAAQ;AAC/B,+BAAuB;AACvB;AAAA,MACF;AAAA,IACF;AAEA,QAAI,yBAAyB,IAAI;AAC/B,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,+DAAa,CAAC;AAC7D;AAAA,IACF;AAEA,UAAM,kBAAkB,SAAS,oBAAoB;AAErD,aAAS,IAAI,SAAS,SAAS,GAAG,IAAI,sBAAsB,KAAK;AAC/D,WAAK,IAAI,YAAY,EAAE,MAAM,iBAAiB,WAAW,SAAS,CAAC,EAAE,GAAG,CAAC;AAAA,IAC3E;AAEA,WAAO,KAAK,IAAI,eAAe,YAAY,EAAE,SAAS,uBAAuB,GAAG;AAC9E,YAAM,KAAK,IAAI,eAAe,kBAAkB;AAAA,IAClD;AAEA,UAAM,KAAK,cAAc,gBAAgB,SAAS,gBAAgB,aAAa;AAAA,MAC7E,iBAAiB;AAAA,IACnB,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAiC;AACrC,QAAI,iBAAiB;AAErB,QAAI,KAAK,IAAI,cAAc,MAAM,GAAG;AAClC,uBAAiB;AACjB,YAAM,KAAK,qBAAqB;AAAA,IAClC;AAEA,UAAM,iBAAkE,CAAC,WAAW,QAAQ,WAAW,OAAO;AAC9G,eAAW,YAAY,gBAAgB;AACrC,UAAI,KAAK,IAAI,cAAc,QAAQ,GAAG;AACpC,yBAAiB;AACjB,aAAK,IAAI,iBAAiB,UAAU,QAAQ,oBAAK;AAAA,MACnD;AAAA,IACF;AAEA,QAAI,kBAAkB,KAAK,IAAI,aAAa;AAC1C,WAAK,IAAI,YAAY,OAAO;AAAA,IAC9B;AAEA,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,CAAC;AAAA,EAC9C;AAAA,EAEA,MAAM,eAA8B;AAClC,QAAI,CAAC,KAAK,IAAI,cAAc,MAAM,GAAG;AACnC;AAAA,IACF;AACA,UAAM,KAAK,qBAAqB;AAEhC,QAAI,KAAK,IAAI,aAAa;AACxB,WAAK,IAAI,YAAY,cAAc,MAAM;AAAA,IAC3C;AAAA,EACF;AAAA,EAEA,MAAc,uBAAsC;AAClD,QAAI,KAAK,IAAI,yBAAyB;AACpC,YAAM,aAAa,KAAK,IAAI,wBAAwB,QAAQ,KAAK,EAAE,SAAS;AAE5E,YAAM,UAAU,KAAK,IAAI,eAAe;AACxC,UAAI,SAAS;AACX,cAAM,cAAc,QAAQ,SAAS,KAAK,OAAK,EAAE,OAAO,KAAK,IAAI,wBAAyB,EAAE;AAE5F,YAAI,YAAY;AACd,cAAI,CAAC,aAAa;AAChB,kBAAM,KAAK,IAAI,eAAe,WAAW,KAAK,IAAI,uBAAuB;AAAA,UAC3E,WAAW,YAAY,YAAY,KAAK,IAAI,wBAAwB,SAAS;AAC3E,kBAAM,KAAK,IAAI,eAAe,kBAAkB,KAAK,IAAI,wBAAwB,SAAS,IAAI;AAAA,UAChG;AAAA,QACF,WAAW,aAAa;AACtB,gBAAM,WAAW,QAAQ,SAAS,UAAU,OAAK,EAAE,OAAO,KAAK,IAAI,wBAAyB,EAAE;AAC9F,cAAI,aAAa,IAAI;AACnB,oBAAQ,SAAS,OAAO,UAAU,CAAC;AACnC,kBAAM,KAAK,IAAI,eAAe,mBAAmB;AAAA,UACnD;AAAA,QACF;AAAA,MACF;AAEA,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,WAAW,KAAK,IAAI,wBAAwB;AAAA,QAC5C,SAAS,KAAK,IAAI,wBAAwB;AAAA,QAC1C,aAAa;AAAA,MACf,CAAC;AAED,WAAK,IAAI,0BAA0B;AAAA,IACrC;AAEA,SAAK,IAAI,iBAAiB,QAAQ,QAAQ,oBAAK;AAC/C,SAAK,IAAI,qBAAqB,KAAK;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,uBACJ,cACA,eACe;AACf,QAAI,KAAK,IAAI,cAAc,MAAM,GAAG;AAClC,YAAM,KAAK,aAAa;AACxB,YAAM,IAAI,QAAQ,CAAAA,aAAW,WAAWA,UAAS,EAAE,CAAC;AAAA,IACtD;AAEA,UAAM,cAAc,MAAM,KAAK,IAAI,kBAAkB;AACrD,QAAI,CAAC,aAAa;AAChB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAEA,SAAK,IAAI,iBAAiB,QAAQ,WAAW,eAAK,YAAY,KAAK;AACnE,SAAK,IAAI,qBAAqB,IAAI;AAElC,UAAM,cAAc,cAAc,KAAK,SAAS,MAC5C,cAAc,KAAK,MAAM,GAAG,GAAG,IAAI,QACnC,cAAc;AAElB,UAAM,iBAAiB,GAAG,YAAY;AAAA;AAAA,QAAa,cAAc,QAAQ;AAAA,EAAK,WAAW;AAAA;AAEzF,UAAM,cAAuB;AAAA,MAC3B,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,KAAK,IAAI;AAAA,IACtB;AAEA,UAAM,KAAK,IAAI,eAAe,WAAW,WAAW;AACpD,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,YAAY,CAAC;AAEjE,UAAM,aAAa,KAAK,sBAAsB,aAAa;AAE3D,UAAM,gBAAgB,KAAK,IAAI,eAAe,YAAY,EAAE,IAAI,SAAO;AACrE,UAAI,IAAI,OAAO,YAAY,IAAI;AAC7B,eAAO,EAAE,GAAG,KAAK,SAAS,WAAW;AAAA,MACvC;AACA,aAAO;AAAA,IACT,CAAC;AAED,UAAM,mBAA4B;AAAA,MAChC,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,KAAK,IAAI;AAAA,MACpB,aAAa;AAAA,IACf;AAEA,UAAM,KAAK,IAAI,eAAe,WAAW,gBAAgB;AACzD,SAAK,IAAI,0BAA0B;AAEnC,QAAI,eAAe,KAAK,IAAI;AAC5B,UAAM,gBAAgB;AAEtB,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,kBAAkB,WAAW,KAAK,CAAC;AAEvF,UAAM,mBAAmB,KAAK,kBAAkB,MAAM;AACtD,UAAM,sBAAsB,KAAK,UAAU,IACvC,oLACA;AAEJ,UAAM,gBAAgB,KAAK,cAAc,mBAAmB,eAAe,MAAM,cAAc,IAAI;AAEnG,UAAM,gBAAyB;AAAA,MAC7B,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,SAAS,mBAAmB,gBAAgB;AAAA,MAC5C,WAAW,KAAK,IAAI;AAAA,IACtB;AACA,UAAM,qBAAqB,CAAC,eAAe,GAAG,aAAa;AAE3D,QAAI;AACF,YAAM,YAAY,YAAY,oBAAoB;AAAA,QAChD,SAAS,CAAC,UAAU;AAClB,2BAAiB,WAAW;AAC5B,cAAI,KAAK,IAAI,yBAAyB;AACpC,iBAAK,IAAI,wBAAwB,UAAU,iBAAiB;AAAA,UAC9D;AACA,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,WAAW,iBAAiB;AAAA,YAC5B,SAAS,iBAAiB;AAAA,UAC5B,CAAC;AAED,gBAAM,MAAM,KAAK,IAAI;AACrB,cAAI,MAAM,eAAe,iBAAiB,iBAAiB,QAAQ,SAAS,GAAG;AAC7E,2BAAe;AACf,iBAAK,IAAI,eAAe,kBAAkB,iBAAiB,SAAS,OAAO,IAAI;AAAA,UACjF;AAAA,QACF;AAAA,QACA,YAAY,OAAO,iBAAiB;AAClC,2BAAiB,UAAU;AAC3B,2BAAiB,cAAc;AAC/B,eAAK,IAAI,0BAA0B;AACnC,eAAK,IAAI,eAAe,kBAAkB,cAAc,IAAI;AAE5D,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,WAAW,iBAAiB;AAAA,YAC5B,SAAS;AAAA,UACX,CAAC;AACD,eAAK,IAAI,qBAAqB,KAAK;AACnC,eAAK,IAAI,iBAAiB,QAAQ,WAAW,GAAG,YAAY,cAAI;AAAA,QAClE;AAAA,QACA,SAAS,CAAC,UAAU;AAClB,eAAK,IAAI,0BAA0B;AACnC,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,SAAS,MAAM;AAAA,UACjB,CAAC;AACD,eAAK,IAAI,qBAAqB,KAAK;AACnC,eAAK,IAAI,iBAAiB,QAAQ,SAAS,MAAM,OAAO;AAAA,QAC1D;AAAA,MACF,GAAG,EAAE,WAAW,OAAO,CAAC;AAAA,IAC1B,SAAS,OAAO;AACd,WAAK,IAAI,0BAA0B;AACnC,YAAM,WAAW,iBAAiB,QAAQ,MAAM,UAAU;AAC1D,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,MACX,CAAC;AACD,WAAK,IAAI,qBAAqB,KAAK;AACnC,WAAK,IAAI,iBAAiB,QAAQ,SAAS,QAAQ;AAAA,IACrD;AAAA,EACF;AAAA,EAEQ,sBAAsB,KAAgC;AAC5D,UAAM,YAAY,KAAK,UAAU;AAEjC,QAAI,SAAS,GAAG,IAAI,MAAM;AAAA;AAAA,IAE1B,YAAY,iBAAO,MAAM,SAAS,IAAI,QAAQ;AAAA,IAC9C,YAAY,iBAAO,UAAU,OAAO,IAAI,QAAQ;AAAA;AAAA,QAE5C,IAAI,QAAQ;AAAA,EAClB,IAAI,IAAI;AAAA;AAGN,QAAI,IAAI,kBAAkB;AACxB,UAAI,WAAW;AACb,kBAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAgBZ,OAAO;AACL,kBAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOZ;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,mBAAkC;AAChC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,sBAAwC;AACtC,WAAO,KAAK;AAAA,EACd;AACF;;;AIrhBA,IAAAC,UAAwB;AACxB,IAAAC,QAAsB;AACtB,IAAAC,MAAoB;AAEpB;AAOO,IAAM,iBAAN,MAA+C;AAAA,EACpD,YAAoB,KAAsB;AAAtB;AAAA,EAAuB;AAAA,EAE3C,MAAM,OAAO,MAA6B;AACxC,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,cAAM,KAAK,gBAAgB,KAAK,aAAa,KAAK,WAAW;AAC7D,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,cAAc,KAAK,WAAW,KAAK,IAAI;AAClD,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,cAAc,KAAK,WAAW,KAAK,MAAM;AACpD,eAAO;AAAA,MACT,KAAK;AACH,aAAK,mBAAmB;AACxB,eAAO;AAAA,MACT,KAAK;AACH,aAAK,YAAY,KAAK,SAAS;AAC/B,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,eAAe,KAAK,MAAM,KAAK,KAAK;AAC/C,eAAO;AAAA,MACT,KAAK;AACH,aAAK,cAAc,KAAK,WAAW,KAAK,QAAQ;AAChD,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAAgB,aAAqB,aAAoC;AAC7E,UAAM,cAAc,MAAM,KAAK,IAAI,kBAAkB;AACrD,QAAI,CAAC,aAAa;AAChB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAEA,UAAM,SAAS,KAAK,IAAI,iBAAiB,eAAe,aAA4B,WAAW;AAC/F,QAAI,WAAW;AAEf,SAAK,IAAI,iBAAiB,WAAW,WAAW,yCAAW;AAE3D,UAAM,mBAAmB,WAAW,KAAK,IAAI,CAAC;AAE9C,UAAM,YAAY;AAAA,MAChB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,MAClE;AAAA,QACE,SAAS,CAAC,UAAU;AAClB,sBAAY;AAAA,QACd;AAAA,QACA,YAAY,YAAY;AACtB,gBAAM,OAAO,KAAK,IAAI,iBAAiB,mBAAmB,QAAQ;AAClE,cAAI,MAAM;AACR,kBAAM,aAAqC;AAAA,cACzC,WAAW;AAAA,cACX,UAAU;AAAA,cACV,OAAO;AAAA,cACP,OAAO;AAAA,cACP,IAAI;AAAA,cACJ,OAAO;AAAA,cACP,KAAK;AAAA,cACL,SAAS;AAAA,cACT,cAAc;AAAA,YAChB;AAEA,kBAAM,YAAY,YAAY,SAAS,KAAK,YAAY,MAAM,GAAG,EAAE,IAAI,QAAQ;AAC/E,kBAAM,QAAQ,GAAG,WAAW,WAAW,KAAK,WAAW,MAAM,SAAS;AAEtE,kBAAM,UAAU,KAAK,IAAI,iBAAiB;AAAA,cACxC;AAAA,cACA;AAAA,cACA;AAAA,YACF;AAGA,kBAAM,KAAK,qBAAqB,OAAO;AAGvC,iBAAK,IAAI,uBAAuB;AAAA,cAC9B,MAAM;AAAA,cACN;AAAA,cACA;AAAA,cACA,WAAW,KAAK,IAAI;AAAA,YACtB;AAEA,iBAAK,IAAI,YAAY,EAAE,MAAM,oBAAoB,QAAQ,CAAC;AAC1D,iBAAK,IAAI,iBAAiB,WAAW,WAAW,sCAAQ;AAAA,UAC1D,OAAO;AACL,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,2EAAe,CAAC;AAC/D,iBAAK,IAAI,iBAAiB,WAAW,SAAS,sCAAQ;AAAA,UACxD;AAAA,QACF;AAAA,QACA,SAAS,CAAC,UAAU;AAClB,eAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,MAAM,QAAQ,CAAC;AAC9D,eAAK,IAAI,iBAAiB,WAAW,SAAS,MAAM,OAAO;AAAA,QAC7D;AAAA,MACF;AAAA,MACA,EAAE,WAAW,MAAM,WAAW,iBAAiB;AAAA,IACjD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,sBAAsB,aAAoC;AAC9D,UAAM,SAAgB,eAAO;AAC7B,QAAI,CAAC,UAAU,OAAO,UAAU,SAAS;AACvC,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,mDAAW,CAAC;AAC3D;AAAA,IACF;AAEA,UAAM,eAAe,OAAO,SAAS,QAAQ,OAAO,SAAS;AAC7D,UAAM,WAAW,OAAO,SAAS;AAEjC,UAAM,cAAc,2BAAO,QAAQ,2BAAO,WAAW;AAAA,QAAY,QAAQ;AAAA,EAAK,YAAY;AAAA;AAE1F,UAAM,KAAK,gBAAgB,aAAa,WAAW;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAiB,UAAmB,aAAqC;AAC7E,UAAM,SAAgB,eAAO;AAC7B,UAAM,aAAa,aAAY,iCAAQ,SAAS,IAAI;AAEpD,QAAI,CAAC,YAAY;AACf,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,mDAAW,CAAC;AAC3D;AAAA,IACF;AAEA,QAAI;AACJ,QAAI;AACF,gBAAa,iBAAa,YAAY,OAAO;AAAA,IAC/C,SAAS,KAAK;AACZ,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,yCAAW,UAAU,GAAG,CAAC;AACxE;AAAA,IACF;AAEA,UAAM,WAAgB,cAAQ,UAAU,EAAE,MAAM,CAAC;AACjD,UAAM,WAAgB,eAAS,UAAU;AACzC,UAAM,OAAO,eAAe;AAE5B,UAAM,cAAc,gBAAM,QAAQ,kCAAS,IAAI;AAAA,QAAY,QAAQ;AAAA,EAAK,QAAQ,MAAM,GAAG,GAAI,CAAC;AAAA;AAE9F,UAAM,KAAK,gBAAgB,MAAM,WAAW;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,wBAAwB,aAAoC;AAEhE,QAAI,cAAc;AAClB,UAAM,YAAY,YAAY,YAAY;AAE1C,QAAI,UAAU,SAAS,cAAI,KAAK,UAAU,SAAS,UAAU,KAAK,UAAU,SAAS,cAAI,GAAG;AAC1F,oBAAc;AAAA,IAChB,WAAW,UAAU,SAAS,QAAG,KAAK,UAAU,SAAS,OAAO,GAAG;AACjE,oBAAc;AAAA,IAChB,WAAW,UAAU,SAAS,cAAI,KAAK,UAAU,SAAS,OAAO,GAAG;AAClE,oBAAc;AAAA,IAChB,WAAW,UAAU,SAAS,IAAI,KAAK,UAAU,SAAS,oBAAK,KAAK,UAAU,SAAS,QAAG,GAAG;AAC3F,oBAAc;AAAA,IAChB,WAAW,UAAU,SAAS,cAAI,KAAK,UAAU,SAAS,OAAO,KAAK,UAAU,SAAS,oBAAK,GAAG;AAC/F,oBAAc;AAAA,IAChB,WAAW,UAAU,SAAS,0BAAM,KAAK,UAAU,SAAS,SAAS,GAAG;AACtE,oBAAc;AAAA,IAChB,WAAW,UAAU,SAAS,cAAI,KAAK,UAAU,SAAS,cAAc,GAAG;AACzE,oBAAc;AAAA,IAChB;AAEA,UAAM,KAAK,gBAAgB,aAAa,WAAW;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,sBAAqC;AApM7C;AAqMI,UAAM,iBAAgB,WAAO,kBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAClE,QAAI,CAAC,eAAe;AAClB,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,yDAAY,CAAC;AAC5D;AAAA,IACF;AAGA,UAAM,YAAY,KAAK,wBAAwB,aAAa;AAC5D,UAAM,cAAc;AAAA,EAAmB,SAAS;AAEhD,UAAM,KAAK,gBAAgB,gBAAgB,WAAW;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,WAAmB,MAA6B;AAClE,UAAM,UAAU,KAAK,IAAI,iBAAiB,cAAc,WAAW,IAAI;AACvE,QAAI,SAAS;AACX,YAAM,UAAU,KAAK,IAAI,iBAAiB,WAAW,SAAS;AAC9D,UAAI,SAAS;AACX,aAAK,IAAI,YAAY,EAAE,MAAM,kBAAkB,QAAQ,CAAC;AAAA,MAC1D;AAAA,IACF,OAAO;AACL,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,uCAAS,CAAC;AAAA,IAC3D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,WAAmB,QAA+B;AACpE,QAAI;AAEF,YAAM,UAAU,KAAK,IAAI,iBAAiB,WAAW,SAAS;AAC9D,UAAI,CAAC,SAAS;AACZ,cAAM,IAAI,MAAM,gCAAO;AAAA,MACzB;AACA,YAAM,SAAS,MAAM,KAAK,IAAI,iBAAiB,cAAc,SAAS,MAAa;AACnF,WAAK,IAAI,YAAY,EAAE,MAAM,mBAAmB,SAAS,QAAQ,OAAO,CAAC;AAAA,IAC3E,SAAS,OAAO;AACd,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,iBAAiB,QAAQ,MAAM,UAAU,gBAAgB,CAAC;AAAA,IAC3G;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAA2B;AACzB,UAAM,WAAW,KAAK,IAAI,iBAAiB,eAAe;AAC1D,SAAK,IAAI,YAAY,EAAE,MAAM,kBAAkB,SAAS,CAAC;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,WAAyB;AACnC,UAAM,UAAU,KAAK,IAAI,iBAAiB,WAAW,SAAS;AAC9D,QAAI,SAAS;AACX,WAAK,IAAI,YAAY,EAAE,MAAM,oBAAoB,QAAQ,CAAC;AAAA,IAC5D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,MAAc,OAA8B;AAC/D,SAAK,IAAI,iBAAiB,WAAW,WAAW,yCAAW;AAE3D,UAAM,qBAAqB,WAAW;AACtC,QAAI,eAAe;AAEnB,QAAI;AACF,YAAM,WAAW,SAAS;AAE1B,YAAM,KAAK,IAAI,eAAe,oBAAoB,MAAM,UAAU;AAAA,QAChE,SAAS,CAAC,OAAO,gBAAgB;AAC/B,cAAI,CAAC,cAAc;AACjB,2BAAe;AACf,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,SAAS;AAAA,gBACP,IAAI;AAAA,gBACJ,MAAM;AAAA,gBACN,SAAS;AAAA,gBACT,WAAW,KAAK,IAAI;AAAA,cACtB;AAAA,cACA,WAAW;AAAA,YACb,CAAC;AAAA,UACH,OAAO;AACL,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,WAAW;AAAA,cACX,SAAS;AAAA,YACX,CAAC;AAAA,UACH;AAAA,QACF;AAAA,QACA,YAAY,CAAC,WAAW;AACtB,cAAI,OAAO,WAAW,OAAO,WAAW;AACtC,kBAAM,eAAe;AAAA;AAAA,EAAmB,OAAO,eAAe,EAAE;AAAA;AAAA;AAAA,EAAsB,OAAO,SAAS;AAAA;AAEtG,gBAAI,cAAc;AAChB,mBAAK,IAAI,YAAY;AAAA,gBACnB,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,SAAS;AAAA,cACX,CAAC;AAAA,YACH;AAEA,iBAAK,IAAI,YAAY,EAAE,MAAM,oBAAoB,MAAM,OAAO,UAAU,CAAC;AACzE,iBAAK,IAAI,iBAAiB,WAAW,WAAW,sCAAQ;AAAA,UAC1D,OAAO;AACL,gBAAI,cAAc;AAChB,mBAAK,IAAI,YAAY;AAAA,gBACnB,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,SAAS;AAAA;AAAA,EAAmB,OAAO,SAAS,kDAAU;AAAA,cACxD,CAAC;AAAA,YACH;AACA,iBAAK,IAAI,iBAAiB,WAAW,SAAS,0BAAM;AAAA,UACtD;AAAA,QACF;AAAA,QACA,SAAS,CAAC,QAAQ;AAChB,gBAAM,eAAe,eAAe,QAAQ,IAAI,UAAU;AAC1D,cAAI,cAAc;AAChB,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,WAAW;AAAA,cACX,SAAS;AAAA;AAAA,EAAmB,YAAY;AAAA,YAC1C,CAAC;AAAA,UACH;AACA,eAAK,IAAI,iBAAiB,WAAW,SAAS,YAAY;AAAA,QAC5D;AAAA,MACF,CAAC;AAAA,IACH,SAAS,GAAG;AACV,YAAM,WAAW,aAAa,QAAQ,EAAE,UAAU;AAClD,WAAK,IAAI,iBAAiB,WAAW,SAAS,QAAQ;AAAA,IACxD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,WAAmB,UAAwB;AACvD,UAAM,UAAU,KAAK,IAAI,iBAAiB,cAAc,WAAW,QAAQ;AAC3E,QAAI,SAAS;AACX,MAAO,eAAO,uBAAuB,+CAAY,QAAQ,EAAE;AAAA,IAC7D,OAAO;AACL,MAAO,eAAO,iBAAiB,gCAAO;AAAA,IACxC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAqB,SAAiC;AAClE,QAAI;AACF,YAAM,MAAM;AACZ,YAAM,WAAW,KAAK,IAAI,iBAAiB,YAAY,IAAe,KAAK,CAAC,CAAC;AAC7E,YAAM,UAAU,CAAC,SAAS,GAAG,SAAS,OAAO,OAAK,EAAE,OAAO,QAAQ,EAAE,CAAC,EAAE,MAAM,GAAG,EAAE;AACnF,YAAM,KAAK,IAAI,iBAAiB,YAAY,OAAO,KAAK,OAAO;AAAA,IACjE,SAAS,GAAG;AACV,cAAQ,MAAM,mCAAmC,CAAC;AAAA,IACpD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,MAAc,QAAQ,GAAG,WAAW,GAAW;AAC7E,QAAI,QAAQ;AAAU,aAAO;AAE7B,UAAM,QAAkB,CAAC;AACzB,UAAM,SAAS,KAAK,OAAO,KAAK;AAEhC,QAAI;AACF,YAAM,QAAW,gBAAY,IAAI;AACjC,YAAM,WAAW,MAAM;AAAA,QAAO,OAC5B,CAAC,EAAE,WAAW,GAAG,KACjB,MAAM,kBACN,MAAM,iBACN,MAAM,UACN,MAAM;AAAA,MACR,EAAE,MAAM,GAAG,EAAE;AAEb,iBAAW,QAAQ,UAAU;AAC3B,cAAM,WAAgB,WAAK,MAAM,IAAI;AACrC,YAAI;AACF,gBAAM,OAAU,aAAS,QAAQ;AACjC,cAAI,KAAK,YAAY,GAAG;AACtB,kBAAM,KAAK,GAAG,MAAM,aAAM,IAAI,GAAG;AACjC,gBAAI,QAAQ,UAAU;AACpB,oBAAM,WAAW,KAAK,wBAAwB,UAAU,QAAQ,GAAG,QAAQ;AAC3E,kBAAI;AAAU,sBAAM,KAAK,QAAQ;AAAA,YACnC;AAAA,UACF,OAAO;AACL,kBAAM,KAAK,GAAG,MAAM,aAAM,IAAI,EAAE;AAAA,UAClC;AAAA,QACF,QAAQ;AAAA,QAAC;AAAA,MACX;AAAA,IACF,QAAQ;AAAA,IAAC;AAET,WAAO,MAAM,KAAK,IAAI;AAAA,EACxB;AACF;;;ACjZA,IAAAC,UAAwB;AACxB,IAAAC,QAAsB;AACtB,IAAAC,MAAoB;AAEpB;AAOO,IAAM,cAAN,MAA4C;AAAA,EACjD,YAAoB,KAAsB;AAAtB;AAAA,EAAuB;AAAA,EAE3C,MAAM,OAAO,MAA6B;AACxC,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,cAAM,KAAK,aAAa,KAAK,QAAQ;AACrC,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,SAAS,KAAK,MAAM,KAAK,IAAI;AACxC,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,QAAQ,KAAK,IAAI;AAC5B,eAAO;AAAA,MACT,KAAK;AACH,aAAK,gBAAgB;AACrB,eAAO;AAAA,MACT,KAAK;AACH,aAAK,SAAS,KAAK,SAAS;AAC5B,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,YAAY,KAAK,MAAM,KAAK,QAAQ,KAAK,WAAW,KAAK,IAAI;AACxE,eAAO;AAAA,MACT,KAAK;AACH,aAAK,WAAW,KAAK,WAAW,KAAK,OAAO;AAC5C,eAAO;AAAA,MACT,KAAK;AACH,aAAK,WAAW,KAAK,SAAS;AAC9B,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,WAAW,KAAK,MAAM,KAAK,WAAW,KAAK,IAAI;AAC1D,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,UAAkC;AAnDvD;AAoDI,UAAM,SAAgB,eAAO;AAC7B,UAAM,aAAa,aAAY,iCAAQ,SAAS,IAAI;AAEpD,QAAI,CAAC,YAAY;AACf,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,qEAAc,CAAC;AAC9D;AAAA,IACF;AAEA,UAAM,SAAS,QAAQ,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAE5E,UAAM,cAAc,MAAM,KAAK,IAAI,kBAAkB;AACrD,QAAI,CAAC,aAAa;AAChB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAEA,UAAM,kBAAgB,WAAO,kBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI,WAAU;AAE5E,UAAM,EAAE,UAAU,UAAU,IAAI,KAAK,IAAI,cAAc,2BAA2B,YAAY,aAAa;AAE3G,QAAI;AACJ,QAAI;AACF,mBAAgB,iBAAa,YAAY,OAAO;AAAA,IAClD,SAAS,KAAK;AACZ,WAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,yCAAW,UAAU,GAAG,CAAC;AACxE;AAAA,IACF;AAEA,UAAM,SAAS,KAAK,IAAI,cAAc,eAAe,YAAY,YAAY,SAAS;AACtF,UAAM,WAAgB,eAAS,UAAU;AAEzC,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,UAAU;AAAA,MACV;AAAA,MACA,QAAQ;AAAA,MACR,SAAS,sBAAO,QAAQ,iBAAO,SAAS;AAAA,MACxC,WAAW,KAAK,IAAI;AAAA,IACtB,CAAC;AAED,QAAI,WAAW;AAEf,UAAM,YAAY;AAAA,MAChB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,MAClE;AAAA,QACE,SAAS,CAAC,UAAU;AAClB,sBAAY;AAAA,QACd;AAAA,QACA,YAAY,YAAY;AACtB,gBAAM,WAAW,KAAK,IAAI,cAAc,gBAAgB,UAAU,QAAQ;AAC1E,gBAAM,WAAW,KAAK,IAAI,cAAc,qBAAqB,YAAY,SAAS;AAGlF,gBAAM,KAAK,kBAAkB;AAAA,YAC3B,MAAM;AAAA,YACN,MAAM;AAAA,YACN;AAAA,YACA,YAAY;AAAA,UACd,CAAC;AAGD,eAAK,IAAI,oBAAoB;AAAA,YAC3B,MAAM;AAAA,YACN;AAAA,YACA,YAAY;AAAA,YACZ,WAAW,KAAK,IAAI;AAAA,UACtB;AAEA,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,MAAM;AAAA,YACN,eAAe;AAAA,YACf;AAAA,YACA;AAAA,UACF,CAAC;AAED,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,UAAU;AAAA,YACV;AAAA,YACA,QAAQ;AAAA,YACR,SAAS,GAAG,QAAQ;AAAA,YACpB,WAAW,KAAK,IAAI;AAAA,UACtB,CAAC;AAAA,QACH;AAAA,QACA,SAAS,CAAC,UAAU;AAClB,eAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,MAAM,QAAQ,CAAC;AAC9D,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,UAAU;AAAA,YACV;AAAA,YACA,QAAQ;AAAA,YACR,SAAS,MAAM;AAAA,YACf,WAAW,KAAK,IAAI;AAAA,UACtB,CAAC;AAAA,QACH;AAAA,MACF;AAAA,MACA,EAAE,WAAW,MAAM,WAAW,QAAQ,MAAM,GAAG;AAAA,IACjD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAiB,aAAoC;AA/J7D;AAgKI,UAAM,SAAS,eAAe,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAEnF,UAAM,cAAc,MAAM,KAAK,IAAI,kBAAkB;AACrD,QAAI,CAAC,aAAa;AAChB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAGA,QAAI,aAAa;AACjB,QAAI,WAAW;AAEf,UAAM,iBAAiB,YAAY,MAAM,4BAA4B;AACrE,QAAI,gBAAgB;AAClB,iBAAW,eAAe,CAAC,KAAK;AAChC,mBAAa,eAAe,CAAC;AAAA,IAC/B,WAAW,YAAY,WAAW,OAAO,GAAG;AAC1C,mBAAa,YAAY,QAAQ,aAAa,EAAE,EAAE,KAAK;AAAA,IACzD;AAEA,QAAI,CAAC,UAAU;AACb,iBAAW,KAAK,uBAAuB,UAAU;AAAA,IACnD;AAEA,QAAI,CAAC,YAAY,aAAa,WAAW;AACvC,YAAM,SAAgB,eAAO;AAC7B,UAAI,QAAQ;AACV,mBAAW,KAAK,oBAAoB,OAAO,SAAS,UAAU;AAAA,MAChE;AAAA,IACF;AAEA,QAAI,CAAC,YAAY,aAAa,WAAW;AACvC,iBAAW;AAAA,IACb;AAEA,UAAM,YAAY,KAAK,4BAA4B,QAAQ;AAE3D,UAAM,kBAAgB,WAAO,kBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI,WAAU;AAC5E,UAAM,SAAS,KAAK,IAAI,cAAc,eAAe,YAAY,UAAU,QAAQ,IAAI,SAAS;AAEhG,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,UAAU;AAAA,MACV;AAAA,MACA,QAAQ;AAAA,MACR,SAAS,+CAAY,QAAQ,kBAAQ,SAAS;AAAA,MAC9C,WAAW,KAAK,IAAI;AAAA,IACtB,CAAC;AAED,QAAI,WAAW;AAEf,UAAM,YAAY;AAAA,MAChB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,MAClE;AAAA,QACE,SAAS,CAAC,UAAU;AAClB,sBAAY;AAAA,QACd;AAAA,QACA,YAAY,YAAY;AACtB,gBAAM,WAAW,KAAK,IAAI,cAAc,gBAAgB,UAAU,QAAQ;AAC1E,gBAAM,MAAM,KAAK,wBAAwB,QAAQ;AACjD,gBAAM,WAAgB,WAAK,eAAe,cAAc,GAAG,EAAE;AAE7D,gBAAM,KAAK,kBAAkB;AAAA,YAC3B,MAAM;AAAA,YACN,MAAM;AAAA,YACN;AAAA,YACA,YAAY;AAAA,UACd,CAAC;AAED,eAAK,IAAI,oBAAoB;AAAA,YAC3B,MAAM;AAAA,YACN;AAAA,YACA,YAAY;AAAA,YACZ,WAAW,KAAK,IAAI;AAAA,UACtB;AAEA,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,MAAM;AAAA,YACN,eAAe;AAAA,YACf;AAAA,YACA;AAAA,UACF,CAAC;AAED,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,UAAU;AAAA,YACV;AAAA,YACA,QAAQ;AAAA,YACR,SAAS,yCAAW,SAAS;AAAA,YAC7B,WAAW,KAAK,IAAI;AAAA,UACtB,CAAC;AAAA,QACH;AAAA,QACA,SAAS,CAAC,UAAU;AAClB,eAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,MAAM,QAAQ,CAAC;AAC9D,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,UAAU;AAAA,YACV;AAAA,YACA,QAAQ;AAAA,YACR,SAAS,MAAM;AAAA,YACf,WAAW,KAAK,IAAI;AAAA,UACtB,CAAC;AAAA,QACH;AAAA,MACF;AAAA,MACA,EAAE,WAAW,MAAM,WAAW,eAAe,MAAM,GAAG;AAAA,IACxD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,MAAc,UAAiC;AAnRhE;AAoRI,QAAI;AACF,YAAM,kBAAgB,WAAO,kBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI,WAAU;AAC5E,YAAM,WAAgB,iBAAW,QAAQ,IAAI,WAAgB,WAAK,eAAe,QAAQ;AAGzF,YAAM,MAAW,cAAQ,QAAQ;AACjC,UAAI,CAAI,eAAW,GAAG,GAAG;AACvB,QAAG,cAAU,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,MACvC;AAEA,MAAG,kBAAc,UAAU,MAAM,OAAO;AAGxC,YAAM,WAAW,MAAa,kBAAU,iBAAiB,QAAQ;AACjE,YAAa,eAAO,iBAAiB,QAAQ;AAE7C,MAAO,eAAO,uBAAuB,+CAAY,QAAQ,EAAE;AAAA,IAC7D,SAAS,OAAO;AACd,MAAO,eAAO,iBAAiB,6BAAS,iBAAiB,QAAQ,MAAM,UAAU,0BAAM,EAAE;AAAA,IAC3F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAQ,UAAiC;AA7SjD;AA8SI,UAAM,iBAAgB,WAAO,kBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAClE,QAAI,CAAC,eAAe;AAClB,MAAO,eAAO,iBAAiB,4CAAS;AACxC;AAAA,IACF;AAGA,UAAM,MAAW,cAAQ,QAAQ;AACjC,QAAI,UAAU;AAEd,QAAI,CAAC,OAAO,QAAQ,OAAO,MAAM,EAAE,SAAS,GAAG,GAAG;AAEhD,YAAM,kBAAuB,WAAK,eAAe,cAAc;AAC/D,UAAO,eAAW,eAAe,GAAG;AAClC,cAAM,MAAM,KAAK,MAAS,iBAAa,iBAAiB,OAAO,CAAC;AAChE,cAAM,OAAO,EAAE,GAAG,IAAI,cAAc,GAAG,IAAI,gBAAgB;AAE3D,YAAI,KAAK,QAAQ,GAAG;AAClB,oBAAU,kBAAkB,QAAQ;AAAA,QACtC,WAAW,KAAK,MAAM,GAAG;AACvB,oBAAU,YAAY,QAAQ;AAAA,QAChC,WAAW,KAAK,OAAO,GAAG;AACxB,oBAAU,aAAa,QAAQ;AAAA,QACjC;AAAA,MACF;AAAA,IACF,WAAW,QAAQ,OAAO;AACxB,gBAAU,oBAAoB,QAAQ;AAAA,IACxC,WAAW,QAAQ,OAAO;AACxB,gBAAU,cAAc,QAAQ;AAAA,IAClC;AAEA,QAAI,CAAC,SAAS;AACZ,gBAAU,eAAe,QAAQ;AAAA,IACnC;AAGA,UAAM,WAAkB,eAAO,eAAe,gBAAgB;AAC9D,aAAS,KAAK;AACd,aAAS,SAAS,OAAO,aAAa,QAAQ,OAAO,EAAE;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAwB;AACtB,UAAM,QAAQ,KAAK,eAAe;AAClC,SAAK,IAAI,YAAY,EAAE,MAAM,eAAe,MAAM,CAAC;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,WAAyB;AAChC,UAAM,QAAQ,KAAK,eAAe;AAClC,QAAI,MAAM,SAAS,GAAG;AACpB,YAAM,OAAO,MAAM,SAAS;AAC5B,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,MAAM,KAAK;AAAA,QACX,eAAe,KAAK;AAAA,QACpB,WAAW,KAAK;AAAA,MAClB,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,MAAc,QAAkB,WAAmB,UAAiC;AACpG,SAAK,IAAI,iBAAiB,QAAQ,WAAW,qDAAa;AAE1D,UAAM,qBAAqB,WAAW;AACtC,UAAM,WAAW,KAAK,yBAAyB,SAAS;AACxD,QAAI,eAAe;AAEnB,QAAI;AAEF,YAAM,cAAc,OAAO,KAAK,IAAI;AACpC,YAAM,KAAK,IAAI,eAAe,iBAAiB,MAAM,aAAa,WAAW,UAAU;AAAA,QACrF,SAAS,CAAC,OAAO,gBAAgB;AAC/B,cAAI,CAAC,cAAc;AACjB,2BAAe;AACf,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,SAAS;AAAA,gBACP,IAAI;AAAA,gBACJ,MAAM;AAAA,gBACN,SAAS;AAAA,gBACT,WAAW,KAAK,IAAI;AAAA,cACtB;AAAA,cACA,WAAW;AAAA,YACb,CAAC;AAAA,UACH,OAAO;AACL,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,WAAW;AAAA,cACX,SAAS;AAAA,YACX,CAAC;AAAA,UACH;AAAA,QACF;AAAA,QACA,YAAY,CAAC,WAAW;AACtB,cAAI,OAAO,WAAW,OAAO,WAAW;AACtC,kBAAM,eAAe;AAAA;AAAA,EAAqB,OAAO,eAAe,EAAE;AAAA;AAAA,QAAa,YAAY,YAAY;AAAA,EAAK,OAAO,SAAS;AAAA;AAE5H,gBAAI,cAAc;AAChB,mBAAK,IAAI,YAAY;AAAA,gBACnB,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,SAAS;AAAA,cACX,CAAC;AAAA,YACH;AAEA,iBAAK,IAAI,YAAY,EAAE,MAAM,iBAAiB,MAAM,OAAO,UAAU,CAAC;AACtE,iBAAK,IAAI,iBAAiB,QAAQ,WAAW,sCAAQ;AAAA,UACvD,OAAO;AACL,gBAAI,cAAc;AAChB,mBAAK,IAAI,YAAY;AAAA,gBACnB,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,SAAS;AAAA;AAAA,EAAmB,OAAO,SAAS,kDAAU;AAAA,cACxD,CAAC;AAAA,YACH;AACA,iBAAK,IAAI,iBAAiB,QAAQ,SAAS,0BAAM;AAAA,UACnD;AAAA,QACF;AAAA,QACA,SAAS,CAAC,QAAQ;AAChB,gBAAM,eAAe,eAAe,QAAQ,IAAI,UAAU;AAC1D,cAAI,cAAc;AAChB,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,WAAW;AAAA,cACX,SAAS;AAAA;AAAA,EAAmB,YAAY;AAAA,YAC1C,CAAC;AAAA,UACH;AACA,eAAK,IAAI,iBAAiB,QAAQ,SAAS,YAAY;AAAA,QACzD;AAAA,MACF,CAAC;AAAA,IACH,SAAS,GAAG;AACV,YAAM,WAAW,aAAa,QAAQ,EAAE,UAAU;AAClD,WAAK,IAAI,iBAAiB,QAAQ,SAAS,QAAQ;AAAA,IACrD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,WAAmB,SAAuB;AACnD,QAAI;AACF,YAAM,MAAM;AACZ,YAAM,QAAQ,KAAK,IAAI,iBAAiB,YAAY,IAAW,KAAK,CAAC,CAAC;AACtE,UAAI,MAAM,SAAS,GAAG;AACpB,cAAM,SAAS,EAAE,aAAa;AAC9B,aAAK,IAAI,iBAAiB,YAAY,OAAO,KAAK,KAAK;AACvD,QAAO,eAAO,uBAAuB,+CAAY,OAAO,EAAE;AAAA,MAC5D;AAAA,IACF,SAAS,GAAG;AACV,MAAO,eAAO,iBAAiB,gCAAO;AAAA,IACxC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,WAAyB;AAClC,QAAI;AACF,YAAM,MAAM;AACZ,YAAM,QAAQ,KAAK,IAAI,iBAAiB,YAAY,IAAW,KAAK,CAAC,CAAC;AACtE,YAAM,OAAO,WAAW,CAAC;AACzB,WAAK,IAAI,iBAAiB,YAAY,OAAO,KAAK,KAAK;AACvD,MAAO,eAAO,uBAAuB,4CAAS;AAAA,IAChD,SAAS,GAAG;AACV,MAAO,eAAO,iBAAiB,0BAAM;AAAA,IACvC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,MAAc,WAAmB,UAAiC;AACjF,SAAK,IAAI,iBAAiB,QAAQ,WAAW,qDAAa;AAE1D,UAAM,qBAAqB,WAAW;AACtC,UAAM,WAAW,KAAK,yBAAyB,SAAS;AACxD,QAAI,eAAe;AACnB,QAAI,WAAW;AAEf,UAAM,cAAc,MAAM,KAAK,IAAI,kBAAkB;AACrD,QAAI,CAAC,aAAa;AAChB,WAAK,IAAI,iBAAiB,QAAQ,SAAS,4BAAa;AACxD;AAAA,IACF;AAEA,UAAM,iBAAiB,KAAK,UAAU,IAClC,+GACA;AAEJ,UAAM,SAAS;AAAA;AAAA,gCAEP,SAAS;AAAA;AAAA;AAAA,EAGnB,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sIAWkB,cAAc;AAElC,UAAM,YAAY;AAAA,MAChB,CAAC,EAAE,IAAI,KAAK,MAAM,QAAQ,SAAS,QAAQ,WAAW,KAAK,IAAI,EAAE,CAAC;AAAA,MAClE;AAAA,QACE,SAAS,CAAC,UAAU;AAClB,sBAAY;AAEZ,cAAI,CAAC,gBAAgB,SAAS,SAAS,IAAI;AACzC,2BAAe;AACf,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,SAAS;AAAA,gBACP,IAAI;AAAA,gBACJ,MAAM;AAAA,gBACN,SAAS;AAAA,gBACT,WAAW,KAAK,IAAI;AAAA,cACtB;AAAA,cACA,WAAW;AAAA,YACb,CAAC;AAAA,UACH,WAAW,cAAc;AACvB,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,WAAW;AAAA,cACX,SAAS;AAAA,YACX,CAAC;AAAA,UACH;AAAA,QACF;AAAA,QACA,YAAY,YAAY;AACtB,gBAAM,cAAc,KAAK,IAAI,cAAc,gBAAgB,UAAU,QAAQ;AAE7E,cAAI,eAAe,YAAY,SAAS,IAAI;AAC1C,kBAAM,eAAe;AAAA;AAAA,QAA2B,YAAY,YAAY;AAAA,EAAK,WAAW;AAAA;AAAA;AAAA;AAExF,gBAAI,cAAc;AAChB,mBAAK,IAAI,YAAY;AAAA,gBACnB,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,SAAS;AAAA,cACX,CAAC;AAAA,YACH;AACA,iBAAK,IAAI,YAAY,EAAE,MAAM,iBAAiB,MAAM,YAAY,CAAC;AACjE,iBAAK,IAAI,iBAAiB,QAAQ,WAAW,kDAAU;AAAA,UACzD,OAAO;AACL,gBAAI,cAAc;AAChB,mBAAK,IAAI,YAAY;AAAA,gBACnB,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,SAAS,YAAY;AAAA,cACvB,CAAC;AAAA,YACH;AACA,iBAAK,IAAI,iBAAiB,QAAQ,SAAS,sCAAQ;AAAA,UACrD;AAAA,QACF;AAAA,QACA,SAAS,CAAC,UAAU;AAClB,cAAI,cAAc;AAChB,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,WAAW;AAAA,cACX,SAAS;AAAA;AAAA,EAAiB,MAAM,OAAO;AAAA,YACzC,CAAC;AAAA,UACH;AACA,eAAK,IAAI,iBAAiB,QAAQ,SAAS,MAAM,OAAO;AAAA,QAC1D;AAAA,MACF;AAAA,MACA,EAAE,WAAW,MAAM,WAAW,eAAe,kBAAkB,GAAG;AAAA,IACpE;AAAA,EACF;AAAA;AAAA,EAIA,MAAc,kBAAkB,MAA4F;AAC1H,QAAI;AACF,YAAM,MAAM;AACZ,YAAM,WAAW,KAAK,IAAI,iBAAiB,YAAY,IAAmB,KAAK,CAAC,CAAC;AACjF,YAAM,UAAU,CAAC,EAAE,GAAG,MAAM,WAAW,KAAK,IAAI,EAAE,GAAG,GAAG,QAAQ,EAAE,MAAM,GAAG,EAAE;AAC7E,YAAM,KAAK,IAAI,iBAAiB,YAAY,OAAO,KAAK,OAAO;AAAA,IACjE,SAAS,GAAG;AACV,cAAQ,MAAM,gCAAgC,CAAC;AAAA,IACjD;AAAA,EACF;AAAA,EAEQ,iBAAwB;AAC9B,WAAO,KAAK,IAAI,iBAAiB,YAAY,IAAW,eAAe,CAAC,CAAC;AAAA,EAC3E;AAAA,EAEQ,yBAAyB,WAA2B;AAC1D,UAAM,qBAA6C;AAAA,MACjD,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,SAAS;AAAA,MACT,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AACA,WAAO,mBAAmB,UAAU,YAAY,CAAC,KAAK;AAAA,EACxD;AAAA,EAEQ,uBAAuB,MAAsB;AACnD,UAAM,aAAuC;AAAA,MAC3C,cAAc,CAAC,iCAAiC,mBAAmB,gBAAgB;AAAA,MACnF,cAAc,CAAC,kBAAkB,mBAAmB,eAAe;AAAA,MACnE,UAAU,CAAC,aAAa,gBAAgB,cAAc;AAAA,MACtD,MAAM,CAAC,cAAc,iBAAiB,aAAa;AAAA,MACnD,QAAQ,CAAC,kBAAkB,iBAAiB,cAAc;AAAA,IAC5D;AAEA,eAAW,CAAC,MAAM,QAAQ,KAAK,OAAO,QAAQ,UAAU,GAAG;AACzD,UAAI,SAAS,KAAK,OAAK,EAAE,KAAK,IAAI,CAAC,GAAG;AACpC,eAAO;AAAA,MACT;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEQ,oBAAoB,QAAwB;AAClD,UAAM,MAA8B;AAAA,MAClC,mBAAmB;AAAA,MACnB,mBAAmB;AAAA,IACrB;AACA,WAAO,IAAI,MAAM,KAAK;AAAA,EACxB;AAAA,EAEQ,4BAA4B,UAA2E;AAC7G,UAAM,aAAsF;AAAA,MAC1F,cAAc;AAAA,MACd,cAAc;AAAA,MACd,UAAU;AAAA,MACV,MAAM;AAAA,MACN,QAAQ;AAAA,IACV;AACA,WAAO,WAAW,QAAQ,KAAK;AAAA,EACjC;AAAA,EAEQ,wBAAwB,UAA0B;AACxD,UAAM,aAAqC;AAAA,MACzC,cAAc;AAAA,MACd,cAAc;AAAA,MACd,UAAU;AAAA,MACV,MAAM;AAAA,MACN,QAAQ;AAAA,IACV;AACA,WAAO,WAAW,QAAQ,KAAK;AAAA,EACjC;AACF;;;ACnpBA,IAAAC,WAAwB;AAIxB;AAEA;AAOO,IAAM,iBAAN,MAA+C;AAAA,EAIpD,YAAoB,KAAsB;AAAtB;AAElB,SAAK,WAAW,YAAY,YAAY,IAAI,gBAAgB;AAC5D,SAAK,WAAW,YAAY,YAAY,IAAI,kBAAkB,KAAK,QAAQ;AAAA,EAC7E;AAAA,EAEA,MAAM,OAAO,MAA6B;AAGxC,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,QAAuB,gBAAqB,aAAkB,gBAAoC;AACrH,UAAM,EAAE,SAAS,KAAK,IAAI;AAG1B,UAAM,iBAAiB,CAAC,SAAS,WAAW,SAAS;AAGrD,QAAI,gBAA+B;AACnC,QAAI,CAAC,eAAe,SAAS,OAAO,GAAG;AACrC,YAAM,cAAc,IAAI,OAAO,GAAG,KAAK,SAAS,IAAI,MAAM,KAAK,KAAK,GAAG,IAAI,EAAE;AAC7E,YAAM,cAAuB;AAAA,QAC3B,IAAI,WAAW;AAAA,QACf,MAAM;AAAA,QACN,SAAS;AAAA,QACT,WAAW,KAAK,IAAI;AAAA,MACtB;AACA,sBAAgB,YAAY;AAC5B,YAAM,KAAK,IAAI,eAAe,WAAW,WAAW;AACpD,WAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,YAAY,CAAC;AAAA,IACnE;AAGA,UAAM,oBAAoB,YAAY;AACpC,UAAI,eAAe;AACjB,cAAM,KAAK,IAAI,eAAe,kBAAkB;AAChD,aAAK,IAAI,YAAY,EAAE,MAAM,iBAAiB,WAAW,cAAc,CAAC;AAAA,MAC1E;AAAA,IACF;AAEA,QAAI;AACF,cAAQ,SAAS;AAAA,QAEf,KAAK;AACH,gBAAM,eAAe,UAAU;AAC/B;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe;AAC1B;AAAA,QACF,KAAK;AACH,gBAAM,eAAe,kBAAkB;AACvC;AAAA,QAGF,KAAK;AACH,gBAAM,KAAK,eAAe,wBAAwB,CAAC,CAAC;AACpD;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,gBAAgB,CAAC,CAAC;AAC5C;AAAA,QACF,KAAK;AACH,cAAI,KAAK,CAAC,GAAG;AACX,kBAAM,KAAK,eAAe,qBAAqB,EAAE,UAAU,KAAK,CAAC,EAAE,CAAC;AAAA,UACtE,OAAO;AACL,kBAAM,kBAAkB;AACxB,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,6CAAU,CAAC;AAAA,UAC5D;AACA;AAAA,QACF,KAAK;AACH,cAAI,KAAK,QAAQ;AACf,kBAAM,KAAK,eAAe,uBAAuB,EAAE,OAAO,KAAK,KAAK,GAAG,EAAE,CAAC;AAAA,UAC5E,OAAO;AACL,kBAAM,kBAAkB;AACxB,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,mDAAW,CAAC;AAAA,UAC7D;AACA;AAAA,QACF,KAAK;AACH,cAAI,KAAK,QAAQ;AACf,kBAAM,KAAK,eAAe,uBAAuB,EAAE,SAAS,KAAK,KAAK,GAAG,EAAE,CAAC;AAAA,UAC9E,OAAO;AACL,kBAAM,kBAAkB;AACxB,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,yDAAY,CAAC;AAAA,UAC9D;AACA;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,iBAAiB,CAAC,CAAC;AAC7C;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,oBAAoB,CAAC,CAAC;AAChD;AAAA,QAGF,KAAK;AACH,cAAI,KAAK,QAAQ;AACf,kBAAM,KAAK,eAAe,uBAAuB,EAAE,SAAS,OAAO,KAAK,KAAK,GAAG,CAAC,GAAG,CAAC;AAAA,UACvF,OAAO;AACL,kBAAM,kBAAkB;AACxB,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,gDAAa,CAAC;AAAA,UAC/D;AACA;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,sBAAsB,CAAC,CAAC;AAClD;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,oBAAoB,CAAC,CAAC;AAChD;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,oBAAoB,CAAC,CAAC;AAChD;AAAA,QACF,KAAK;AACH,cAAI,KAAK,CAAC,GAAG;AACX,kBAAM,KAAK,eAAe,wBAAwB,EAAE,QAAQ,KAAK,CAAC,EAAE,CAAC;AAAA,UACvE,OAAO;AACL,kBAAM,kBAAkB;AACxB,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,uCAAS,CAAC;AAAA,UAC3D;AACA;AAAA,QACF,KAAK;AACH,cAAI,KAAK,QAAQ;AACf,kBAAM,KAAK,eAAe,sBAAsB,EAAE,SAAS,KAAK,KAAK,GAAG,EAAE,CAAC;AAAA,UAC7E,OAAO;AACL,kBAAM,kBAAkB;AACxB,iBAAK,IAAI,YAAY,EAAE,MAAM,SAAS,SAAS,6CAAU,CAAC;AAAA,UAC5D;AACA;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,oBAAoB,EAAE,MAAM,KAAK,CAAC,KAAK,OAAU,CAAC;AAC5E;AAAA,QACF,KAAK;AACH,gBAAM,KAAK,eAAe,mBAAmB,EAAE,OAAO,GAAG,CAAC;AAC1D;AAAA,QAGF,KAAK;AACH,eAAK,IAAI,YAAY,EAAE,MAAM,aAAa,CAAC;AAC3C,gBAAM,KAAK,qBAAqB,MAAM,cAAc;AACpD;AAAA,QACF,KAAK;AACH,eAAK,IAAI,YAAY,EAAE,MAAM,aAAa,CAAC;AAC3C,gBAAM,WAAW,KAAK,KAAK,GAAG;AAC9B,cAAI,SAAS,WAAW,OAAO,KAAK,SAAS,SAAS,KAAK,GAAG;AAC5D,kBAAM,YAAY,iBAAiB,QAAQ;AAAA,UAC7C,OAAO;AACL,kBAAM,YAAY,aAAa,KAAK,CAAC,CAAC;AAAA,UACxC;AACA;AAAA,QAEF;AACE,gBAAM,kBAAkB;AACxB,eAAK,IAAI,YAAY;AAAA,YACnB,MAAM;AAAA,YACN,SAAS;AAAA,cACP,IAAI,WAAW;AAAA,cACf,MAAM;AAAA,cACN,SAAS,uCAAc,OAAO;AAAA;AAAA;AAAA,cAC9B,WAAW,KAAK,IAAI;AAAA,YACtB;AAAA,UACF,CAAC;AACD;AAAA,MACJ;AAAA,IACF,SAAS,OAAO;AACd,YAAM,kBAAkB;AACxB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MACpD,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAe,QAAgB,QAA4C;AAjM3F;AAkMI,UAAM,eAAe,KAAK,SAAS,QAAQ,MAAM;AAEjD,QAAI,CAAC,cAAc;AACjB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS,kCAAc,MAAM;AAAA,UAC7B,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF,CAAC;AACD;AAAA,IACF;AAEA,SAAK,IAAI,iBAAiB,WAAW,WAAW,iBAAO,aAAa,KAAK,IAAI,EAAE;AAE/E,QAAI;AACF,YAAM,SAAS,MAAM,KAAK,SAAS,QAAQ;AAAA,QACzC;AAAA,QACA,WAAW;AAAA,QACX,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAe,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAAA,UAC3D,aAAY,KAAO,gBAAO,qBAAd,mBAAgC,SAAS;AAAA,QACvD;AAAA,MACF,CAAC;AAGD,UAAI;AACJ,UAAI,OAAO,SAAS;AAClB,cAAM,OAAO,OAAO;AAGpB,YAAI,OAAO,SAAS,UAAU;AAC5B,oBAAU;AAAA,QACZ,WAAW,6BAAM,SAAS;AAExB,oBAAU,KAAK;AAAA,QACjB,YAAW,6BAAM,YAAW,WAAa,6BAAM,YAAW,QAAW;AAEnE,gBAAM,UAAU,KAAK,YAAY,SAAS,KAAK,aAAa;AAC5D,gBAAM,SAAS,CAAC,KAAK,QAAQ,KAAK,MAAM,EAAE,OAAO,OAAO,EAAE,KAAK,IAAI;AACnE,oBAAU,GAAG,UAAU,WAAM,QAAG,MAAM,aAAa,KAAK,IAAI;AAAA;AAAA;AAAA,EAAiB,UAAU,sBAAO;AAAA;AAAA,QAChG,YAAW,6BAAM,SAAQ,QAAW;AAElC,oBAAU;AAAA;AAAA;AAAA,EAA2B,KAAK,OAAO,sBAAO;AAAA;AAAA,QAC1D,YAAW,6BAAM,UAAS,QAAW;AAEnC,oBAAU;AAAA;AAAA;AAAA,EAA+B,KAAK,QAAQ,sBAAO;AAAA;AAAA,QAC/D,WAAW,6BAAM,MAAM;AAErB,oBAAU;AAAA;AAAA;AACV,qBAAW,iCAAa,KAAK,IAAI;AAAA;AACjC,cAAI,KAAK;AAAW,uBAAW,qBAAW,KAAK,SAAS;AAAA;AACxD,cAAI,KAAK;AAAU,uBAAW,qBAAW,KAAK,QAAQ;AAAA;AACtD,cAAI,KAAK,WAAW;AAClB,kBAAM,eAAe,KAAK,UAAU,KAAK,WAAW,MAAM,CAAC,EAAE,MAAM,GAAG,GAAI;AAC1E,uBAAW;AAAA;AAAA;AAAA,EAAwB,YAAY;AAAA;AAAA,UACjD;AAAA,QACF,OAAO;AAEL,gBAAM,UAAU,KAAK,UAAU,MAAM,MAAM,CAAC;AAC5C,oBAAU,YAAO,aAAa,KAAK,IAAI;AAAA;AAAA;AAAA,EAAqB,QAAQ,MAAM,GAAG,GAAI,CAAC,GAAG,QAAQ,SAAS,MAAO,8BAAe,EAAE;AAAA;AAAA,QAChI;AAAA,MACF,OAAO;AACL,kBAAU,YAAO,aAAa,KAAK,IAAI;AAAA;AAAA,IAAc,YAAO,UAAP,mBAAc,YAAW,0BAAM;AAAA,MACtF;AAEA,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN;AAAA,UACA,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF,CAAC;AAED,WAAK,IAAI;AAAA,QAAiB;AAAA,QAAW,OAAO,UAAU,YAAY;AAAA,QAChE,OAAO,UAAU,iBAAO;AAAA,MAAI;AAAA,IAEhC,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS,oCAAW,iBAAiB,QAAQ,MAAM,UAAU,0BAAM;AAAA,UACnE,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF,CAAC;AACD,WAAK,IAAI,iBAAiB,WAAW,SAAS,0BAAM;AAAA,IACtD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAqB,MAAgB,gBAAoC;AACrF,QAAI,KAAK,CAAC,GAAG;AACX,YAAM,cAAc,KAAK,CAAC,EAAE,YAAY;AAExC,UAAI,gBAAgB,QAAQ;AAC1B,cAAM,eAAe,iBAAiB,KAAK,CAAC,CAAC;AAAA,MAC/C,WAAW,gBAAgB,WAAW;AACpC,cAAM,eAAe,oBAAoB;AAAA,MAC3C,WAAW,CAAC,aAAa,YAAY,SAAS,SAAS,MAAM,SAAS,WAAW,cAAc,EAAE,SAAS,WAAW,GAAG;AACtH,cAAM,SAAgB,gBAAO;AAC7B,YAAI,UAAU,CAAC,OAAO,UAAU,SAAS;AACvC,gBAAM,eAAe,sBAAsB,WAAW;AAAA,QACxD,WAAW,QAAQ;AACjB,gBAAM,eAAe,iBAAiB,QAAW,WAAW;AAAA,QAC9D,OAAO;AACL,cAAI,CAAC,gBAAgB,SAAS,EAAE,SAAS,WAAW,GAAG;AACrD,kBAAM,eAAe,oBAAoB;AAAA,UAC3C,OAAO;AACL,iBAAK,IAAI,YAAY;AAAA,cACnB,MAAM;AAAA,cACN,SAAS;AAAA,gBACP,IAAI,WAAW;AAAA,gBACf,MAAM;AAAA,gBACN,SAAS;AAAA;AAAA;AAAA,gBACT,WAAW,KAAK,IAAI;AAAA,cACtB;AAAA,YACF,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF,OAAO;AACL,cAAM,cAAc,KAAK,KAAK,GAAG;AACjC,cAAM,eAAe,wBAAwB,WAAW;AAAA,MAC1D;AAAA,IACF,OAAO;AACL,YAAM,SAAgB,gBAAO;AAC7B,UAAI,UAAU,CAAC,OAAO,UAAU,SAAS;AACvC,cAAM,eAAe,sBAAsB,WAAW;AAAA,MACxD,WAAW,QAAQ;AACjB,cAAM,eAAe,iBAAiB;AAAA,MACxC,OAAO;AACL,cAAM,eAAe,oBAAoB;AAAA,MAC3C;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAgC;AAC5C,UAAM,WAAW,KAAK,IAAI,eAAe,YAAY;AAErD,QAAI,SAAS,SAAS,GAAG;AACvB,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS;AAAA,UACT,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF,CAAC;AACD;AAAA,IACF;AAGA,UAAM,YAAY,KAAK,IAAI,GAAG,KAAK,MAAM,SAAS,SAAS,CAAC,CAAC;AAC7D,UAAM,eAAe,SAAS,SAAS;AAGvC,UAAM,UAAU,uBAAQ,YAAY;AAEpC,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,SAAS;AAAA,QACP,IAAI,WAAW;AAAA,QACf,MAAM;AAAA,QACN,SAAS;AAAA;AAAA,EAAe,OAAO;AAAA;AAAA,2BAAY,SAAS;AAAA,QACpD,WAAW,KAAK,IAAI;AAAA,MACtB;AAAA,IACF,CAAC;AAAA,EACH;AACF;;;ACtXA,IAAAC,WAAwB;AAQjB,IAAM,gBAAN,MAA8C;AAAA,EACnD,YAAoB,KAAsB;AAAtB;AAAA,EAAuB;AAAA,EAE3C,MAAM,OAAO,MAA6B;AACxC,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,aAAK,WAAW;AAChB,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,YAAY,KAAK,UAAU,KAAK,KAAK;AAChD,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,UAAU,KAAK,UAAU,KAAK,MAAM;AAC/C,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,gBAAgB;AAC3B,eAAO;AAAA,MACT,KAAK;AACH,cAAM,KAAK,YAAY,KAAK,QAAQ;AACpC,eAAO;AAAA,MACT,KAAK;AACH,aAAK,aAAa;AAClB,eAAO;AAAA,MACT,KAAK;AACH,aAAK,mBAAmB,KAAK,SAAS;AACtC,eAAO;AAAA,MACT,KAAK;AACH,aAAK,uBAAuB,KAAK,KAAK;AACtC,eAAO;AAAA,MACT,KAAK;AACH,aAAK,eAAe,KAAK,KAAK;AAC9B,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAmB;AACjB,UAAM,cAAc,KAAK,IAAI,cAAc,eAAe;AAC1D,UAAM,YAAY,KAAK,IAAI,cAAc,aAAa;AACtD,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,MACA;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,UAAkB,OAA8B;AAChE,UAAM,KAAK,IAAI,cAAc,kBAAkB,EAAE,UAA2B,MAAM,CAAC;AAGnF,UAAM,SAAS,MAAM,KAAK,IAAI,cAAc,mBAAmB;AAC/D,QAAI,OAAO,QAAQ;AACjB,YAAM,EAAE,aAAAC,aAAY,IAAI,MAAM;AAC9B,WAAK,IAAI,cAAc,IAAIA,aAAY,MAAM;AAAA,IAC/C;AAEA,SAAK,WAAW;AAChB,IAAO,gBAAO,uBAAuB,yCAAW,KAAK,EAAE;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,UAAkB,QAA+B;AAC/D,UAAM,KAAK,IAAI,cAAc,UAAU,UAAiB,MAAM;AAG9D,UAAM,SAAS,MAAM,KAAK,IAAI,cAAc,mBAAmB;AAC/D,QAAI,OAAO,QAAQ;AACjB,YAAM,EAAE,aAAAA,aAAY,IAAI,MAAM;AAC9B,WAAK,IAAI,cAAc,IAAIA,aAAY,MAAM;AAAA,IAC/C;AAEA,UAAM,KAAK,gBAAgB;AAC3B,IAAO,gBAAO,uBAAuB,GAAG,QAAQ,6BAAc;AAAA,EAChE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAiC;AACrC,UAAM,YAAY,CAAC,YAAY,UAAU,aAAa,QAAQ,YAAY;AAC1E,UAAM,SAAkC,CAAC;AAEzC,eAAW,YAAY,WAAW;AAChC,YAAM,MAAM,MAAM,KAAK,IAAI,cAAc,UAAU,QAAe;AAClE,aAAO,QAAQ,IAAI,CAAC,CAAC,OAAO,IAAI,SAAS;AAAA,IAC3C;AAEA,SAAK,IAAI,YAAY,EAAE,MAAM,gBAAgB,OAAO,CAAC;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,UAAiC;AAEjD,UAAM,WAAW,aAAa,OAAO,UAAU;AAC/C,SAAK,YAAY,QAA6B;AAC9C,UAAM,KAAK,IAAI,iBAAiB,YAAY,OAAO,wBAAwB,QAAQ;AACnF,SAAK,IAAI,YAAY,EAAE,MAAM,mBAAmB,UAAU,SAAS,CAAC;AACpE,IAAO,gBAAO;AAAA,MACZ,aAAa,UAAU,qDAAa;AAAA,IACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,eAAqB;AACnB,UAAM,WAAW,KAAK,mBAAmB;AACzC,SAAK,IAAI,YAAY,EAAE,MAAM,YAAY,SAAS,CAAC;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,WAAgC;AACjD,UAAM,UAAU,KAAK,IAAI;AAEzB,QAAI,QAAQ,WAAW,GAAG;AACxB,WAAK,IAAI,YAAY,EAAE,MAAM,eAAe,SAAS,GAAG,CAAC;AACzD;AAAA,IACF;AAEA,QAAI,cAAc,MAAM;AACtB,UAAI,KAAK,IAAI,eAAe,QAAQ,SAAS,GAAG;AAC9C,aAAK,IAAI;AAAA,MACX;AAAA,IACF,OAAO;AACL,UAAI,KAAK,IAAI,eAAe,IAAI;AAC9B,aAAK,IAAI;AAAA,MACX;AAAA,IACF;AAEA,UAAM,UAAU,KAAK,IAAI,gBAAgB,IACrC,QAAQ,QAAQ,SAAS,IAAI,KAAK,IAAI,YAAY,IAClD;AAEJ,SAAK,IAAI,YAAY,EAAE,MAAM,eAAe,QAAQ,CAAC;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAuB,OAAqB;AAC1C,QAAI,CAAC,MAAM,WAAW,GAAG,GAAG;AAC1B,WAAK,IAAI,YAAY,EAAE,MAAM,eAAe,aAAa,CAAC,EAAE,CAAC;AAC7D;AAAA,IACF;AAEA,UAAM,QAAQ,MAAM,MAAM,CAAC,EAAE,YAAY;AACzC,UAAMC,YAAW;AAAA,MACf,EAAE,SAAS,UAAU,aAAa,uCAAS;AAAA,MAC3C,EAAE,SAAS,SAAS,aAAa,uCAAS;AAAA,MAC1C,EAAE,SAAS,YAAY,aAAa,2BAAO;AAAA,MAC3C,EAAE,SAAS,YAAY,aAAa,2BAAO;AAAA,MAC3C,EAAE,SAAS,QAAQ,aAAa,2BAAO;AAAA,MACvC,EAAE,SAAS,WAAW,aAAa,2BAAO;AAAA,MAC1C,EAAE,SAAS,SAAS,aAAa,2BAAO;AAAA,MACxC,EAAE,SAAS,SAAS,aAAa,2BAAO;AAAA,MACxC,EAAE,SAAS,QAAQ,aAAa,aAAa;AAAA,MAC7C,EAAE,SAAS,QAAQ,aAAa,WAAW;AAAA,MAC3C,EAAE,SAAS,QAAQ,aAAa,WAAW;AAAA,MAC3C,EAAE,SAAS,QAAQ,aAAa,gBAAgB;AAAA,IAClD;AAEA,UAAM,cAAcA,UACjB,OAAO,OAAK,EAAE,QAAQ,YAAY,EAAE,SAAS,KAAK,CAAC,EACnD,MAAM,GAAG,CAAC;AAEb,SAAK,IAAI,YAAY,EAAE,MAAM,eAAe,YAAY,CAAC;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,OAAqB;AAClC,QAAI,CAAC,SAAS,MAAM,KAAK,EAAE,WAAW,GAAG;AACvC,WAAK,IAAI,YAAY,EAAE,MAAM,iBAAiB,SAAS,CAAC,GAAG,OAAO,GAAG,CAAC;AACtE;AAAA,IACF;AAEA,UAAM,kBAAkB,MAAM,KAAK,EAAE,YAAY;AACjD,UAAM,aAAa,gBAAgB,MAAM,KAAK,EAAE,OAAO,OAAK,EAAE,SAAS,CAAC;AAExE,UAAM,UAAU,KAAK,IAAI,eAAe;AACxC,QAAI,UAQC,CAAC;AAEN,QAAI,SAAS;AACX,YAAM,iBAAiB,KAAK,gBAAgB,SAAS,YAAY,eAAe;AAChF,cAAQ,KAAK,GAAG,cAAc;AAAA,IAChC;AAGA,UAAM,cAAc,KAAK,IAAI,eAAe,eAAe;AAC3D,eAAW,eAAe,aAAa;AACrC,UAAI,YAAY,QAAO,mCAAS;AAAI;AAEpC,YAAM,oBAAoB,KAAK,IAAI,eAAe,eAAe,YAAY,EAAE;AAC/E,UAAI,mBAAmB;AACrB,cAAM,iBAAiB,KAAK;AAAA,UAC1B;AAAA,UACA;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ,YAAY;AAAA,QACd;AACA,gBAAQ,KAAK,GAAG,cAAc;AAAA,MAChC;AAAA,IACF;AAGA,YAAQ,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AACxC,cAAU,QAAQ,MAAM,GAAG,EAAE;AAE7B,UAAM,eAAe,QAAQ,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,MAAM,IAAI;AAC7D,SAAK,IAAI,YAAY,EAAE,MAAM,iBAAiB,SAAS,cAAc,MAAM,CAAC;AAAA,EAC9E;AAAA;AAAA;AAAA;AAAA,EAKQ,gBACN,SACA,YACA,iBACA,WACA,cASC;AACD,UAAM,UAQD,CAAC;AAEN,eAAW,KAAK,QAAQ,UAAU;AAChC,YAAM,eAAe,EAAE,QAAQ,YAAY;AAE3C,UAAI,QAAQ;AACZ,UAAI,aAAa;AAEjB,YAAM,kBAAkB,aAAa,QAAQ,eAAe;AAC5D,UAAI,oBAAoB,IAAI;AAC1B,iBAAS;AACT,qBAAa;AAAA,MACf;AAEA,UAAI,cAAc;AAClB,iBAAW,QAAQ,YAAY;AAC7B,YAAI,aAAa,SAAS,IAAI,GAAG;AAC/B;AACA,cAAI,eAAe,IAAI;AACrB,yBAAa,aAAa,QAAQ,IAAI;AAAA,UACxC;AAAA,QACF;AAAA,MACF;AAEA,UAAI,cAAc,GAAG;AACnB,iBAAS,cAAc;AACvB,YAAI,gBAAgB,WAAW,QAAQ;AACrC,mBAAS;AAAA,QACX;AAAA,MACF;AAEA,UAAI,QAAQ,GAAG;AACb,gBAAQ,KAAK;AAAA,UACX,IAAI,EAAE;AAAA,UACN,MAAM,EAAE;AAAA,UACR,SAAS,KAAK,iBAAiB,EAAE,SAAS,iBAAiB,UAAU;AAAA,UACrE,WAAW,EAAE;AAAA,UACb;AAAA,UACA;AAAA,UACA;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,SAAiB,OAAe,YAA4B;AACnF,UAAM,YAAY;AAElB,QAAI,cAAc,GAAG;AACnB,YAAM,QAAQ,KAAK,IAAI,GAAG,aAAa,EAAE;AACzC,YAAM,MAAM,KAAK,IAAI,QAAQ,QAAQ,QAAQ,SAAS;AACtD,UAAI,UAAU,QAAQ,MAAM,OAAO,GAAG;AACtC,UAAI,QAAQ;AAAG,kBAAU,QAAQ;AACjC,UAAI,MAAM,QAAQ;AAAQ,mBAAW;AACrC,aAAO;AAAA,IACT;AAEA,WAAO,QAAQ,MAAM,GAAG,SAAS,KAAK,QAAQ,SAAS,YAAY,QAAQ;AAAA,EAC7E;AACF;;;ACpUA,IAAAC,WAAwB;AAExB;AACA;AAoDO,IAAM,aAAN,MAA2C;AAAA,EAMhD,YAAoB,KAAsB;AAAtB;AAElB,SAAK,WAAW,YAAY,YAAY,IAAI,gBAAgB;AAC5D,SAAK,WAAW,YAAY,YAAY,IAAI,kBAAkB,KAAK,QAAQ;AAC3E,SAAK,QAAQ,SAAS;AAAA,MACpB,IAAI;AAAA,MACJ,KAAK;AAAA,MACL,KAAK;AAAA,MACL,IAAI;AAAA,IACN;AAGA,SAAK,kBAAkB,gBAAgB;AAAA,MACrC,IAAI;AAAA,MACJ,KAAK;AAAA,MACL,KAAK;AAAA,MACL,IAAI;AAAA,IACN;AAGA,SAAK,SAAS,oBAAoB,CAAC,YAA8B;AAC/D,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAGD,SAAK,MAAM,eAAe,CAAC,WAAwB;AACjD,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,SAAK,MAAM,aAAa,CAAC,SAAoB;AAC3C,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,SAAK,MAAM,WAAW,CAAC,aAAqD;AAC1E,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,GAAG;AAAA,MACL,CAAC;AAAA,IACH,CAAC;AAGD,SAAK,gBAAgB,eAAe,CAAC,WAAW;AAC9C,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,SAAK,gBAAgB,YAAY,CAAC,cAA+B;AAC/D,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,SAAK,gBAAgB,UAAU,CAAC,YAAY;AAC1C,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,SAAK,gBAAgB,gBAAgB,CAAC,EAAE,MAAM,OAAO,MAAM;AACzD,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,QACA;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,SAAK,gBAAgB,WAAW,CAAC,aAAa;AAC5C,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,GAAG;AAAA,MACL,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,OAAO,MAA6B;AA7J5C;AA+JI,QAAI,GAAC,UAAK,SAAL,mBAAW,WAAW,UAAS;AAClC,aAAO;AAAA,IACT;AAEA,YAAQ,KAAK,MAAM;AAAA,MAEjB,KAAK;AACH,cAAM,KAAK,eAAe;AAC1B,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,cAAc,KAAK,MAAM;AACpC,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,mBAAmB,KAAK,IAAI;AACvC,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,iBAAiB,KAAK,IAAI;AACrC,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,iBAAiB,KAAK,MAAM;AACvC,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,iBAAiB,KAAK,QAAQ,KAAK,OAAO;AACrD,eAAO;AAAA,MAGT,KAAK;AACH,cAAM,KAAK,eAAe,KAAK,QAAQ,KAAK,UAAU;AACtD,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,kBAAkB,KAAK,MAAM;AACxC,eAAO;AAAA,MAGT,KAAK;AACH,cAAM,KAAK,mBAAmB,KAAK,OAAO;AAC1C,eAAO;AAAA,MAET,KAAK;AACH,aAAK,MAAM,WAAW;AACtB,eAAO;AAAA,MAGT,KAAK;AACH,cAAM,KAAK,6BAA6B,KAAK,OAAO;AACpD,eAAO;AAAA,MAET,KAAK;AACH,aAAK,gBAAgB,OAAO;AAC5B,eAAO;AAAA,MAET,KAAK;AACH,aAAK,IAAI,YAAY;AAAA,UACnB,MAAM;AAAA,UACN,QAAQ,KAAK,gBAAgB,UAAU;AAAA,UACvC,YAAY,KAAK,gBAAgB,cAAc;AAAA,QACjD,CAAC;AACD,eAAO;AAAA,MAGT,KAAK;AACH,aAAK,gBAAgB;AACrB,eAAO;AAAA,MAET,KAAK;AACH,cAAM,KAAK,mBAAmB,KAAK,MAAM;AACzC,eAAO;AAAA,MAGT,KAAK;AACH,cAAM,KAAK,kBAAkB,KAAK,IAAI;AACtC,eAAO;AAAA,MAET,KAAK;AACH,aAAK,kBAAkB,KAAK,OAAO;AACnC,eAAO;AAAA,MAGT,KAAK;AACH,aAAK,0BAA0B,KAAK,KAAK;AACzC,eAAO;AAAA,MAET;AACE,eAAO;AAAA,IACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,iBAAiB,OAAiC;AACtD,UAAM,cAAc,UAAU,MAAM,KAAK;AAEzC,QAAI,YAAY,SAAS,QAAQ;AAC/B,aAAO;AAAA,IACT;AAGA,UAAM,cAAuB;AAAA,MAC3B,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,KAAK,IAAI;AAAA,IACtB;AACA,UAAM,KAAK,IAAI,eAAe,WAAW,WAAW;AACpD,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,YAAY,CAAC;AAGjE,YAAQ,YAAY,MAAM;AAAA,MACxB,KAAK;AACH,cAAM,KAAK,qBAAqB,UAAU,YAAY,CAAC;AACvD;AAAA,MAEF,KAAK;AACH,cAAM,KAAK,aAAa;AACxB;AAAA,MAEF,KAAK;AACH,cAAM,KAAK,kBAAkB,YAAY,eAAe,EAAE;AAC1D;AAAA,MAEF,KAAK;AACH,aAAK,IAAI,YAAY,EAAE,MAAM,sBAAsB,CAAC;AACpD,cAAM,KAAK,qBAAqB,iEAAe;AAC/C;AAAA,MAEF,KAAK;AACH,cAAM,KAAK,qBAAqB;AAChC;AAAA,MAEF,KAAK;AAEH,aAAK,IAAI,iBAAiB,OAAO,WAAW,6BAAS,YAAY,MAAM,EAAE;AACzE,cAAM,KAAK,oBAAoB,WAAW;AAC1C;AAAA,MAEF,KAAK;AAEH,cAAM,KAAK,qBAAqB,WAAW;AAC3C;AAAA,IACJ;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,iBAAgC;AAC5C,UAAM,QAAQ,KAAK,SAAS,YAAY;AACxC,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,cAAc,QAA+B;AACzD,UAAM,OAAO,KAAK,SAAS,QAAQ,MAAM;AACzC,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,MAAM,QAAQ;AAAA,IAChB,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,mBAAmB,MAAwC;AACvE,QAAI;AACF,YAAM,KAAK,SAAS,aAAa,IAAI;AACrC,WAAK,IAAI,YAAY,EAAE,MAAM,sBAAsB,QAAQ,KAAK,GAAG,CAAC;AAAA,IACtE,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAc,iBAAiB,MAAwC;AACrE,QAAI;AACF,YAAM,KAAK,SAAS,WAAW,IAAI;AACnC,WAAK,IAAI,YAAY,EAAE,MAAM,mBAAmB,QAAQ,KAAK,GAAG,CAAC;AAAA,IACnE,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAc,iBAAiB,QAA+B;AAC5D,QAAI;AACF,YAAM,KAAK,SAAS,WAAW,MAAM;AACrC,WAAK,IAAI,YAAY,EAAE,MAAM,mBAAmB,OAAO,CAAC;AAAA,IAC1D,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAc,iBAAiB,QAAgB,SAAiC;AAC9E,QAAI;AACF,YAAM,KAAK,SAAS,WAAW,QAAQ,OAAO;AAC9C,WAAK,IAAI,YAAY,EAAE,MAAM,mBAAmB,QAAQ,QAAQ,CAAC;AAAA,IACnE,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAc,eAAe,QAAgB,YAAgD;AA3X/F;AA4XI,UAAM,SAAS,MAAM,KAAK,SAAS,QAAQ;AAAA,MACzC;AAAA,MACA,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAe,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAAA,MAC7D;AAAA,IACF,CAAC;AAED,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,MACA;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,kBAAkB,QAA0C;AACxE,UAAM,SAAS,MAAM,KAAK,SAAS,QAAQ,MAAM;AAGjD,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,mBAAmB,SAAyC;AACxE,QAAI;AACF,YAAM,SAAS,MAAM,KAAK,MAAM,QAAQ,OAAO;AAC/C,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEQ,kBAAwB;AAE9B,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,QAAQ,CAAC;AAAA,IACX,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,mBAAmB,QAA2C;AAE1E,SAAK,IAAI,YAAY,EAAE,MAAM,oBAAoB,CAAC;AAAA,EACpD;AAAA,EAEA,MAAc,kBAAkB,MAA0B;AAExD,SAAK,IAAI,YAAY,EAAE,MAAM,qBAAqB,CAAC;AAAA,EACrD;AAAA,EAEQ,kBAAkB,SAAyB;AAEjD,UAAM,QAAQ,QAAQ,IAAI,QAAM,KAAK,SAAS,QAAQ,EAAE,CAAC,EAAE,OAAO,OAAO;AACzE,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,MAAM;AAAA,IACR,CAAC;AAAA,EACH;AAAA,EAEQ,0BAA0B,OAAsB;AACtD,UAAM,UAAU,KAAK,SAAS,WAAW,KAAK;AAC9C,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAqB,SAAgC;AACjE,UAAM,UAAmB;AAAA,MACvB,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN;AAAA,MACA,WAAW,KAAK,IAAI;AAAA,IACtB;AACA,UAAM,KAAK,IAAI,eAAe,WAAW,OAAO;AAChD,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,QAAQ,CAAC;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAA8B;AAC1C,UAAM,WAAW,KAAK,SAAS,YAAY;AAE3C,QAAI,SAAS,WAAW,GAAG;AACzB,YAAM,KAAK,qBAAqB,8JAA2C;AAC3E;AAAA,IACF;AAGA,UAAM,aAAa,oBAAI,IAA6B;AACpD,aAAS,QAAQ,SAAO;AACtB,YAAM,MAAM,IAAI,KAAK,YAAY;AACjC,UAAI,CAAC,WAAW,IAAI,GAAG,GAAG;AACxB,mBAAW,IAAI,KAAK,CAAC,CAAC;AAAA,MACxB;AACA,iBAAW,IAAI,GAAG,EAAG,KAAK,GAAG;AAAA,IAC/B,CAAC;AAED,QAAI,UAAU;AAEd,eAAW,QAAQ,CAAC,OAAO,aAAa;AACtC,iBAAW,MAAM,KAAK,gBAAgB,QAAQ,CAAC;AAAA;AAAA;AAC/C,YAAM,QAAQ,SAAO;AACnB,cAAM,SAAS,IAAI,UAAU,WAAM;AACnC,mBAAW,GAAG,MAAM,MAAM,IAAI,KAAK,IAAI,cAAc,IAAI,KAAK,EAAE;AAAA;AAChE,mBAAW,MAAM,IAAI,KAAK,WAAW;AAAA;AAAA;AAAA,MACvC,CAAC;AAAA,IACH,CAAC;AAED,eAAW;AAEX,UAAM,KAAK,qBAAqB,OAAO;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAkB,OAA8B;AAC5D,UAAM,UAAU,KAAK,SAAS,YAAY,KAAK;AAE/C,QAAI,QAAQ,WAAW,GAAG;AACxB,YAAM,KAAK,qBAAqB,yCAAW,KAAK,4BAAQ;AACxD;AAAA,IACF;AAEA,QAAI,UAAU,0CAAe,KAAK;AAAA;AAAA;AAClC,YAAQ,QAAQ,SAAO;AACrB,YAAM,SAAS,IAAI,UAAU,WAAM;AACnC,iBAAW,GAAG,MAAM,MAAM,IAAI,KAAK,IAAI,cAAc,IAAI,KAAK,EAAE;AAAA;AAChE,iBAAW,MAAM,IAAI,KAAK,WAAW;AAAA;AAAA;AAAA,IACvC,CAAC;AAED,UAAM,KAAK,qBAAqB,OAAO;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,uBAAsC;AAClD,UAAM,UAAU,KAAK,SAAS,WAAW,EAAE;AAE3C,QAAI,QAAQ,WAAW,GAAG;AACxB,YAAM,KAAK,qBAAqB,4CAAS;AACzC;AAAA,IACF;AAEA,QAAI,UAAU;AAEd,eAAW,KAAK,SAAS;AACvB,YAAM,SAAS,EAAE,UAAU,WAAM;AACjC,YAAM,OAAO,IAAI,KAAK,EAAE,SAAS,EAAE,eAAe;AAClD,YAAM,WAAW,EAAE;AAEnB,iBAAW,GAAG,MAAM,MAAM,EAAE,QAAQ,QAAQ,IAAI,KAAK,QAAQ;AAAA;AAC7D,iBAAW,UAAU,EAAE,MAAM;AAAA;AAAA;AAAA,IAC/B;AAEA,UAAM,KAAK,qBAAqB,OAAO;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoB,aAAiC;AA5iBrE;AA6iBI,UAAM,EAAE,QAAQ,OAAO,IAAI;AAG3B,UAAM,eAAe,KAAK,SAAS,QAAQ,MAAM;AACjD,QAAI,CAAC,cAAc;AACjB,YAAM,KAAK,qBAAqB,kBAAQ,MAAM,kGAAiC;AAC/E;AAAA,IACF;AAEA,QAAI,CAAC,aAAa,SAAS;AACzB,YAAM,KAAK,qBAAqB,kBAAQ,MAAM,6BAAS;AACvD;AAAA,IACF;AAGA,SAAK,IAAI,iBAAiB,QAAQ,WAAW,4BAAQ,aAAa,KAAK,IAAI,KAAK;AAChF,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN;AAAA,MACA,UAAU,aAAa,KAAK;AAAA,MAC5B;AAAA,IACF,CAAC;AAGD,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,SAAS,MAAM,KAAK,SAAS,QAAQ;AAAA,MACzC;AAAA,MACA,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAe,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAAA,QAC3D,aAAY,KAAO,gBAAO,qBAAd,mBAAgC,SAAS;AAAA,MACvD;AAAA,IACF,CAAC;AAED,UAAM,WAAW,KAAK,IAAI,IAAI;AAG9B,UAAM,kBAA0C;AAAA,MAC9C,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN;AAAA,MACA,SAAS,OAAO;AAAA,MAChB,MAAM,OAAO;AAAA,MACb,QAAO,YAAO,UAAP,mBAAc;AAAA,MACrB;AAAA,MACA,WAAW,KAAK,IAAI;AAAA,IACtB;AAEA,SAAK,IAAI,YAAY;AAAA,MACnB,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,UAAU,aAAa,KAAK;AAAA,IAC9B,CAAC;AAGD,QAAI;AACJ,QAAI,OAAO,SAAS;AAClB,YAAM,UAAU,OAAO,QAAQ,OAC1B,OAAO,OAAO,SAAS,WAAW,OAAO,OAAO,KAAK,UAAU,OAAO,MAAM,MAAM,CAAC,IACpF;AACJ,YAAM,YAAY,QAAQ,SAAS,MAAO,QAAQ,MAAM,GAAG,GAAI,IAAI,0CAAiB;AAEpF,oBAAc,YAAO,aAAa,KAAK,IAAI,gCAAY,QAAQ;AAAA;AAAA;AAC/D,qBAAe;AAAA,EAAe,SAAS;AAAA;AAAA,IACzC,OAAO;AACL,oBAAc,YAAO,aAAa,KAAK,IAAI,gCAAY,QAAQ;AAAA;AAAA;AAC/D,qBAAe,uBAAW,YAAO,UAAP,mBAAc,YAAW,0BAAM;AAAA,IAC3D;AAEA,UAAM,KAAK,qBAAqB,WAAW;AAC3C,SAAK,IAAI;AAAA,MAAiB;AAAA,MAAQ,OAAO,UAAU,YAAY;AAAA,MAC7D,OAAO,UAAU,GAAG,aAAa,KAAK,IAAI,8BAAU,GAAG,aAAa,KAAK,IAAI;AAAA,IAAO;AAAA,EACxF;AAAA;AAAA;AAAA;AAAA,EAIA,MAAc,qBAAqB,aAAiC;AAClE,UAAM,OAAO,YAAY;AAGzB,UAAM,KAAK,wCAAwC,IAAI;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,UAA0B;AAChD,UAAM,QAAgC;AAAA,MACpC,MAAM;AAAA,MACN,MAAM;AAAA,MACN,KAAK;AAAA,MACL,UAAU;AAAA,MACV,OAAO;AAAA,MACP,KAAK;AAAA,MACL,IAAI;AAAA,MACJ,SAAS;AAAA,MACT,QAAQ;AAAA,IACV;AACA,WAAO,MAAM,QAAQ,KAAK;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,cAA2B;AACzB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,cAA2B;AACzB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,WAAqB;AACnB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAsC;AACpC,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAc,6BAA6B,SAAgD;AACzF,QAAI;AACF,YAAM,SAAS,MAAM,KAAK,gBAAgB,QAAQ,OAAO;AAEzD,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,MACF,CAAC;AAAA,IACH,SAAS,OAAO;AACd,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,wCAAwC,MAA6B;AA1sBrF;AA2sBI,QAAI,CAAC,MAAM;AACT,YAAM,KAAK,qBAAqB,iIAAuC;AACvE;AAAA,IACF;AAGA,SAAK,IAAI,iBAAiB,OAAO,WAAW,4BAAa,KAAK,MAAM,GAAG,EAAE,CAAC,KAAK;AAG/E,UAAM,YAAY,WAAW;AAC7B,UAAM,iBAA0B;AAAA,MAC9B,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,KAAK,IAAI;AAAA,MACpB,aAAa;AAAA,MACb,UAAU;AAAA,QACR,MAAM;AAAA,QACN;AAAA,MACF;AAAA,IACF;AAEA,UAAM,KAAK,IAAI,eAAe,WAAW,cAAc;AACvD,SAAK,IAAI,YAAY,EAAE,MAAM,cAAc,SAAS,gBAAgB,WAAW,KAAK,CAAC;AAGrF,QAAI,qBAAqB;AACzB,QAAI,aAAa;AAGjB,UAAM,mBAAmB,CAAC,OAAe,WAAoB,SAAS;AACpE,UAAI,UAAU;AACZ,8BAAsB;AAAA,MACxB;AACA,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,QACA,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAGA,qBAAiB,qCAAoB,IAAI;AAAA;AAAA,CAAM;AAC/C,qBAAiB;AAAA;AAAA,CAAS;AAG1B,UAAM,kBAAkB,KAAK,gBAAgB,WAAW,CAAC,aAAa;AACpE,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,QACA,OAAO;AAAA,QACP,UAAU,SAAS;AAAA,QACnB,SAAS,SAAS;AAAA,MACpB,CAAC;AAAA,IACH,CAAC;AAGD,UAAM,iBAAiB,KAAK,gBAAgB,UAAU,CAAC,YAAY;AACjE;AACA,uBAAiB,kBAAQ,UAAU,YAAO;AAE1C,UAAI,QAAQ,aAAa,YAAY;AACnC,yBAAiB;AAAA;AAAA,CAAY;AAAA,MAC/B,WAAW,QAAQ,aAAa,WAAW;AACzC,yBAAiB;AAAA;AAAA,CAAY;AAAA,MAC/B,OAAO;AACL,yBAAiB;AAAA;AAAA,CAAS;AAAA,MAC5B;AAGA,uBAAiB;AAAA;AAAA;AAAA,CAA2C;AAC5D,uBAAiB,GAAG,QAAQ,QAAQ;AAAA;AAAA,CAAM;AAC1C,UAAI,QAAQ,UAAU,SAAS,GAAG;AAChC,yBAAiB;AAAA,CAAW;AAC5B,mBAAW,QAAQ,QAAQ,WAAW;AACpC,2BAAiB,eAAQ,KAAK,QAAQ,WAAM,KAAK,MAAM;AAAA,CAAI;AAAA,QAC7D;AAAA,MACF;AACA,uBAAiB;AAAA;AAAA;AAAA,CAAkB;AAAA,IACrC,CAAC;AAGD,UAAM,uBAAuB,KAAK,gBAAgB,gBAAgB,CAAC,EAAE,MAAM,OAAO,MAAM;AACtF,UAAI,CAAC,QAAQ;AAEX,yBAAiB,cAAS,KAAK,QAAQ,aAAQ,KAAK,MAAM;AAAA,CAAI;AAAA,MAChE,OAAO;AAEL,cAAM,SAAS,OAAO,UAAU,WAAM;AACtC,cAAM,WAAW,OAAO,WAAW,KAAK,OAAO,QAAQ,QAAQ;AAE/D,YAAI,OAAO,WAAW,OAAO,MAAM;AACjC,gBAAM,UAAU,OAAO,OAAO,SAAS,WACnC,OAAO,OACP,KAAK,UAAU,OAAO,MAAM,MAAM,CAAC;AACvC,gBAAM,YAAY,QAAQ,SAAS,MAC/B,QAAQ,MAAM,GAAG,GAAG,IAAI,UACxB;AACJ,2BAAiB,KAAK,MAAM,gBAAM,QAAQ;AAAA;AAAA;AAAA,IAAoB,UAAU,MAAM,IAAI,EAAE,KAAK,MAAM,CAAC;AAAA;AAAA;AAAA,CAAgB;AAAA,QAClH,WAAW,CAAC,OAAO,SAAS;AAC1B,2BAAiB,KAAK,MAAM,gBAAM,QAAQ,KAAK,OAAO,KAAK;AAAA;AAAA,CAAM;AAAA,QACnE,OAAO;AACL,2BAAiB,KAAK,MAAM,gBAAM,QAAQ;AAAA;AAAA,CAAM;AAAA,QAClD;AAAA,MACF;AAAA,IACF,CAAC;AAGD,UAAM,mBAAmB,KAAK,gBAAgB,YAAY,CAAC,cAAc;AAEvE,uBAAiB;AAAA,2BAA2B,UAAU,SAAS;AAAA;AAAA,CAAmB;AAClF,uBAAiB,GAAG,UAAU,WAAW;AAAA;AAAA,CAAM;AAC/C,uBAAiB;AAAA;AAAA,CAAgB;AAAA,IACnC,CAAC;AAED,QAAI;AAEF,YAAM,SAAS,MAAM,KAAK,gBAAgB,QAAQ;AAAA,QAChD;AAAA,QACA,SAAS;AAAA,UACP,gBAAe,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAAA,UAC3D,aAAY,KAAO,gBAAO,qBAAd,mBAAgC,SAAS;AAAA,UACrD,eAAc,KAAO,gBAAO,qBAAd,mBAAgC,SAAS;AAAA,YAC9C,gBAAO,iBAAiB;AAAA;AAAA,QAEnC;AAAA,QACA,QAAQ;AAAA,UACN,eAAe;AAAA,UACf,kBAAkB;AAAA,UAClB,SAAS;AAAA,QACX;AAAA,MACF,CAAC;AAGD,uBAAiB;AAAA;AAAA,CAAS;AAC1B,uBAAiB;AAAA;AAAA,CAAa;AAC9B,uBAAiB,GAAG,OAAO,WAAW;AAAA;AAAA,CAAM;AAG5C,uBAAiB;AAAA;AAAA;AAAA,CAA2C;AAC5D,uBAAiB,mBAAS,OAAO,MAAM,eAAe;AAAA,CAAM;AAC5D,uBAAiB,+BAAW,OAAO,MAAM,cAAc,yBAAU,OAAO,MAAM,eAAe,mBAAS,OAAO,MAAM,WAAW;AAAA,CAAK;AACnI,uBAAiB,oBAAU,OAAO,gBAAgB,KAAM,QAAQ,CAAC,CAAC;AAAA,CAAK;AACvE,UAAI,OAAO,UAAU,SAAS,GAAG;AAC/B,yBAAiB,+BAAW,OAAO,UAAU,KAAK,IAAI,CAAC;AAAA,CAAI;AAAA,MAC7D;AACA,uBAAiB;AAAA;AAAA,CAAgB;AAGjC,qBAAe,UAAU;AACzB,qBAAe,cAAc;AAC7B,YAAM,KAAK,IAAI,eAAe,kBAAkB,oBAAoB,IAAI;AACxE,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,QACA,SAAS;AAAA,MACX,CAAC;AAED,WAAK,IAAI,iBAAiB,OAAO,WAAW,+BAAW;AAAA,IAEzD,SAAS,OAAO;AACd,uBAAiB;AAAA;AAAA;AAAA,CAAW;AAC5B,uBAAiB;AAAA;AAAA,CAAe;AAChC,uBAAiB,GAAG,iBAAiB,QAAQ,MAAM,UAAU,0BAAM;AAAA,CAAI;AAEvE,qBAAe,UAAU;AACzB,qBAAe,cAAc;AAC7B,YAAM,KAAK,IAAI,eAAe,kBAAkB,oBAAoB,IAAI;AACxE,WAAK,IAAI,YAAY;AAAA,QACnB,MAAM;AAAA,QACN;AAAA,QACA,SAAS;AAAA,QACT,OAAO;AAAA,MACT,CAAC;AAED,WAAK,IAAI,iBAAiB,OAAO,SAAS,iBAAiB,QAAQ,MAAM,UAAU,0BAAM;AAAA,IAC3F,UAAE;AAEA,sBAAgB,QAAQ;AACxB,qBAAe,QAAQ;AACvB,2BAAqB,QAAQ;AAC7B,uBAAiB,QAAQ;AAAA,IAC3B;AAAA,EACF;AACF;;;AlBv2BA;;;AmBlBA,IAAAC,WAAwB;AACxB,IAAAC,SAAsB;AACtB,IAAAC,MAAoB;;;ACLpB,IAAAC,QAAsB;AACtB,IAAAC,MAAoB;AAGb,IAAM,eAAN,MAAM,aAAY;AAAA,EAGvB,OAAO,cAA2B;AAChC,QAAI,CAAC,aAAY,UAAU;AACzB,mBAAY,WAAW,IAAI,aAAY;AAAA,IACzC;AACA,WAAO,aAAY;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAkB,SAKrB;AACD,QAAI;AACF,UAAI,CAAI,eAAW,OAAO,GAAG;AAC3B,eAAO,EAAE,SAAS,OAAO,OAAO,mCAAU,OAAO,GAAG;AAAA,MACtD;AAGA,YAAM,eAAoB,WAAK,SAAS,eAAe;AACvD,UAAI,CAAI,eAAW,YAAY,GAAG;AAChC,eAAO,EAAE,SAAS,OAAO,OAAO,+CAAsB;AAAA,MACxD;AAEA,YAAM,kBAAqB,iBAAa,cAAc,OAAO;AAC7D,YAAM,WAAW,KAAK,MAAM,eAAe;AAG3C,YAAM,aAAa,KAAK,iBAAiB,QAAQ;AACjD,UAAI,CAAC,WAAW,OAAO;AACrB,eAAO,EAAE,SAAS,OAAO,OAAO,WAAW,MAAM;AAAA,MACnD;AAGA,YAAM,gBAAqB,WAAK,SAAS,SAAS,aAAa,UAAU;AACzE,UAAI;AAEJ,UAAO,eAAW,aAAa,GAAG;AAChC,cAAM,aAAgB,iBAAa,eAAe,OAAO;AACzD,mBAAW,KAAK,mBAAmB,UAAU;AAAA,MAC/C;AAEA,aAAO,EAAE,SAAS,MAAM,UAAU,SAAS;AAAA,IAC7C,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YACJ,SACA,WACA,QAMC;AACD,QAAI;AAEF,UAAI,CAAI,eAAW,SAAS,GAAG;AAC7B,QAAG,cAAU,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,MAC7C;AAGA,YAAM,EAAE,UAAAC,UAAS,IAAI,QAAQ,eAAe;AAC5C,YAAM,YAAY,SAAS,MAAM,MAAM,KAAK;AAE5C,MAAAA,UAAS,aAAa,SAAS,eAAe,OAAO,MAAM,SAAS,KAAK;AAAA,QACvE,OAAO;AAAA,QACP,SAAS;AAAA,MACX,CAAC;AAED,aAAO,KAAK,kBAAkB,SAAS;AAAA,IACzC,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YACJ,KACA,WAMC;AACD,QAAI;AACF,YAAM,QAAQ,QAAQ,OAAO;AAC7B,YAAM,OAAO,QAAQ,MAAM;AAE3B,UAAI,CAAI,eAAW,SAAS,GAAG;AAC7B,QAAG,cAAU,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,MAC7C;AAEA,YAAM,cAAmB,WAAK,WAAW,iBAAiB;AAG1D,YAAM,IAAI,QAAc,CAACC,UAAS,WAAW;AAC3C,cAAM,WAAW,IAAI,WAAW,OAAO,IAAI,QAAQ;AACnD,cAAM,OAAU,sBAAkB,WAAW;AAE7C,cAAM,UAAU,SAAS,IAAI,KAAK,CAAC,aAAkB;AAEnD,cAAI,SAAS,eAAe,OAAO,SAAS,eAAe,KAAK;AAC9D,iBAAK,MAAM;AACX,YAAG,eAAW,WAAW;AACzB,iBAAK,YAAY,SAAS,QAAQ,UAAU,SAAS,EAClD,KAAK,MAAMA,SAAQ,CAAC,EACpB,MAAM,MAAM;AACf;AAAA,UACF;AAEA,mBAAS,KAAK,IAAI;AAClB,eAAK,GAAG,UAAU,MAAM;AACtB,iBAAK,MAAM;AACX,YAAAA,SAAQ;AAAA,UACV,CAAC;AAAA,QACH,CAAC;AAED,gBAAQ,GAAG,SAAS,CAAC,QAAe;AAClC,eAAK,MAAM;AACX,UAAG,eAAW,WAAW;AACzB,iBAAO,GAAG;AAAA,QACZ,CAAC;AAED,gBAAQ,WAAW,KAAO,MAAM;AAC9B,kBAAQ,QAAQ;AAChB,iBAAO,IAAI,MAAM,0BAAM,CAAC;AAAA,QAC1B,CAAC;AAAA,MACH,CAAC;AAGD,YAAM,SAAS,QAAQ,SAAS;AAChC,YAAM,MAAM,IAAI,OAAO,WAAW;AAClC,UAAI,aAAa,WAAW,IAAI;AAGhC,MAAG,eAAW,WAAW;AAGzB,YAAM,eAAe,KAAK,SAAS,WAAW,eAAe;AAC7D,UAAI,CAAC,cAAc;AACjB,eAAO,EAAE,SAAS,OAAO,OAAO,2DAAwB;AAAA,MAC1D;AAEA,aAAO,KAAK,kBAAuB,cAAQ,YAAY,CAAC;AAAA,IAC1D,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,UAA6D;AAC5E,QAAI,CAAC,SAAS,IAAI;AAChB,aAAO,EAAE,OAAO,OAAO,OAAO,2CAAa;AAAA,IAC7C;AAEA,QAAI,CAAC,2BAA2B,KAAK,SAAS,EAAE,GAAG;AACjD,aAAO,EAAE,OAAO,OAAO,OAAO,0LAAoC;AAAA,IACpE;AAEA,QAAI,CAAC,SAAS,MAAM;AAClB,aAAO,EAAE,OAAO,OAAO,OAAO,6CAAe;AAAA,IAC/C;AAEA,QAAI,CAAC,SAAS,SAAS;AACrB,aAAO,EAAE,OAAO,OAAO,OAAO,gDAAkB;AAAA,IAClD;AAEA,QAAI,CAAC,SAAS,aAAa;AACzB,aAAO,EAAE,OAAO,OAAO,OAAO,oDAAsB;AAAA,IACtD;AAGA,UAAM,gBAAgB,CAAC,QAAQ,UAAU,SAAS,SAAS;AAC3D,QAAI,SAAS,WAAW,CAAC,cAAc,SAAS,SAAS,OAAO,GAAG;AACjE,aAAO,EAAE,OAAO,OAAO,OAAO,yCAAW,SAAS,OAAO,GAAG;AAAA,IAC9D;AAEA,WAAO,EAAE,OAAO,KAAK;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,SAAgC;AA7NrD;AA8NI,UAAM,WAAmC,CAAC;AAC1C,UAAM,QAAQ,QAAQ,MAAM,IAAI;AAEhC,QAAI,iBAAiB;AACrB,QAAI,iBAA2B,CAAC;AAChC,QAAI,QAAQ;AAEZ,eAAW,QAAQ,OAAO;AAExB,YAAM,UAAU,KAAK,MAAM,YAAY;AACvC,UAAI,WAAW,CAAC,OAAO;AACrB,gBAAQ,QAAQ,CAAC,EAAE,KAAK;AACxB;AAAA,MACF;AAGA,YAAM,UAAU,KAAK,MAAM,aAAa;AACxC,UAAI,SAAS;AACX,YAAI,eAAe,SAAS,GAAG;AAC7B,mBAAS,cAAc,IAAI,eAAe,KAAK,IAAI,EAAE,KAAK;AAAA,QAC5D;AACA,yBAAiB,KAAK,qBAAqB,QAAQ,CAAC,EAAE,KAAK,CAAC;AAC5D,yBAAiB,CAAC;AAClB;AAAA,MACF;AAEA,qBAAe,KAAK,IAAI;AAAA,IAC1B;AAGA,QAAI,eAAe,SAAS,GAAG;AAC7B,eAAS,cAAc,IAAI,eAAe,KAAK,IAAI,EAAE,KAAK;AAAA,IAC5D;AAGA,UAAM,WAAqB,CAAC;AAC5B,UAAM,iBAAiB,SAAS,UAAU,KAAK,SAAS,OAAO,KAAK;AACpE,UAAM,aAAa,eAAe,MAAM,iBAAiB;AACzD,QAAI,YAAY;AACd,eAAS,KAAK,GAAG,WAAW,IAAI,OAAK,EAAE,QAAQ,cAAc,EAAE,EAAE,KAAK,CAAC,CAAC;AAAA,IAC1E;AAEA,WAAO;AAAA,MACL,OAAO,SAAS;AAAA,MAChB,eAAa,cAAS,aAAa,MAAtB,mBAAyB,MAAM,QAAQ,OAAM;AAAA,MAC1D,OAAO,SAAS,OAAO,KAAK,SAAS,0BAAM;AAAA,MAC3C;AAAA,MACA,UAAU,SAAS,WAAW,KAAK,SAAS,QAAQ,KAAK,SAAS,sBAAO;AAAA,MACzE,eAAe,SAAS,eAAe,KAAK,SAAS,QAAQ,KAAK,SAAS,cAAI;AAAA,MAC/E,YAAY;AAAA,MACZ;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,MAAsB;AACjD,UAAM,UAAkC;AAAA,MACtC,gBAAM;AAAA,MACN,4BAAQ;AAAA,MACR,gBAAM;AAAA,MACN,gBAAM;AAAA,MACN,gBAAM;AAAA,MACN,gBAAM;AAAA,MACN,wBAAS;AAAA,MACT,sBAAO;AAAA,IACT;AAEA,UAAM,QAAQ,KAAK,YAAY;AAC/B,WAAO,QAAQ,KAAK,KAAK,MAAM,QAAQ,QAAQ,GAAG;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS,KAAa,UAAkB,WAAW,GAAkB;AAC3E,UAAM,SAAS,CAAC,YAAoB,UAAiC;AACnE,UAAI,QAAQ;AAAU,eAAO;AAE7B,YAAM,WAAgB,WAAK,YAAY,QAAQ;AAC/C,UAAO,eAAW,QAAQ,GAAG;AAC3B,eAAO;AAAA,MACT;AAEA,YAAM,UAAa,gBAAY,YAAY,EAAE,eAAe,KAAK,CAAC;AAClE,iBAAW,SAAS,SAAS;AAC3B,YAAI,MAAM,YAAY,KAAK,CAAC,MAAM,KAAK,WAAW,GAAG,GAAG;AACtD,gBAAM,QAAQ,OAAY,WAAK,YAAY,MAAM,IAAI,GAAG,QAAQ,CAAC;AACjE,cAAI;AAAO,mBAAO;AAAA,QACpB;AAAA,MACF;AAEA,aAAO;AAAA,IACT;AAEA,WAAO,OAAO,KAAK,CAAC;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,UAA4B;AACtC,UAAM,aAAkB,WAAK,UAAU,SAAS;AAChD,QAAI,CAAI,eAAW,UAAU;AAAG,aAAO,CAAC;AAExC,UAAM,UAAoB,CAAC;AAC3B,UAAM,UAAa,gBAAY,YAAY,EAAE,eAAe,KAAK,CAAC;AAElE,eAAW,SAAS,SAAS;AAC3B,UAAI,MAAM,OAAO,GAAG;AAClB,cAAM,MAAW,cAAQ,MAAM,IAAI,EAAE,YAAY;AACjD,YAAI,CAAC,OAAO,OAAO,OAAO,KAAK,EAAE,SAAS,GAAG,GAAG;AAC9C,kBAAQ,KAAU,WAAK,YAAY,MAAM,IAAI,CAAC;AAAA,QAChD;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,UAA4B;AACxC,UAAM,SAAc,WAAK,UAAU,KAAK;AACxC,QAAI,CAAI,eAAW,MAAM;AAAG,aAAO,CAAC;AAEpC,UAAM,YAAsB,CAAC;AAE7B,UAAM,OAAO,CAAC,QAAgB;AAC5B,YAAM,UAAa,gBAAY,KAAK,EAAE,eAAe,KAAK,CAAC;AAC3D,iBAAW,SAAS,SAAS;AAC3B,cAAM,WAAgB,WAAK,KAAK,MAAM,IAAI;AAC1C,YAAI,MAAM,YAAY,GAAG;AACvB,eAAK,QAAQ;AAAA,QACf,OAAO;AACL,oBAAU,KAAK,QAAQ;AAAA,QACzB;AAAA,MACF;AAAA,IACF;AAEA,SAAK,MAAM;AACX,WAAO;AAAA,EACT;AACF;AApWa,aACI,WAA+B;AADzC,IAAM,cAAN;;;ACLP,IAAAC,WAAwB;AACxB,IAAAC,QAAsB;AACtB,IAAAC,MAAoB;AACpB,IAAAC,wBAA8C;;;ACMvC,IAAM,qBAAN,MAAmD;AAAA,EAMxD,YACE,OACA,UACA,UACA;AANF,SAAQ,kBAA+B,oBAAI,IAAI;AAO7C,SAAK,QAAQ;AACb,SAAK,WAAW;AAChB,SAAK,WAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,QAAgB,QAAuD;AAChF,UAAM,YAAY,KAAK,IAAI;AAE3B,QAAI;AAEF,YAAM,eAAe,KAAK,MAAM,SAAS;AACzC,UAAI,gBAAgB,CAAC,aAAa,SAAS,MAAM,KAAK,CAAC,aAAa,SAAS,GAAG,GAAG;AACjF,eAAO;AAAA,UACL,SAAS;AAAA,UACT,OAAO;AAAA,YACL,MAAM;AAAA,YACN,SAAS,UAAU,KAAK,MAAM,SAAS,IAAI,2CAAa,MAAM;AAAA,UAChE;AAAA,UACA,UAAU,KAAK,IAAI,IAAI;AAAA,QACzB;AAAA,MACF;AAGA,YAAM,OAAO,KAAK,SAAS,QAAQ,MAAM;AACzC,UAAI,CAAC,MAAM;AACT,eAAO;AAAA,UACL,SAAS;AAAA,UACT,OAAO;AAAA,YACL,MAAM;AAAA,YACN,SAAS,iBAAO,MAAM;AAAA,UACxB;AAAA,UACA,UAAU,KAAK,IAAI,IAAI;AAAA,QACzB;AAAA,MACF;AAGA,YAAM,SAAS,MAAM,KAAK,SAAS,QAAQ;AAAA,QACzC;AAAA,QACA,WAAW;AAAA,QACX,QAAQ;AAAA;AAAA,QACR,SAAS;AAAA,UACP,WAAW,SAAS,KAAK,MAAM,SAAS,EAAE;AAAA,QAC5C;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS,OAAO;AAAA,QAChB,MAAM,OAAO;AAAA,QACb,OAAO,OAAO,QAAQ;AAAA,UACpB,MAAM,OAAO,MAAM;AAAA,UACnB,SAAS,OAAO,MAAM;AAAA,QACxB,IAAI;AAAA,QACJ,UAAU,OAAO,MAAM;AAAA,MACzB;AAAA,IACF,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO;AAAA,UACL,MAAM;AAAA,UACN,SAAS,iBAAiB,QAAQ,MAAM,UAAU;AAAA,QACpD;AAAA,QACA,UAAU,KAAK,IAAI,IAAI;AAAA,MACzB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAA0C;AAC9C,UAAM,WAAW,KAAK,SAAS,YAAY;AAC3C,UAAM,eAAe,KAAK,MAAM,SAAS;AAGzC,QAAI,CAAC,gBAAgB,aAAa,SAAS,GAAG,GAAG;AAC/C,aAAO,SAAS,OAAO,CAAAC,OAAKA,GAAE,OAAO,EAAE,IAAI,CAAAA,OAAKA,GAAE,IAAI;AAAA,IACxD;AAGA,WAAO,SACJ,OAAO,CAAAA,OAAKA,GAAE,WAAW,aAAa,SAASA,GAAE,KAAK,EAAE,CAAC,EACzD,IAAI,CAAAA,OAAKA,GAAE,IAAI;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,MAAwE;AACzF,QAAI;AAEF,YAAM,cAAc,KAAK,MAAM,SAAS,eAAe,CAAC;AACxD,UAAI,CAAC,YAAY,SAAS,cAAc,GAAG;AACzC,eAAO;AAAA,UACL,SAAS;AAAA,UACT,OAAO,UAAU,KAAK,MAAM,SAAS,IAAI;AAAA,QAC3C;AAAA,MACF;AAGA,YAAM,eAAkC;AAAA,QACtC,GAAG;AAAA,QACH,IAAI,SAAS,KAAK,MAAM,SAAS,EAAE,IAAI,KAAK,EAAE;AAAA,QAC9C,aAAa,GAAG,KAAK,WAAW,mBAAS,KAAK,MAAM,SAAS,IAAI;AAAA,QACjE,UAAU;AAAA,UACR,QAAQ;AAAA,UACR,WAAW,KAAK,IAAI;AAAA,UACpB,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF;AAEA,YAAM,SAAS,MAAM,KAAK,SAAS,aAAa,cAAc,MAAM;AAEpE,UAAI,OAAO,SAAS;AAClB,aAAK,gBAAgB,IAAI,aAAa,EAAE;AAAA,MAC1C;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,QAA+D;AAClF,QAAI;AACF,YAAM,aAAa,OAAO,WAAW,QAAQ,IACzC,SACA,SAAS,KAAK,MAAM,SAAS,EAAE,IAAI,MAAM;AAE7C,UAAI,CAAC,KAAK,gBAAgB,IAAI,UAAU,GAAG;AACzC,eAAO;AAAA,UACL,SAAS;AAAA,UACT,OAAO,iBAAO,MAAM;AAAA,QACtB;AAAA,MACF;AAEA,YAAM,SAAS,MAAM,KAAK,SAAS,WAAW,UAAU;AAExD,UAAI,OAAO,SAAS;AAClB,aAAK,gBAAgB,OAAO,UAAU;AAAA,MACxC;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAClD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,wBAIH;AACD,UAAM,aAAuB,CAAC;AAC9B,UAAM,SAAmB,CAAC;AAE1B,UAAM,gBAAgB,KAAK,MAAM,SAAS;AAC1C,QAAI,CAAC,iBAAiB,cAAc,WAAW,GAAG;AAChD,aAAO,EAAE,SAAS,MAAM,YAAY,OAAO;AAAA,IAC7C;AAEA,eAAW,QAAQ,eAAe;AAChC,YAAM,SAAS,MAAM,KAAK,aAAa,IAAI;AAC3C,UAAI,OAAO,SAAS;AAClB,mBAAW,KAAK,KAAK,EAAE;AAAA,MACzB,OAAO;AACL,eAAO,KAAK,GAAG,KAAK,EAAE,KAAK,OAAO,KAAK,EAAE;AAAA,MAC3C;AAAA,IACF;AAEA,WAAO;AAAA,MACL,SAAS,OAAO,WAAW;AAAA,MAC3B;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,qBAAoC;AACxC,eAAW,UAAU,KAAK,iBAAiB;AACzC,YAAM,KAAK,SAAS,WAAW,MAAM;AAAA,IACvC;AACA,SAAK,gBAAgB,MAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,qBAA+B;AAC7B,WAAO,MAAM,KAAK,KAAK,eAAe;AAAA,EACxC;AACF;AAKO,IAAM,yBAAN,MAAM,uBAAsB;AAAA,EAA5B;AAEL,SAAQ,WAA+B;AACvC,SAAQ,WAA+B;AACvC,SAAQ,UAA2C,oBAAI,IAAI;AAAA;AAAA,EAE3D,OAAO,cAAqC;AAC1C,QAAI,CAAC,uBAAsB,UAAU;AACnC,6BAAsB,WAAW,IAAI,uBAAsB;AAAA,IAC7D;AACA,WAAO,uBAAsB;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,UAAuB,UAA6B;AAC7D,SAAK,WAAW;AAChB,SAAK,WAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,OAA2C;AACtD,QAAI,CAAC,KAAK,YAAY,CAAC,KAAK,UAAU;AACpC,YAAM,IAAI,MAAM,gDAA4B;AAAA,IAC9C;AAEA,UAAM,WAAW,KAAK,QAAQ,IAAI,MAAM,SAAS,EAAE;AACnD,QAAI,UAAU;AACZ,aAAO;AAAA,IACT;AAEA,UAAM,SAAS,IAAI,mBAAmB,OAAO,KAAK,UAAU,KAAK,QAAQ;AACzE,SAAK,QAAQ,IAAI,MAAM,SAAS,IAAI,MAAM;AAE1C,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,SAAiD;AACzD,WAAO,KAAK,QAAQ,IAAI,OAAO;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,SAAgC;AACjD,UAAM,SAAS,KAAK,QAAQ,IAAI,OAAO;AACvC,QAAI,QAAQ;AACV,YAAM,OAAO,mBAAmB;AAChC,WAAK,QAAQ,OAAO,OAAO;AAAA,IAC7B;AAAA,EACF;AACF;AAzDa,uBACI,WAAyC;AADnD,IAAM,wBAAN;;;AD5NA,IAAM,iBAAN,MAAM,eAAc;AAAA,EAMjB,YAAY,SAAkC;AAFtD,SAAQ,mBAA8C,oBAAI,IAAI;AAG5D,SAAK,UAAU;AACf,SAAK,gBAAgB,sBAAsB,YAAY;AAAA,EACzD;AAAA,EAEA,OAAO,YAAY,SAAiD;AAClE,QAAI,CAAC,eAAc,UAAU;AAC3B,qBAAc,WAAW,IAAI,eAAc,OAAO;AAAA,IACpD;AACA,WAAO,eAAc;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QACJ,OACA,QACA,kBAKsB;AA/C1B;AAgDI,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,OAA4B,CAAC;AACnC,UAAM,WAAoC,CAAC;AAE3C,UAAM,MAAM,CAAC,SAAiB,QAAmC,WAAW;AAC1E,WAAK,KAAK,EAAE,OAAO,SAAS,WAAW,KAAK,IAAI,EAAE,CAAC;AACnD,cAAQ,IAAI,UAAU,MAAM,SAAS,EAAE,MAAM,KAAK,KAAK,OAAO,EAAE;AAAA,IAClE;AAEA,QAAI;AACF,UAAI,kCAAc,MAAM,SAAS,IAAI,EAAE;AAGvC,YAAM,SAAS,KAAK,cAAc,aAAa,KAAK;AAGpD,YAAM,gBAAgB;AAAA,QACpB,MAAM,OAAO,QAAgB,eAAoC;AAC/D,gBAAM,SAAS,MAAM,OAAO,KAAK,QAAQ,UAAU;AACnD,mBAAS,KAAK,EAAE,QAAQ,QAAQ,YAAY,OAAO,CAAC;AACpD,iBAAO;AAAA,QACT;AAAA,QACA,WAAW,MAAM,OAAO,UAAU;AAAA,QAClC,cAAc,CAAC,SAAc,OAAO,aAAa,IAAI;AAAA,QACrD,gBAAgB,CAAC,WAAmB,OAAO,eAAe,MAAM;AAAA,MAClE;AAGA,YAAM,cAA4B;AAAA,QAChC;AAAA,QACA,gBAAe,qDAAkB,oBAC/B,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAAA,QAC9C,aAAY,qDAAkB,iBAC5B,KAAO,gBAAO,qBAAd,mBAAgC,SAAS;AAAA,QAC3C,cAAc,qDAAkB;AAAA,QAChC;AAAA,QACA,KAAK;AAAA,QACL;AAAA,QACA,UAAU,CAAC,SAAS,YAAY;AAC9B,cAAI,iBAAO,OAAO,IAAI,UAAU,MAAM,OAAO,KAAK,EAAE,IAAI,MAAM;AAAA,QAChE;AAAA,MACF;AAGA,YAAM,UAAU,MAAM,SAAS,WAAW;AAC1C,UAAI;AAEJ,cAAQ,SAAS;AAAA,QACf,KAAK;AACH,mBAAS,MAAM,KAAK,YAAY,OAAO,WAAW;AAClD;AAAA,QACF,KAAK;AACH,mBAAS,MAAM,KAAK,cAAc,OAAO,WAAW;AACpD;AAAA,QACF,KAAK;AACH,mBAAS,MAAM,KAAK,aAAa,OAAO,WAAW;AACnD;AAAA,QACF,KAAK;AACH,mBAAS,MAAM,KAAK,eAAe,OAAO,WAAW;AACrD;AAAA,QACF;AACE,gBAAM,IAAI,MAAM,+CAAY,OAAO,EAAE;AAAA,MACzC;AAEA,UAAI,0BAAM;AAEV,aAAO;AAAA,QACL,SAAS;AAAA,QACT;AAAA,QACA;AAAA,QACA;AAAA,QACA,UAAU,KAAK,IAAI,IAAI;AAAA,MACzB;AAAA,IACF,SAAS,OAAO;AACd,YAAM,eAAe,iBAAiB,QAAQ,MAAM,UAAU;AAC9D,UAAI,6BAAS,YAAY,IAAI,OAAO;AAEpC,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO;AAAA,QACP;AAAA,QACA;AAAA,QACA,UAAU,KAAK,IAAI,IAAI;AAAA,MACzB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YACZ,OACA,SACc;AACd,UAAM,aAAa,MAAM,SAAS,QAAQ;AAC1C,UAAM,aAAkB,WAAK,MAAM,aAAa,UAAU;AAE1D,QAAI,CAAI,eAAW,UAAU,GAAG;AAC9B,YAAM,IAAI,MAAM,yCAAW,UAAU,EAAE;AAAA,IACzC;AAGA,QAAI,WAAW,SAAS,KAAK,GAAG;AAC9B,aAAO,KAAK,kBAAkB,OAAO,SAAS,UAAU;AAAA,IAC1D;AAGA,UAAM,KAAK,QAAQ,IAAI;AACvB,UAAM,gBAAmB,iBAAa,YAAY,OAAO;AAGzD,UAAM,UAAU,KAAK,cAAc,OAAO;AAE1C,UAAM,SAAS,IAAI,GAAG,OAAO;AAAA;AAAA,UAEvB,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAalB;AAED,UAAM,UAAU,OAAO,gBAAgB,OAAO;AAC9C,WAAO,QAAQ,OAAO;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBACZ,OACA,SACA,YACc;AA7LlB;AA8LI,UAAM,SAAS,WAAW,QAAQ,SAAS,KAAK;AAGhD,QAAI,CAAI,eAAW,MAAM,KAClB,aAAS,UAAU,EAAE,QAAW,aAAS,MAAM,EAAE,OAAO;AAC7D,UAAI;AACF,4CAAS,YAAY,UAAU,eAAoB,cAAQ,MAAM,CAAC,KAAK;AAAA,UACrE,KAAK,MAAM;AAAA,UACX,OAAO;AAAA,QACT,CAAC;AAAA,MACH,SAAS,OAAO;AACd,cAAM,IAAI,MAAM,uCAAmB,KAAK,EAAE;AAAA,MAC5C;AAAA,IACF;AAGA,UAAM,eAAe;AAAA,MACnB,GAAG;AAAA,MACH,UAAU;AAAA,QACR,GAAG,MAAM;AAAA,QACT,OAAM,WAAM,SAAS,SAAf,mBAAqB,QAAQ,SAAS;AAAA,MAC9C;AAAA,IACF;AAEA,WAAO,KAAK,YAAY,cAAc,OAAO;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,cACZ,OACA,SACc;AACd,UAAM,aAAa,MAAM,SAAS,QAAQ;AAC1C,UAAM,aAAkB,WAAK,MAAM,aAAa,UAAU;AAE1D,QAAI,CAAI,eAAW,UAAU,GAAG;AAC9B,YAAM,IAAI,MAAM,yCAAW,UAAU,EAAE;AAAA,IACzC;AAEA,WAAO,IAAI,QAAQ,CAACC,UAAS,WAAW;AACtC,YAAM,cAAc,KAAK,UAAU;AAAA,QACjC,eAAe,QAAQ;AAAA,QACvB,YAAY,QAAQ;AAAA,QACpB,cAAc,QAAQ;AAAA,QACtB,QAAQ,QAAQ;AAAA,QAChB,SAAS,MAAM,SAAS;AAAA,MAC1B,CAAC;AAED,YAAM,aAAS,6BAAM,UAAU,CAAC,UAAU,GAAG;AAAA,QAC3C,KAAK,MAAM;AAAA,QACX,KAAK;AAAA,UACH,GAAG,QAAQ;AAAA,UACX,eAAe;AAAA,UACf,YAAY,MAAM;AAAA,QACpB;AAAA,MACF,CAAC;AAED,WAAK,iBAAiB,IAAI,MAAM,SAAS,IAAI,MAAM;AAEnD,UAAI,SAAS;AACb,UAAI,SAAS;AAEb,aAAO,OAAO,GAAG,QAAQ,CAAC,SAAS;AACjC,kBAAU,KAAK,SAAS;AACxB,gBAAQ,IAAI,KAAK,SAAS,EAAE,KAAK,GAAG,MAAM;AAAA,MAC5C,CAAC;AAED,aAAO,OAAO,GAAG,QAAQ,CAAC,SAAS;AACjC,kBAAU,KAAK,SAAS;AACxB,gBAAQ,IAAI,KAAK,SAAS,EAAE,KAAK,GAAG,OAAO;AAAA,MAC7C,CAAC;AAED,aAAO,GAAG,SAAS,CAAC,SAAS;AAC3B,aAAK,iBAAiB,OAAO,MAAM,SAAS,EAAE;AAE9C,YAAI,SAAS,GAAG;AACd,cAAI;AACF,kBAAM,WAAW,OAAO,KAAK,EAAE,MAAM,IAAI,EAAE,IAAI,KAAK;AACpD,YAAAA,SAAQ,KAAK,MAAM,QAAQ,CAAC;AAAA,UAC9B,QAAQ;AACN,YAAAA,SAAQ,MAAM;AAAA,UAChB;AAAA,QACF,OAAO;AACL,iBAAO,IAAI,MAAM,wCAAe,IAAI,KAAK,MAAM,EAAE,CAAC;AAAA,QACpD;AAAA,MACF,CAAC;AAED,aAAO,GAAG,SAAS,CAAC,UAAU;AAC5B,aAAK,iBAAiB,OAAO,MAAM,SAAS,EAAE;AAC9C,eAAO,KAAK;AAAA,MACd,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aACZ,OACA,SACc;AACd,UAAM,aAAa,MAAM,SAAS,QAAQ;AAC1C,UAAM,aAAkB,WAAK,MAAM,aAAa,UAAU;AAE1D,QAAI,CAAI,eAAW,UAAU,GAAG;AAC9B,YAAM,IAAI,MAAM,yCAAW,UAAU,EAAE;AAAA,IACzC;AAEA,WAAO,IAAI,QAAQ,CAACA,UAAS,WAAW;AACtC,YAAM,QAAQ,QAAQ,aAAa,UAAU,mBAAmB;AAChE,YAAM,OAAO,QAAQ,aAAa,UAAU,CAAC,SAAS,UAAU,IAAI,CAAC,UAAU;AAE/E,YAAM,WAAO,6BAAM,OAAO,MAAM;AAAA,QAC9B,KAAK,MAAM;AAAA,QACX,KAAK;AAAA,UACH,GAAG,QAAQ;AAAA,UACX,gBAAgB,QAAQ,iBAAiB;AAAA,UACzC,aAAa,QAAQ,cAAc;AAAA,UACnC,eAAe,QAAQ,gBAAgB;AAAA,UACvC,UAAU,MAAM,SAAS;AAAA,UACzB,cAAc,KAAK,UAAU,QAAQ,UAAU,CAAC,CAAC;AAAA,QACnD;AAAA,MACF,CAAC;AAED,WAAK,iBAAiB,IAAI,MAAM,SAAS,IAAI,IAAI;AAEjD,UAAI,SAAS;AACb,UAAI,SAAS;AAEb,WAAK,OAAO,GAAG,QAAQ,CAAC,SAAS;AAC/B,kBAAU,KAAK,SAAS;AACxB,gBAAQ,IAAI,KAAK,SAAS,EAAE,KAAK,GAAG,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,OAAO,GAAG,QAAQ,CAAC,SAAS;AAC/B,kBAAU,KAAK,SAAS;AACxB,gBAAQ,IAAI,KAAK,SAAS,EAAE,KAAK,GAAG,OAAO;AAAA,MAC7C,CAAC;AAED,WAAK,GAAG,SAAS,CAAC,SAAS;AACzB,aAAK,iBAAiB,OAAO,MAAM,SAAS,EAAE;AAE9C,YAAI,SAAS,GAAG;AACd,UAAAA,SAAQ,MAAM;AAAA,QAChB,OAAO;AACL,iBAAO,IAAI,MAAM,uCAAc,IAAI,KAAK,MAAM,EAAE,CAAC;AAAA,QACnD;AAAA,MACF,CAAC;AAED,WAAK,GAAG,SAAS,CAAC,UAAU;AAC1B,aAAK,iBAAiB,OAAO,MAAM,SAAS,EAAE;AAC9C,eAAO,KAAK;AAAA,MACd,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eACZ,OACA,SACc;AACd,UAAM,aAAa,MAAM,SAAS,QAAQ;AAC1C,UAAM,aAAkB,WAAK,MAAM,aAAa,UAAU;AAE1D,QAAI,CAAI,eAAW,UAAU,GAAG;AAC9B,YAAM,IAAI,MAAM,yCAAW,UAAU,EAAE;AAAA,IACzC;AAGA,UAAMC,UAAS,QAAQ,UAAU;AAEjC,QAAI,OAAOA,QAAO,YAAY,YAAY;AACxC,aAAOA,QAAO,QAAQ,OAAO;AAAA,IAC/B,WAAW,OAAOA,QAAO,YAAY,YAAY;AAC/C,aAAOA,QAAO,QAAQ,OAAO;AAAA,IAC/B,WAAW,OAAOA,YAAW,YAAY;AACvC,aAAOA,QAAO,OAAO;AAAA,IACvB;AAEA,UAAM,IAAI,MAAM,kDAAU;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAc,SAA4C;AAChE,WAAO;AAAA,MACL,SAAS;AAAA,QACP,KAAK,IAAI,SAAgB,QAAQ,IAAI,KAAK,KAAK,GAAG,GAAG,MAAM;AAAA,QAC3D,MAAM,IAAI,SAAgB,QAAQ,IAAI,KAAK,KAAK,GAAG,GAAG,MAAM;AAAA,QAC5D,OAAO,IAAI,SAAgB,QAAQ,IAAI,KAAK,KAAK,GAAG,GAAG,OAAO;AAAA,QAC9D,MAAM,IAAI,SAAgB,QAAQ,IAAI,KAAK,KAAK,GAAG,GAAG,MAAM;AAAA,MAC9D;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,QAAQ,EAAE,SAAS,CAAC,EAAE;AAAA,MACtB,SAAS,CAAC;AAAA,MACV,SAAS,KAAK,kBAAkB,QAAQ,MAAM,WAAW;AAAA,IAC3D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,WAA4C;AACpE,UAAM,iBAAiB,CAAC,QAAQ,MAAM,OAAO,QAAQ,UAAU,MAAM;AAErE,WAAO,CAAC,eAAuB;AAC7B,UAAI,eAAe,SAAS,UAAU,GAAG;AACvC,eAAO,QAAQ,UAAU;AAAA,MAC3B;AAGA,UAAI,WAAW,WAAW,IAAI,KAAK,WAAW,WAAW,KAAK,GAAG;AAC/D,cAAM,eAAoB,cAAQ,WAAW,UAAU;AACvD,YAAI,aAAa,WAAW,SAAS,GAAG;AACtC,iBAAO,QAAQ,YAAY;AAAA,QAC7B;AAAA,MACF;AAGA,YAAM,kBAAuB,WAAK,WAAW,gBAAgB,UAAU;AACvE,UAAO,eAAW,eAAe,GAAG;AAClC,eAAO,QAAQ,eAAe;AAAA,MAChC;AAEA,YAAM,IAAI,MAAM,+CAAY,UAAU,EAAE;AAAA,IAC1C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,SAA0B;AAC/B,UAAM,OAAO,KAAK,iBAAiB,IAAI,OAAO;AAC9C,QAAI,MAAM;AACR,WAAK,KAAK,SAAS;AACnB,WAAK,iBAAiB,OAAO,OAAO;AACpC,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,SAA0B;AAClC,WAAO,KAAK,iBAAiB,IAAI,OAAO;AAAA,EAC1C;AACF;AA1ba,eACI,WAAiC;AAD3C,IAAM,gBAAN;;;AFQP,IAAMC,eAAc;AACpB,IAAM,aAAa;AAEZ,IAAM,gBAAN,MAAM,cAAa;AAAA,EAmBhB,YACN,SACA,UACA,UACA;AAhBF,SAAQ,SAAsC,oBAAI,IAAI;AAItD;AAAA,SAAQ,oBAAoB,IAAW,sBAA6B;AACpE,SAAQ,sBAAsB,IAAW,sBAAqB;AAC9D,SAAQ,wBAAwB,IAAW,sBAAkD;AAE7F,SAAS,mBAAmB,KAAK,kBAAkB;AACnD,SAAS,qBAAqB,KAAK,oBAAoB;AACvD,SAAS,uBAAuB,KAAK,sBAAsB;AAOzD,SAAK,UAAU;AACf,SAAK,SAAS,YAAY,YAAY;AACtC,SAAK,WAAW,cAAc,YAAY,OAAO;AACjD,SAAK,gBAAgB,sBAAsB,YAAY;AACvD,SAAK,cAAc,WAAW,UAAU,QAAQ;AAEhD,SAAK,YAAiB,YAAK,QAAQ,iBAAiB,QAAQ,UAAU;AACtE,QAAI,CAAI,eAAW,KAAK,SAAS,GAAG;AAClC,MAAG,cAAU,KAAK,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,IAClD;AAAA,EACF;AAAA,EAEA,OAAO,YACL,SACA,UACA,UACc;AACd,QAAI,CAAC,cAAa,UAAU;AAC1B,UAAI,CAAC,YAAY,CAAC,UAAU;AAC1B,cAAM,IAAI,MAAM,gGAA8C;AAAA,MAChE;AACA,oBAAa,WAAW,IAAI,cAAa,SAAS,UAAU,QAAQ;AAAA,IACtE;AACA,WAAO,cAAa;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAA4B;AAChC,UAAM,KAAK,kBAAkB;AAC7B,UAAM,KAAK,oBAAoB;AAC/B,YAAQ,IAAI,kDAAyB,KAAK,OAAO,IAAI,cAAS;AAAA,EAChE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAmC;AAE/C,UAAM,aAAkB,YAAK,KAAK,QAAQ,eAAe,QAAQ,aAAa,kBAAkB;AAEhG,QAAI,CAAI,eAAW,UAAU,GAAG;AAC9B,cAAQ,IAAI,yEAAiC,UAAU;AAEvD,YAAM,SAAc,YAAK,KAAK,QAAQ,eAAe,OAAO,aAAa,UAAU,kBAAkB;AACrG,UAAO,eAAW,MAAM,GAAG;AACzB,gBAAQ,IAAI,oEAA4B,MAAM;AAC9C,eAAO,KAAK,oBAAoB,MAAM;AAAA,MACxC;AACA;AAAA,IACF;AAEA,WAAO,KAAK,oBAAoB,UAAU;AAAA,EAC5C;AAAA,EAEA,MAAc,oBAAoB,YAAmC;AAAK,UAAM,UAAa,gBAAY,YAAY,EAAE,eAAe,KAAK,CAAC;AAC1I,eAAW,SAAS,SAAS;AAC3B,UAAI,CAAC,MAAM,YAAY;AAAG;AAE1B,YAAM,WAAgB,YAAK,YAAY,MAAM,IAAI;AACjD,YAAM,eAAoB,YAAK,UAAU,eAAe;AAExD,UAAI,CAAI,eAAW,YAAY;AAAG;AAElC,UAAI;AACF,cAAM,aAAa,MAAM,KAAK,OAAO,kBAAkB,QAAQ;AAC/D,YAAI,CAAC,WAAW,WAAW,CAAC,WAAW;AAAU;AAEjD,cAAM,WAAW,WAAW;AAG5B,YAAI,KAAK,OAAO,IAAI,SAAS,EAAE;AAAG;AAElC,cAAM,QAAwB;AAAA,UAC5B;AAAA,UACA,aAAa;AAAA,UACb,aAAa;AAAA;AAAA,UACb,QAAQ;AAAA,UACR,QAAQ,EAAE,MAAM,SAAS,WAAW,SAAS;AAAA,QAC/C;AAEA,aAAK,OAAO,IAAI,SAAS,IAAI,KAAK;AAAA,MACpC,SAAS,KAAK;AACZ,gBAAQ,MAAM,4DAA8B,MAAM,IAAI,KAAK,GAAG;AAAA,MAChE;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAqC;AACjD,UAAM,QAAQ,KAAK,QAAQ,YAAY,IAAsBA,YAAW,KAAK,CAAC;AAE9E,eAAW,SAAS,OAAO;AACzB,UAAI,CAAI,eAAW,MAAM,WAAW;AAAG;AAEvC,WAAK,OAAO,IAAI,MAAM,SAAS,IAAI,KAAK;AAExC,UAAI,MAAM,WAAW,UAAU;AAC7B,YAAI;AACF,gBAAM,KAAK,gBAAgB,KAAK;AAAA,QAClC,SAAS,KAAK;AACZ,kBAAQ,MAAM,uCAAc,MAAM,SAAS,EAAE,KAAK,GAAG;AACrD,eAAK,aAAa,MAAM,SAAS,IAAI,SAAS,OAAO,GAAG,CAAC;AAAA,QAC3D;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAc,aAA4B;AAExC,UAAM,aAAa,MAAM,KAAK,KAAK,OAAO,OAAO,CAAC,EAC/C,OAAO,OAAK,EAAE,cAAc,CAAC;AAChC,UAAM,KAAK,QAAQ,YAAY,OAAOA,cAAa,UAAU;AAAA,EAC/D;AAAA;AAAA,EAIA,MAAM,iBACJ,WACA,UAA+B,CAAC,GACuC;AACvE,QAAI;AACF,YAAM,aAAa,MAAM,KAAK,OAAO,kBAAkB,SAAS;AAChE,UAAI,CAAC,WAAW,WAAW,CAAC,WAAW,UAAU;AAC/C,eAAO,EAAE,SAAS,OAAO,OAAO,WAAW,SAAS,2BAAO;AAAA,MAC7D;AAEA,YAAM,WAAW,WAAW;AAE5B,UAAI,KAAK,OAAO,IAAI,SAAS,EAAE,KAAK,CAAC,QAAQ,WAAW;AACtD,eAAO,EAAE,SAAS,OAAO,OAAO,UAAU,SAAS,EAAE,uBAAQ;AAAA,MAC/D;AAEA,YAAM,YAAiB,YAAK,KAAK,WAAW,SAAS,EAAE;AACvD,YAAM,KAAK,cAAc,WAAW,SAAS;AAE7C,YAAM,QAAwB;AAAA,QAC5B;AAAA,QACA,aAAa;AAAA,QACb,aAAa,KAAK,IAAI;AAAA,QACtB,QAAQ,QAAQ,eAAe,QAAQ,WAAW;AAAA,QAClD,YAAY,QAAQ,UAAU,CAAC;AAAA,QAC/B,QAAQ,EAAE,MAAM,SAAS,UAAU;AAAA,MACrC;AAEA,WAAK,OAAO,IAAI,SAAS,IAAI,KAAK;AAClC,YAAM,KAAK,WAAW;AAEtB,UAAI,MAAM,WAAW,UAAU;AAC7B,cAAM,KAAK,gBAAgB,KAAK;AAAA,MAClC;AAEA,WAAK,kBAAkB,KAAK,KAAK;AACjC,aAAO,EAAE,SAAS,MAAM,MAAM;AAAA,IAChC,SAAS,OAAO;AACd,aAAO,EAAE,SAAS,OAAO,OAAO,OAAO,KAAK,EAAE;AAAA,IAChD;AAAA,EACF;AAAA,EAEA,MAAM,eACJ,SACA,UAAqD,CAAC,GACiB;AACvE,UAAM,UAAe,YAAK,KAAK,WAAW,WAAW,KAAK,IAAI,CAAC;AAE/D,QAAI;AACF,MAAG,cAAU,SAAS,EAAE,WAAW,KAAK,CAAC;AAEzC,YAAM,aAAa,MAAM,KAAK,OAAO,YAAY,SAAS,SAAS,QAAQ,MAAM;AACjF,UAAI,CAAC,WAAW,WAAW,CAAC,WAAW,UAAU;AAC/C,eAAO,EAAE,SAAS,OAAO,OAAO,WAAW,SAAS,2BAAO;AAAA,MAC7D;AAEA,YAAM,WAAW,WAAW;AAE5B,UAAI,KAAK,OAAO,IAAI,SAAS,EAAE,KAAK,CAAC,QAAQ,WAAW;AACtD,eAAO,EAAE,SAAS,OAAO,OAAO,UAAU,SAAS,EAAE,uBAAQ;AAAA,MAC/D;AAEA,YAAM,YAAiB,YAAK,KAAK,WAAW,SAAS,EAAE;AACvD,UAAO,eAAW,SAAS,GAAG;AAC5B,QAAG,WAAO,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,MAC1C;AACA,MAAG,eAAW,SAAS,SAAS;AAEhC,YAAM,QAAwB;AAAA,QAC5B;AAAA,QACA,aAAa;AAAA,QACb,aAAa,KAAK,IAAI;AAAA,QACtB,QAAQ,QAAQ,eAAe,QAAQ,WAAW;AAAA,QAClD,YAAY,QAAQ,UAAU,CAAC;AAAA,QAC/B,QAAQ,EAAE,MAAM,OAAO,KAAK,SAAS,QAAQ,QAAQ,OAAO;AAAA,MAC9D;AAEA,WAAK,OAAO,IAAI,SAAS,IAAI,KAAK;AAClC,YAAM,KAAK,WAAW;AAEtB,UAAI,MAAM,WAAW,UAAU;AAC7B,cAAM,KAAK,gBAAgB,KAAK;AAAA,MAClC;AAEA,WAAK,kBAAkB,KAAK,KAAK;AACjC,aAAO,EAAE,SAAS,MAAM,MAAM;AAAA,IAChC,SAAS,OAAO;AACd,aAAO,EAAE,SAAS,OAAO,OAAO,OAAO,KAAK,EAAE;AAAA,IAChD,UAAE;AACA,UAAO,eAAW,OAAO,GAAG;AAC1B,QAAG,WAAO,SAAS,EAAE,WAAW,KAAK,CAAC;AAAA,MACxC;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,eACJ,KACA,UAA+B,CAAC,GACuC;AACvE,UAAM,UAAe,YAAK,KAAK,WAAW,WAAW,KAAK,IAAI,CAAC;AAE/D,QAAI;AACF,MAAG,cAAU,SAAS,EAAE,WAAW,KAAK,CAAC;AAEzC,YAAM,aAAa,MAAM,KAAK,OAAO,YAAY,KAAK,OAAO;AAC7D,UAAI,CAAC,WAAW,WAAW,CAAC,WAAW,UAAU;AAC/C,eAAO,EAAE,SAAS,OAAO,OAAO,WAAW,SAAS,2BAAO;AAAA,MAC7D;AAEA,YAAM,WAAW,WAAW;AAE5B,UAAI,KAAK,OAAO,IAAI,SAAS,EAAE,KAAK,CAAC,QAAQ,WAAW;AACtD,eAAO,EAAE,SAAS,OAAO,OAAO,UAAU,SAAS,EAAE,uBAAQ;AAAA,MAC/D;AAEA,YAAM,eAAe,KAAK,SAAS,SAAS,eAAe;AAC3D,YAAM,iBAAiB,eAAoB,eAAQ,YAAY,IAAI;AAEnE,YAAM,YAAiB,YAAK,KAAK,WAAW,SAAS,EAAE;AACvD,UAAO,eAAW,SAAS,GAAG;AAC5B,QAAG,WAAO,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,MAC1C;AACA,YAAM,KAAK,cAAc,gBAAgB,SAAS;AAElD,YAAM,QAAwB;AAAA,QAC5B;AAAA,QACA,aAAa;AAAA,QACb,aAAa,KAAK,IAAI;AAAA,QACtB,QAAQ,QAAQ,eAAe,QAAQ,WAAW;AAAA,QAClD,YAAY,QAAQ,UAAU,CAAC;AAAA,QAC/B,QAAQ,EAAE,MAAM,OAAO,IAAI;AAAA,MAC7B;AAEA,WAAK,OAAO,IAAI,SAAS,IAAI,KAAK;AAClC,YAAM,KAAK,WAAW;AAEtB,UAAI,MAAM,WAAW,UAAU;AAC7B,cAAM,KAAK,gBAAgB,KAAK;AAAA,MAClC;AAEA,WAAK,kBAAkB,KAAK,KAAK;AACjC,aAAO,EAAE,SAAS,MAAM,MAAM;AAAA,IAChC,SAAS,OAAO;AACd,aAAO,EAAE,SAAS,OAAO,OAAO,OAAO,KAAK,EAAE;AAAA,IAChD,UAAE;AACA,UAAO,eAAW,OAAO,GAAG;AAC1B,QAAG,WAAO,SAAS,EAAE,WAAW,KAAK,CAAC;AAAA,MACxC;AAAA,IACF;AAAA,EACF;AAAA;AAAA,EAIA,MAAM,UAAU,SAAgE;AAC9E,QAAI;AACF,YAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,UAAI,CAAC,OAAO;AACV,eAAO,EAAE,SAAS,OAAO,OAAO,UAAU,OAAO,uBAAQ;AAAA,MAC3D;AAGA,UAAI,MAAM,gBAAgB,GAAG;AAC3B,eAAO,EAAE,SAAS,OAAO,OAAO,sBAAY,OAAO,2DAAc;AAAA,MACnE;AAEA,YAAM,KAAK,cAAc,aAAa,OAAO;AAC7C,WAAK,SAAS,OAAO,OAAO;AAE5B,UAAO,eAAW,MAAM,WAAW,GAAG;AACpC,QAAG,WAAO,MAAM,aAAa,EAAE,WAAW,KAAK,CAAC;AAAA,MAClD;AAEA,WAAK,OAAO,OAAO,OAAO;AAC1B,YAAM,KAAK,WAAW;AAEtB,WAAK,oBAAoB,KAAK,OAAO;AACrC,aAAO,EAAE,SAAS,KAAK;AAAA,IACzB,SAAS,OAAO;AACd,aAAO,EAAE,SAAS,OAAO,OAAO,OAAO,KAAK,EAAE;AAAA,IAChD;AAAA,EACF;AAAA,EAEA,MAAM,OAAO,SAAgE;AAC3E,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC;AAAO,aAAO,EAAE,SAAS,OAAO,OAAO,UAAU,OAAO,uBAAQ;AAErE,QAAI;AACF,YAAM,KAAK,gBAAgB,KAAK;AAChC,YAAM,KAAK,aAAa,SAAS,QAAQ;AACzC,aAAO,EAAE,SAAS,KAAK;AAAA,IACzB,SAAS,OAAO;AACd,YAAM,KAAK,aAAa,SAAS,SAAS,OAAO,KAAK,CAAC;AACvD,aAAO,EAAE,SAAS,OAAO,OAAO,OAAO,KAAK,EAAE;AAAA,IAChD;AAAA,EACF;AAAA,EAEA,MAAM,QAAQ,SAAgE;AAC5E,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC;AAAO,aAAO,EAAE,SAAS,OAAO,OAAO,UAAU,OAAO,uBAAQ;AAErE,QAAI;AACF,YAAM,KAAK,cAAc,aAAa,OAAO;AAC7C,WAAK,SAAS,OAAO,OAAO;AAC5B,YAAM,KAAK,aAAa,SAAS,UAAU;AAC3C,aAAO,EAAE,SAAS,KAAK;AAAA,IACzB,SAAS,OAAO;AACd,aAAO,EAAE,SAAS,OAAO,OAAO,OAAO,KAAK,EAAE;AAAA,IAChD;AAAA,EACF;AAAA,EAEA,MAAM,QAAQ,SAAiB,QAAoD;AACjF,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC;AAAO,aAAO,EAAE,SAAS,OAAO,OAAO,UAAU,OAAO,wBAAS,UAAU,EAAE;AAClF,QAAI,MAAM,WAAW;AAAU,aAAO,EAAE,SAAS,OAAO,OAAO,UAAU,OAAO,wBAAS,UAAU,EAAE;AACrG,WAAO,KAAK,SAAS,QAAQ,OAAO,MAAM;AAAA,EAC5C;AAAA,EAEA,MAAM,OAAO,SAAgE;AAC3E,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC;AAAO,aAAO,EAAE,SAAS,OAAO,OAAO,UAAU,OAAO,uBAAQ;AAErE,UAAM,SAAS,MAAM;AACrB,YAAQ,OAAO,MAAM;AAAA,MACnB,KAAK;AACH,eAAO,KAAK,eAAe,OAAO,KAAM,EAAE,QAAQ,OAAO,QAAQ,WAAW,MAAM,QAAQ,MAAM,WAAW,CAAC;AAAA,MAC9G,KAAK;AACH,eAAO,KAAK,eAAe,OAAO,KAAM,EAAE,WAAW,MAAM,QAAQ,MAAM,WAAW,CAAC;AAAA,MACvF,KAAK;AACH,eAAO,KAAK,iBAAiB,OAAO,WAAY,EAAE,WAAW,MAAM,QAAQ,MAAM,WAAW,CAAC;AAAA,MAC/F;AACE,eAAO,EAAE,SAAS,OAAO,OAAO,mDAAW;AAAA,IAC/C;AAAA,EACF;AAAA;AAAA,EAIA,qBAAuC;AACrC,WAAO,MAAM,KAAK,KAAK,OAAO,OAAO,CAAC;AAAA,EACxC;AAAA,EAEA,kBAAoC;AAClC,WAAO,MAAM,KAAK,KAAK,OAAO,OAAO,CAAC,EAAE,OAAO,OAAK,EAAE,WAAW,QAAQ;AAAA,EAC3E;AAAA,EAEA,SAAS,SAA6C;AACpD,WAAO,KAAK,OAAO,IAAI,OAAO;AAAA,EAChC;AAAA,EAEA,MAAM,iBAAiB,SAAgD;AACrE,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC;AAAO,aAAO;AACnB,UAAM,aAAa,MAAM,KAAK,OAAO,kBAAkB,MAAM,WAAW;AACxE,WAAO,WAAW,YAAY;AAAA,EAChC;AAAA,EAEA,MAAM,aAAa,SAAiB,QAA4D;AAC9F,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC;AAAO,aAAO,EAAE,SAAS,MAAM;AACpC,UAAM,aAAa,EAAE,GAAG,MAAM,YAAY,GAAG,OAAO;AACpD,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,KAAK,WAAW;AACtB,WAAO,EAAE,SAAS,KAAK;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,iBAAiB,SAAwC;AACvD,YAAQ,cAAc;AAAA,MACb,kBAAS,gBAAgB,6BAA6B,MAAM,KAAK,kBAAkB,CAAC;AAAA,MACpF,kBAAS,gBAAgB,4BAA4B,MAAM,KAAK,iBAAiB,CAAC;AAAA,MAClF,kBAAS,gBAAgB,4BAA4B,MAAM,KAAK,iBAAiB,CAAC;AAAA,IAC3F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAmC;AAC/C,UAAM,SAAS,MAAa,gBAAO;AAAA,MACjC;AAAA,QACE,EAAE,OAAO,wDAAc,aAAa,2DAAwB,OAAO,QAAQ;AAAA,QAC3E,EAAE,OAAO,+CAAe,aAAa,qCAAiB,OAAO,MAAM;AAAA,QACnE,EAAE,OAAO,+CAAe,aAAa,sDAAmB,OAAO,MAAM;AAAA,MACvE;AAAA,MACA,EAAE,aAAa,uCAAS;AAAA,IAC1B;AAEA,QAAI,CAAC;AAAQ;AAEb,YAAQ,OAAO,OAAO;AAAA,MACpB,KAAK,SAAS;AACZ,cAAM,OAAO,MAAa,gBAAO,eAAe;AAAA,UAC9C,kBAAkB;AAAA,UAAM,gBAAgB;AAAA,UACxC,WAAW;AAAA,QACb,CAAC;AACD,YAAI,6BAAO,IAAI;AACb,gBAAM,SAAS,MAAM,KAAK,iBAAiB,KAAK,CAAC,EAAE,MAAM;AACzD,eAAK,kBAAkB,MAAM;AAAA,QAC/B;AACA;AAAA,MACF;AAAA,MACA,KAAK,OAAO;AACV,cAAM,MAAM,MAAa,gBAAO,aAAa;AAAA,UAC3C,QAAQ;AAAA,UACR,aAAa;AAAA,QACf,CAAC;AACD,YAAI,KAAK;AACP,gBAAM,SAAS,MAAM,KAAK,eAAe,GAAG;AAC5C,eAAK,kBAAkB,MAAM;AAAA,QAC/B;AACA;AAAA,MACF;AAAA,MACA,KAAK,OAAO;AACV,cAAM,MAAM,MAAa,gBAAO,aAAa;AAAA,UAC3C,QAAQ;AAAA,UACR,aAAa;AAAA,QACf,CAAC;AACD,YAAI,KAAK;AACP,gBAAM,SAAS,MAAM,KAAK,eAAe,GAAG;AAC5C,eAAK,kBAAkB,MAAM;AAAA,QAC/B;AACA;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAkC;AAC9C,UAAM,SAAS,KAAK,mBAAmB;AACvC,QAAI,OAAO,WAAW,GAAG;AACvB,MAAO,gBAAO,uBAAuB,2CAAa;AAClD;AAAA,IACF;AAEA,UAAM,QAAQ,OAAO,IAAI,QAAM;AAAA,MAC7B,OAAO,GAAG,EAAE,WAAW,WAAW,WAAM,EAAE,WAAW,aAAa,iBAAO,QAAG,IAAI,EAAE,SAAS,IAAI;AAAA,MAC/F,aAAa,IAAI,EAAE,SAAS,OAAO,MAAM,EAAE,SAAS,WAAW;AAAA,MAC/D,QAAQ,OAAO,EAAE,SAAS,EAAE,oBAAU,EAAE,OAAO,IAAI,GAAG,EAAE,gBAAgB,IAAI,oBAAU,EAAE;AAAA,MACxF,OAAO;AAAA,IACT,EAAE;AAEF,UAAM,WAAW,MAAa,gBAAO,cAAc,OAAO;AAAA,MACxD,aAAa;AAAA,IACf,CAAC;AAED,QAAI,CAAC;AAAU;AAEf,UAAM,UAAU;AAAA,MACd,EAAE,OAAO,SAAS,MAAM,WAAW,WAAW,8BAAU,6BAAS,OAAO,SAAS;AAAA,MACjF,EAAE,OAAO,0BAAS,OAAO,SAAS;AAAA,MAClC,EAAE,OAAO,yCAAW,OAAO,OAAO;AAAA,IACpC;AAEA,QAAI,SAAS,MAAM,cAAc,GAAG;AAClC,cAAQ,KAAK,EAAE,OAAO,gCAAU,OAAO,YAAY,CAAC;AAAA,IACtD;AAEA,UAAM,SAAS,MAAa,gBAAO,cAAc,SAAS;AAAA,MACxD,aAAa,gBAAM,SAAS,MAAM,SAAS,IAAI;AAAA,IACjD,CAAC;AAED,QAAI,CAAC;AAAQ;AAEb,YAAQ,OAAO,OAAO;AAAA,MACpB,KAAK;AACH,YAAI,SAAS,MAAM,WAAW,UAAU;AACtC,gBAAM,KAAK,QAAQ,SAAS,MAAM,SAAS,EAAE;AAC7C,UAAO,gBAAO,uBAAuB,sBAAO,SAAS,MAAM,SAAS,IAAI,EAAE;AAAA,QAC5E,OAAO;AACL,gBAAM,KAAK,OAAO,SAAS,MAAM,SAAS,EAAE;AAC5C,UAAO,gBAAO,uBAAuB,sBAAO,SAAS,MAAM,SAAS,IAAI,EAAE;AAAA,QAC5E;AACA;AAAA,MACF,KAAK;AACH,cAAM,SAAS,MAAM,KAAK,OAAO,SAAS,MAAM,SAAS,EAAE;AAC3D,YAAI,OAAO,SAAS;AAClB,UAAO,gBAAO,uBAAuB,sBAAO,SAAS,MAAM,SAAS,IAAI,EAAE;AAAA,QAC5E,OAAO;AACL,UAAO,gBAAO,iBAAiB,6BAAS,OAAO,KAAK,EAAE;AAAA,QACxD;AACA;AAAA,MACF,KAAK;AACH,cAAM,KAAK,MAAM,KAAK,iBAAiB,SAAS,MAAM,SAAS,EAAE;AACjE,YAAI,IAAI;AACN,gBAAM,MAAM,MAAa,mBAAU,iBAAiB,EAAE,SAAS,GAAG,YAAY,UAAU,WAAW,CAAC;AACpG,gBAAa,gBAAO,iBAAiB,KAAK,EAAE,SAAS,KAAK,CAAC;AAAA,QAC7D;AACA;AAAA,MACF,KAAK;AACH,cAAM,UAAU,MAAa,gBAAO;AAAA,UAClC,kCAAS,SAAS,MAAM,SAAS,IAAI;AAAA,UAAK,EAAE,OAAO,KAAK;AAAA,UAAG;AAAA,QAC7D;AACA,YAAI,YAAY,4BAAQ;AACtB,gBAAM,KAAK,UAAU,SAAS,MAAM,SAAS,EAAE;AAC/C,UAAO,gBAAO,uBAAuB,sBAAO,SAAS,MAAM,SAAS,IAAI,EAAE;AAAA,QAC5E;AACA;AAAA,IACJ;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAkC;AAC9C,UAAM,OAAO,MAAa,gBAAO,aAAa;AAAA,MAC5C,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,eAAe,OAAK,2BAA2B,KAAK,CAAC,IAAI,OAAO;AAAA,IAClE,CAAC;AAED,QAAI,CAAC;AAAM;AAEX,UAAM,OAAO,MAAa,gBAAO,eAAe;AAAA,MAC9C,kBAAkB;AAAA,MAAM,gBAAgB;AAAA,MACxC,WAAW;AAAA,IACb,CAAC;AAED,QAAI,EAAC,6BAAO;AAAI;AAEhB,UAAM,YAAiB,YAAK,KAAK,CAAC,EAAE,QAAQ,IAAI;AAEhD,QAAI,cAAmB,YAAK,KAAK,QAAQ,eAAe,QAAQ,aAAa,aAAa,eAAe;AACzG,QAAI,CAAI,eAAW,WAAW,GAAG;AAE/B,oBAAmB,YAAK,KAAK,QAAQ,eAAe,OAAO,aAAa,UAAU,aAAa,eAAe;AAAA,IAChH;AAEA,QAAI;AACF,YAAM,KAAK,cAAc,aAAa,SAAS;AAG/C,YAAM,eAAoB,YAAK,WAAW,eAAe;AACzD,YAAM,WAAW,KAAK,MAAS,iBAAa,cAAc,OAAO,CAAC;AAClE,eAAS,KAAK;AACd,eAAS,OAAO;AAChB,eAAS,cAAc,4BAAa,IAAI;AACxC,MAAG,kBAAc,cAAc,KAAK,UAAU,UAAU,MAAM,CAAC,CAAC;AAGhE,YAAM,MAAM,MAAa,mBAAU,iBAAiB,YAAY;AAChE,YAAa,gBAAO,iBAAiB,GAAG;AAExC,MAAO,gBAAO;AAAA,QACZ,UAAU,IAAI,8BAAU,SAAS;AAAA,QACjC;AAAA,MACF,EAAE,KAAK,OAAM,WAAU;AACrB,YAAI,WAAW,kCAAS;AACtB,gBAAM,SAAS,MAAM,KAAK,iBAAiB,SAAS;AACpD,eAAK,kBAAkB,MAAM;AAAA,QAC/B;AAAA,MACF,CAAC;AAAA,IACH,SAAS,OAAO;AACd,MAAO,gBAAO,iBAAiB,6BAAS,KAAK,EAAE;AAAA,IACjD;AAAA,EACF;AAAA,EAEQ,kBAAkB,QAA4E;AACpG,QAAI,OAAO,SAAS;AAClB,MAAO,gBAAO,uBAAuB,iBAAY,OAAO,MAAO,SAAS,IAAI,4BAAQ;AAAA,IACtF,OAAO;AACL,MAAO,gBAAO,iBAAiB,oCAAW,OAAO,KAAK,EAAE;AAAA,IAC1D;AAAA,EACF;AAAA;AAAA,EAIA,MAAc,gBAAgB,OAAsC;AAClE,UAAM,SAAS,KAAK,cAAc,aAAa,KAAK;AACpD,UAAM,OAAO,sBAAsB;AACnC,YAAQ,IAAI,2CAA4B,MAAM,SAAS,EAAE,EAAE;AAAA,EAC7D;AAAA,EAEA,MAAc,aAAa,SAAiB,QAAqB,OAA+B;AAC9F,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,OAAO;AACT,YAAM,SAAS;AACf,YAAM,QAAQ;AACd,YAAM,YAAY,KAAK,IAAI;AAC3B,YAAM,KAAK,WAAW;AACtB,WAAK,sBAAsB,KAAK,EAAE,IAAI,SAAS,OAAO,CAAC;AAAA,IACzD;AAAA,EACF;AAAA,EAEA,MAAc,cAAc,KAAa,MAA6B;AACpE,QAAI,CAAI,eAAW,IAAI,GAAG;AACxB,MAAG,cAAU,MAAM,EAAE,WAAW,KAAK,CAAC;AAAA,IACxC;AACA,UAAM,UAAa,gBAAY,KAAK,EAAE,eAAe,KAAK,CAAC;AAC3D,eAAW,SAAS,SAAS;AAC3B,YAAM,UAAe,YAAK,KAAK,MAAM,IAAI;AACzC,YAAM,WAAgB,YAAK,MAAM,MAAM,IAAI;AAC3C,UAAI,MAAM,YAAY,GAAG;AACvB,cAAM,KAAK,cAAc,SAAS,QAAQ;AAAA,MAC5C,OAAO;AACL,QAAG,iBAAa,SAAS,QAAQ;AAAA,MACnC;AAAA,IACF;AAAA,EACF;AAAA,EAEQ,SAAS,KAAa,UAAiC;AAC7D,UAAM,UAAa,gBAAY,KAAK,EAAE,eAAe,KAAK,CAAC;AAC3D,eAAW,SAAS,SAAS;AAC3B,YAAM,WAAgB,YAAK,KAAK,MAAM,IAAI;AAC1C,UAAI,MAAM,OAAO,KAAK,MAAM,SAAS;AAAU,eAAO;AACtD,UAAI,MAAM,YAAY,KAAK,CAAC,MAAM,KAAK,WAAW,GAAG,GAAG;AACtD,cAAM,QAAQ,KAAK,SAAS,UAAU,QAAQ;AAC9C,YAAI;AAAO,iBAAO;AAAA,MACpB;AAAA,IACF;AACA,WAAO;AAAA,EACT;AACF;AAppBa,cACI,WAAgC;AAD1C,IAAM,eAAN;;;AnByBA,IAAM,mBAAN,MAA6D;AAAA,EAyClE,YACmB,eACA,UACjB;AAFiB;AACA;AArBnB,SAAQ,2BAA2C;AACnD,SAAQ,kBAA4B,CAAC;AACrC,SAAQ,gBAAgB;AAexB;AAAA,SAAQ,gCAAgC;AAOtC,SAAK,iBAAiB,IAAI,cAAc,QAAQ;AAChD,SAAK,kBAAkB,IAAI,eAAe,QAAQ;AAClD,SAAK,iBAAiB,IAAI,cAAc;AACxC,SAAK,oBAAoB,IAAI,iBAAiB,QAAQ;AACtD,SAAK,iBAAiB,IAAI,cAAc,QAAQ;AAChD,SAAK,kBAAkB,IAAI,eAAe,QAAQ;AAClD,SAAK,mBAAmB,IAAI,wBAAwB;AACpD,SAAK,eAAe,IAAI,iBAAiB;AAIzC,SAAK,gBAAgB;AACrB,SAAK,iBAAiB,cAAc,YAAY,QAAQ;AAGxD,SAAK,oBAAoB,IAAI,iBAAiB,CAAC,QAAQ,KAAK,aAAa,GAAG,CAAC;AAAA,EAC/E;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAkC;AACxC,WAAO;AAAA,MACL,cAAc,KAAK;AAAA,MACnB,kBAAkB,KAAK;AAAA,MACvB,MAAM,KAAK;AAAA,MAEX,aAAa,KAAK;AAAA,MAClB,eAAe,KAAK;AAAA,MACpB,gBAAgB,KAAK;AAAA,MACrB,kBAAkB,KAAK;AAAA,MACvB,eAAe,KAAK;AAAA,MACpB,gBAAgB,KAAK;AAAA,MACrB,iBAAiB,KAAK;AAAA,MACtB,aAAa,KAAK;AAAA,MAClB,eAAe,KAAK;AAAA,MAEpB,YAAY,KAAK,kBAAkB,cAAc;AAAA,MACjD,yBAAyB,KAAK;AAAA,MAC9B,gBAAgB,KAAK;AAAA,MACrB,cAAc,KAAK;AAAA,MACnB,gBAAgB,KAAK;AAAA,MACrB,sBAAsB,KAAK;AAAA,MAC3B,mBAAmB,KAAK;AAAA,MAExB,aAAa,CAAC,QAAQ,KAAK,aAAa,GAAG;AAAA,MAC3C,kBAAkB,CAAC,MAAM,QAAQ,QAAQ,KAAK,kBAAkB,aAAa,MAAM,QAAQ,GAAG;AAAA,MAC9F,eAAe,CAAC,SAAS,KAAK,kBAAkB,UAAU,IAAI;AAAA,MAC9D,sBAAsB,CAAC,eAAe,KAAK,sBAAsB,UAAU;AAAA,MAC3E,mBAAmB,MAAM,KAAK,mBAAmB;AAAA,IACnD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAA4B;AAClC,UAAM,MAAM,KAAK,eAAe;AAGhC,UAAM,uBAAuB,OAAwB;AAAA,MACnD,GAAG;AAAA,MACH,MAAM,KAAK;AAAA,MACX,aAAa,KAAK;AAAA,MAClB,yBAAyB,KAAK;AAAA,MAC9B,gBAAgB,KAAK;AAAA,MACrB,cAAc,KAAK;AAAA,MACnB,gBAAgB,KAAK;AAAA,MACrB,sBAAsB,KAAK;AAAA,MAC3B,mBAAmB,KAAK;AAAA,IAC1B;AAGA,UAAM,aAAa,IAAI,MAAM,CAAC,GAAsB;AAAA,MAClD,KAAK,CAAC,GAAG,SAAS;AAChB,cAAM,aAAa,qBAAqB;AACxC,cAAM,QAAS,WAAmB,IAAI;AAGtC,YAAI,SAAS,2BAA2B;AACtC,iBAAO,KAAK;AAAA,QACd;AACA,YAAI,SAAS,gBAAgB;AAC3B,iBAAO,KAAK;AAAA,QACd;AAEA,eAAO;AAAA,MACT;AAAA,MACA,KAAK,CAAC,GAAG,MAAM,UAAU;AAEvB,YAAI,SAAS,2BAA2B;AACtC,eAAK,2BAA2B;AAChC,iBAAO;AAAA,QACT;AACA,YAAI,SAAS,gBAAgB;AAC3B,eAAK,gBAAgB;AACrB,iBAAO;AAAA,QACT;AACA,YAAI,SAAS,kBAAkB;AAC7B,eAAK,kBAAkB;AACvB,iBAAO;AAAA,QACT;AACA,YAAI,SAAS,wBAAwB;AACnC,eAAK,wBAAwB;AAC7B,iBAAO;AAAA,QACT;AACA,YAAI,SAAS,qBAAqB;AAChC,eAAK,qBAAqB;AAC1B,iBAAO;AAAA,QACT;AACA,YAAI,SAAS,eAAe;AAC1B,eAAK,eAAe;AACpB,iBAAO;AAAA,QACT;AACA,eAAO;AAAA,MACT;AAAA,IACF,CAAC;AAED,SAAK,kBAAkB,IAAI,eAAe,UAAU;AACpD,SAAK,sBAAsB,IAAI,mBAAmB,UAAU;AAC5D,SAAK,kBAAkB,IAAI,eAAe,UAAU;AACpD,SAAK,eAAe,IAAI,YAAY,UAAU;AAC9C,SAAK,kBAAkB,IAAI,eAAe,UAAU;AACpD,SAAK,iBAAiB,IAAI,cAAc,UAAU;AAClD,SAAK,cAAc,IAAI,WAAW,UAAU;AAG5C,QAAI;AACF,YAAM,WAAW,KAAK,YAAY,YAAY;AAC9C,YAAM,WAAW,KAAK,YAAY,YAAY;AAC9C,WAAK,gBAAgB,aAAa,YAAY,KAAK,UAAU,UAAU,QAAQ;AAE/E,WAAK,cAAc,WAAW,EAAE,KAAK,MAAM;AACzC,gBAAQ,IAAI,+DAAsC;AAAA,MACpD,CAAC,EAAE,MAAM,OAAK,QAAQ,MAAM,kDAAyB,CAAC,CAAC;AACvD,WAAK,cAAc,iBAAiB,KAAK,QAAQ;AAAA,IACnD,SAAS,KAAK;AACZ,cAAQ,MAAM,kEAAyC,GAAG;AAAA,IAC5D;AAAA,EACF;AAAA,EAEA,MAAa,mBACX,aACA,UACA,QACe;AACf,SAAK,QAAQ;AAEb,gBAAY,QAAQ,UAAU;AAAA,MAC5B,eAAe;AAAA,MACf,oBAAoB,CAAC,KAAK,aAAa;AAAA,IACzC;AAEA,gBAAY,QAAQ;AACpB,gBAAY,QAAQ,OAAO,KAAK,mBAAmB,YAAY,OAAO;AAGtE,UAAM,SAAS,MAAM,KAAK,eAAe,mBAAmB;AAC5D,QAAI,OAAO,QAAQ;AACjB,WAAK,eAAe,IAAI,YAAY,MAAM;AAAA,IAC5C;AAGA,SAAK,oBAAoB;AAGzB,QAAI,CAAC,KAAK,gBAAgB,gBAAgB;AACxC,YAAM,KAAK,gBAAgB,oBAAoB;AAAA,IACjD;AACA,QAAI,CAAC,KAAK,gBAAgB,gBAAgB;AACxC,WAAK,gBAAgB,cAAc;AAAA,IACrC;AAGA,gBAAY,QAAQ,oBAAoB,OAAO,SAA+C;AAC5F,YAAM,KAAK,eAAe,IAAI;AAAA,IAChC,CAAC;AAGD,QAAI,CAAC,KAAK,+BAA+B;AACvC,WAAK,gCAAgC;AACrC,kBAAY,sBAAsB,YAAY;AAC5C,YAAI,YAAY,SAAS;AACvB,eAAK,gBAAgB,8BAA8B;AAAA,QACrD;AAAA,MACF,CAAC;AAAA,IACH;AAGA,SAAK,gBAAgB,8BAA8B;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAe,MAA0B;AAIrD,QAAI,MAAM,KAAK,gBAAgB,OAAO,IAAI;AAAG;AAG7C,QAAI,MAAM,KAAK,eAAe,OAAO,IAAI;AAAG;AAG5C,QAAI,MAAM,KAAK,YAAY,OAAO,IAAI;AAAG;AAGzC,QAAI,MAAM,KAAK,gBAAgB,OAAO,IAAI;AAAG;AAG7C,QAAI,MAAM,KAAK,aAAa,OAAO,IAAI;AAAG;AAG1C,QAAI,KAAK,SAAS,eAAe;AAC/B,YAAM,KAAK,mBAAmB,KAAK,SAAS,KAAK,WAAW;AAC5D;AAAA,IACF;AACA,QAAI,MAAM,KAAK,oBAAoB,OAAO,IAAI;AAAG;AAGjD,QAAI,KAAK,SAAS,kBAAkB;AAClC,YAAM,KAAK,gBAAgB,KAAK,MAAM,KAAK,UAAU,KAAK,QAAQ;AAClE;AAAA,IACF;AACA,QAAI,KAAK,SAAS,cAAc;AAC9B,YAAM,KAAK,oBAAoB,KAAK,IAAI;AACxC;AAAA,IACF;AACA,QAAI,KAAK,SAAS,eAAe;AAC/B,YAAM,KAAK,qBAAqB,KAAK,UAAU,KAAK,WAAW;AAC/D;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,gBAAgB;AAChC,YAAM,KAAK,oBAAoB,KAAK,SAAS,KAAK,MAAM;AACxD;AAAA,IACF;AACA,QAAI,KAAK,SAAS,sBAAsB;AACtC,YAAM,KAAK,oBAAoB;AAC/B;AAAA,IACF;AACA,QAAI,KAAK,SAAS,eAAe;AAC/B,WAAK,aAAa,KAAK,OAAO;AAC9B;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,gBAAgB;AAChC,YAAM,KAAK,mBAAmB,KAAK,OAAO;AAC1C;AAAA,IACF;AACA,QAAI,KAAK,SAAS,iBAAiB;AACjC,YAAM,KAAK,oBAAoB,KAAK,OAAO;AAC3C;AAAA,IACF;AACA,QAAI,KAAK,SAAS,mBAAmB;AACnC,YAAM,KAAK,sBAAsB,KAAK,OAAO;AAC7C;AAAA,IACF;AACA,QAAI,KAAK,SAAS,wBAAwB;AACxC,YAAM,KAAK,2BAA2B,KAAK,GAAG;AAC9C;AAAA,IACF;AACA,QAAI,KAAK,SAAS,2BAA2B;AAC3C,MAAO,kBAAS,eAAe,2BAA2B;AAC1D;AAAA,IACF;AACA,QAAI,KAAK,SAAS,0BAA0B;AAC1C,MAAO,kBAAS,eAAe,0BAA0B;AACzD;AAAA,IACF;AAEA,YAAQ,KAAK,8CAA8C,KAAK,IAAI;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAc,mBAAmB,SAAiB,aAAoC;AACpF,QAAI,EAAC,mCAAS,YAAW,CAAC,eAAe,YAAY,WAAW,IAAI;AAClE;AAAA,IACF;AAGA,QAAI,mCAAS,QAAQ;AACnB,WAAK,gBAAgB,KAAK,OAAO;AACjC,UAAI,KAAK,gBAAgB,SAAS,KAAK;AACrC,aAAK,gBAAgB,MAAM;AAAA,MAC7B;AACA,WAAK,gBAAgB;AAAA,IACvB;AAKA,QAAI,UAAU,aAAa,OAAO,GAAG;AACnC,YAAM,UAAU,MAAM,KAAK,YAAY,iBAAiB,OAAO;AAC/D,UAAI;AAAS;AAAA,IACf;AAGA,QAAI,KAAK,gBAAgB,OAAO,GAAG;AACjC,YAAM,KAAK,oBAAoB,OAAO;AACtC;AAAA,IACF;AAGA,UAAM,SAAS,KAAK,aAAa,MAAM,OAAO;AAC9C,QAAI,OAAO,SAAS,WAAW;AAC7B,YAAM,gBAAgB,KAAK,eAAe,MAAM,OAAO;AACvD,UAAI,eAAe;AACjB,cAAM,KAAK,gBAAgB;AAAA,UACzB;AAAA,UACA,KAAK;AAAA,UACL,KAAK;AAAA,UACL,KAAK;AAAA,QACP;AACA;AAAA,MACF;AAAA,IACF;AAKA,UAAM,KAAK,oBAAoB,kBAAkB,SAAS,WAAW;AAAA,EACvE;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,OAAwB;AAC9C,WAAO,MAAM,KAAK,EAAE,YAAY,EAAE,WAAW,QAAQ;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoB,OAA8B;AAC9D,UAAM,UAAU,MAAM,KAAK;AAG3B,UAAM,QAAQ,QAAQ,MAAM,qCAAqC;AAGjE,UAAM,cAAuB;AAAA,MAC3B,IAAI,WAAW;AAAA,MACf,MAAM;AAAA,MACN,SAAS;AAAA,MACT,WAAW,KAAK,IAAI;AAAA,IACtB;AACA,UAAM,KAAK,gBAAgB,WAAW,WAAW;AACjD,SAAK,aAAa,EAAE,MAAM,cAAc,SAAS,YAAY,CAAC;AAE9D,QAAI,CAAC,OAAO;AAEV,WAAK,aAAa;AAAA,QAChB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS,KAAK,kBAAkB;AAAA,UAChC,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF,CAAC;AACD;AAAA,IACF;AAEA,UAAM,UAAU,MAAM,CAAC;AACvB,UAAM,SAAS,MAAM,CAAC;AAEtB,QAAI,CAAC,SAAS;AAEZ,WAAK,aAAa;AAAA,QAChB,MAAM;AAAA,QACN,SAAS;AAAA,UACP,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS,KAAK,kBAAkB;AAAA,UAChC,WAAW,KAAK,IAAI;AAAA,QACtB;AAAA,MACF,CAAC;AACD;AAAA,IACF;AAGA,QAAI,QAAQ,YAAY,MAAM,QAAQ;AACpC,YAAM,KAAK,eAAe;AAC1B;AAAA,IACF;AAGA,UAAM,KAAK,oBAAoB,SAAS,SAAS,EAAE,OAAO,OAAO,IAAI,MAAS;AAAA,EAChF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoB,SAAiB,QAA6C;AAxflG;AAyfI,SAAK,kBAAkB,aAAa,SAAS,WAAW,6BAAS,OAAO,EAAE;AAG1E,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN;AAAA,MACA;AAAA,IACF,CAAC;AAED,UAAM,YAAY,KAAK,IAAI;AAE3B,QAAI;AAEF,UAAI,CAAC,KAAK,eAAe;AACvB,cAAM,IAAI,MAAM,6EAA2B;AAAA,MAC7C;AAEA,YAAM,QAAQ,KAAK,cAAc,SAAS,OAAO;AAEjD,UAAI,CAAC,OAAO;AAEV,cAAMC,YAAW,KAAK,IAAI,IAAI;AAC9B,cAAM,WAAoB;AAAA,UACxB,IAAI,WAAW;AAAA,UACf,MAAM;AAAA,UACN,SAAS,+BAAW,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,UAC3B,WAAW,KAAK,IAAI;AAAA,QACtB;AAEA,cAAM,KAAK,gBAAgB,WAAW,QAAQ;AAC9C,aAAK,aAAa,EAAE,MAAM,cAAc,SAAS,SAAS,CAAC;AAC3D,aAAK,kBAAkB,aAAa,SAAS,SAAS,gBAAM,OAAO,qBAAM;AACzE;AAAA,MACF;AAEA,YAAM,SAAgB,gBAAO;AAC7B,YAAM,mBAAmB;AAAA,QACvB,gBAAe,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAAA,QAC3D,YAAY,iCAAQ,SAAS;AAAA,QAC7B,eAAc,iCAAQ,UAAU,WAAU,SAAY,iCAAQ,SAAS,QAAQ,OAAO;AAAA,MACxF;AAGA,YAAM,SAAS,MAAM,KAAK,eAAe,QAAQ,OAAO,QAAQ,gBAAgB;AAChF,YAAM,WAAW,KAAK,IAAI,IAAI;AAG9B,YAAM,kBAAwC;AAAA,QAC5C,IAAI,WAAW;AAAA,QACf;AAAA,QACA,WAAW,MAAM,SAAS;AAAA,QAC1B,SAAS,OAAO;AAAA,QAChB,QAAQ,OAAO;AAAA,QACf,OAAO,OAAO;AAAA,QACd;AAAA,QACA,MAAM,OAAO,QAAQ,CAAC;AAAA,QACtB,UAAU,OAAO,YAAY,CAAC;AAAA,MAChC;AAEA,WAAK,aAAa;AAAA,QAChB,MAAM;AAAA,QACN,QAAQ;AAAA,MACV,CAAC;AAGD,UAAI;AACJ,UAAI,OAAO,SAAS;AAClB,cAAM,YAAY,OAAO,UAAU,OAC9B,OAAO,OAAO,WAAW,WAAW,OAAO,SAAS,KAAK,UAAU,OAAO,QAAQ,MAAM,CAAC,IAC1F;AACJ,cAAM,YAAY,UAAU,SAAS,MAAO,UAAU,MAAM,GAAG,GAAI,IAAI,8BAAe;AAEtF,sBAAc,YAAO,MAAM,SAAS,IAAI,gCAAY,QAAQ;AAAA;AAAA;AAC5D,uBAAe;AAAA,EAAW,SAAS;AAAA;AAGnC,YAAI,OAAO,QAAQ,OAAO,KAAK,SAAS,GAAG;AACzC,yBAAe;AAAA;AAAA;AAAA,+CAAoC,OAAO,KAAK,MAAM;AAAA;AAAA;AACrE,qBAAW,OAAO,OAAO,MAAM;AAC7B,kBAAM,OAAO,IAAI,UAAU,UAAU,WAAM,IAAI,UAAU,SAAS,iBAAO;AACzE,2BAAe,GAAG,IAAI,IAAI,IAAI,OAAO;AAAA;AAAA,UACvC;AACA,yBAAe;AAAA;AAAA,QACjB;AAAA,MACF,OAAO;AACL,sBAAc,YAAO,MAAM,SAAS,IAAI,gCAAY,QAAQ;AAAA;AAAA,EAAU,OAAO,KAAK;AAAA,MACpF;AAEA,YAAM,gBAAyB;AAAA,QAC7B,IAAI,WAAW;AAAA,QACf,MAAM;AAAA,QACN,SAAS;AAAA,QACT,WAAW,KAAK,IAAI;AAAA,QACpB,UAAU;AAAA,UACR,MAAM;AAAA,UACN;AAAA,UACA,UAAU,gBAAgB;AAAA,QAC5B;AAAA,MACF;AAEA,YAAM,KAAK,gBAAgB,WAAW,aAAa;AACnD,WAAK,aAAa,EAAE,MAAM,cAAc,SAAS,cAAc,CAAC;AAEhE,WAAK,kBAAkB;AAAA,QAAa;AAAA,QAAS,OAAO,UAAU,YAAY;AAAA,QACxE,OAAO,UAAU,yCAAW,OAAO,SAAS;AAAA,MAAM;AAAA,IAEtD,SAAS,OAAO;AACd,YAAM,eAAe,iBAAiB,QAAQ,MAAM,UAAU;AAC9D,YAAM,WAAW,KAAK,IAAI,IAAI;AAE9B,WAAK,aAAa;AAAA,QAChB,MAAM;AAAA,QACN;AAAA,QACA,OAAO;AAAA,QACP;AAAA,MACF,CAAC;AAED,YAAM,WAAoB;AAAA,QACxB,IAAI,WAAW;AAAA,QACf,MAAM;AAAA,QACN,SAAS,yBAAU,OAAO,gCAAY,QAAQ,QAAQ,YAAY;AAAA,QAClE,WAAW,KAAK,IAAI;AAAA,MACtB;AAEA,YAAM,KAAK,gBAAgB,WAAW,QAAQ;AAC9C,WAAK,aAAa,EAAE,MAAM,cAAc,SAAS,SAAS,CAAC;AAE3D,WAAK,kBAAkB,aAAa,SAAS,SAAS,YAAY;AAAA,IACpE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAqC;AACjD,UAAM,YAAgH,CAAC;AAEvH,QAAI,KAAK,eAAe;AACtB,YAAM,YAAY,KAAK,cAAc,mBAAmB;AACxD,iBAAW,KAAK,WAAW;AACzB,kBAAU,KAAK;AAAA,UACb,IAAI,EAAE,SAAS;AAAA,UACf,MAAM,EAAE,SAAS;AAAA,UACjB,MAAM,EAAE,SAAS;AAAA,UACjB,MAAM,EAAE,gBAAgB,IAAI,YAAY;AAAA,UACxC,SAAS,EAAE,SAAS;AAAA,UACpB,QAAQ,EAAE;AAAA,QACZ,CAAC;AAAA,MACH;AAAA,IACF;AAEA,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,QAAQ;AAAA,IACV,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,SAAuB;AAC1C,UAAM,YAAY,KAAK,eAAe,OAAO,OAAO;AAEpD,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN;AAAA,MACA,SAAS;AAAA,IACX,CAAC;AAED,QAAI,WAAW;AACb,WAAK,kBAAkB,aAAa,SAAS,QAAQ,oBAAK;AAAA,IAC5D;AAAA,EACF;AAAA;AAAA,EAIA,MAAc,mBAAmB,SAAgC;AAC/D,QAAI,CAAC,KAAK;AAAe;AACzB,UAAM,SAAS,MAAM,KAAK,cAAc,OAAO,OAAO;AACtD,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,WAAW;AAAA,MACX;AAAA,MACA,SAAS,OAAO;AAAA,MAChB,OAAO,OAAO;AAAA,IAChB,CAAC;AACD,QAAI,OAAO,SAAS;AAClB,YAAM,KAAK,oBAAoB;AAAA,IACjC;AAAA,EACF;AAAA,EAEA,MAAc,oBAAoB,SAAgC;AAChE,QAAI,CAAC,KAAK;AAAe;AACzB,UAAM,SAAS,MAAM,KAAK,cAAc,QAAQ,OAAO;AACvD,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,WAAW;AAAA,MACX;AAAA,MACA,SAAS,OAAO;AAAA,MAChB,OAAO,OAAO;AAAA,IAChB,CAAC;AACD,QAAI,OAAO,SAAS;AAClB,YAAM,KAAK,oBAAoB;AAAA,IACjC;AAAA,EACF;AAAA,EAEA,MAAc,sBAAsB,SAAgC;AAClE,QAAI,CAAC,KAAK;AAAe;AACzB,UAAM,SAAS,MAAM,KAAK,cAAc,UAAU,OAAO;AACzD,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,WAAW;AAAA,MACX;AAAA,MACA,SAAS,OAAO;AAAA,MAChB,OAAO,OAAO;AAAA,IAChB,CAAC;AACD,QAAI,OAAO,SAAS;AAClB,YAAM,KAAK,oBAAoB;AAAA,IACjC;AAAA,EACF;AAAA,EAEA,MAAc,2BAA2B,KAA4B;AACnE,QAAI,CAAC,KAAK;AAAe;AACzB,SAAK,aAAa,EAAE,MAAM,yBAAyB,QAAQ,eAAe,IAAI,CAAC;AAC/E,UAAM,SAAS,MAAM,KAAK,cAAc,eAAe,GAAG;AAC1D,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,WAAW;AAAA,MACX,SAAS,OAAO;AAAA,MAChB,OAAO,OAAO;AAAA,MACd,OAAO,OAAO,QAAQ;AAAA,QACpB,IAAI,OAAO,MAAM,SAAS;AAAA,QAC1B,MAAM,OAAO,MAAM,SAAS;AAAA,QAC5B,SAAS,OAAO,MAAM,SAAS;AAAA,MACjC,IAAI;AAAA,IACN,CAAC;AACD,QAAI,OAAO,SAAS;AAClB,YAAM,KAAK,oBAAoB;AAAA,IACjC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAA4B;AAClC,QAAI,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeX,QAAI,KAAK,eAAe;AACtB,YAAM,SAAS,KAAK,cAAc,mBAAmB;AACrD,iBAAW,KAAK,QAAQ;AACtB,cAAM,OAAO,EAAE,gBAAgB,IAAI,cAAO;AAC1C,gBAAQ,OAAO,EAAE,SAAS,EAAE,QAAQ,IAAI,IAAI,EAAE,SAAS,IAAI,MAAM,EAAE,SAAS,WAAW;AAAA;AAAA,MACzF;AAAA,IACF;AAEA,QAAI,CAAC,KAAK,iBAAiB,KAAK,cAAc,mBAAmB,EAAE,WAAW,GAAG;AAC/E,cAAQ;AAAA,IACV;AAEA,YAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYR,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAgC;AAC5C,UAAM,kBAAkB,KAAK,gBAAgB,KAAK,cAAc,mBAAmB,IAAI,CAAC;AAExF,QAAI,UAAU;AAGd,UAAM,WAAW,gBAAgB,OAAO,OAAK,EAAE,gBAAgB,CAAC;AAChE,UAAM,gBAAgB,gBAAgB,OAAO,OAAK,EAAE,cAAc,CAAC;AAEnE,QAAI,SAAS,SAAS,GAAG;AACvB,iBAAW;AACX,iBAAW;AACX,iBAAW;AACX,iBAAW,SAAS,UAAU;AAC5B,cAAM,aAAa,MAAM,WAAW,WAAW,WAAM,MAAM,WAAW,aAAa,iBAAO;AAC1F,mBAAW,OAAO,MAAM,SAAS,EAAE,QAAQ,MAAM,SAAS,IAAI,MAAM,MAAM,SAAS,WAAW,MAAM,UAAU;AAAA;AAAA,MAChH;AAAA,IACF,OAAO;AACL,iBAAW;AAAA,IACb;AAEA,QAAI,cAAc,SAAS,GAAG;AAC5B,iBAAW;AACX,iBAAW;AACX,iBAAW;AACX,iBAAW,SAAS,eAAe;AACjC,cAAM,aAAa,MAAM,WAAW,WAAW,WAAM,MAAM,WAAW,aAAa,iBAAO;AAC1F,mBAAW,OAAO,MAAM,SAAS,EAAE,QAAQ,MAAM,SAAS,IAAI,MAAM,MAAM,SAAS,OAAO,MAAM,UAAU;AAAA;AAAA,MAC5G;AAAA,IACF;AAEA,eAAW;AACX,eAAW;AACX,eAAW;AAEX,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,SAAS;AAAA,QACP,IAAI,WAAW;AAAA,QACf,MAAM;AAAA,QACN;AAAA,QACA,WAAW,KAAK,IAAI;AAAA,MACtB;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAkD;AAC9D,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,SAAS,MAAM,KAAK,eAAe,mBAAmB;AAC5D,UAAI,CAAC,OAAO,QAAQ;AAClB,eAAO;AAAA,MACT;AACA,WAAK,eAAe,IAAI,YAAY,MAAM;AAAA,IAC5C;AACA,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,gBAAgB,MAAc,UAAkB,UAAiC;AA11BjG;AA21BI,QAAI;AACF,YAAM,iBAAgB,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAClE,UAAI,CAAC,eAAe;AAClB,QAAO,gBAAO,iBAAiB,4CAAS;AACxC;AAAA,MACF;AAEA,YAAM,UAAU,MAAa,gBAAO,eAAe;AAAA,QACjD,YAAmB,aAAI,KAAK,GAAG,aAAa,IAAI,QAAQ,EAAE;AAAA,QAC1D,SAAS,EAAE,aAAa,CAAC,GAAG,EAAE;AAAA,MAChC,CAAC;AAED,UAAI,SAAS;AACX,cAAMC,OAAK,QAAQ,IAAI;AACvB,QAAAA,KAAG,cAAc,QAAQ,QAAQ,MAAM,OAAO;AAE9C,cAAM,WAAW,MAAa,mBAAU,iBAAiB,OAAO;AAChE,cAAa,gBAAO,iBAAiB,QAAQ;AAE7C,QAAO,gBAAO,uBAAuB,mCAAU,QAAQ,MAAM,EAAE;AAAA,MACjE;AAAA,IACF,SAAS,OAAO;AACd,MAAO,gBAAO,iBAAiB,6BAAS,iBAAiB,QAAQ,MAAM,UAAU,0BAAM,EAAE;AAAA,IAC3F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoB,MAA6B;AAC7D,UAAM,SAAgB,gBAAO;AAC7B,QAAI,CAAC,QAAQ;AACX,MAAO,gBAAO,mBAAmB,kDAAU;AAC3C;AAAA,IACF;AAEA,UAAM,OAAO,KAAK,iBAAe;AAC/B,kBAAY,OAAO,OAAO,UAAU,QAAQ,IAAI;AAAA,IAClD,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAqB,UAAkB,aAAoC;AACvF,UAAM,SAAgB,gBAAO;AAC7B,QAAI,CAAC,QAAQ;AACX,MAAO,gBAAO,mBAAmB,kDAAU;AAC3C;AAAA,IACF;AAEA,UAAM,WAAW,OAAO;AACxB,UAAM,WAAW,SAAS,QAAQ;AAClC,UAAM,QAAQ,SAAS,QAAQ,QAAQ;AAEvC,QAAI,UAAU,IAAI;AAChB,MAAO,gBAAO,mBAAmB,wDAAW;AAC5C;AAAA,IACF;AAEA,UAAM,WAAW,SAAS,WAAW,KAAK;AAC1C,UAAM,SAAS,SAAS,WAAW,QAAQ,SAAS,MAAM;AAC1D,UAAM,QAAQ,IAAW,eAAM,UAAU,MAAM;AAE/C,UAAM,OAAO,KAAK,iBAAe;AAC/B,kBAAY,QAAQ,OAAO,WAAW;AAAA,IACxC,CAAC;AAED,IAAO,gBAAO,uBAAuB,gCAAO;AAAA,EAC9C;AAAA,EAEQ,sBAAsB,YAA2B;AACvD,IAAO,kBAAS,eAAe,cAAc,4BAA4B,UAAU;AAAA,EACrF;AAAA,EAEQ,aAAa,SAAoB;AAt6B3C;AAu6BI,eAAK,UAAL,mBAAY,QAAQ,YAAY;AAAA,EAClC;AAAA,EAEQ,mBAAmB,SAAiC;AAC1D,UAAM,YAAY,QAAQ;AAAA,MACjB,aAAI,SAAS,KAAK,eAAe,QAAQ,YAAY;AAAA,IAC9D;AACA,UAAM,WAAW,QAAQ;AAAA,MAChB,aAAI,SAAS,KAAK,eAAe,QAAQ,aAAa;AAAA,IAC/D;AAEA,UAAM,QAAQ,KAAK,UAAU;AAE7B,WAAO;AAAA;AAAA;AAAA;AAAA;AAAA,sFAK2E,QAAQ,SAAS,uCAAuC,KAAK,cAAc,QAAQ,SAAS,qDAAqD,QAAQ,SAAS;AAAA,gBACxO,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,mBAKL,KAAK,UAAU,SAAS;AAAA;AAAA;AAAA,EAGzC;AAAA,EAEQ,YAAoB;AAC1B,QAAI,OAAO;AACX,UAAM,QAAQ;AACd,aAAS,IAAI,GAAG,IAAI,IAAI,KAAK;AAC3B,cAAQ,MAAM,OAAO,KAAK,MAAM,KAAK,OAAO,IAAI,MAAM,MAAM,CAAC;AAAA,IAC/D;AACA,WAAO;AAAA,EACT;AAAA;AAAA,EAIA,MAAa,UAAyB;AACpC,UAAM,KAAK,gBAAgB,cAAc;AAAA,EAC3C;AAAA,EAEO,WAAiB;AACtB,SAAK,oBAAoB,gBAAgB;AAAA,EAC3C;AAAA,EAEA,MAAa,sBAAqC;AAChD,UAAM,KAAK,gBAAgB,oBAAoB;AAAA,EACjD;AAAA,EAEA,MAAa,oBAAmC;AAC9C,UAAM,KAAK,gBAAgB,kBAAkB;AAAA,EAC/C;AAAA,EAEO,uBAA6B;AAClC,SAAK,gBAAgB,qBAAqB;AAAA,EAC5C;AAAA,EAEA,MAAa,YAAY,SAAgC;AACvD,QAAI,CAAC,KAAK,OAAO;AACf,MAAO,gBAAO,mBAAmB,4FAAiB;AAClD;AAAA,IACF;AACA,UAAM,KAAK,mBAAmB,OAAO;AAAA,EACvC;AAAA,EAEA,MAAa,uBACX,cACA,eACe;AACf,UAAM,KAAK,oBAAoB,uBAAuB,cAAc,aAAa;AAAA,EACnF;AACF;AA37Ba,iBACY,WAAW;;;AuBvDpC,IAAAC,WAAwB;AA2EjB,IAAM,kBAAN,MAAsB;AAAA;AAAA;AAAA;AAAA,EAc3B,OAAO,WAAW,SAAwC;AAExD,SAAK,qBAA4B,mBAAU;AAAA,MACzC,CAAC,cAAc,cAAc,mBAAmB,mBAAmB,YAAY,WAAW;AAAA,MAC1F;AAAA,QACE,wBAAwB,CAAC,UAAU,aAAa;AAC9C,iBAAO,KAAK,mBAAmB,UAAU,QAAQ;AAAA,QACnD;AAAA,QACA,uBAAuB,CAAC,SAAS;AAC/B,iBAAO,KAAK,kBAAkB,IAAI;AAAA,QACpC;AAAA,MACF;AAAA,MACA;AAAA,MAAK;AAAA,MAAK;AAAA;AAAA,IACZ;AAGA,SAAK,gBAAuB,mBAAU;AAAA,MACpC,CAAC,cAAc,cAAc,mBAAmB,mBAAmB,YAAY,WAAW;AAAA,MAC1F;AAAA,QACE,cAAc,CAAC,UAAU,aAAa;AACpC,iBAAO,KAAK,aAAa,UAAU,QAAQ;AAAA,QAC7C;AAAA,MACF;AAAA,IACF;AAEA,YAAQ,cAAc,KAAK,KAAK,oBAAoB,KAAK,aAAa;AAGtE,SAAK,iBAAiB;AAGtB,SAAK,kBAAkB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,mBAAyB;AACtC,UAAM,eAAoC;AAAA,MACxC;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,QACtE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,UACpE,EAAE,MAAM,WAAW,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,QACzE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,aAAa,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,QAC3E;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,wCAAU,UAAU,KAAK;AAAA,QACxE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,UAAU,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,UACtE,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,8DAA0C,UAAU,KAAK;AAAA,QACxG;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,WAAW,MAAM,UAAU,aAAa,qBAAW,UAAU,KAAK;AAAA,QAC5E;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,oDAAY,UAAU,MAAM;AAAA,QAC3E;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,WAAW,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,QACzE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,SAAS,MAAM,UAAU,aAAa,kCAAS,UAAU,KAAK;AAAA,QACxE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,WAAW,MAAM,UAAU,aAAa,kCAAS,UAAU,KAAK;AAAA,QAC1E;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,wCAAU,UAAU,KAAK;AAAA,QACxE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,WAAW,MAAM,UAAU,aAAa,gEAAc,UAAU,MAAM;AAAA,QAChF;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,sEAAkD,UAAU,KAAK;AAAA,UAC9G,EAAE,MAAM,eAAe,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,QAC7E;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,OAAO,MAAM,UAAU,aAAa,mBAAS,UAAU,KAAK;AAAA,QACtE;AAAA,MACF;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,YAAY;AAAA,UACV,EAAE,MAAM,QAAQ,MAAM,UAAU,aAAa,4BAAQ,UAAU,KAAK;AAAA,QACtE;AAAA,MACF;AAAA,IACF;AAEA,eAAW,QAAQ,cAAc;AAC/B,WAAK,SAAS,IAAI,KAAK,IAAI,IAAI;AAAA,IACjC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,aAAa,MAA+B;AACjD,SAAK,SAAS,IAAI,KAAK,IAAI,IAAI;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,cAAc,OAAkC;AACrD,eAAW,QAAQ,OAAO;AACxB,WAAK,SAAS,IAAI,KAAK,IAAI,IAAI;AAAA,IACjC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,oBAA0B;AACvC,UAAM,gBAAmC;AAAA,MACvC;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,oBAAoB,CAAC,cAAc,cAAc,UAAU,QAAQ,IAAI;AAAA,MACzE;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,oBAAoB,CAAC,cAAc,cAAc,UAAU,QAAQ,IAAI;AAAA,MACzE;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,oBAAoB,CAAC,cAAc,cAAc,UAAU,QAAQ,IAAI;AAAA,MACzE;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,oBAAoB,CAAC,cAAc,cAAc,UAAU,QAAQ,IAAI;AAAA,MACzE;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,UAAU;AAAA,QACV,MAAM;AAAA,QACN,YAAY;AAAA,MACd;AAAA,IACF;AAEA,eAAW,SAAS,eAAe;AACjC,WAAK,WAAW,IAAI,MAAM,IAAI,KAAK;AAAA,IACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,cAAc,OAA8B;AACjD,SAAK,WAAW,IAAI,MAAM,IAAI,KAAK;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,QAAiC;AACrD,eAAW,SAAS,QAAQ;AAC1B,WAAK,WAAW,IAAI,MAAM,IAAI,KAAK;AAAA,IACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,mBACb,UACA,UAC8B;AAC9B,UAAM,aAAa,SAAS,OAAO,QAAQ,EAAE,KAAK,UAAU,GAAG,SAAS,SAAS;AAGjF,UAAM,UAAU,WAAW,MAAM,qBAAqB;AACtD,QAAI,CAAC,SAAS;AACZ,aAAO;AAAA,IACT;AAEA,UAAM,SAAS,QAAQ,CAAC,KAAK;AAC7B,UAAM,QAAiC,CAAC;AAGxC,UAAM,gBAAgB,WAAW,MAAO,OAAO,WAAW,MAAM,KAAK,CAAC,OAAO,WAAW,MAAM;AAC9F,UAAM,kBAAkB,WAAW,MAAO,SAAS,WAAW,MAAM,KAAK,CAAC,OAAO,WAAW,QAAQ;AACpG,UAAM,gBAAgB,OAAO,WAAW,MAAM;AAC9C,UAAM,cAAc,OAAO,WAAW,QAAQ;AAG9C,QAAI,eAAe;AACjB,YAAM,UAAU,IAAW,wBAAe,SAAgB,4BAAmB,MAAM;AACnF,cAAQ,SAAS;AACjB,cAAQ,gBAAgB,IAAW;AAAA,QACjC;AAAA,MAGF;AACA,cAAQ,aAAa,IAAW,uBAAc,UAAU;AACxD,cAAQ,aAAa;AACrB,cAAQ,UAAU,EAAE,SAAS,gCAAgC,OAAO,2BAAO;AAC3E,cAAQ,WAAW;AACnB,YAAM,KAAK,OAAO;AAAA,IACpB;AAEA,QAAI,iBAAiB;AACnB,YAAM,YAAY,IAAW,wBAAe,WAAkB,4BAAmB,MAAM;AACvF,gBAAU,SAAS;AACnB,gBAAU,gBAAgB,IAAW;AAAA,QACnC;AAAA,MAGF;AACA,gBAAU,aAAa,IAAW,uBAAc,YAAY;AAC5D,gBAAU,aAAa;AACvB,gBAAU,UAAU,EAAE,SAAS,gCAAgC,OAAO,2BAAO;AAC7E,gBAAU,WAAW;AACrB,YAAM,KAAK,SAAS;AAAA,IACtB;AAGA,QAAI,eAAe;AACjB,YAAM,aAAa,OAAO,MAAM,CAAC;AACjC,iBAAW,CAAC,IAAI,IAAI,KAAK,KAAK,UAAU;AACtC,YAAI,eAAe,MAAM,GAAG,WAAW,UAAU,KAAK,GAAG,SAAS,UAAU,KAAK,KAAK,KAAK,SAAS,UAAU,GAAG;AAC/G,gBAAM,OAAO,IAAW,wBAAe,QAAQ,EAAE,IAAW,4BAAmB,QAAQ;AACvF,eAAK,SAAS,KAAK;AACnB,eAAK,gBAAgB,IAAW;AAAA,YAC9B,KAAK,KAAK,IAAI;AAAA;AAAA,EAAS,KAAK,WAAW;AAAA;AAAA,KACtC,KAAK,aACF;AAAA,EAAY,KAAK,WAAW;AAAA,cAAI,OAC9B,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI,GAAG,EAAE,WAAW,KAAK,gBAAM,MAAM,EAAE,WAAW;AAAA,YAC1E,EAAE,KAAK,IAAI,CAAC,KACZ;AAAA,UACN;AACA,eAAK,aAAa,IAAW,uBAAc,KAAK,WAAW,QAAQ,SAAS,EAAE,CAAC;AAC/E,eAAK,aAAa,QAAQ,EAAE;AAC5B,eAAK,WAAW,KAAK,KAAK,QAAQ,IAAI,EAAE;AACxC,gBAAM,KAAK,IAAI;AAAA,QACjB;AAAA,MACF;AAAA,IACF;AAGA,QAAI,aAAa;AACf,YAAM,cAAc,OAAO,MAAM,CAAC;AAClC,iBAAW,CAAC,IAAI,KAAK,KAAK,KAAK,YAAY;AACzC,YAAI,gBAAgB,MAAM,GAAG,WAAW,WAAW,KAAK,GAAG,SAAS,WAAW,KAAK,MAAM,KAAK,SAAS,WAAW,GAAG;AACpH,gBAAM,OAAO,IAAW,wBAAe,UAAU,EAAE,IAAW,4BAAmB,MAAM;AACvF,eAAK,SAAS,GAAG,MAAM,IAAI,IAAI,MAAM,IAAI;AACzC,eAAK,gBAAgB,IAAW;AAAA,YAC9B,MAAM,MAAM,IAAI,IAAI,MAAM,IAAI;AAAA;AAAA,EAC3B,MAAM,WAAW;AAAA;AAAA,sBACP,MAAM,QAAQ;AAAA;AAAA,KAC1B,MAAM,qBACH,iCAAa,MAAM,mBAAmB,KAAK,IAAI,CAAC,KAChD;AAAA,UACN;AACA,eAAK,aAAa,IAAW,uBAAc,MAAM,WAAW,QAAQ,WAAW,EAAE,CAAC;AAClF,eAAK,aAAa,UAAU,EAAE;AAC9B,eAAK,WAAW,KAAK,MAAM,QAAQ,IAAI,EAAE;AACzC,gBAAM,KAAK,IAAI;AAAA,QACjB;AAAA,MACF;AAAA,IACF;AAEA,WAAO,MAAM,SAAS,IAAI,IAAW,wBAAe,OAAO,KAAK,IAAI;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,sBACb,UACA,UACA,SAAiB,IACM;AACvB,UAAM,QAAiC,CAAC;AAGxC,eAAW,CAAC,IAAI,IAAI,KAAK,KAAK,UAAU;AACtC,UAAI,GAAG,WAAW,MAAM,KAAK,KAAK,KAAK,SAAS,MAAM,GAAG;AACvD,cAAM,OAAO,IAAW;AAAA,UACtB,QAAQ,EAAE;AAAA,UACH,4BAAmB;AAAA,QAC5B;AACA,aAAK,SAAS,KAAK;AACnB,aAAK,gBAAgB,IAAW;AAAA,UAC9B,KAAK,KAAK,IAAI;AAAA;AAAA,EAAS,KAAK,WAAW;AAAA;AAAA,KACtC,KAAK,aACF;AAAA,EAAY,KAAK,WAAW;AAAA,YAAI,OAC9B,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI,GAAG,EAAE,WAAW,KAAK,gBAAM,MAAM,EAAE,WAAW;AAAA,UAC1E,EAAE,KAAK,IAAI,CAAC,KACZ;AAAA,QACN;AACA,aAAK,aAAa,IAAW,uBAAc,KAAK,WAAW,QAAQ,SAAS,EAAE,CAAC;AAC/E,aAAK,aAAa,QAAQ,EAAE;AAC5B,aAAK,WAAW,KAAK,KAAK,QAAQ,IAAI,EAAE;AACxC,cAAM,KAAK,IAAI;AAAA,MACjB;AAAA,IACF;AAEA,WAAO,IAAW,wBAAe,OAAO,KAAK;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,wBACb,UACA,UACA,SAAiB,IACM;AACvB,UAAM,QAAiC,CAAC;AAGxC,eAAW,CAAC,IAAI,KAAK,KAAK,KAAK,YAAY;AACzC,UAAI,GAAG,WAAW,MAAM,KAAK,MAAM,KAAK,SAAS,MAAM,GAAG;AACxD,cAAM,OAAO,IAAW;AAAA,UACtB,UAAU,EAAE;AAAA,UACL,4BAAmB;AAAA,QAC5B;AACA,aAAK,SAAS,GAAG,MAAM,IAAI,IAAI,MAAM,IAAI;AACzC,aAAK,gBAAgB,IAAW;AAAA,UAC9B,MAAM,MAAM,IAAI,IAAI,MAAM,IAAI;AAAA;AAAA,EAC3B,MAAM,WAAW;AAAA;AAAA,sBACP,MAAM,QAAQ;AAAA;AAAA,KAC1B,MAAM,qBACH,iCAAa,MAAM,mBAAmB,KAAK,IAAI,CAAC,KAChD;AAAA,QACN;AACA,aAAK,aAAa,IAAW,uBAAc,MAAM,WAAW,QAAQ,WAAW,EAAE,CAAC;AAClF,aAAK,aAAa,UAAU,EAAE;AAC9B,aAAK,WAAW,KAAK,MAAM,QAAQ,IAAI,EAAE;AACzC,cAAM,KAAK,IAAI;AAAA,MACjB;AAAA,IACF;AAEA,WAAO,IAAW,wBAAe,OAAO,KAAK;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,6BAAoD;AACjE,UAAM,QAAiC,CAAC;AAGxC,UAAM,UAAU,IAAW,wBAAe,QAAe,4BAAmB,MAAM;AAClF,YAAQ,SAAS;AACjB,YAAQ,gBAAgB,IAAW;AAAA,MACjC;AAAA,IAYF;AACA,YAAQ,aAAa,IAAW,uBAAc,UAAU;AACxD,YAAQ,UAAU;AAAA,MAChB,SAAS;AAAA,MACT,OAAO;AAAA,IACT;AACA,YAAQ,WAAW;AACnB,UAAM,KAAK,OAAO;AAGlB,UAAM,YAAY,IAAW,wBAAe,UAAiB,4BAAmB,MAAM;AACtF,cAAU,SAAS;AACnB,cAAU,gBAAgB,IAAW;AAAA,MACnC;AAAA,IAWF;AACA,cAAU,aAAa,IAAW,uBAAc,YAAY;AAC5D,cAAU,UAAU;AAAA,MAClB,SAAS;AAAA,MACT,OAAO;AAAA,IACT;AACA,cAAU,WAAW;AACrB,UAAM,KAAK,SAAS;AAEpB,WAAO,IAAW,wBAAe,OAAO,KAAK;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,kBAAkB,MAAoD;AApqBvF;AAqqBI,UAAM,UAAQ,UAAK,UAAL,mBAAY,eAAc;AAGxC,QAAI,MAAM,WAAW,OAAO,GAAG;AAC7B,YAAM,SAAS,MAAM,QAAQ,SAAS,EAAE;AACxC,YAAM,OAAO,KAAK,SAAS,IAAI,MAAM;AACrC,UAAI,QAAQ,KAAK,eAAe;AAC9B,aAAK,gBAAgB,IAAW,wBAAe,KAAK,aAAa;AAAA,MACnE;AAAA,IACF;AAGA,QAAI,MAAM,WAAW,SAAS,GAAG;AAC/B,YAAM,UAAU,MAAM,QAAQ,WAAW,EAAE;AAC3C,YAAM,QAAQ,KAAK,WAAW,IAAI,OAAO;AACzC,UAAI,SAAS,MAAM,eAAe;AAChC,aAAK,gBAAgB,IAAW,wBAAe,MAAM,aAAa;AAAA,MACpE;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,aACb,UACA,UACqB;AAErB,UAAM,WAAW,SAAS,uBAAuB,UAAU,sBAAsB;AACjF,QAAI,UAAU;AACZ,YAAM,OAAO,SAAS,QAAQ,QAAQ;AACtC,YAAM,SAAS,KAAK,QAAQ,SAAS,EAAE;AACvC,YAAM,OAAO,KAAK,SAAS,IAAI,MAAM;AAErC,UAAI,MAAM;AACR,cAAM,WAAW,IAAW,wBAAe;AAC3C,iBAAS,YAAY;AACrB,iBAAS,eAAe,gBAAS,KAAK,IAAI;AAAA;AAAA,CAAM;AAChD,iBAAS,eAAe,GAAG,KAAK,WAAW;AAAA;AAAA,CAAM;AACjD,iBAAS,eAAe,uBAAa,KAAK,QAAQ;AAAA;AAAA,CAAQ;AAE1D,YAAI,KAAK,cAAc,KAAK,WAAW,SAAS,GAAG;AACjD,mBAAS,eAAe;AAAA;AAAA,CAAa;AACrC,qBAAW,SAAS,KAAK,YAAY;AACnC,kBAAM,WAAW,MAAM,WAAW,mBAAS;AAC3C,qBAAS,eAAe,OAAO,MAAM,IAAI,MAAM,QAAQ,KAAK,MAAM,WAAW;AAAA,CAAI;AAAA,UACnF;AACA,mBAAS,eAAe,IAAI;AAAA,QAC9B;AAEA,iBAAS,eAAe,uBAAa,KAAK,UAAU,IAAI;AAExD,eAAO,IAAW,eAAM,UAAU,QAAQ;AAAA,MAC5C;AAAA,IACF;AAGA,UAAM,aAAa,SAAS,uBAAuB,UAAU,wBAAwB;AACrF,QAAI,YAAY;AACd,YAAM,OAAO,SAAS,QAAQ,UAAU;AACxC,YAAM,UAAU,KAAK,QAAQ,WAAW,EAAE;AAC1C,YAAM,QAAQ,KAAK,WAAW,IAAI,OAAO;AAEzC,UAAI,OAAO;AACT,cAAM,WAAW,IAAW,wBAAe;AAC3C,iBAAS,YAAY;AACrB,iBAAS,eAAe,MAAM,MAAM,IAAI,IAAI,MAAM,IAAI;AAAA;AAAA,CAAM;AAC5D,iBAAS,eAAe,GAAG,MAAM,WAAW;AAAA;AAAA,CAAM;AAClD,iBAAS,eAAe,uBAAa,MAAM,QAAQ;AAAA;AAAA,CAAQ;AAE3D,YAAI,MAAM,sBAAsB,MAAM,mBAAmB,SAAS,GAAG;AACnE,mBAAS,eAAe,iCAAa,MAAM,mBAAmB,KAAK,IAAI,CAAC;AAAA;AAAA,CAAM;AAAA,QAChF,OAAO;AACL,mBAAS,eAAe;AAAA;AAAA,CAAoB;AAAA,QAC9C;AAEA,iBAAS,eAAe,uBAAa,MAAM,UAAU,IAAI;AAEzD,eAAO,IAAW,eAAM,UAAU,UAAU;AAAA,MAC9C;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,mBAAmB,UAA6C;AACrE,UAAM,OAAO,SAAS,QAAQ;AAC9B,UAAM,WAAW,SAAS;AAC1B,UAAM,iBAA2B,CAAC;AAGlC,UAAM,aAAa,4BAA4B,KAAK,IAAI;AACxD,UAAM,eAAe,yDAAyD,KAAK,IAAI;AACvF,UAAM,aAAa,eAAe,KAAK,IAAI;AAG3C,QAAI,gBAAgB,YAAY;AAC9B,qBAAe,KAAK,gBAAgB,eAAe;AAAA,IACrD;AAEA,QAAI,YAAY;AACd,qBAAe,KAAK,eAAe;AAAA,IACrC;AAGA,QAAI,SAAS,SAAS,SAAS,QAAQ,KAAK,SAAS,SAAS,SAAS,QAAQ,GAAG;AAChF,qBAAe,KAAK,UAAU;AAAA,IAChC;AAGA,QAAI,SAAS,SAAS,SAAS,cAAc,KAAK,SAAS,SAAS,SAAS,eAAe,GAAG;AAC7F,qBAAe,KAAK,WAAW;AAAA,IACjC;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,yBAAyB,UAAoD;AAClF,UAAM,WAAW,KAAK,mBAAmB,QAAQ;AACjD,UAAM,cAAmC,CAAC;AAE1C,eAAW,UAAU,SAAS,gBAAgB;AAC5C,YAAM,OAAO,KAAK,SAAS,IAAI,MAAM;AACrC,UAAI,MAAM;AACR,oBAAY,KAAK,IAAI;AAAA,MACvB;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,UAAgB;AACrB,QAAI,KAAK,oBAAoB;AAC3B,WAAK,mBAAmB,QAAQ;AAChC,WAAK,qBAAqB;AAAA,IAC5B;AACA,QAAI,KAAK,eAAe;AACtB,WAAK,cAAc,QAAQ;AAC3B,WAAK,gBAAgB;AAAA,IACvB;AACA,SAAK,SAAS,MAAM;AACpB,SAAK,WAAW,MAAM;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,cAAc,MAA0B;AAC7C,UAAM,QAAQ,KAAK,MAAM,IAAI,EAAE,OAAO,OAAK,EAAE,KAAK,EAAE,SAAS,CAAC;AAC9D,QAAI,MAAM,WAAW,GAAG;AACtB,aAAO,EAAE,MAAM,KAAK,MAAM,GAAG,OAAO,GAAG,KAAK,GAAG;AAAA,IACjD;AAGA,UAAM,UAAU,MACb,IAAI,UAAK;AAt1BhB;AAs1BmB,yBAAK,MAAM,SAAS,MAApB,mBAAwB,OAAM;AAAA,KAAE,EAC5C,OAAO,YAAU,OAAO,SAAS,CAAC;AAErC,QAAI,QAAQ,WAAW,GAAG;AACxB,aAAO,EAAE,MAAM,KAAK,MAAM,GAAG,OAAO,GAAG,KAAK,GAAG;AAAA,IACjD;AAGA,UAAM,WAAW,QAAQ,KAAK,OAAK,EAAE,SAAS,GAAI,CAAC;AACnD,UAAM,OAAO,WAAW,MAAO;AAG/B,QAAI,OAAO;AACX,QAAI,CAAC,UAAU;AACb,YAAM,SAAS,QACZ,IAAI,OAAK,EAAE,MAAM,EACjB,OAAO,SAAO,MAAM,CAAC;AAExB,UAAI,OAAO,SAAS,GAAG;AAErB,cAAM,QAAQ,CAAC;AACf,cAAM,SAAS,CAAC,GAAG,IAAI,IAAI,MAAM,CAAC,EAAE,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC;AACxD,iBAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACtC,gBAAM,KAAK,OAAO,CAAC,IAAI,OAAO,IAAI,CAAC,CAAC;AAAA,QACtC;AACA,YAAI,MAAM,SAAS,GAAG;AACpB,iBAAO,KAAK,IAAI,GAAG,MAAM,OAAO,OAAK,IAAI,CAAC,CAAC,KAAK;AAAA,QAClD;AAAA,MACF,WAAW,OAAO,WAAW,GAAG;AAC9B,eAAO,OAAO,CAAC,KAAK,IAAI,OAAO,CAAC,IAAI;AAAA,MACtC;AAAA,IACF,OAAO;AACL,aAAO;AAAA,IACT;AAEA,WAAO,EAAE,MAAM,MAAM,OAAO,GAAG,KAAK,GAAG;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,cAAc,MAAc,YAAoC;AACrE,UAAM,QAAQ,KAAK,MAAM,SAAS;AAClC,UAAM,MAAM,QAAQ,MAAM,CAAC,IAAI;AAE/B,QAAI,QAAQ;AACZ,QAAI,WAAW,SAAS,KAAM;AAC5B,eAAS,IAAI,MAAM,KAAK,KAAK,CAAC,GAAG;AAAA,IACnC,OAAO;AACL,cAAQ,KAAK,MAAM,IAAI,SAAS,WAAW,IAAI;AAAA,IACjD;AAEA,WAAO,EAAE,GAAG,YAAY,OAAO,IAAI;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,aAAa,MAAc,cAAkC;AAh5BtE;AAi5BI,UAAM,QAAQ,KAAK,MAAM,IAAI;AAC7B,QAAI,MAAM,WAAW;AAAG,aAAO;AAG/B,UAAM,gBAAgB,MAAM,OAAO,OAAK,EAAE,KAAK,EAAE,SAAS,CAAC;AAC3D,QAAI,cAAc,WAAW;AAAG,aAAO;AAEvC,UAAM,eAAa,mBAAc,CAAC,EAAE,MAAM,SAAS,MAAhC,mBAAoC,OAAM;AAC7D,UAAM,YAAY,KAAK,cAAc,cAAc,CAAC,GAAG,YAAY,EAAE;AAGrE,UAAM,cAAc,aAAa;AACjC,UAAM,YAAY,cAAc;AAEhC,WAAO,MAAM,IAAI,UAAQ;AA/5B7B,UAAAC;AAg6BM,UAAI,KAAK,KAAK,EAAE,WAAW,GAAG;AAC5B,eAAO;AAAA,MACT;AAEA,YAAM,kBAAgBA,MAAA,KAAK,MAAM,SAAS,MAApB,gBAAAA,IAAwB,OAAM;AACpD,YAAM,eAAe,KAAK,cAAc,MAAM,YAAY,EAAE;AAC5D,YAAM,WAAW,KAAK,IAAI,GAAG,eAAe,SAAS;AACrD,YAAM,YAAY,aAAa,KAAK,OAAO,WAAW,aAAa,IAAI;AAEvE,aAAO,YAAY,KAAK,UAAU;AAAA,IACpC,CAAC,EAAE,KAAK,IAAI;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,iBACL,UACA,YACA,YAAoB,GACqC;AACzD,UAAM,WAAW,SAAS,QAAQ;AAClC,UAAM,QAAQ,SAAS,QAAQ,YAAY,SAAS;AAEpD,QAAI,UAAU;AAAI,aAAO;AAEzB,UAAM,QAAQ,SAAS,WAAW,KAAK;AACvC,UAAM,MAAM,SAAS,WAAW,QAAQ,WAAW,MAAM;AAEzD,WAAO,EAAE,OAAO,IAAI;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,cACL,UACA,YAC8E;AAC9E,UAAM,WAAW,SAAS,QAAQ;AAClC,UAAM,cAAc,WAAW,MAAM,IAAI,EAAE,IAAI,OAAK,EAAE,KAAK,CAAC,EAAE,OAAO,OAAK,EAAE,SAAS,CAAC;AAEtF,QAAI,YAAY,WAAW;AAAG,aAAO;AAErC,UAAM,YAAY,SAAS,MAAM,IAAI;AAGrC,aAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,UAAI,UAAU,CAAC,EAAE,KAAK,MAAM,YAAY,CAAC,GAAG;AAE1C,YAAI,WAAW;AACf,YAAI,UAAU;AAEd,iBAAS,IAAI,GAAG,IAAI,YAAY,QAAQ,KAAK;AAC3C,cAAI,IAAI,KAAK,UAAU,UAAU,UAAU,IAAI,CAAC,EAAE,KAAK,MAAM,YAAY,CAAC,GAAG;AAC3E,uBAAW;AACX;AAAA,UACF;AACA,oBAAU,IAAI;AAAA,QAChB;AAEA,YAAI,UAAU;AACZ,gBAAM,QAAQ,IAAW,kBAAS,GAAG,CAAC;AACtC,gBAAM,MAAM,IAAW,kBAAS,SAAS,UAAU,OAAO,EAAE,MAAM;AAClE,gBAAM,cAAc,UAAU,MAAM,GAAG,UAAU,CAAC,EAAE,KAAK,IAAI;AAC7D,iBAAO,EAAE,OAAO,KAAK,YAAY;AAAA,QACnC;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,YACX,UACA,SACA,SACA,UAAuD,CAAC,GACtC;AAClB,UAAM,SAAS,MAAa,gBAAO,iBAAiB,QAAQ;AAG5D,QAAI,WAAW,KAAK,iBAAiB,UAAU,OAAO;AAGtD,QAAI,CAAC,YAAY,QAAQ,OAAO;AAC9B,YAAM,cAAc,KAAK,cAAc,UAAU,OAAO;AACxD,UAAI,aAAa;AACf,mBAAW,EAAE,OAAO,YAAY,OAAO,KAAK,YAAY,IAAI;AAE5D,YAAI,QAAQ,cAAc;AACxB,gBAAM,aAAa,KAAK,cAAc,SAAS,QAAQ,CAAC;AACxD,gBAAM,eAAe,KAAK;AAAA,YACxB,SAAS,OAAO,YAAY,MAAM,IAAI,EAAE;AAAA,YACxC;AAAA,UACF;AACA,oBAAU,KAAK,aAAa,SAAS,YAAY;AAAA,QACnD;AAAA,MACF;AAAA,IACF;AAEA,QAAI,CAAC,UAAU;AACb,aAAO;AAAA,IACT;AAGA,QAAI,QAAQ,gBAAgB,CAAC,QAAQ,OAAO;AAC1C,YAAM,aAAa,KAAK,cAAc,SAAS,QAAQ,CAAC;AACxD,YAAM,eAAe,KAAK;AAAA,QACxB,SAAS,OAAO,SAAS,MAAM,IAAI,EAAE;AAAA,QACrC;AAAA,MACF;AACA,gBAAU,KAAK,aAAa,SAAS,YAAY;AAAA,IACnD;AAEA,UAAM,QAAQ,IAAW,eAAM,SAAS,OAAO,SAAS,GAAG;AAE3D,UAAM,UAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,kBAAY,QAAQ,OAAO,OAAO;AAAA,IACpC,CAAC;AAED,QAAI,SAAS;AAEX,YAAM,SAAS,KAAK;AAAA,IACtB;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,iBACX,UACA,QACA,SACA,UACA,UAAsC,CAAC,GACrB;AAClB,UAAM,SAAS,MAAa,gBAAO,iBAAiB,QAAQ;AAE5D,UAAM,iBAAiB,KAAK,iBAAiB,UAAU,MAAM;AAC7D,QAAI,CAAC;AAAgB,aAAO;AAG5B,UAAM,aAAa,KAAK,cAAc,SAAS,QAAQ,CAAC;AACxD,UAAM,aAAa,SAAS,OAAO,eAAe,MAAM,IAAI;AAC5D,UAAM,eAAe,KAAK,cAAc,WAAW,MAAM,UAAU;AAGnE,QAAI,QAAQ,cAAc;AACxB,gBAAU,KAAK,aAAa,SAAS,YAAY;AAAA,IACnD;AAEA,QAAI;AACJ,QAAI;AAEJ,QAAI,aAAa,UAAU;AACzB,uBAAiB,IAAW,kBAAS,eAAe,MAAM,MAAM,CAAC;AACjE,sBAAgB,UAAU;AAAA,IAC5B,OAAO;AACL,uBAAiB,IAAW,kBAAS,eAAe,IAAI,OAAO,GAAG,CAAC;AACnE,sBAAgB,UAAU;AAAA,IAC5B;AAEA,UAAM,UAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,kBAAY,OAAO,gBAAgB,aAAa;AAAA,IAClD,CAAC;AAED,QAAI,SAAS;AACX,YAAM,SAAS,KAAK;AAAA,IACtB;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,aACX,UACA,YACA,SACA,UAAoE,CAAC,GACnD;AAClB,UAAM,SAAS,MAAa,gBAAO,iBAAiB,QAAQ;AAG5D,UAAM,aAAa,KAAK,IAAI,GAAG,KAAK,IAAI,YAAY,SAAS,SAAS,CAAC;AAGvE,QAAI,QAAQ,cAAc;AACxB,YAAM,UAAU,KAAK,IAAI,GAAG,cAAc,QAAQ,uBAAuB,GAAG;AAC5E,UAAI,UAAU,SAAS,WAAW;AAChC,cAAM,aAAa,KAAK,cAAc,SAAS,QAAQ,CAAC;AACxD,cAAM,eAAe,KAAK,cAAc,SAAS,OAAO,OAAO,EAAE,MAAM,UAAU;AACjF,kBAAU,KAAK,aAAa,SAAS,YAAY;AAAA,MACnD;AAAA,IACF;AAEA,UAAM,iBAAiB,IAAW,kBAAS,YAAY,CAAC;AAExD,UAAM,UAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,kBAAY,OAAO,gBAAgB,UAAU,IAAI;AAAA,IACnD,CAAC;AAED,QAAI,SAAS;AACX,YAAM,SAAS,KAAK;AAAA,IACtB;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,WACX,UACA,YACA,UAA0D,CAAC,GACzC;AAClB,UAAM,SAAS,MAAa,gBAAO,iBAAiB,QAAQ;AAE5D,QAAI,WAAW,KAAK,iBAAiB,UAAU,UAAU;AAEzD,QAAI,CAAC,YAAY,QAAQ,OAAO;AAC9B,YAAM,cAAc,KAAK,cAAc,UAAU,UAAU;AAC3D,UAAI,aAAa;AACf,mBAAW,EAAE,OAAO,YAAY,OAAO,KAAK,YAAY,IAAI;AAAA,MAC9D;AAAA,IACF;AAEA,QAAI,CAAC;AAAU,aAAO;AAEtB,QAAI;AAEJ,QAAI,QAAQ,iBAAiB;AAC3B,cAAQ,IAAW;AAAA,QACjB,IAAW,kBAAS,SAAS,MAAM,MAAM,CAAC;AAAA,QAC1C,IAAW,kBAAS,SAAS,IAAI,OAAO,GAAG,CAAC;AAAA,MAC9C;AAAA,IACF,OAAO;AACL,cAAQ,IAAW,eAAM,SAAS,OAAO,SAAS,GAAG;AAAA,IACvD;AAEA,UAAM,UAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,kBAAY,OAAO,KAAK;AAAA,IAC1B,CAAC;AAED,QAAI,SAAS;AACX,YAAM,SAAS,KAAK;AAAA,IACtB;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,WACX,UACA,YACoD;AACpD,UAAM,YAAsB,CAAC;AAE7B,aAAS,IAAI,GAAG,IAAI,WAAW,QAAQ,KAAK;AAC1C,YAAM,KAAK,WAAW,CAAC;AACvB,UAAI,UAAU;AAEd,cAAQ,GAAG,MAAM;AAAA,QACf,KAAK;AACH,oBAAU,MAAM,KAAK,YAAY,UAAU,GAAG,SAAS,GAAG,SAAS;AAAA,YACjE,OAAO;AAAA,YACP,cAAc;AAAA,UAChB,CAAC;AACD;AAAA,QACF,KAAK;AACH,oBAAU,MAAM,KAAK,iBAAiB,UAAU,GAAG,QAAQ,GAAG,SAAS,GAAG,UAAU;AAAA,YAClF,cAAc;AAAA,UAChB,CAAC;AACD;AAAA,QACF,KAAK;AACH,oBAAU,MAAM,KAAK,aAAa,UAAU,GAAG,MAAM,GAAG,SAAS;AAAA,YAC/D,cAAc;AAAA,UAChB,CAAC;AACD;AAAA,QACF,KAAK;AACH,oBAAU,MAAM,KAAK,WAAW,UAAU,GAAG,QAAQ;AAAA,YACnD,OAAO;AAAA,YACP,iBAAiB;AAAA,UACnB,CAAC;AACD;AAAA,QACF,KAAK;AAEH,oBAAU,MAAM,KAAK;AAAA,YACnB;AAAA,YACA,GAAG;AAAA,YACH,GAAG,SAAS,GAAG,SAAS,GAAG;AAAA,YAC3B,EAAE,OAAO,KAAK;AAAA,UAChB;AACA;AAAA,MACJ;AAEA,UAAI,CAAC,SAAS;AACZ,kBAAU,KAAK,CAAC;AAAA,MAClB;AAAA,IAIF;AAEA,WAAO;AAAA,MACL,SAAS,UAAU,WAAW;AAAA,MAC9B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,gBACX,gBACA,YACgD;AAEhD,UAAM,aAAa,KAAK,gBAAgB,UAAU;AAElD,QAAI,WAAW,WAAW,GAAG;AAC3B,aAAO,EAAE,SAAS,OAAO,SAAS,uCAAuC;AAAA,IAC3E;AAEA,UAAM,SAAS,MAAM,KAAK,WAAW,gBAAgB,UAAU;AAE/D,QAAI,OAAO,SAAS;AAClB,aAAO,EAAE,SAAS,MAAM,SAAS,WAAW,WAAW,MAAM,wBAAwB;AAAA,IACvF,OAAO;AACL,aAAO;AAAA,QACL,SAAS;AAAA,QACT,SAAS,mBAAmB,OAAO,UAAU,MAAM,OAAO,WAAW,MAAM;AAAA,MAC7E;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,gBAAgB,UAAmC;AAChE,UAAM,aAA8B,CAAC;AAGrC,UAAM,YAAY,SAAS,MAAM,mCAAmC;AACpE,QAAI,WAAW;AACb,iBAAW,QAAQ,WAAW;AAC5B,cAAM,SAAS,KAAK,UAAU,IAAI;AAClC,mBAAW,KAAK,GAAG,MAAM;AAAA,MAC3B;AAAA,IACF;AAGA,UAAM,qBAAqB,SAAS;AAAA,MAClC;AAAA,IACF;AACA,QAAI,oBAAoB;AACtB,iBAAW,SAAS,oBAAoB;AACtC,cAAM,QAAQ,MAAM;AAAA,UAClB;AAAA,QACF;AACA,YAAI,OAAO;AACT,qBAAW,KAAK;AAAA,YACd,MAAM;AAAA,YACN,SAAS,MAAM,CAAC;AAAA,YAChB,SAAS,MAAM,CAAC;AAAA,UAClB,CAAC;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,UAAU,MAA+B;AACtD,UAAM,aAA8B,CAAC;AACrC,UAAM,QAAQ,KAAK,MAAM,IAAI;AAE7B,QAAI,WAAqB,CAAC;AAC1B,QAAI,WAAqB,CAAC;AAC1B,QAAI,SAAS;AAEb,eAAW,QAAQ,OAAO;AACxB,UAAI,KAAK,WAAW,IAAI,GAAG;AAEzB,YAAI,SAAS,SAAS,KAAK,SAAS,SAAS,GAAG;AAC9C,qBAAW,KAAK;AAAA,YACd,MAAM;AAAA,YACN,SAAS,SAAS,KAAK,IAAI;AAAA,YAC3B,SAAS,SAAS,KAAK,IAAI;AAAA,UAC7B,CAAC;AAAA,QACH;AACA,mBAAW,CAAC;AACZ,mBAAW,CAAC;AACZ,iBAAS;AAAA,MACX,WAAW,QAAQ;AACjB,YAAI,KAAK,WAAW,GAAG,GAAG;AACxB,mBAAS,KAAK,KAAK,MAAM,CAAC,CAAC;AAAA,QAC7B,WAAW,KAAK,WAAW,GAAG,GAAG;AAC/B,mBAAS,KAAK,KAAK,MAAM,CAAC,CAAC;AAAA,QAC7B,WAAW,KAAK,WAAW,GAAG,GAAG;AAC/B,mBAAS,KAAK,KAAK,MAAM,CAAC,CAAC;AAC3B,mBAAS,KAAK,KAAK,MAAM,CAAC,CAAC;AAAA,QAC7B;AAAA,MACF;AAAA,IACF;AAGA,QAAI,SAAS,SAAS,KAAK,SAAS,SAAS,GAAG;AAC9C,iBAAW,KAAK;AAAA,QACd,MAAM;AAAA,QACN,SAAS,SAAS,KAAK,IAAI;AAAA,QAC3B,SAAS,SAAS,KAAK,IAAI;AAAA,MAC7B,CAAC;AAAA,IACH;AAEA,WAAO;AAAA,EACT;AACF;AAAA;AAAA;AAAA;AAnwCa,gBAMI,WAA2C,oBAAI,IAAI;AANvD,gBAOI,aAA2C,oBAAI,IAAI;AAPvD,gBAQI,qBAA+C;AARnD,gBASI,gBAA0C;;;ACpF3D,IAAAC,WAAwB;AAiBjB,IAAM,cAAN,MAAkB;AAAA,EAAlB;AACL,SAAQ,iBAA0C,oBAAI,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,EAK1D,iBAAiB,UAAkB,YAAmC;AACpE,UAAM,UAAwB,CAAC;AAI/B,UAAM,iBAAiB,SAAS;AAAA,MAC9B;AAAA,IACF;AAEA,eAAW,SAAS,gBAAgB;AAClC,YAAM,CAAC,EAAE,UAAU,UAAU,IAAI,IAAI;AACrC,cAAQ,KAAK;AAAA,QACX,UAAU,SAAS,KAAK;AAAA,QACxB,UAAU;AAAA,QACV,UAAU,KAAK,KAAK;AAAA,QACpB,YAAY,CAAC,EAAE,MAAM,WAAW,SAAS,IAAI,SAAS,KAAK,KAAK,EAAE,CAAC;AAAA,MACrE,CAAC;AAAA,IACH;AAGA,UAAM,sBAAsB,SAAS;AAAA,MACnC;AAAA,IACF;AAEA,eAAW,SAAS,qBAAqB;AACvC,YAAM,CAAC,EAAE,UAAU,SAAS,OAAO,IAAI;AACvC,YAAMC,UAAO,qCAAU,WAAU,cAAc;AAE/C,YAAM,WAAW,QAAQ,KAAK,OAAK,EAAE,aAAaA,MAAI;AACtD,UAAI,UAAU;AACZ,iBAAS,WAAW,KAAK;AAAA,UACvB,MAAM;AAAA,UACN,SAAS;AAAA,UACT,SAAS;AAAA,QACX,CAAC;AAAA,MACH,OAAO;AACL,gBAAQ,KAAK;AAAA,UACX,UAAUA;AAAA,UACV,UAAU;AAAA,UACV,UAAU;AAAA,UACV,YAAY,CAAC,EAAE,MAAM,WAAW,SAAS,SAAS,SAAS,QAAQ,CAAC;AAAA,QACtE,CAAC;AAAA,MACH;AAAA,IACF;AAGA,QAAI,QAAQ,WAAW,KAAK,YAAY;AACtC,YAAM,YAAY,SAAS,MAAM,yBAAyB;AAC1D,UAAI,WAAW;AACb,gBAAQ,KAAK;AAAA,UACX,UAAU;AAAA,UACV,UAAU;AAAA,UACV,UAAU,UAAU,CAAC,EAAE,KAAK;AAAA,UAC5B,YAAY,CAAC;AAAA,QACf,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAAgB,QAAmC;AACvD,UAAM,MAAa,aAAI,MAAM,WAAW,OAAO,QAAQ,EAAE;AAGzD,UAAM,cAAqB,aAAI,MAAM,eAAe,OAAO,QAAQ,EAAE;AACrE,UAAM,cAAqB,aAAI,MAAM,eAAe,OAAO,QAAQ,EAAE;AAGrE,UAAa,kBAAS;AAAA,MAAe;AAAA,MACnC;AAAA,MACA;AAAA,MACA,eAAe,OAAO,QAAQ;AAAA,IAChC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aACJ,SACA,UAAqD,CAAC,GAC8B;AA5GxF;AA6GI,UAAM,WAAqB,CAAC;AAC5B,QAAI,UAAU;AACd,QAAI,SAAS;AAEb,eAAW,UAAU,SAAS;AAC5B,UAAI;AAEF,YAAI;AAEJ,cAAM,iBAAgB,WAAO,mBAAU,qBAAjB,mBAAoC,OAApC,mBAAwC,IAAI;AAClE,cAAM,WAAW,OAAO,SAAS,WAAW,GAAG,IAC3C,OAAO,WACP,GAAG,aAAa,IAAI,OAAO,QAAQ;AAEvC,cAAM,MAAa,aAAI,KAAK,QAAQ;AAEpC,YAAI;AACF,qBAAW,MAAa,mBAAU,iBAAiB,GAAG;AAAA,QACxD,QAAQ;AAEN,cAAI,OAAO,UAAU;AACnB,kBAAa,mBAAU,GAAG;AAAA,cACxB;AAAA,cACA,OAAO,KAAK,OAAO,UAAU,OAAO;AAAA,YACtC;AACA,qBAAS,KAAK,YAAY,OAAO,QAAQ,EAAE;AAC3C;AACA;AAAA,UACF,OAAO;AACL,kBAAM,IAAI,MAAM,mBAAmB,OAAO,QAAQ,EAAE;AAAA,UACtD;AAAA,QACF;AAGA,YAAI,OAAO,WAAW,SAAS,GAAG;AAChC,gBAAM,SAAS,MAAM,gBAAgB,WAAW,UAAU,OAAO,UAAU;AAE3E,cAAI,OAAO,SAAS;AAClB,qBAAS,KAAK,WAAW,OAAO,WAAW,MAAM,eAAe,OAAO,QAAQ,EAAE;AACjF;AAAA,UACF,OAAO;AACL,qBAAS,KAAK,mCAAmC,OAAO,QAAQ,EAAE;AAClE;AAAA,UACF;AAAA,QACF,WAAW,OAAO,UAAU;AAE1B,gBAAM,SAAS,MAAa,gBAAO,iBAAiB,QAAQ;AAC5D,gBAAM,YAAY,IAAW;AAAA,YAC3B,SAAS,WAAW,CAAC;AAAA,YACrB,SAAS,WAAW,SAAS,QAAQ,EAAE,MAAM;AAAA,UAC/C;AAEA,gBAAM,OAAO,KAAK,iBAAe;AAC/B,wBAAY,QAAQ,WAAW,OAAO,QAAQ;AAAA,UAChD,CAAC;AAED,cAAI,QAAQ,UAAU;AACpB,kBAAM,SAAS,KAAK;AAAA,UACtB;AAEA,mBAAS,KAAK,YAAY,OAAO,QAAQ,EAAE;AAC3C;AAAA,QACF;AAAA,MACF,SAAS,OAAO;AACd,iBAAS,KAAK,UAAU,OAAO,QAAQ,MAAM,iBAAiB,QAAQ,MAAM,UAAU,eAAe,EAAE;AACvG;AAAA,MACF;AAAA,IACF;AAEA,WAAO,EAAE,SAAS,WAAW,GAAG,SAAS,QAAQ,SAAS;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YACJ,UACA,MACA,MACgD;AAChD,UAAM,SAAS,MAAa,gBAAO,iBAAiB,QAAQ;AAC5D,UAAM,YAAY,OAAO;AAGzB,QAAI,CAAC,UAAU,SAAS;AACtB,YAAMC,cAAa,gBAAgB,cAAc,SAAS,QAAQ,CAAC;AACnE,YAAMC,gBAAe,gBAAgB;AAAA,QACnC,SAAS,OAAO,UAAU,MAAM,IAAI,EAAE;AAAA,QACtCD;AAAA,MACF;AAEA,YAAME,gBAAe,gBAAgB,aAAa,MAAMD,aAAY;AAEpE,YAAME,WAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,oBAAY,QAAQ,WAAWD,aAAY;AAAA,MAC7C,CAAC;AAED,aAAO;AAAA,QACL,SAAAC;AAAA,QACA,SAASA,WAAU,+BAA+B;AAAA,MACpD;AAAA,IACF;AAGA,QAAI,MAAM;AACR,YAAM,WAAW,gBAAgB,iBAAiB,UAAU,IAAI;AAChE,UAAI,UAAU;AACZ,cAAMH,cAAa,gBAAgB,cAAc,SAAS,QAAQ,CAAC;AACnE,cAAMC,gBAAe,gBAAgB;AAAA,UACnC,SAAS,OAAO,SAAS,MAAM,IAAI,EAAE;AAAA,UACrCD;AAAA,QACF;AAEA,cAAME,gBAAe,gBAAgB,aAAa,MAAMD,aAAY;AACpE,cAAM,iBAAiB,IAAW,kBAAS,SAAS,IAAI,OAAO,GAAG,CAAC;AAEnE,cAAME,WAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,sBAAY,OAAO,gBAAgBD,gBAAe,IAAI;AAAA,QACxD,CAAC;AAED,eAAO;AAAA,UACL,SAAAC;AAAA,UACA,SAASA,WAAU,wBAAwB,KAAK,MAAM,GAAG,EAAE,CAAC,SAAS;AAAA,QACvE;AAAA,MACF;AAAA,IACF;AAGA,UAAM,iBAAiB,UAAU;AACjC,UAAM,aAAa,gBAAgB,cAAc,SAAS,QAAQ,CAAC;AACnE,UAAM,eAAe,gBAAgB;AAAA,MACnC,SAAS,OAAO,eAAe,IAAI,EAAE;AAAA,MACrC;AAAA,IACF;AAEA,UAAM,eAAe,gBAAgB,aAAa,MAAM,YAAY;AAEpE,UAAM,UAAU,MAAM,OAAO,KAAK,iBAAe;AAC/C,kBAAY,OAAO,gBAAgB,YAAY;AAAA,IACjD,CAAC;AAED,WAAO;AAAA,MACL;AAAA,MACA,SAAS,UAAU,4BAA4B;AAAA,IACjD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eACJ,UACA,MACkB;AAClB,UAAM,SAAS,MAAM,KAAK,YAAY,UAAU,IAAI;AAEpD,QAAI,OAAO,SAAS;AAElB,UAAI;AACF,cAAa,kBAAS,eAAe,8BAA8B;AAAA,MACrE,QAAQ;AAAA,MAER;AAEA,YAAM,SAAS,KAAK;AAAA,IACtB;AAEA,WAAO,OAAO;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,iBACJ,UACA,YACgD;AAChD,UAAM,UAAU,KAAK,iBAAiB,UAAU,UAAU;AAE1D,QAAI,QAAQ,WAAW,GAAG;AACxB,aAAO,EAAE,SAAS,OAAO,SAAS,wBAAwB;AAAA,IAC5D;AAGA,UAAM,QAAQ,QAAQ,IAAI,CAAC,QAAQ,WAAW;AAAA,MAC5C,OAAO,OAAO,YAAY,UAAU,QAAQ,CAAC;AAAA,MAC7C,aAAa,GAAG,OAAO,WAAW,MAAM;AAAA,MACxC,QAAQ,OAAO,SAAS,MAAM,GAAG,GAAG,IAAI;AAAA,MACxC;AAAA,MACA,QAAQ;AAAA,IACV,EAAE;AAEF,UAAM,WAAW,MAAa,gBAAO,cAAc,OAAO;AAAA,MACxD,aAAa;AAAA,MACb,aAAa;AAAA,IACf,CAAC;AAED,QAAI,CAAC,YAAY,SAAS,WAAW,GAAG;AACtC,aAAO,EAAE,SAAS,OAAO,SAAS,sBAAsB;AAAA,IAC1D;AAEA,UAAM,SAAS,MAAM,KAAK;AAAA,MACxB,SAAS,IAAI,OAAK,EAAE,MAAM;AAAA,MAC1B,EAAE,UAAU,KAAK;AAAA,IACnB;AAEA,WAAO;AAAA,MACL,SAAS,OAAO;AAAA,MAChB,SAAS,WAAW,OAAO,OAAO,aAAa,OAAO,MAAM;AAAA,IAC9D;AAAA,EACF;AACF;AAKO,IAAM,sBAAN,MAAwE;AAAA,EAAxE;AACL,SAAQ,WAAW,oBAAI,IAAoB;AAAA;AAAA,EAE3C,WAAW,KAAa,SAAuB;AAC7C,SAAK,SAAS,IAAI,KAAK,OAAO;AAAA,EAChC;AAAA,EAEA,2BAA2B,KAAyB;AAClD,WAAO,KAAK,SAAS,IAAI,IAAI,SAAS,CAAC,KAAK;AAAA,EAC9C;AACF;;;AC1UA,IAAAC,WAAwB;AAcjB,IAAM,sBAAN,MAAM,oBAAmB;AAAA,EAKtB,YAAY,SAAkC;AACpD,SAAK,UAAU;AAGf,SAAK,WAAW,OAAO;AAAA,EACzB;AAAA,EAEA,OAAO,YAAY,SAAsD;AACvE,QAAI,CAAC,oBAAmB,UAAU;AAChC,0BAAmB,WAAW,IAAI,oBAAmB,OAAO;AAAA,IAC9D;AACA,WAAO,oBAAmB;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,qBAAwC;AACtC,WAAO,KAAK,mBAAmB;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,UAA4C;AAC5D,UAAM,KAAK,YAAY,QAAQ;AAC/B,IAAO,gBAAO;AAAA,MACZ,aAAa,UACT,4DACA;AAAA,IACN;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,uBAAsC;AAC1C,UAAMC,aAAY;AAClB,UAAM,kBAAkB,KAAK,mBAAmB;AAEhD,UAAM,QAAQA,WAAU,IAAI,WAAS;AAAA,MACnC,OAAO,GAAG,KAAK,SAAS,kBAAkB,cAAc,EAAE,GAAG,KAAK,UAAU;AAAA,MAC5E,aAAa,KAAK;AAAA,MAClB,MAAM,KAAK;AAAA,IACb,EAAE;AAEF,UAAM,WAAW,MAAa,gBAAO,cAAc,OAAO;AAAA,MACxD,aAAa,EAAE,QAAQ,gBAAgB;AAAA,IACzC,CAAC;AAED,QAAI,UAAU;AACZ,YAAM,KAAK,YAAY,SAAS,IAAI;AAAA,IACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,OAAgD,WAAmB;AACnF,WAAO,KAAK,gBAAgB,IAAI;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,UACE,UACA,KACQ;AACR,WAAO,EAAE,UAAU,GAAG;AAAA,EACxB;AACF;AA9Ea,oBACI,WAAsC;AADhD,IAAM,qBAAN;AAmFA,SAAS,4BACd,SACA,SACM;AAEN,UAAQ,cAAc;AAAA,IACb,kBAAS,gBAAgB,2BAA2B,MAAM;AAC/D,cAAQ,qBAAqB;AAAA,IAC/B,CAAC;AAAA,EACH;AACF;AAGO,SAAS,sBAAsB,SAAsD;AAC1F,SAAO,mBAAmB,YAAY,OAAO;AAC/C;;;A1BlHA;AAEA,IAAI;AACJ,IAAI;AACJ,IAAI;AACJ,IAAI;AAEG,SAAS,SAAS,SAAkC;AACzD,UAAQ,IAAI,uCAAuC;AAGnD,qBAAmB,IAAI,iBAAiB,QAAQ,cAAc,OAAO;AACrE,qBAAmB,iBAAiB,YAAY,QAAQ,cAAc,OAAO;AAC7E,QAAM,gBAAgB,IAAI,cAAc,OAAO;AAC/C,gBAAc,IAAI,YAAY;AAC9B,iBAAe,IAAI,oBAAoB;AAGvC,kBAAgB,WAAW,OAAO;AAClC,UAAQ,IAAI,8DAA8D;AAG1E,QAAM,qBAAqB,sBAAsB,OAAO;AACxD,8BAA4B,SAAS,kBAAkB;AACvD,UAAQ,IAAI,kCAAkC;AAG9C,UAAQ,cAAc;AAAA,IACb,mBAAU,oCAAoC,eAAe,YAAY;AAAA,IACzE,mBAAU,oCAAoC,eAAe,YAAY;AAAA,EAClF;AAGA,UAAQ,cAAc;AAAA,IACb,gBAAO,4BAA4B,iBAAiB,UAAU,gBAAgB;AAAA,IAC9E,gBAAO,4BAA4B,iBAAiB,UAAU,gBAAgB;AAAA,EACvF;AAGA,QAAMC,YAAoE;AAAA;AAAA,IAExE,EAAE,IAAI,uBAAuB,SAAS,MAAM,iBAAiB,QAAQ,EAAE;AAAA,IACvE,EAAE,IAAI,yBAAyB,SAAS,MAAM,iBAAiB,QAAQ,EAAE;AAAA,IACzE,EAAE,IAAI,wBAAwB,SAAS,MAAM,iBAAiB,SAAS,EAAE;AAAA,IACzE,EAAE,IAAI,8BAA8B,SAAS,MAAa,kBAAS,eAAe,4BAA4B,EAAE;AAAA;AAAA,IAGhH,EAAE,IAAI,mCAAmC,SAAS,MAAM,iBAAiB,oBAAoB,EAAE;AAAA,IAC/F,EAAE,IAAI,6BAA6B,SAAS,MAAM,iBAAiB,kBAAkB,EAAE;AAAA;AAAA,IAGvF;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,UAAU,MAAa,gBAAO;AAAA,UAClC;AAAA,UACA,EAAE,OAAO,KAAK;AAAA,UACd;AAAA,QACF;AAEA,YAAI,YAAY,4BAAQ;AAEtB,gBAAM,cAAc;AAAA,YAClB;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF;AAEA,qBAAW,OAAO,aAAa;AAC7B,kBAAM,QAAQ,YAAY,OAAO,KAAK,MAAS;AAAA,UACjD;AAGA,2BAAiB,qBAAqB;AAEtC,UAAO,gBAAO,uBAAuB,wDAAW;AAAA,QAClD;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA,EAAE,IAAI,qBAAqB,SAAS,MAAa,kBAAS,eAAe,4BAA4B,EAAE;AAAA;AAAA,IAGvG;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,YAAY,CAAC,YAAY,UAAU,aAAa,QAAQ,YAAY;AAC1E,cAAM,WAAW,MAAa,gBAAO,cAAc,WAAW;AAAA,UAC5D,aAAa;AAAA,QACf,CAAC;AACD,YAAI,CAAC;AAAU;AAEf,cAAM,SAAS,MAAa,gBAAO,aAAa;AAAA,UAC9C,QAAQ,qBAAqB,QAAQ;AAAA,UACrC,UAAU;AAAA,UACV,aAAa;AAAA,QACf,CAAC;AACD,YAAI,QAAQ;AACV,gBAAM,cAAc,UAAU,UAAiB,MAAM;AACrD,UAAO,gBAAO,uBAAuB,eAAe,QAAQ,iBAAiB;AAAA,QAC/E;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,YAAY,cAAc,aAAa;AAC7C,cAAM,QAAgC,CAAC;AAEvC,mBAAW,CAAC,UAAU,MAAM,KAAK,OAAO,QAAQ,SAAS,GAAG;AAC1D,qBAAW,SAAS,QAAQ;AAC1B,kBAAM,KAAK;AAAA,cACT,OAAO,MAAM;AAAA,cACb,aAAa;AAAA,cACb,QAAQ,MAAM,gBAAgB,8BAAuB;AAAA,YACvD,CAAC;AAAA,UACH;AAAA,QACF;AAEA,cAAM,WAAW,MAAa,gBAAO,cAAc,OAAO;AAAA,UACxD,aAAa;AAAA,QACf,CAAC;AAED,YAAI,UAAU;AACZ,gBAAM,WAAW,SAAS;AAC1B,gBAAM,SAAS,UAAU,QAAkC;AAC3D,gBAAM,QAAQ,OAAO,KAAK,CAAC,MAAM,EAAE,SAAS,SAAS,KAAK;AAC1D,cAAI,OAAO;AACT,kBAAM,cAAc,kBAAkB,EAAE,UAAU,OAAO,MAAM,GAAG,CAAC;AACnE,YAAO,gBAAO,uBAAuB,eAAe,MAAM,IAAI,EAAE;AAAA,UAClE;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA;AAAA;AAAA,IAKA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,SAAgB,gBAAO;AAC7B,YAAI,CAAC,QAAQ;AACX,UAAO,gBAAO,mBAAmB,kBAAkB;AACnD;AAAA,QACF;AAGA,cAAM,gBAAgB,MAAa,aAAI,UAAU,SAAS;AAC1D,YAAI,CAAC,eAAe;AAClB,UAAO,gBAAO,mBAAmB,oBAAoB;AACrD;AAAA,QACF;AAEA,cAAM,SAAS,MAAM,YAAY,YAAY,OAAO,UAAU,aAAa;AAC3E,YAAI,OAAO,SAAS;AAClB,UAAO,gBAAO,uBAAuB,OAAO,OAAO;AAAA,QACrD,OAAO;AACL,UAAO,gBAAO,iBAAiB,OAAO,OAAO;AAAA,QAC/C;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,SAAgB,gBAAO;AAC7B,YAAI,CAAC,QAAQ;AACX,UAAO,gBAAO,mBAAmB,kBAAkB;AACnD;AAAA,QACF;AAEA,cAAM,YAAY,OAAO;AACzB,cAAM,eAAe,OAAO,SAAS,QAAQ,SAAS;AAEtD,YAAI,CAAC,cAAc;AACjB,UAAO,gBAAO,mBAAmB,kBAAkB;AACnD;AAAA,QACF;AAEA,cAAM,UAAU,MAAa,gBAAO,aAAa;AAAA,UAC/C,QAAQ;AAAA,UACR,OAAO,MAAa,aAAI,UAAU,SAAS;AAAA,QAC7C,CAAC;AAED,YAAI,SAAS;AACX,gBAAM,UAAU,MAAM,gBAAgB;AAAA,YACpC,OAAO;AAAA,YACP;AAAA,YACA;AAAA,YACA,EAAE,cAAc,KAAK;AAAA,UACvB;AAEA,cAAI,SAAS;AACX,YAAO,gBAAO,uBAAuB,4BAA4B;AAAA,UACnE,OAAO;AACL,YAAO,gBAAO,iBAAiB,wBAAwB;AAAA,UACzD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,SAAgB,gBAAO;AAC7B,YAAI,CAAC;AAAQ;AAEb,cAAM,SAAS,MAAa,gBAAO,aAAa;AAAA,UAC9C,QAAQ;AAAA,QACV,CAAC;AACD,YAAI,CAAC;AAAQ;AAEb,cAAM,OAAO,MAAa,aAAI,UAAU,SAAS;AACjD,YAAI,CAAC,MAAM;AACT,UAAO,gBAAO,mBAAmB,oBAAoB;AACrD;AAAA,QACF;AAEA,cAAM,UAAU,MAAM,gBAAgB;AAAA,UACpC,OAAO;AAAA,UACP;AAAA,UACA;AAAA,UACA;AAAA,UACA,EAAE,cAAc,KAAK;AAAA,QACvB;AAEA,YAAI,SAAS;AACX,UAAO,gBAAO,uBAAuB,4BAA4B;AAAA,QACnE,OAAO;AACL,UAAO,gBAAO,iBAAiB,gCAAgC,MAAM,GAAG;AAAA,QAC1E;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,WAAW,8BAA8B;AAAA,IACrF;AAAA,IACA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,YAAY,gDAAgD;AAAA,IACxG;AAAA,IACA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,OAAO,+CAA+C;AAAA,IAClG;AAAA,IACA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,WAAW,0CAA0C;AAAA,IACjG;AAAA,IACA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,YAAY,gDAAgD;AAAA,IACxG;AAAA,IACA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,UAAU,+CAA+C;AAAA,IACrG;AAAA,IACA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM,2BAA2B,QAAQ,+BAA+B;AAAA,IACnF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,SAAgB,gBAAO;AAC7B,cAAM,eAAe,UAAU,CAAC,OAAO,UAAU;AAEjD,cAAM,QAAgC,CAAC;AAEvC,YAAI,cAAc;AAChB,gBAAM,KAAK;AAAA,YACT,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,UACV,CAAC;AACD,gBAAM,KAAK;AAAA,YACT,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,UACV,CAAC;AACD,gBAAM,KAAK;AAAA,YACT,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,UACV,CAAC;AACD,gBAAM,KAAK;AAAA,YACT,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,UACV,CAAC;AAAA,QACH;AAEA,YAAI,QAAQ;AACV,gBAAM,KAAK;AAAA,YACT,OAAO;AAAA,YACP,aAAa,OAAO,SAAS,SAAS,MAAM,OAAO,EAAE,IAAI;AAAA,YACzD,QAAQ;AAAA,UACV,CAAC;AAAA,QACH;AAEA,cAAM,KAAK;AAAA,UACT,OAAO;AAAA,UACP,aAAa;AAAA,UACb,QAAQ;AAAA,QACV,CAAC;AAED,cAAM,KAAK;AAAA,UACT,OAAO;AAAA,UACP,aAAa;AAAA,UACb,QAAQ;AAAA,QACV,CAAC;AACD,cAAM,KAAK;AAAA,UACT,OAAO;AAAA,UACP,aAAa;AAAA,UACb,QAAQ;AAAA,QACV,CAAC;AACD,cAAM,KAAK;AAAA,UACT,OAAO;AAAA,UACP,aAAa;AAAA,UACb,QAAQ;AAAA,QACV,CAAC;AAED,cAAM,WAAW,MAAa,gBAAO,cAAc,OAAO;AAAA,UACxD,aAAa,eAAe,qGAAqB;AAAA,UACjD,oBAAoB;AAAA,UACpB,eAAe;AAAA,QACjB,CAAC;AAED,YAAI,CAAC;AAAU;AAEf,cAAa,kBAAS,eAAe,4BAA4B;AACjE,cAAM,IAAI,QAAQ,CAAAC,aAAW,WAAWA,UAAS,GAAG,CAAC;AAErD,cAAM,QAAQ,SAAS;AAEvB,YAAI,MAAM,SAAS,sCAAQ,GAAG;AAC5B,2BAAiB,YAAY,eAAe;AAAA,QAC9C,WAAW,MAAM,SAAS,sCAAQ,GAAG;AACnC,2BAAiB,YAAY,kBAAkB;AAAA,QACjD,WAAW,gBAAgB,QAAQ;AACjC,gBAAM,eAAe,OAAO,SAAS,QAAQ,OAAO,SAAS;AAC7D,gBAAM,WAAW,OAAO,SAAS;AAEjC,cAAI,cAAc;AAClB,cAAI,MAAM,SAAS,oBAAK;AAAG,0BAAc;AAAA,mBAChC,MAAM,SAAS,cAAI;AAAG,0BAAc;AAAA,mBACpC,MAAM,SAAS,oBAAK;AAAG,0BAAc;AAAA,mBACrC,MAAM,SAAS,UAAK;AAAG,0BAAc;AAAA,mBACrC,MAAM,SAAS,oBAAK;AAAG,0BAAc;AAAA,mBACrC,MAAM,SAAS,0BAAM;AAAG,0BAAc;AAE/C,2BAAiB,YAAY,YAAY,WAAW;AAAA,QAAiB,QAAQ;AAAA,EAAK,YAAY;AAAA,OAAU;AAAA,QAC1G,OAAO;AACL,cAAI,cAAc;AAClB,cAAI,MAAM,SAAS,UAAK;AAAG,0BAAc;AAAA,mBAChC,MAAM,SAAS,oBAAK;AAAG,0BAAc;AAAA,mBACrC,MAAM,SAAS,0BAAM;AAAG,0BAAc;AAE/C,gBAAM,cAAc,MAAa,gBAAO,aAAa;AAAA,YACnD,QAAQ;AAAA,YACR,aAAa;AAAA,UACf,CAAC;AAED,cAAI,aAAa;AACf,6BAAiB,YAAY,YAAY,WAAW,IAAI,WAAW,EAAE;AAAA,UACvE;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,SAAgB,gBAAO;AAC7B,YAAI,CAAC,QAAQ;AACX,UAAO,gBAAO,mBAAmB,kBAAkB;AACnD;AAAA,QACF;AACA,cAAa,kBAAS,eAAe,4BAA4B;AAAA,MACnE;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,OAAO,aAAsB;AAnZ5C;AAoZQ,cAAM,aAAa,cAAY,KAAO,gBAAO,qBAAd,mBAAgC,SAAS,IAAI;AAC5E,YAAI,CAAC,YAAY;AACf,UAAO,gBAAO,mBAAmB,oEAAa;AAC9C;AAAA,QACF;AACA,cAAa,kBAAS,eAAe,4BAA4B;AAEjE,yBAAiB,YAAY,YAAY,UAAU,EAAE;AAAA,MACvD;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,MAAM;AACb,QAAO,kBAAS,eAAe,iCAAiC,aAAa;AAAA,MAC/E;AAAA,IACF;AAAA;AAAA;AAAA,IAKA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,YAAI;AACF,gBAAa,kBAAS,eAAe,4BAA4B;AAAA,QACnE,SAAS,OAAO;AACd,UAAO,gBAAO;AAAA,YACZ;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,EAAE,aAAAC,aAAY,IAAI,MAAM;AAC9B,cAAM,WAAWA,aAAY,YAAY,OAAO;AAChD,cAAM,QAAQ,SAAS,gBAAgB;AAEvC,YAAI,MAAM,WAAW,GAAG;AACtB,UAAO,gBAAO,mBAAmB,+CAAY;AAC7C;AAAA,QACF;AAEA,cAAM,QAAQ,MAAM,IAAI,CAAAC,QAAM;AAAA,UAC5B,OAAO,YAAYA,GAAE,KAAK,IAAI;AAAA,UAC9B,aAAa,QAAQA,GAAE,KAAK,EAAE;AAAA,UAC9B,QAAQA,GAAE,KAAK;AAAA,UACf,QAAQA,GAAE,KAAK;AAAA,QACjB,EAAE;AAEF,cAAM,WAAW,MAAa,gBAAO,cAAc,OAAO;AAAA,UACxD,aAAa;AAAA,UACb,oBAAoB;AAAA,UACpB,eAAe;AAAA,QACjB,CAAC;AAED,YAAI,UAAU;AACZ,gBAAa,kBAAS,eAAe,4BAA4B;AACjE,gBAAM,IAAI,QAAQ,CAAAF,aAAW,WAAWA,UAAS,GAAG,CAAC;AACrD,2BAAiB,YAAY,QAAS,SAAiB,MAAM,EAAE;AAAA,QACjE;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGA;AAAA,MACE,IAAI;AAAA,MACJ,SAAS,YAAY;AACnB,cAAM,OAAO,MAAa,gBAAO,aAAa;AAAA,UAC5C,QAAQ;AAAA,UACR,aAAa;AAAA,UACb,gBAAgB;AAAA,QAClB,CAAC;AAED,YAAI,MAAM;AACR,gBAAa,kBAAS,eAAe,4BAA4B;AACjE,gBAAM,IAAI,QAAQ,CAAAA,aAAW,WAAWA,UAAS,GAAG,CAAC;AACrD,2BAAiB,YAAY,cAAc,IAAI,EAAE;AAAA,QACnD;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAGA,aAAW,OAAOD,WAAU;AAC1B,YAAQ,cAAc,KAAY,kBAAS,gBAAgB,IAAI,IAAI,IAAI,OAAO,CAAC;AAAA,EACjF;AAGA,iBAAe,2BAA2B,QAAgB,QAAgB;AACxE,UAAM,SAAgB,gBAAO;AAC7B,QAAI,CAAC,QAAQ;AACX,MAAO,gBAAO,mBAAmB,gFAAe;AAChD;AAAA,IACF;AAEA,UAAM,YAAY,OAAO;AACzB,UAAM,eAAe,OAAO,SAAS,QAAQ,SAAS;AAEtD,QAAI,CAAC,cAAc;AACjB,MAAO,gBAAO,mBAAmB,oEAAa;AAC9C;AAAA,IACF;AAEA,UAAM,WAAW,OAAO,SAAS;AACjC,UAAM,WAAW,OAAO,SAAS,IAAI;AACrC,UAAM,WAAW,SAAS,MAAM,OAAO,EAAE,IAAI,KAAK;AAElD,UAAM,eAAuC;AAAA,MAC3C,WAAW;AAAA,MACX,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,WAAW;AAAA,MACX,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,gBAAgB;AAAA,IAClB;AAEA,UAAM,eAAe,aAAa,MAAM,KAAK;AAE7C,UAAM,gBAAgB;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,MACN,kBAAkB,CAAC,CAAC,WAAW,QAAQ,UAAU,cAAc,EAAE,SAAS,MAAM;AAAA,IAClF;AAEA,UAAa,kBAAS,eAAe,4BAA4B;AACjE,UAAM,IAAI,QAAQ,CAAAC,aAAW,WAAWA,UAAS,GAAG,CAAC;AAErD,qBAAiB,uBAAuB,cAAc,aAAa;AAEnE,IAAO,gBAAO,uBAAuB,eAAK,YAAY,KAAK;AAAA,EAC7D;AAGA,QAAM,OAAO,QAAQ;AACrB,MAAI,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,YAAY,GAAG;AACtD,qBAAiB,oBAAoB;AAAA,EACvC,WAAW,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,UAAU,GAAG;AAC3D,qBAAiB,kBAAkB;AAAA,EACrC;AAGA,QAAM,gBAAuB,gBAAO,oBAA2B,4BAAmB,OAAO,GAAG;AAC5F,gBAAc,OAAO;AACrB,gBAAc,UAAU;AACxB,gBAAc,UAAU;AACxB,gBAAc,KAAK;AACnB,UAAQ,cAAc,KAAK,aAAa;AAGxC,UAAQ,cAAc;AAAA,IACb,mBAAU;AAAA,MACf,EAAE,SAAS,OAAO;AAAA,MAClB,IAAI,qBAAqB;AAAA,MACzB,EAAE,yBAAyB,qBAAqB,wBAAwB;AAAA,IAC1E;AAAA,EACF;AACF;AAMA,IAAM,uBAAN,MAAgE;AAAA,EAO9D,mBACE,UACA,OACqB;AACrB,QAAI,MAAM;AAAS,aAAO,CAAC;AAE3B,UAAM,UAA+B,CAAC;AAGtC,UAAM,YAAY,IAAW,oBAAW,oBAAoB,wBAAe,QAAQ;AACnF,cAAU,UAAU,EAAE,SAAS,uBAAuB,OAAO,SAAS;AACtE,YAAQ,KAAK,SAAS;AAGtB,UAAM,iBAAiB,IAAW,oBAAW,yBAAyB,wBAAe,QAAQ;AAC7F,mBAAe,UAAU,EAAE,SAAS,4BAA4B,OAAO,cAAc;AACrF,YAAQ,KAAK,cAAc;AAG3B,UAAM,gBAAgB,IAAW,oBAAW,wBAAwB,wBAAe,KAAK;AACxF,kBAAc,UAAU,EAAE,SAAS,2BAA2B,OAAO,aAAa;AAClF,YAAQ,KAAK,aAAa;AAG1B,UAAM,gBAAgB,IAAW,oBAAW,6BAA6B,wBAAe,QAAQ;AAChG,kBAAc,UAAU,EAAE,SAAS,2BAA2B,OAAO,kBAAkB;AACvF,YAAQ,KAAK,aAAa;AAG1B,UAAM,cAAc,IAAW,oBAAW,+BAA+B,wBAAe,QAAQ;AAChG,gBAAY,UAAU,EAAE,SAAS,4BAA4B,OAAO,oBAAoB;AACxF,YAAQ,KAAK,WAAW;AAExB,WAAO;AAAA,EACT;AACF;AA1CM,qBACY,0BAA0B;AAAA,EACjC,wBAAe;AAAA,EACf,wBAAe;AAAA,EACf,wBAAe;AACxB;AAuCK,SAAS,aAAa;AAE3B,kBAAgB,QAAQ;AACxB,UAAQ,IAAI,oCAAoC;AAClD;",
  "names": ["t", "_a", "path", "commands", "vscode", "fs", "path", "exec", "promisify", "execAsync", "vscode", "fs", "path", "TestGenerator", "t", "vscode", "STORAGE_KEY", "t", "vscode", "env", "path", "t", "vscode", "t", "vscode", "finalAnswer", "exec", "t", "path", "vscode", "vscode", "vscode", "vscode", "vscode", "vscode", "lastNewline", "resolve", "path", "fs", "vscode", "vscode", "vscode", "m", "resolve", "vscode", "path", "fs", "vscode", "path", "fs", "vscode", "vscode", "ChatService", "commands", "vscode", "vscode", "path", "fs", "path", "fs", "execSync", "resolve", "vscode", "path", "fs", "import_child_process", "t", "resolve", "module", "STORAGE_KEY", "duration", "fs", "vscode", "_a", "vscode", "path", "indentInfo", "targetIndent", "adjustedCode", "success", "vscode", "languages", "commands", "resolve", "MCPRegistry", "t"]
}
